!function($){var logger=IC_Common.getLogger("ChatPopoutContact");$.widget("AgentConsole.chatPopoutContactPanel",$.AgentConsole.chatContactPanel,{options:{controller:null,resourceBase:"",chatContactCount:0,contact:null,canRoundTopCorners:!1,canRoundBottomCorners:!1,useSecDisposition:!1,reqDisposition:!1,isPopout:""},stopDestroy:!1,transcriptLoaded:!1,intialLoad:!1,chatRef:[],PrimayNotificationSec:9e4,SecondaryNotificationSec:18e4,isResetTimer:!0,contactIndicator:[],isDispositionPnlShow:!1,_init:function(){document.getElementById("renderTextSize")||$('<div id="renderTextSize"/>').addClass("renderTextSize").appendTo("Body"),this.chatStatusLocal={Active:IC_Localization.active,Disconnected:IC_Localization.disconnected}},_create:function(){this.agentLabel=IC_Localization.you,this.clientLabel=IC_Localization.contact,this.systemLabel=IC_Localization.system,this.contactTime=this.options.contact.time,this._contactInfo=this.options.contact,logger.debug("Contact Time on start : "+this.contactTime),this.resourceBase=this.options.resourceBase,this.options.isPopout?this.consoleOptions=this.options.controller.options:this.consoleOptions=this.options.controller.consoleOptions(),this.root=this.createRootPanels(),this.contactIndicatorPanel=$('<div class="contactIndicator"/>').appendTo(this.stateControlsPanel),this.contactIndicatorPanel.indicator({container:this,isContact:!0}),this.contactIndicatorPanel.hide(),this.typingPnl.remove().empty(),this.root.appendTo(this.element),this.postCreate(),this.root.addClass("chatPopoutContact")},postCreate:function(){this.statusColor("Agent")},renderCustomScroll:function(width,height){var that=this,minMessagePnl=parseInt(this.messagePnl.css("min-height"))-20;this.messagePnl.height()>minMessagePnl&&(this.messagePnl.mCustomScrollbar("destroy"),this.messagePnl.mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0,advanced:{autoScrollOnFocus:!1,updateOnContentResize:!0},callbacks:{whileScrolling:function(){that.whileScrolling()}}}),this.isScrollToBottom=!0,!0!==this.loadChatText&&this.messagePnl.mCustomScrollbar("scrollTo","span:last"),this.loadChatText=!1,this.messagePnl.css({height:this.messagePnl.css("min-height")})),IC_Validation.isNullOrEmpty(width)||this.textPnl.css("width",width-90+"px")},loadChatUI:function(status){var contactId=this._contactInfo.id,idToShow=this.options.idToShow,isActive=this._contactInfo.active;if(this.element.addClass("Separator"),!0===isActive&&(IC_Validation.isNullOrEmpty(idToShow)&&"Active"===status||idToShow===contactId)){if(this.options.controller.isChatMessageEditorOverlay(status),this.contentPnl.slideDown(350),this.options.controller.onChatShow(status),this.statePanel.addClass("TopLeftRound TopRightRound"),this.contactControlsPanel.addClass("TopRightRound TopLeftRound"),this.stateControlsPanel.addClass("TopRightRound"),this.controlsPanel.addClass("TopRightRound TopLeftRound"),this.bumberPanelLeft.addClass("TopLeftRound"),this.bumberPanelRight.addClass("TopRightRound"),"Disconnected"===status&&!0===this._contactInfo.finalState)this.closeNotesPanel();else if("Disconnected"===status&&!1===this._contactInfo.finalState){this.chatStatusImg.showfn();var imgURL="/css/images/SFDC-Chat-Icons_r2_c2_trans.png";this.chatStatusDiv.attr("title",IC_Localization.acw),this.chatStatusImg.addClass("ChatStatusAcw"),this.changeButtonState(this.chatStatusDiv,this.chatStatusImg,"unselected",this.resourceBase+imgURL,this.resourceBase+imgURL),this.options.controller.destroyContactResultPanel(!1),this.notesPanelDisplay()}}else this.stateControlsPanel.css("border-right","0px solid #FFFFFF"),this.controlsPanel.css("display","none"),this.leftBumberMouseFlag=!0,this.bumberPanelLeft.showfn(),this.rightArrowPnl.css("display","none"),this.closeNotesPanel(),this.contentPnl.slideUp(350),this.options.controller.onChatHide(),this.bumberPanelLeft.addClass("TopLeftRound BottomLeftRound"),this.stateControlsPanel.addClass("TopRightRound BottomRightRound"),this.bumberPanelRight.addClass("TopRightRound BottomRightRound"),this.contactControlsPanel.addClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound"),this.controlsPanel.addClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound"),this.statePanel.addClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound");this.updateStatePnlHeight(status),$(".ui-dialog-content").dialog("close")},updateStatePnlHeight:function(status){"Active"===status||"Disconnected"===status?this.resizeContentPanel(this.contactIndicatorPanel.indicator("getIndicatorShown")):"Interrupted"===status&&this.resizeContentPanel(!1)},agentIndicatorAction:function(indicator){this.options.controller.agentIndicatorAction(indicator)},notesPanelDisplay:function(){this.options.controller.chatContactCount();this.stateControlsPanel.css("border-right","0px solid #FFFFFF"),"Disconnected"===this._contactInfo.status&&!1===this.isDispositionPnlShow&&!0===this.options.controller.isDisconnectedChat()&&(this.options.controller.isChatMessageEditorOverlay("Disconnected"),this.options.controller.showDispositionPanel(this._contactInfo),this.isDispositionPnlShow=!0)},closeNotesPanel:function(){!0===this.isDispositionPnlShow&&(this.options.controller.hideChatDisposition(),this.isDispositionPnlShow=!1)},statusColor:function(status){"System"===status||"Client"===status||"Agent"===status?(this.bumberPanelLeft.removeClass("BumpPnlLeftGradientIncoming BumpPnlLeftGradientActive BumpPnlLeftGradientHoldDiconnect GradientRed GradientYellow"),this.bumberPanelRight.removeClass("BumpPnlRightGradientIncoming BumpPnlRightGradientActive BumpPnlLeftGradientHoldDiconnect GradientRed GradientYellow")):(this.ctrlPanel.removeClass("ActiveCtrlPanel").removeClass("InterruptCtrlPanel").addClass("InterruptCtrlPanel"),this.stateControlsPanel.removeClass("StatePnlSelected").removeClass("btnDivEnable").addClass("btnDivEnable"),this.contentPnl.removeClass("ActiveCtrlPanel")),IC_Validation.isNotNullOrUndefinedString(this._contactInfo)&&"Disconnected"===this._contactInfo.status?(this.contactStatus.addClass("BumpPnlLeftGradientHoldDiconnect"),this.bumberPanelLeft.addClass("BumpPnlLeftGradientHoldDiconnect"),this.bumberPanelRight.addClass("BumpPnlRightGradientHoldDisconnect"),this._contactInfo.id===this.options.idToShow&&(this.stateControlsPanel.removeClass("btnDivEnable").addClass("StatePnlSelected"),this.ctrlPanel.removeClass("InterruptCtrlPanel").addClass("ActiveCtrlPanel"),this.contentPnl.addClass("ActiveCtrlPanel")),IC_Validation.isNotNullOrUndefinedString(this.patronTypingNotify)&&"block"===this.patronTypingNotify.css("display")&&(this.patronTypingNotify.hide(),this.notificationPointer.hide(),this.renderCustomScroll())):"Active"===status?(this.contactStatus.addClass("BumpPnlLeftGradientActive"),this.stateControlsPanel.removeClass("btnDivEnable").addClass("StatePnlSelected"),this.ctrlPanel.removeClass("InterruptCtrlPanel").addClass("ActiveCtrlPanel"),this.contentPnl.addClass("ActiveCtrlPanel")):"Incoming"===status||"Dialing"===status||"Ringing"===status||"Interrupted"===status?this.contactStatus.addClass("BumpPnlLeftGradientIncoming"):"System"===status?(this.bumberPanelLeft.addClass("GradientRed"),this.bumberPanelRight.addClass("GradientRed"),"Chat"!==this.options.controller.getCurrentSelectedMediaTab()&&this.options.controller.chatIndicateIcon.removeClass("newContactTabIndicate viewedContactTabIndicate").addClass("noReplyNewContact")):"Client"===status?(this.bumberPanelLeft.addClass("GradientYellow"),this.bumberPanelRight.addClass("GradientYellow")):"Agent"===status?(this.bumberPanelLeft.addClass("BumpPnlLeftGradientActive"),this.bumberPanelRight.addClass("BumpPnlRightGradientActive")):(this.contactStatus.addClass("BumpPnlLeftGradientHoldDiconnect"),this.bumberPanelLeft.addClass("BumpPnlLeftGradientHoldDiconnect"),this.bumberPanelRight.addClass("BumpPnlRightGradientHoldDisconnect")),this.options.controller.continueResizeChatPanel()},tooltipScrollBar:function(obj){"block"===obj.css("display")&&(obj.mCustomScrollbar("destroy"),obj.mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0}))},updateContactIndicator:function(contactIndicator){this.contactIndicator=contactIndicator,this.contactIndicatorPanel.indicator("updateData","contactId",this._contactInfo.id),this.contactIndicatorPanel.indicator("updateData","indicator",contactIndicator)},resizeContentPanel:function(showIndicator){!0===showIndicator?"Interrupted"!==this._contactInfo.status&&(this.statePanel.addClass("statePnlLarge"),this.stateControlsPanel.addClass("stateCtrlPnlLarge"),this.bumberPanelLeft.addClass("bumberPnlLeftLarge"),this.bumberPanelRight.addClass("bumberPnlRightLarge"),this.controlsPanel.addClass("ctrlPnlLarge"),this.dropDiv.css({"margin-top":"17px"}),this.transferDiv.css({"margin-top":"17px"}),this.contactIndicatorPanel.showfn()):(this.contactIndicatorPanel.hide(),this.statePanel.removeClass("statePnlLarge"),this.stateControlsPanel.removeClass("stateCtrlPnlLarge"),this.bumberPanelLeft.removeClass("bumberPnlLeftLarge"),this.bumberPanelRight.removeClass("bumberPnlRightLarge"),this.controlsPanel.removeClass("ctrlPnlLarge"),this.dropDiv.css({"margin-top":"11px"}),this.transferDiv.css({"margin-top":"11px"}))},resizeMessagePanel:function(_height){this.messagePnl.css({"min-height":_height+"px"}),this.messagePnl.css({height:_height+"px"})},getChatContPanelHeight:function(){return this.contentPnl.height()},destroy:function(){var that=this,contactId=that._contactInfo.id;!0!==this.stopDestroy&&(this.stopDestroy=!0,setTimeout(function(){logger.trace("ContactID: "+contactId," :contactInfo before"),null!==that._timerLst[that._agentStateTimerId]&&clearInterval(that._timerLst[that._agentStateTimerId]),null!==that._timerLst[that._durationStateTimerId]&&clearInterval(that._timerLst[that._durationStateTimerId]),that.element.slideUp(250,function(){that.options.controller.onContactDestroy(that._contactInfo,that);try{that.statePanel.remove(),that.controlsPanel.remove(),$(that).children().each(function(){IC_Common.discardElement(this)}),that.rootPanel.remove(),that.element.remove()}catch(ex){logger.error("destroy :",ex)}logger.trace("ContactID: "+contactId," :contactInfo after")})},3e3))}})}(jQuery);