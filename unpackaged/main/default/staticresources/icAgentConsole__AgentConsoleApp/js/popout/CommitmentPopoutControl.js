!function($){IC_Common.getLogger("CommitmentPopoutControl");$.widget("AgentConsole.commitmentPopout",{options:{resourceBase:"",record:null,height:250,width:375},_create:function(){document.title=IC_Localization.commitmentReminder;var rootDiv=$('<div class="commitmentReminder brRoundT" />').appendTo(this.element),that=this;this.rootDiv=rootDiv,document.getElementById("renderTextSize")||$('<div id="renderTextSize"/>').addClass("renderTextSize").appendTo("Body"),window.resizeTo(that.options.width,that.options.height);var headerPanel=$('<div class="bgHeaderGradient  header"/>').appendTo(rootDiv);this.headerLogo=$('<div class="logo"></div>').text(IC_Localization.salesforceAgent).appendTo(headerPanel),this.contentPanel=$("<div class='bgBodyGradient contentPanel'>").appendTo(rootDiv);var data=this.options.record;this.namePanel=$("<div class='namePanel'>").appendTo(this.contentPanel),this.pinImage=$("<div class='pinImage'>").appendTo(this.namePanel);var fullName=data.firstName+" "+data.lastName;this.agentName=$("<div class='agentName'>").text(fullName).appendTo(this.namePanel),this.agentPhone=$("<div class='agentPhone'>").text(data.dialNumber).appendTo(this.namePanel),IC_Common.setTextWithEllipsis(this.agentName,fullName,120),IC_Common.setTextWithEllipsis(this.agentPhone,data.dialNumber,120),this.reminderTimeLabelContainer=$("<div class='reminderTimeLabelContainer'>").appendTo(this.contentPanel),this.controlsPanel=$("<div class='controlsPanel'>").appendTo(this.contentPanel),this.proceedBtn=$('<div class="btnDivEnable proceedbtnStyle" id = "proceedbtnID" ></div>').on("click",$.proxy(this.proceesPromiseKeeper,this)).appendTo(this.controlsPanel),proceedBtn=$('<div class="proceedBtn"></div>').appendTo(this.proceedBtn),IC_Common.setTextWithEllipsis(proceedBtn,IC_Localization.proceed,52),this.proceedBtn.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.rescheduleBtn=$('<div class="btnDivEnable rescheduleBtnStyle" id = "rescheduleBtnID" ></div>').on("click",$.proxy(this.reschedulePromiseKeeper,this)).appendTo(this.controlsPanel),rescheduleBtn=$('<div class="rescheduleBtn"></div>').appendTo(this.rescheduleBtn),IC_Common.setTextWithEllipsis(rescheduleBtn,IC_Localization.reschedule,80),this.rescheduleBtn.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),$(window).on("resize",function(){window.resizeTo(that.options.width,that.options.height)}),window.focus(),this.enableAutoScheduleEveneHandlers(),window.destroyReminder=function(){that._closeWindow()}},enableAutoScheduleEveneHandlers:function(){var that=this;$(window).on("beforeunload",function(event){return IC_Localization.commitmentAutoPostpone}),$(window).on("unload",function(event){that._autoReschedule()})},disableAutoScheduleEveneHandlers:function(){$(window).off("beforeunload").off("unload")},_autoReschedule:function(){localStorage.openedCommitmentReminderWindow="",clearInterval(this._runningTimerId),this._isTimerElapsed()||(localStorage.commitmentReminder=JSON.stringify({data:this.options.record,action:"autoReschedule"}))},_remainingTimeinSeconds:120,_runningTimerId:null,startTime:new Date,_init:function(){this.startTime=(new Date).getTime(),delay=Math.round((this.startTime-parseFloat(this.options.record.receivedTime))/1e3),that=this,that._remainingTimeinSeconds-=delay,clearInterval(that._runningTimerId);var remainingTime=that._remainingTimeinSeconds--;function setFormattedTime(remainingTime){var minutes=parseInt(remainingTime/60),seconds=remainingTime%60;minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),that.reminderTimeLabelContainer.text(IC_Localization.commitmentRefusedTime.replace("{0}",minutes).replace("{1}",seconds)),remainingTime<=0&&that._closeWindow()}that._remainingTimeinSeconds<=0?that._closeWindow():(setFormattedTime(that._remainingTimeinSeconds),this._runningTimerId=setInterval(function(){that._remainingTimeinSeconds=remainingTime-Math.ceil(((new Date).getTime()-that.startTime)/1e3),that._remainingTimeinSeconds<=0?(clearInterval(that._runningTimerId),that._closeWindow()):setFormattedTime(that._remainingTimeinSeconds)},1e3))},proceesPromiseKeeper:function(){this._isTimerElapsed()||(localStorage.commitmentReminder=JSON.stringify({data:this.options.record,action:"proceed"})),this._closeWindow()},reschedulePromiseKeeper:function(){this._isTimerElapsed()||(this.options.record._timeout=this._remainingTimeinSeconds,localStorage.commitmentReminder=JSON.stringify({data:this.options.record,action:"reschedule"})),this._closeWindow()},_isTimerElapsed:function(){return(new Date).getTime()-this.options.record.receivedTime>=12e4},_closeWindow:function(){clearInterval(this._runningTimerId),localStorage.openedCommitmentReminderWindow="",this.disableAutoScheduleEveneHandlers(),window.close()}})}(jQuery);