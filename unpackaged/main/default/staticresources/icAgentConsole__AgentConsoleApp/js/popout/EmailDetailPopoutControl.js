!function($){var logger=IC_Common.getLogger("EmailDetailPopout");$.widget("AgentConsole.emailDetailPopoutControl",{options:{controller:null,resourceBase:""},contactInfo:{},resourceBase:"",weekDays:[],isDispositionPnlShow:!1,_init:function(){this.resourceBase=this.options.resourceBase,this.weekDays=[IC_Localization.sun,IC_Localization.mon,IC_Localization.tue,IC_Localization.wed,IC_Localization.thu,IC_Localization.fri,IC_Localization.sat];var bodyTag=$("body"),progressBarDiv=$('<div id="progressBar" class="progressBar"></div>').appendTo(bodyTag);$('<img src="'+this.resourceBase+'/css/images/spinner.gif" />').appendTo(progressBarDiv),$('<div id="overlay"></div>').appendTo(bodyTag)},_create:function(){this.element.append(this._createRootPanels())},persistEmailInfo:{},_createRootPanels:function(){var that=this,resourceBase=this.options.resourceBase;this.rootPanel=$('<div class="ChatPnl"/>'),this.controlsPanel=$('<div class="ControlsPnl" />'),this.dialogPanel=$('<div class="DialogPanel" title="'+IC_Localization.insertHyperLink+'" />').appendTo(this.controlsPanel);var textToDisplay=$('<div class="DialogPanelURLLab" style="width: 81px;"/>');textToDisplay.text(IC_Localization.textToDisplay+": ").appendTo(this.dialogPanel),IC_Common.setTextWithEllipsis(textToDisplay,IC_Localization.textToDisplay+": ",81),this.dialogPanelURLTxt=$('<input type="text" class="DialogPanelURLLab DialogPanelURLTxt" title="'+IC_Localization.textToDisplay+'"/>').appendTo(this.dialogPanel);var hyperlinkAddress=$('<div class="DialogPanelURLLab" style="width: 81px;"/>');hyperlinkAddress.text(IC_Localization.address+": ").appendTo(this.dialogPanel),IC_Common.setTextWithEllipsis(hyperlinkAddress,IC_Localization.address+": ",81),this.dialogPanelURL=$('<input type="text" class="DialogPanelURLLab DialogPanelURLTxt" title="'+IC_Localization.address+'"/>').val("http://").appendTo(this.dialogPanel);var labelOptions={};labelOptions.ok=IC_Localization.ok,labelOptions.cancel=IC_Localization.cancel;var buttonOptions={};buttonOptions[labelOptions.ok]=function(){if(!IC_Validation.isNotNullOrUndefinedString(that.dialogPanelURLTxt.val()))return that.dialogPanelURLTxt.css({border:" 1px solid #FF0000"}),!0;if(that.dialogPanelURLTxt.css({border:" 1px solid #AAAAAA"}),!IC_Validation.isNotNullOrUndefinedString(that.dialogPanelURL.val()))return that.dialogPanelURL.css({border:" 1px solid #FF0000"}),!0;that.dialogPanelURL.css({border:" 1px solid #AAAAAA"});if(!/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(that.dialogPanelURL.val()))return that.dialogPanelURL.css({border:" 1px solid #FF0000"}),!0;that.addHyperlink(that.dialogPanelURLTxt.val(),that.dialogPanelURL.val()),$(this).dialog("close")},buttonOptions[labelOptions.cancel]=function(){$(this).dialog("close")},this.dialogPanel.dialog({autoOpen:!1,resizable:!1,height:160,width:"330px",modal:!0,buttons:buttonOptions,close:function(){that.clearURLTxt()}}),$(".ui-widget-header").addClass("DialogPanelBG"),$(".ui-dialog-title").addClass("DialogPanelTitle"),$(".ui-dialog-buttonpane button").addClass("DialogPanelBut"),$(".ui-widget-content").addClass("DialogPanelFontStyle"),$(".ui-dialog-titlebar-close").attr("title",IC_Localization.close),$(".ui-button-text").addClass("DialogPanelButton"),this.contentPnl=$('<div class="contentPnl" id= "contentPnlDisableOverlay"/>').css("z-index","0"),this.emailPnl=$('<div class="emailPnl" />').appendTo(this.contentPnl),this.emailToolPnl=$('<div class="emailToolPnl btnDivEnable" />').appendTo(this.emailPnl),this.emailEditorPnl=$('<div class="emailEditorPnl" />').appendTo(this.emailPnl),this.emailViewPnl=$('<div class="emailViewPnl" />').appendTo(this.emailPnl),this.emailSelectedViewPnl=$('<div class="emailSelectedViewPnl" />').appendTo(this.emailPnl),this.emailSelectedCountPnl=$('<div class="emailSelectedCountPnl" />').appendTo(this.emailSelectedViewPnl),this.emailSelectedCount=$('<div class="emailSelectedCount" />').appendTo(this.emailSelectedCountPnl),this.emailSelectedCountLb=$('<div class="emailSelectedCountLb" />').text(" "+IC_Localization.emailsSelected).appendTo(this.emailSelectedCountPnl),$('<div class="emailSelectedLine" />').appendTo(this.emailSelectedViewPnl),this.emailSelectedDatePnl=$('<div class="emailSelectedDatePnl" />').appendTo(this.emailSelectedViewPnl),this.emailSelectedDateLb=$('<div class="emailSelectedDateLb" />').text(IC_Localization.dateRange+":").appendTo(this.emailSelectedDatePnl),this.emailSelectedStartDt=$('<div class="emailSelectedStartDt" />').appendTo(this.emailSelectedDatePnl),$('<div style="float: left;" />').text(" - ").appendTo(this.emailSelectedDatePnl),this.emailSelectedEndDt=$('<div class="emailSelectedEndDt" />').appendTo(this.emailSelectedDatePnl),this.emailSelectedSkillsPnl=$('<div class="emailSelectedSkillsPnl" />').appendTo(this.emailSelectedViewPnl),this.emailSelectedSkillsLb=$('<div class="emailSelectedSkillsLb" />').text(IC_Localization.skills+":").appendTo(this.emailSelectedSkillsPnl),this.emailSelectedSkillsList=$('<div class="emailSelectedSkillsList" />').appendTo(this.emailSelectedSkillsPnl),this.emailSelectedViewPnl.hide(),this.quickResp=$('<div class="iconEmailDiv btnDivDisable" id="quickResp"/>').appendTo(this.emailToolPnl),this.quickResp.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.quickRespIcn=$('<img class="icon"/>').attr("src",resourceBase+"/css/images/QuickResp_Disable.png").appendTo(this.quickResp),this.quickResp.attr({title:IC_Localization.quickResponse}),this.quickResp.on("click",function(event){"block"===that.emailTools.css("display")?that.toggleEditorTools($.proxy(that.toggleQuickReply,that)):(that.toolTipPnl.css("width",that.element.width()-260+"px"),that.updateMetaData("quickReply",that.options.controller.getEmailQuickReplyData(that._contactInfo)),that.toggleQuickReply())}),this.attach=$('<div class="iconEmailDiv btnDivDisable"/>').appendTo(this.emailToolPnl),this.attach.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.attachIcn=$('<img class="icon attachIcon" id="attachIcon"/>').attr("src",resourceBase+"/css/images/Attach_Disable.png").appendTo(this.attach),this.attach.attr({title:IC_Localization.attachment}),this.filePicker=$('<input type="file" multiple id="filePicker">').appendTo(this.emailToolPnl),this.attach.on("click",function(event){IC_Common.isButtonEnabled(that.attach)&&that.filePicker.trigger("click")}),this.filePicker.on("change",function(event){that.mailAddressDiv.emailAddressPopoutControl("startNewWorker",event)}),this.filePicker.on("click",function(event){that.clearFileSelection()}),this.tools=$('<div class="iconEmailDiv btnDivDisable"/>').appendTo(this.emailToolPnl),this.tools.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.toolsIcn=$('<img class="icon"/>').attr("src",resourceBase+"/css/images/Editor_Disable.png").appendTo(this.tools),this.tools.attr({title:IC_Localization.tools}),this.tools.on("click",function(event){"block"===that.quiclReplyLstDiv.css("display")?that.toggleQuickReply($.proxy(that.toggleEditorTools,that)):that.toggleEditorTools()}),this.edit=$('<div class="iconEmailDiv btnDivDisable"/>').appendTo(this.emailToolPnl),this.edit.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.editIcn=$('<img class="icon"/>').attr("src",resourceBase+"/css/images/Edit_Disable.png").appendTo(this.edit),this.edit.attr({title:IC_Localization.edit}),this.link=$('<div class="iconEmailDiv btnDivDisable"/>').appendTo(this.emailToolPnl),this.link.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.linkIcn=$('<img class="icon"/>').attr("src",resourceBase+"/css/images/Link_Disable.png").appendTo(this.link),this.link.attr({title:IC_Localization.hyperlink}),this.requeueDiv=$('<div class="iconEmailDiv" id="requeueId"/>').appendTo(this.emailToolPnl).css({display:"none",float:"right"}),this.requeueDiv.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.requeueIcon=$('<img class=""/>').attr("src",resourceBase+"/css/images/requeue.svg").appendTo(this.requeueDiv),this.requeueIcon.css({"margin-top":"4px",width:"28px",height:"28px"}),this.requeueDiv.attr({title:IC_Localization.requeue}),this.replyAction=$("<div />").appendTo(this.emailToolPnl),this.replyArrow=$('<div class="iconEmailResp iconEmailDiv replyAction" id="replyArrowId"/>').appendTo(this.replyAction),this.replyArrow.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.replyArrowIcon=$('<img class="icon"/>').attr("src",resourceBase+"/css/images/drop.png").appendTo(this.replyArrow),this.replyArrow.attr({title:IC_Localization.replyAction}),this.replyArrow.on("mouseleave",function(event){if(IC_Validation.isNotNullOrUndefinedString(event.relatedTarget)&&IC_Validation.isNotNullOrUndefinedString(event.relatedTarget.className)){var relatedTargetClass=event.relatedTarget.className,splitClass=relatedTargetClass.split(" ");"iconEmailReplyDiv"!==splitClass[0]&&"iconEmailDiv"!==splitClass[0]&&"icon"!==relatedTargetClass&&that.mailResp.hide("slide",{direction:"up"},250)}else that.mailResp.hide("slide",{direction:"up"},250)}),this.mailRespAction=$('<div class="iconEmailResp iconEmailDiv reply mailRespAction" cus_op="reply" id="mailRespActionId"/>').appendTo(this.replyAction),this.mailRespAction.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.mailRespIcon=$('<img class="icon"/>').attr("src",resourceBase+"/css/images/reply.png").appendTo(this.mailRespAction),this.mailRespIcon.css({"margin-top":"6px"}),this.mailRespAction.attr({title:IC_Localization.reply}),this.obReplyText=$("<div/>").css({"text-align":"right","padding-right":"2px"}).appendTo(this.mailRespAction),IC_Common.setTextWithEllipsis(this.obReplyText,IC_Localization.reply,55),$('<div class="broderVLine" />').appendTo(this.replyAction),this.discardMail=$('<div class="btnDivEnable discardMailDiv"/>').appendTo(this.replyAction),this.discardMail.css({"padding-top":"1px"}),this.discardMail.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),$('<img class="icon discardMail"/>').attr("src",resourceBase+"/css/images/close.png").appendTo(this.discardMail),this.discardMail.attr({title:IC_Localization.discard}),this.mailResp=$('<div class="mailResp" id = "mailRespId"/>').appendTo(this.replyAction),$('<div class="broderHLine" />').appendTo(this.mailResp),this.reply=$('<div class="iconEmailReplyDiv replyAll" cus_op="reply" id="replyAllId"/>').appendTo(this.mailResp),this.reply.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),$('<img class="iconReplyAll"/>').attr("src",resourceBase+"/css/images/reply.png").appendTo(this.reply);var iconReplyTxt=$("<div/>").addClass("iconReplyTxt");iconReplyTxt.text(IC_Localization.reply).appendTo(this.reply),IC_Common.setTextWithEllipsis(iconReplyTxt,IC_Localization.reply,100),this.reply.attr({title:IC_Localization.reply}),this.reply.hide(),$('<div class="broderHLine" />').appendTo(this.mailResp),this.replyAll=$('<div id="replyAll" class="iconEmailReplyDiv replyAll" cus_op="replyAll" />').appendTo(this.mailResp),this.replyAll.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),$('<img class="iconReplyAll"/>').attr("src",resourceBase+"/css/images/replyall.png").appendTo(this.replyAll);var iconReplyAllTxt=$("<div/>").addClass("iconReplyAllTxt");iconReplyAllTxt.text(IC_Localization.replyAll).appendTo(this.replyAll),IC_Common.setTextWithEllipsis(iconReplyAllTxt,IC_Localization.replyAll,60),this.replyAll.attr({title:IC_Localization.replyAll}),$('<div class="broderHLine" />').appendTo(this.mailResp),this.forward=$('<div class="iconEmailReplyDiv forward" cus_op="forward" id="forwardId"/>').appendTo(this.mailResp),this.forward.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),$('<img class="iconForward"/>').attr("src",resourceBase+"/css/images/forward.png").appendTo(this.forward);var iconForwardTxt=$("<div/>").addClass("iconForwardTxt");return iconForwardTxt.text(IC_Localization.forward).appendTo(this.forward),IC_Common.setTextWithEllipsis(iconForwardTxt,IC_Localization.forward,60),this.forward.attr({title:IC_Localization.forward}),this.mailAddressDiv=$('<div class = "mailAddressDiv" />').emailAddressPopoutControl({controller:this,resourceBase:resourceBase}),this.toolTipPnl=$('<div id="tooltipID" class="tooltipStyle"/>'),this.toolTipPnl.hoverfn(function(event){that.toolTipPnl.showfn(),that.tooltipScrollBar(that.toolTipPnl)},function(){that.toolTipPnl.hide()}),this.quiclReplyLstDiv=$('<div class = "quickReplyDiv" id="quickReplyLstDiv" />').quickReplyPopoutControl({controller:this,resourceBase:resourceBase}),$('<div class="broderHLine" />').appendTo(this.mailResp),this.mailResp.hide(),this.mailResp.on("mouseleave",function(){that.mailResp.hide("slide",{direction:"up"},250)}),this.mailRespAction.on("mouseleave",function(event){if(IC_Validation.isNotNullOrUndefinedString(event.relatedTarget)){var relatedTargetClass=event.relatedTarget.className;if(IC_Validation.isNotNullOrUndefinedString(relatedTargetClass))"iconEmailReplyDiv"!==relatedTargetClass.split(" ")[0]&&that.mailResp.hide("slide",{direction:"up"},250);else that.mailResp.hide("slide",{direction:"up"},250)}}),this.link.on("click",function(){IC_Common.isButtonEnabled(that.link)&&(that.link.addClass("btnDivSelect"),that.dialogPanel.dialog("open"))}),this.mailRespAction.on("click",$.proxy(this.setMailContent,this)),this.discardMail.on("click",$.proxy(this.showEmailViewPanel,this)),this.replyAll.on("click",$.proxy(this.setMailContent,this)),this.forward.on("click",$.proxy(this.setMailContent,this)),this.reply.on("click",$.proxy(this.setMailContent,this)),this.replyArrow.on("click",$.proxy(this.showReplyAction,this)),this.requeueDiv.on("click",$.proxy(this.emailRequeue,this)),this.emailEditor=$('<textarea id="emailEditor" class="emailEditor" />').appendTo(this.emailEditorPnl),this.emailTools=$("<span>"),this.rootPanel.append(this.controlsPanel).append(this.contentPnl),this.rootPanel},showToolsOnLoad:function(){!1===IC_Validation.isNullOrEmpty(this.persistEmailInfo.tools)&&"show"==this.persistEmailInfo.tools&&this.emailTools.showfn()},showSelectedParkedEmailsRange:function(selectedContacts){this.clearSelectedParkedEmailsRange(),this.emailSelectedViewPnl.showfn();var contactTimes=[],uniqueSkillNames=[];$.grep(selectedContacts,function(contact){contactTimes.push(new Date(contact.time).getTime())});var rangeStartDate=Math.min.apply(null,contactTimes),rangeEndDate=Math.max.apply(null,contactTimes);$.grep(selectedContacts,function(contact){-1==uniqueSkillNames.indexOf(contact.skillName)&&uniqueSkillNames.push(contact.skillName)}),this.emailSelectedCount.text(selectedContacts.length);for(var i=0,length=uniqueSkillNames.length;i<length;i++)$('<div class="skillName" />').text(uniqueSkillNames[i]).appendTo(this.emailSelectedSkillsList);function pad(n){return n<10?"0"+n:n}var sWeekDay=this.weekDays[new Date(rangeStartDate).getDay()],eWeekDay=this.weekDays[new Date(rangeEndDate).getDay()],sDay=pad(new Date(rangeStartDate).getDate()),eDay=pad(new Date(rangeEndDate).getDate()),sMonth=pad(new Date(rangeStartDate).getMonth()+1),eMonth=pad(new Date(rangeEndDate).getMonth()+1);this.emailSelectedStartDt.text(sWeekDay+". "+sDay+"/"+sMonth),this.emailSelectedEndDt.text(eWeekDay+". "+eDay+"/"+eMonth)},clearSelectedParkedEmailsRange:function(){this.emailSelectedCount.text(""),this.emailSelectedSkillsList.empty(),this.emailSelectedStartDt.text(""),this.emailSelectedEndDt.text(""),this.emailSelectedViewPnl.hide()},requeueToggle:function(isVisible){this.requeueDiv.toggle(isVisible),this.replyAction.toggle(!isVisible),!1===this._contactInfo.isInbound&&this.replyAction.toggle(!1)},emailRequeue:function(){this.options.controller.emailRequeue()},clearPreviewContent:function(){this.emailViewPnl.empty(),this.contentPnl.hide()},clearURLTxt:function(){this.link.removeClass("btnDivSelect"),this.dialogPanelURL.val("http://"),this.dialogPanelURLTxt.val(""),this.dialogPanelURL.css({border:" 1px solid #AAAAAA"}),this.dialogPanelURLTxt.css({border:" 1px solid #AAAAAA"})},showReplyAction:function(){this.mailResp.css({left:this.replyArrow.offset().left-245+"px",top:"56px"}),this.mailResp.toggle("slide",{direction:"up"},250)},addHyperlink:function(txt,url){tinymce.execCommand("mceInsertContent",!1,"<a href='"+url+"'>"+txt+"</a>"),this.clearURLTxt()},mailResponse:function(mailRespAction){this.persistEmailInfo.action=mailRespAction,this.setEmailPersist(),"outbound"===mailRespAction?this.replyAction.hide():(this.reply.hide(),this.replyAll.hide(),this.forward.hide(),this.replyArrow.hide(),this.mailRespAction.hide(),this.replyAction.showfn(),this.discardMail.showfn())},persistMailContent:function(){this.persistEmailInfo.content=$($($("#emailEditor_ifr").contents()).find("body")).html(),this.setEmailPersist()},loadEmailEditorUI:function(){var that=this,buttons=$("[role=button]",that.rootPanel);this.emailTools=$(".mce-toolbar-grp.mce-container.mce-panel.mce-first.mce-stack-layout-item",that.rootPanel),this.emailTools.on("mouseup",function(){setTimeout(function(){that.persistMailContent()},100)}),$($(buttons[2]).children()[0]).empty(),$($(buttons[2]).children()[0]).append($("<img/>").attr("src",this.resourceBase+"/css/images/mailtoolbar/bold.png")),$($(buttons[3]).children()[0]).empty(),$($(buttons[3]).children()[0]).append($("<img/>").attr("src",this.resourceBase+"/css/images/mailtoolbar/italic.png")),$($(buttons[4]).children()[0]).empty(),$($(buttons[4]).children()[0]).append($("<img/>").attr("src",this.resourceBase+"/css/images/mailtoolbar/underline.png")),$($(buttons[5]).children()[0]).empty(),$($(buttons[5]).children()[0]).append($("<img/>").attr("src",this.resourceBase+"/css/images/mailtoolbar/left.png")),$(buttons[5]).on("click",function(){var selectedNodes=that.emailTinyMceEditor.selection.getSelectedBlocks();$.each(selectedNodes,function(i,selectedNode){"DIV"==selectedNode.tagName?"LI"==(selectedNode=selectedNode.parentNode).tagName&&(selectedNode.className="left",$(selectedNode).css("text-align","left")):"LI"==selectedNode.tagName&&(selectedNode.className="left",$(selectedNode).css("text-align","left"))})}),$($(buttons[6]).children()[0]).empty(),$($(buttons[6]).children()[0]).append($("<img/>").attr("src",this.resourceBase+"/css/images/mailtoolbar/center.png")),$(buttons[6]).on("click",function(){var selectedNodes=that.emailTinyMceEditor.selection.getSelectedBlocks();$.each(selectedNodes,function(i,selectedNode){"DIV"==selectedNode.tagName?"LI"==(selectedNode=selectedNode.parentNode).tagName&&(selectedNode.className="center",$(selectedNode).css("text-align","center")):"LI"==selectedNode.tagName&&(selectedNode.className="center",$(selectedNode).css("text-align","center"))})}),$($(buttons[7]).children()[0]).empty(),$($(buttons[7]).children()[0]).append($("<img/>").attr("src",this.resourceBase+"/css/images/mailtoolbar/right.png")),$(buttons[7]).on("click",function(){var selectedNodes=that.emailTinyMceEditor.selection.getSelectedBlocks();$.each(selectedNodes,function(i,selectedNode){"DIV"==selectedNode.tagName?"LI"==(selectedNode=selectedNode.parentNode).tagName&&(selectedNode.className="right",$(selectedNode).css("text-align","right")):"LI"==selectedNode.tagName&&(selectedNode.className="right",$(selectedNode).css("text-align","right"))})}),$($(buttons[8]).children()[0]).empty(),$($(buttons[8]).children()[0]).append($("<img/>").attr("src",this.resourceBase+"/css/images/mailtoolbar/justify.png")),$(buttons[8]).on("click",function(){var selectedNodes=that.emailTinyMceEditor.selection.getSelectedBlocks();$.each(selectedNodes,function(i,selectedNode){"DIV"==selectedNode.tagName?"LI"==(selectedNode=selectedNode.parentNode).tagName&&(selectedNode.className="justify",$(selectedNode).css("text-align","justify")):"LI"==selectedNode.tagName&&(selectedNode.className="justify",$(selectedNode).css("text-align","justify"))})}),$($(buttons[9]).children()[0]).empty(),$($(buttons[9]).children()[0]).append($("<img/>").attr("src",this.resourceBase+"/css/images/mailtoolbar/ul.png")),$($(buttons[10]).children()[0]).find("i").replaceWith($("<img/>").attr("src",this.resourceBase+"/css/images/mailtoolbar/FontColor.png")),$($(buttons[11]).children()[0]).find("i").replaceWith($("<img/>").attr("src",this.resourceBase+"/css/images/mailtoolbar/Highlight.png")),$($(".mce-container-body.mce-stack-layout",that.rootPanel).first().children()[0]).after(this.mailAddressDiv),$($(".mce-container-body.mce-stack-layout",that.rootPanel).first().children()[0]).after(that.toolTipPnl).css("margin-left","0px"),$($(".mce-container-body.mce-stack-layout",that.rootPanel).first().children()[0]).after(that.quiclReplyLstDiv),$("#emailEditor_ifr").addClass("emailEditor_iframe"),$($($("#emailEditor_ifr").contents()).find("body")).css({"word-wrap":"break-word",overflow:"hidden",margin:"1px",padding:"7px",outline:"1px solid #B8B8B8","min-height":"110px"}),$($($("#emailEditor_ifr").contents()).find("body")).on("keyup",function(){$("#emailEditor_ifr").height($($($("#emailEditor_ifr").contents()).find("body")).height()+20),that.persistMailContent()}),$($($("#emailEditor_ifr").contents()).find("body")).on("keypress",function(){$("#emailEditor_ifr").height($($($("#emailEditor_ifr").contents()).find("body")).height()+20)});var iframeDoc=$("#emailEditor_ifr").contents().get(0);$(iframeDoc).on("click",function(){$("#emailEditor_ifr").contents().find("body").trigger("focus")}),$(".addressFields").on("mouseenter",function(){$(this).addClass("userselectable")}),$(".addressFields").on("mouseleave",function(){$(this).removeClass("userselectable")})},loadEmailContentinEditor:function(mode){var bodyHtml=this._contactInfo.bodyHTML||this.getEmailPlainText(),content="",respStr="";if(IC_Validation.isNotNullOrUndefinedString(this.persistEmailInfo)&&IC_Validation.isNotNullOrUndefinedString(this.persistEmailInfo.content))content=this.persistEmailInfo.content;else if(!0===this._contactInfo.isInbound){if("draft"!==mode&&(respStr="<div><br/></div><div><div class='addressFields' style='border:none;border-top:solid #C7C7C7 1.0pt;padding:3.0pt 0in 0in 0in'><p style='white-space:normal;'><b><span style='font-size:10.0pt;font-family:\"Tahoma\",\"sans-serif\"'>"+IC_Localization.from+':</span></b><span style=\'font-size:10.0pt;font-family:"Tahoma","sans-serif"\'> {0} <br><b>'+IC_Localization.sent+":</b>{1}<br><b>"+IC_Localization.to+":</b> {2}<br>",IC_Validation.isNotNullOrEmpty(this._contactInfo.ccAddress)&&(respStr=respStr+"<b>"+IC_Localization.cc+":</b> "+this._contactInfo.ccAddress+"<br>"),respStr=(respStr=respStr+"<b>"+IC_Localization.subject+":</b> {3}<o:p></o:p></span></p></div></div><br/>").replace("{0}",this._contactInfo.fromAddress).replace("{1}",IC_Common.getAMPMLocale(new Date(this._contactInfo.sentDate).format(this.options.controller.options.localeDateTimeFormat),this.options.controller.options.localeCode)).replace("{2}",this._contactInfo.toAddress).replace("{3}",this._contactInfo.subject)),/<body /i.test(bodyHtml)){var i=bodyHtml.indexOf("<body");i+=bodyHtml.substring(i).indexOf(">"),bodyHtml=bodyHtml.substring(0,i)+bodyHtml.substring(i).replace(">",">"+respStr)}else bodyHtml="<html><body>"+respStr+bodyHtml+"</body></html>";for(var key in this.inlineCss)if(this.inlineCss.hasOwnProperty(key)){var regex=new RegExp("class="+key,"g");bodyHtml=bodyHtml.replace(regex,"style='"+this.inlineCss[key]+"'")}content=this.bodyHtml=bodyHtml.replace(/\\n/g,"").replace(/\\/g,"")}this.emailTinyMceEditor&&this.emailTinyMceEditor.setContent(content),"Parked"==this._contactInfo.status&&this._contactInfo.isDraft&&this.emailTinyMceEditor&&this.emailTinyMceEditor.getBody().setAttribute("contenteditable",!1)},setEmailPersist:function(){"Active"==this._contactInfo.status&&(this.persistEmailInfo.id=this._contactInfo.id,this.options.controller.setPersistEmailInfo(this.persistEmailInfo))},getEmailPlainText:function(){return(this._contactInfo.body||"").replace(/\\n/g,"<br>")},getEmailPersist:function(){this.persistEmailInfo=this.options.controller.getPersistEmailInfo(this._contactInfo.id)||{id:this._contactInfo.id},this._contactInfo.isDraft&&(this.persistEmailInfo.action="draft")},clearEmailPersist:function(){this.persistEmailInfo={},this.setEmailPersist()},showEmailViewPanel:function(){this._contactInfo.isDraft&&this.options.controller.emailRestore(this._contactInfo.id),this.emailType="",this.mailAddressDiv.emailAddressPopoutControl("updateView",this.emailType),this.clearEmailPersist(),this.showEmail()},showEmailEditor:function(mode){var that=this;!0!==this.editorCreated?(this.editorCreated=!0,setTimeout(function(){that.createEmailEditor(mode)},0)):this.loadEmailContentinEditor(mode)},toggleEmailPanelButtons:function(toolBarIconsState){this.changeButtonState(this.link,this.linkIcn,toolBarIconsState,this.resourceBase+"/css/images/Link.png",this.resourceBase+"/css/images/Link_Disable.png"),this.changeButtonState(this.edit,this.editIcn,toolBarIconsState,this.resourceBase+"/css/images/Edit.png",this.resourceBase+"/css/images/Edit_Disable.png"),this.changeButtonState(this.tools,this.toolsIcn,toolBarIconsState,this.resourceBase+"/css/images/Editor.png",this.resourceBase+"/css/images/Editor_Disable.png"),this.changeButtonState(this.attach,this.attachIcn,toolBarIconsState,this.resourceBase+"/css/images/Attach.png",this.resourceBase+"/css/images/Attach_Disable.png"),this.changeButtonState(this.quickResp,this.quickRespIcn,toolBarIconsState,this.resourceBase+"/css/images/QuickResp.png",this.resourceBase+"/css/images/QuickResp_Disable.png")},changeButtonState:function(div,img,state,iconEnabled,iconDisabled){"enabled"===(state=state||"disabled")?IC_Common.enableButton(div,img,iconEnabled):"disabled"===state?IC_Common.disableButton(div,img,iconDisabled):"selected"===state?IC_Common.selectButton(div,img,iconEnabled):"unselected"===state&&IC_Common.unselectButton(div,img,iconEnabled)},showEmail:function(){this.emailViewPnl.empty(),this.emailViewPnl.stop(!0,!0).fadeIn("slow"),this.emailEditorPnl.hide(),this.mailRespAction.showfn(),this.replyAll.showfn(),this.forward.showfn(),this.replyArrow.showfn(),this.reply.hide(),this.discardMail.hide(),this.toggleEmailPanelButtons("disabled"),this.emailViewPnl.css("width","100%"),this.mailViewAddress=$("<div id = 'mailViewAddressId' class='mailViewLabels' />"),this.mailView=$("<div style='background-color:#FFFFFF' >").appendTo(this.emailViewPnl);var mailViewFromDIV=$("<div class='mailViewFromDIV' />"),mailViewFrom=($("<div  class='mailViewLabel' />").text(IC_Localization.from+": ").appendTo(mailViewFromDIV),$("<div class='mailViewDetail'/>").appendTo(mailViewFromDIV)),mailViewToDIV=$("<div class='mailViewToDIV' />"),mailViewCCDIV=($("<div class='mailViewLabel' />").text(IC_Localization.to+": ").appendTo(mailViewToDIV),$("<div class='mailViewCCDIV' />")),mailViewCC=($("<div class='mailViewLabel' />").text(IC_Localization.cc+": ").appendTo(mailViewCCDIV),$("<div class='mailViewDetail' id='mailViewCCId'/>").appendTo(mailViewCCDIV)),mailViewSentDateDIV=$("<div class='mailViewSentDateDiv'/>"),mailViewSentDate=($("<div class='mailViewLabel' />").text(IC_Localization.sent+": ").appendTo(mailViewSentDateDIV),$("<div id = 'mailViewPopoutSentDateId' class='mailViewSentDate'/>").appendTo(mailViewSentDateDIV)),mailViewAttachmentsDIV=$("<div id = 'mailViewAttachmentsDIV' class='mailViewAttachmentsDiv'/>"),mailViewSubjectLine=($('<img src = "'+this.options.resourceBase+'/css/images/Attach.png" class="mailViewAttachIcon" />').appendTo(mailViewAttachmentsDIV),$("<div class='HLine'/>")),mailViewSubjectDiv=$("<div class='mailViewSubjectDiv' />"),mailViewSubject=($("<div class='mailViewSubLabel'>"+IC_Localization.subject+": </div>").appendTo(mailViewSubjectDiv),$("<div class='mailViewSubject'></div>").appendTo(mailViewSubjectDiv)),mailViewEmailLine=$("<div class='HLine'/>");this.mailViewAttachments=$("<div id = 'mailViewAttachmentsId' class='mailViewAttachmentDetail'/>").appendTo(mailViewAttachmentsDIV),this.mailViewTo=$("<div class='mailViewDetail mailViewTo'/>").appendTo(mailViewToDIV),this.mailViewToContent=$("<div class='mailViewToContent'/>").appendTo(this.mailViewTo),this.mailViewAddress.appendTo(this.mailView),mailViewFromDIV.appendTo(this.mailViewAddress),mailViewToDIV.appendTo(this.mailViewAddress),mailViewCCDIV.appendTo(this.mailViewAddress),mailViewSentDateDIV.appendTo(this.mailViewAddress),mailViewAttachmentsDIV.appendTo(this.mailViewAddress),mailViewSubjectLine.appendTo(this.mailViewAddress),mailViewSubjectDiv.appendTo(this.mailViewAddress),mailViewEmailLine.appendTo(this.mailViewAddress),this.mailViewEmailDiv=$("<div class='mailViewEmailDiv'/>").appendTo(this.mailView),this.mailViewEmailContent=$("<div />").appendTo(this.mailViewEmailDiv),mailViewFrom.text(this._contactInfo.fromAddress),IC_Common.setTextWithEllipsis(this.mailViewToContent,this._contactInfo.toAddress,this.emailPnl.width()-60),IC_Validation.isNotNullOrEmpty(this._contactInfo.ccAddress)?(mailViewCCDIV.showfn(),IC_Common.setTextWithEllipsis(mailViewCC,this._contactInfo.ccAddress,this.emailPnl.width()-60)):mailViewCCDIV.hide(),mailViewSentDate.text(IC_Common.getAMPMLocale(new Date(this._contactInfo.sentDate).format(this.options.controller.options.localeDateTimeFormat),this.options.controller.options.localeCode)),IC_Validation.isNotNullOrEmpty(this._contactInfo.attachments)?(mailViewAttachmentsDIV.showfn(),this.formAttachments(this._contactInfo.attachments)):mailViewAttachmentsDIV.hide(),IC_Common.setTextWithEllipsis(mailViewSubject,this._contactInfo.subject,this.emailPnl.width()-100,!0);var emailBody=this._contactInfo.bodyHTML||this.getEmailPlainText();for(var key in this.inlineCss)this.inlineCss.hasOwnProperty(key)&&(this.inlineCss[key]=this.getIBMailCss(key,emailBody));for(var key in this.inlineCss)if(this.inlineCss.hasOwnProperty(key)){var regex=new RegExp("class="+key,"g");emailBody=emailBody.replace(regex,"style='"+this.inlineCss[key]+"'")}this.mailViewEmailContent.html(emailBody.replace(/\\n/g,"").replace(/\\/g,"")),$(window).trigger("resize")},_showOverlay:function(){$("#overlay").addClass("overlay"),$("#agentConsolePopoutContainer").addClass("disableContainer"),$("input",this.mailAddressDiv).trigger("blur"),$("input",this.mailAddressDiv).each(function(index,element){$(element).prop("disabled",!0)}),this.emailTinyMceEditor&&this.emailTinyMceEditor.getBody().setAttribute("contenteditable",!1)},_hideOverlay:function(){$("input",this.mailAddressDiv).each(function(index,element){$(element).prop("disabled",!1)}),this.emailTinyMceEditor&&this.emailTinyMceEditor.getBody().setAttribute("contenteditable",!0),$("#overlay").removeClass("overlay")},formAttachments:function(attachments){for(var attachmentsList=attachments.split("|"),i=0;i<attachmentsList.length;i++){var attachmentName=attachmentsList[i].split("\\")[attachmentsList[i].split("\\").length-1],fileExtClass="disabled",fileExtn=attachmentName.lastIndexOf("."),str=attachmentName.substring(fileExtn,attachmentName.length),newDiv=$("<div id ='newDivId' class='mailViewAttachments'></div>").appendTo(this.mailViewAttachments);if(IC_Validation.isNotNullOrEmptyArray(this.attachmentExtn))for(var j=0;j<this.attachmentExtn.length;j++)if(this.attachmentExtn[j].toLowerCase()===str.toLowerCase()){fileExtClass="enabled";break}var attachment=$('<a href="#" cus_fileName = "'+attachmentsList[i]+'" class="'+fileExtClass+'">'+attachmentName+"</a>").appendTo(newDiv);$('<img src = "'+this.options.resourceBase+'/css/images/spinner.gif" class="loadingAttachment" cus_attach="'+attachmentName+'"/>').appendTo(newDiv).hide(),newDiv.append(";"),attachment.on("click",$.proxy(this.downloadFile,this))}},downloadFile:function(event){var fileNameWithPath=event.target.attributes.cus_fileName.value,fileName=fileNameWithPath.split("\\")[fileNameWithPath.split("\\").length-1];if("disabled"!==event.currentTarget.className){var loadImg=$('img[cus_attach="'+fileName+'"]');loadImg.showfn(),this.options.controller.getAttachmentFiles(fileNameWithPath,function(data){for(var byteString=atob(data.files.file),ab=new ArrayBuffer(byteString.length),ia=new Uint8Array(ab),i=0;i<byteString.length;i++)ia[i]=byteString.charCodeAt(i);loadImg.hide();var blob=new Blob([ia],{type:"application/octet-stream"});saveAs(blob,fileName)})}},createEmailEditor:function(mode){var that=this;tinymce.init({plugins:"textcolor paste code",convert_fonts_to_spans:!1,mode:"specific_textareas",editor_selector:"emailEditor",menubar:!1,toolbar:["fontselect fontsizeselect bold italic underline alignleft aligncenter alignright alignjustify bullist forecolor backcolor"],statusbar:!1,content_css:that.resourceBase+"/css/EmailEditor.css",fontsize_formats:"8=8pt 9=9pt 10=10pt 11=11pt 12=12pt 14=14pt 16=16pt 18=18pt 20=20pt 22=22pt 24=24pt 26=26pt 28=28pt 36=36pt 48=48pt 72=72pt",font_formats:"_sans=_sans;_serif=_serif;_typewriter=_typewriter;Arial=Arial;Courier=Courier;Courier New=Courier New;Geneva=Geneva;Georgia=Georgia;Helvetica=Helvetica;Times New Roman=Times New Roman;Times=Times;Verdana=Verdana",setup:function(ed){ed.on("init",function(){this.getDoc().body.style.font="8pt verdana",$(".mce-toolbar-grp.mce-container.mce-panel.mce-first.mce-stack-layout-item",that.rootPanel).hide(),that.emailTinyMceEditor=ed,that.loadEmailEditorUI(),that.loadEmailContentinEditor(mode),that.mailAddressDiv.emailAddressPopoutControl("resizeWidget")}),ed.on("keydown",function(){if("Active"!==that._contactInfo.status)return!1})},paste_preprocess:function(plugin,args){args.content&&/<(\"[^\"]*\"|'[^']*'|[^'\">])*>/.test(args.content)&&(args.content+="<br>")}})},setMailContent:function(event){this.emailViewPnl.hide(),this.emailEditorPnl.fadeIn("slow"),"Discarded"!==this._contactInfo.status&&this.mailAddressDiv.emailAddressPopoutControl("resetAttachmentVariables"),this.toggleEmailPanelButtons("enabled"),this.discardMail.showfn(),this.mailResp.hide();var currEmailType=this.emailType;event&&(this.emailType=currEmailType=event.currentTarget.attributes.cus_op.value),this.mailResponse(currEmailType),this.showEmailEditor(currEmailType),"forward"!==currEmailType&&"draft"!==currEmailType||IC_Validation.isNotNullOrEmpty(this._contactInfo.attachments)&&this.getAttachmentsIB(this._contactInfo.attachments),this.mailAddressDiv.emailAddressPopoutControl("updateView",this.emailType)},getAttachmentsIB:function(attachments){var splitAttachments=attachments.split("|"),that=this;this.mailAddressDiv.emailAddressPopoutControl("showInboundAttachments",splitAttachments),$.each(splitAttachments,function(i,fileServerPath){that.options.controller.getAttachmentFiles(fileServerPath,function(res){i==splitAttachments.length-1?that.mailAddressDiv.emailAddressPopoutControl("addInboundAttachmentContent",res.files.fileName,res.files.file,that.emailType):that.mailAddressDiv.emailAddressPopoutControl("addInboundAttachmentContent",res.files.fileName,res.files.file)})})},getIBMailCss:function(cssName,content){var cssIndex=content.indexOf(cssName),cssStartIndex=content.indexOf("{",cssIndex),cssEndIndex=content.indexOf("}",cssStartIndex);return content=content.substring(cssStartIndex+1,cssEndIndex).replace(/\\n/g,"").replace(/\\t/g,"").replace(/\\/g,"")},getMailContent:function(){var emailBody=$($($("#emailEditor_ifr").contents()).find("body")).html(),emailText=$($($("#emailEditor_ifr").contents()).find("body")).text(),that=this;!0===this._contactInfo.isInbound&&(emailBody="<div>"+emailBody+"</div>");var addr=this.mailAddressDiv.emailAddressPopoutControl("getEmailAddress",!0),attachments=this.mailAddressDiv.emailAddressPopoutControl("getAttachmentContentList"),attachmentNames=this.mailAddressDiv.emailAddressPopoutControl("getAttachmentNamesList");if(!0!==addr.isError){this.emailType=addr.emailType;var emailContent={contactId:this._contactInfo.id,skillId:this._contactInfo.skillId,toAddress:addr.to,fromAddress:this._contactInfo.emailFromAddress,ccAddress:addr.cc,bccAddress:addr.bcc,subject:addr.sub,bodyHtml:emailBody,attachments:attachments,attachmentNames:attachmentNames};IC_Validation.isNullOrEmpty(emailText)&&IC_Validation.isNullOrEmpty(addr.sub)?this.options.controller.showConfirmationPrompt(IC_Localization.alertMessageSendMail1,function(){that.sendMail(emailContent,that.emailType)},function(){that.mailAddressDiv.emailAddressPopoutControl("setSendIconClicked",!1)}):IC_Validation.isNullOrEmpty(addr.sub)?this.options.controller.showConfirmationPrompt(IC_Localization.alertMessageSendMail2,function(){that.sendMail(emailContent,that.emailType)},function(){that.mailAddressDiv.emailAddressPopoutControl("setSendIconClicked",!1)}):(this.sendMail(emailContent,this.emailType),this.mailAddressDiv.emailAddressPopoutControl("setSendIconClicked",!0))}else this.mailAddressDiv.emailAddressPopoutControl("setSendIconClicked",!1)},sendMail:function(emailContent,emailType){var that=this;this.options.controller.sendEmail(emailContent,this.emailType,function(res){that.mailSentAction(res)})},mailSentAction:function(res){this.mailAddressDiv.emailAddressPopoutControl("setSendIconClicked",res)},renderCustomScroll:function(_width,_height){var emailViewPnlHeight,emailContentHeight,emailToolPnl,height=this.emailPnl.height(),viewAddressHeight=84,contactResultsNotesPanelHeight=this.options.controller.elements.ContactResultsNotesPanel?this.options.controller.elements.ContactResultsNotesPanel.height():0,mailViewAddress=0,parkedEmailHeight=0;(0!==this.emailPnlheight&&(height=this.emailPnlheight),emailViewPnlHeight=height-56-contactResultsNotesPanelHeight,this.emailViewPnl.css({height:emailViewPnlHeight+2+"px"}),"block"===$(".mailViewAttachmentsDiv").css("display"))&&(viewAddressHeight+=$(".mailViewAttachmentsDiv").height());var status=this._contactInfo.status;this._contactInfo.isInbound&&"Interrupted"!=status&&this.mailViewEmailContent&&this.mailViewTo&&(IC_Validation.isNotNull(this.mailViewToContent)&&this.mailViewToContent.height()>35?this.mailViewTo.css({"overflow-y":"scroll",height:"34px"}):this.mailViewTo.css({"overflow-y":"hidden",height:"auto"}),emailContentHeight=emailViewPnlHeight-(viewAddressHeight+this.mailViewTo.outerHeight(!0))-15,!1===IC_Validation.isNullOrEmpty(this._contactInfo.ccAddress)&&(emailContentHeight-=22),this.mailViewEmailDiv.css({height:"auto","min-height":"auto"}),this.mailViewEmailDiv.mCustomScrollbar("destroy"),"Parked"===status?(emailToolPnl=this.emailToolPnl.height(),mailViewAddress=this.mailViewAddress.outerHeight(),parkedEmailHeight=this.options.controller.getWidgetPanelHeight()-(emailToolPnl+mailViewAddress+20),this.emailViewPnl.css({height:parkedEmailHeight+(mailViewAddress+16)+"px"}),this.mailViewEmailDiv.css({height:parkedEmailHeight+"px","min-height":parkedEmailHeight+"px"})):this.mailViewEmailDiv.css({height:emailContentHeight,"min-height":emailContentHeight}),this.mailViewEmailContent.height()>emailContentHeight&&(this.mailViewEmailDiv.mCustomScrollbar("destroy"),this.mailViewEmailDiv.mCustomScrollbar({scrollButtons:{enable:!0},advanced:{updateOnContentResize:!0},scrollInertia:0}))),this.resizeEditorPanel()},resizeEditorPanel:function(){var height=this.emailPnlheight>0==!0?this.emailPnlheight:this.emailPnl.height(),contactResultsNotesPanel=this.options.controller.elements.ContactResultsNotesPanel;height=IC_Validation.isValidObject(this.mailAddressDiv)?height-(this.mailAddressDiv.height()+70):height,contactResultsNotesPanelHeight=contactResultsNotesPanel&&"block"===contactResultsNotesPanel.css("display")?contactResultsNotesPanel.height():0,"block"===this.emailTools.css("display")?this.emailPnl.width()<=415?height-=52:height-=26:height=height,$(".mailViewSubject").css("width",this.emailPnl.width()-100),$(".mailViewToContent").css("width",this.emailPnl.width()-60),$("#mailViewCCId").css("width",this.emailPnl.width()-60),height="block"===this.quiclReplyLstDiv.css("display")?height-126:height,$($(".mce-edit-area.mce-container.mce-panel.mce-last.mce-stack-layout-item",this.rootPanel).first()).css({height:height-contactResultsNotesPanelHeight+"px","overflow-x":"hidden","overflow-y":"scroll","padding-left":"3px"}),"block"===this.emailEditorPnl.css("display")&&$("#emailEditor_ifr").height($($($("#emailEditor_ifr").contents()).find("body")).height()+20)},triggerDownArrowKeyPress:function(){var e=$.Event("keydown");e.which=40,e.keyCode=40,$($($("#emailEditor_ifr").contents()).find("body")).trigger(e)},loadEmailUI:function(){var that=this;if("Interrupted"!==this._contactInfo.status){switch(this._hideOverlay(),this.contentPnl.slideDown(350),this.mailAddressDiv.emailAddressPopoutControl("setSendIconClicked",!1),this.emailType=function(){if(!1===IC_Validation.isNullOrEmpty(that.persistEmailInfo.action))return that.persistEmailInfo.action;if(!that._contactInfo.isInbound)return"outbound";if(that._contactInfo.isDraft)return"draft";return""}(),this.mailAddressDiv.emailAddressPopoutControl("updateData",this._contactInfo),this.emailType){case"draft":case"forward":case"reply":case"replyAll":this.showDraftMode();break;case"outbound":this.showEmailinOutboundMode();break;default:this.showEmail()}this.mailAddressDiv.emailAddressPopoutControl("updateView",this.emailType),this.mailAddressDiv.emailAddressPopoutControl("persistAddressGet")}else{"Email"===this.options.controller.getCurrentSelectedMediaTab()?this.options.controller.showEmailInterruptOverlay():this.options.controller.hideEmailInterruptOverlay()}},showEmailinOutboundMode:function(){$("#mailCompTo").attr("readonly",!1),$("#emailSubTxt").attr("readonly",!1),this.setMailContent(),this.discardMail.hide(),this.emailViewPnl.hide(),this.emailEditorPnl.fadeIn("slow")},notesPanelDisplay:function(){"Disconnected"!==this._contactInfo.status&&"Discarded"!==this._contactInfo.status||!1===this.isDispositionPnlShow&&this.options.controller.hasEmailDisposition(this._contactInfo.skillId)&&(this.options.controller.showDispositionPanel(this._contactInfo),this.isDispositionPnlShow=!0)},setDispositionContactData:function(){this.dispositionPanel.disposition("setDispOptions",{contactId:this._contactInfo.id,useSecDisposition:this._contactInfo.useSecDispositions,reqDisposition:this._contactInfo.reqDisposition,agentInfo:this._agentInfo})},destroyContactResultPanel:function(){this.contactResultPanel.hide(),this.dispositionPanel.slideUp(250),this.dispositionPanel.disposition("resetSelectedValue"),this._showOverlay()},emailChangeDesc:function(emailDesc){var res=emailDesc,contact=this.options.controller.getChatContact();return this.statePanel.removeClass("interruptEmail"),"Active"===emailDesc?(res=IC_Localization.active,this.hideContentPanelOverlay(),this._hideOverlay(),this.mailAddressDiv.emailAddressPopoutControl("textBoxDisable","Active"),this.emailTinyMceEditor&&this.emailTinyMceEditor.getBody().setAttribute("contenteditable",!0),IC_Validation.isValidObject(contact)&&"ChatContactEvent"===contact.contactType&&"Incoming"===contact.status&&(this._showOverlay(),this.showContentPanelOverlay())):"Discarded"===emailDesc?res=IC_Localization.discarded:"Interrupted"===emailDesc&&(res=IC_Localization.interrupted,this._showOverlay(),$("#contentPnlDisableOverlay").removeClass("contentPnlDisableOverlay"),IC_Validation.isValidObject(contact)&&"ChatContactEvent"===contact.contactType?("Incoming"===contact.status&&"ChatContactEvent"===contact.contactType?(this._showOverlay(),this.showContentPanelOverlay()):"Incoming"!=contact.status&&"ChatContactEvent"===contact.contactType&&(this._hideOverlay(),this.hideContentPanelOverlay()),this.statePanel.addClass("interruptEmail")):(this.mailAddressDiv.emailAddressPopoutControl("textBoxDisable","Interrupted"),this.emailTinyMceEditor&&this.emailTinyMceEditor.getBody().setAttribute("contenteditable",!1))),res},showContentPanelOverlay:function(){$("#overlay").removeClass("overlay"),$("#agentConsolePopoutContainer").removeClass("disableContainer"),$("#contentPnlDisableOverlay",this.element).addClass("contentPnlDisableOverlay")},hideContentPanelOverlay:function(){$("#agentConsolePopoutContainer").removeClass("disableContainer"),$("#contentPnlDisableOverlay",this.element).removeClass("contentPnlDisableOverlay")},hidePopoutOverlay:function(){this._hideOverlay(),$("#agentConsolePopoutContainer").removeClass("disableContainer")},resizeWidget:function(width,height){IC_Validation.isNullOrEmpty(this._contactInfo)||(this.windowHeight=height-180,this.emailPnlheight=height,this._contactInfo.isInbound&&"Interrupted"!==this._contactInfo.status&&"Parked"!==this._contactInfo.status&&this.renderCustomScroll(),this.mailResp.css({left:this.reply.offset().left-192+"px",top:"43px"}),IC_Validation.isValidObject(this.mailAddressDiv)&&this.mailAddressDiv.emailAddressPopoutControl("resizeWidget",width),this.mailResp.hide(),this.renderCustomScroll(width,height))},showEmailErrorMsg:function(msg){this.options.controller.showErrorMsg(msg)},updateMetaData:function(type,data){"quickReply"===type?this.quiclReplyLstDiv.quickReplyPopoutControl("updateData",data.quickReply,data.skillId):"dispositionPanel"===type&&(this.isDispositionPnlShow=data)},restrictEmailAttachment:function(fileExtList){this.attachmentExtn=fileExtList},appendQuickReply:function(mailContent){tinymce.execCommand("mceInsertContent",!1,mailContent),this.toggleQuickReply()},toggleQuickReply:function(callback){var that=this;IC_Common.isButtonEnabled(this.quickResp)&&this.quiclReplyLstDiv.toggle("slide",{direction:"up"},250,function(){"none"===that.quiclReplyLstDiv.css("display")?(that.toolTipPnl.hide(),that.quickResp.removeClass("btnDivSelect"),that.resizeEditorPanel(),that.persistEmailInfo.quickResp="hide",that.quiclReplyLstDiv.quickReplyPopoutControl("resetQuickReply"),"function"==typeof callback&&callback()):(that.quickResp.addClass("btnDivSelect"),that.quiclReplyLstDiv.quickReplyPopoutControl("renderCustomScrollBar"),that.resizeEditorPanel(),that.persistEmailInfo.quickResp="show")})},toggleEditorTools:function(callback){var that=this;IC_Common.isButtonEnabled(this.tools)&&this.emailTools.toggle("slide",{direction:"up"},250,function(){"none"===that.emailTools.css("display")?(that.tools.removeClass("btnDivSelect"),that.resizeEditorPanel(),that.persistEmailInfo.tools="hide","function"==typeof callback&&callback()):(that.tools.addClass("btnDivSelect"),that.resizeEditorPanel(),that.persistEmailInfo.tools="show"),that.setEmailPersist()})},tooltipScrollBar:function(obj){"block"===obj.css("display")&&(obj.mCustomScrollbar("destroy"),obj.mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0}))},destroy:function(){var that=this,contactId=that._contactInfo.id;!0!==this.stopDestroy&&(this.stopDestroy=!0,this.emailEditorPnl.empty(),setTimeout(function(){logger.trace("ContactID: "+contactId," :contactInfo before"),that.element.slideUp(250,function(){that.options.controller.onContactDestroy(that._contactInfo,that);try{that.emailEditorPnl.remove(),$("#emailEditor_ifr").remove(),$(that).children().each(function(){IC_Common.discardElement(this)}),that.element.remove()}catch(ex){logger.error("destroy :",ex)}logger.trace("ContactID: "+contactId," :contactInfo after")})},3e3))},clearFileSelection:function(){IC_Validation.isNotNull(this.filePicker)&&this.filePicker.length>0&&(this.filePicker[0].value="")},previewMode:function(contactInfo){$("#widgetPnlOverlay").removeClass("contentPnlDisableOverlay"),$("#overlay").removeClass("emailInterruptOverlay"),$("#agentConsolePopoutContainer").removeClass("disableContainer")},normalMode:function(){var contact=this.options.controller.getChatContact()||{};"Interrupted"!=this._contactInfo.status&&"ChatContactEvent"!==contact.contactType?this.hideContentPanelOverlay():"ChatContactEvent"===contact.contactType&&$("#widgetPnlOverlay").addClass("contentPnlDisableOverlay")},showDraftMode:function(){this.setMailContent()},isDiscarded:function(){var contact=this._contactInfo;if("Discarded"===contact.status){if(!1===contact.finalState){if(this.notesPanelDisplay(),this.options.controller.hasEmailDisposition(contact.skillId)||this.options.controller.hasEmailAcw(contact.skillId))"Email"===this.options.controller.getCurrentSelectedMediaTab()?this.options.controller.showEmailInterruptOverlay():this.options.controller.hideEmailInterruptOverlay()}else!0===this.isDispositionPnlShow&&(this.options.controller.hideEmailDisposition(),this.isDispositionPnlShow=!1);return!0}return!1},_isTagsOnlyChanged:function(currentContact,newContact){var _currentContact=$.extend({},currentContact),_newContact=$.extend({},newContact);return _newContact.tags=_currentContact.tags=[],JSON.stringify(_currentContact)==JSON.stringify(_newContact)},_updateUI:function(){this.isDiscarded()||(this.getEmailPersist(),this.loadEmailUI(),"Parked"==this._contactInfo.status?(this.options.controller.hideEmailInterruptOverlay(),this._contactInfo.isDraft&&(this.toggleEmailPanelButtons("disabled"),this.discardMail.hide(),$("input",this.mailAddressDiv).trigger("blur"),$("input",this.mailAddressDiv).each(function(index,element){$(element).prop("disabled",!0)}),this.emailTinyMceEditor&&this.emailTinyMceEditor.getBody().setAttribute("contenteditable",!1),this.mailAddressDiv.emailAddressPopoutControl("disableEmailAddressIcons"),"block"===this.quiclReplyLstDiv.css("display")&&this.quiclReplyLstDiv.hide(),"block"===this.emailTools.css("display")&&this.emailTools.hide()),this.replyAction.toggle(!1),this.previewMode(),this.requeueToggle(!0)):(this.requeueToggle(!1),this.mailAddressDiv.emailAddressPopoutControl("enableEmailAddressIcons"),this.normalMode()))},refresh:function(contactInfo,agentInfo){this._isTagsOnlyChanged(this._contactInfo,contactInfo);this._contactInfo=contactInfo,this._agentInfo=agentInfo,this.clearSelectedParkedEmailsRange(),this._updateUI()},getCurrentContact:function(){return this._contactInfo},parkEmail:function(contactId){var contactInfo={};if(contactId===this._contactInfo.id){contactInfo=this.mailAddressDiv.emailAddressPopoutControl("getEmailDetails");var isDraft=!!IC_Validation.isNotNullOrEmpty(this.persistEmailInfo.action);contactInfo.bodyHtml=isDraft?this.emailTinyMceEditor?this.emailTinyMceEditor.getContent():"":this._contactInfo.bodyHTML||this.getEmailPlainText()}else contactInfo=this.options.controller.getPersistEmailInfo(contactId),IC_Validation.isNotNull(contactInfo)||(contactInfo=this.options.controller.getContact(contactId));IC_Validation.isNotNull(contactInfo)&&this.options.controller.parkEmail(contactId,contactInfo)}})}(jQuery);