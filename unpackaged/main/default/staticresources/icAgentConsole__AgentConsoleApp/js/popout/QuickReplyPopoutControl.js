!function($){$.widget("AgentConsole.quickReplyPopoutControl",{options:{controller:null,resourceBase:""},quickReplies:[],quickReplyFiltered:[],selectedQuickReply:null,skillId:"",_create:function(){var root=$("<div />").appendTo(this.element),that=this;this.subDiv=$('<div class= "qSubDiv" />').appendTo(root),this.subDivTitle=$('<div class= "subDivTitle" />').appendTo(this.subDiv);$('<div class= "lineDiv" />').appendTo(root);this.replyLstDiv=$('<div class= "replyLstDiv" />').appendTo(root),this.contentDiv=$('<div class= "contentDiv" />').appendTo(root),this.quickReplyContent=$('<div class= "quickReplyContent" />').appendTo(this.contentDiv),this.updateView(),this.DefaultSearchText=IC_Localization.quickResponse,this.subDivInput=$('<input type="text" name="searchFieldInput" title="'+IC_Localization.search+" "+IC_Localization.quickResponse+'">').addClass("searchTextInput defaultSearchText").appendTo(this.subDiv),this.subDivInput.val(this.DefaultSearchText),this.subDivInput.trigger("focus"),this.subDivInput.on("keyup",$.proxy(this.onFilterChange,this)),this.subDivInput.on("focus",$.proxy(this.onSearchTextClick,this)),this.subDivInput.on("click",$.proxy(this.onSearchTextClick,this)),this.subDivInput.on("blur",$.proxy(this.onSearchTextBlur,this));var divSubmit=$('<div class="insertPanel insertGradient"></div>').on("click",$.proxy(this.saveNotes,this)).appendTo(this.contentDiv);$('<div class="insertText textEllipsis" title="'+IC_Localization.insert+'">'+IC_Localization.insert+"</div>").appendTo(divSubmit),divSubmit.hoverfn(function(){$(this).addClass("insertHover")},function(){$(this).removeClass("insertHover")}),$('<img class="imgRightArrow" src="'+this.options.resourceBase+'/css/images/arrow-right.png" />').appendTo(divSubmit),divSubmit.on("click",$.proxy(this.insertQuickReply,this)),this.dialogPanel=$('<div class="DialogPanel" id="placeHolderPanel" title="'+IC_Localization.replaceVariables+'" />').appendTo(root),this.placeHolderErrorDiv=$('<div class="placeHolderErrorDiv" >'+IC_Localization.fieldsEmpty+"</div>").appendTo(this.dialogPanel),this.placeHolderDiv=$("<div />").appendTo(this.dialogPanel);var labelOptions={};labelOptions.ok=IC_Localization.insert,labelOptions.cancel=IC_Localization.cancel;var buttonOptions={};buttonOptions[labelOptions.ok]=function(){for(var mailContent=that.selectedQuickReply.content,isEmpty=!1,i=0;i<that.placeHolderInput.length;i++){var quickReplyTxt=IC_Common.safeTagsReplace(that.placeHolderInput[i].val());if(IC_Validation.isNullOrEmpty(quickReplyTxt)?(that.placeHolderInput[i].addClass("placeHolderTextError"),isEmpty=!0):that.placeHolderInput[i].removeClass("placeHolderTextError"),!1===isEmpty){var placeHolder=that.lstplaceHolder[i];mailContent=mailContent.replaceAll(placeHolder,quickReplyTxt)}}!1===isEmpty?(that.placeHolderErrorDiv.hide(),that.options.controller.appendQuickReply(mailContent),$(this).dialog("close")):that.placeHolderErrorDiv.showfn()},buttonOptions[labelOptions.cancel]=function(){that.placeHolderErrorDiv.hide(),that.resetQuickReply(),$(this).dialog("close")},this.dialogPanel.dialog({autoOpen:!1,resizable:!1,height:210,width:"330px",modal:!0,buttons:buttonOptions,close:function(){that.placeHolderErrorDiv.hide(),that.resetQuickReply()}}),$(".ui-widget-header").addClass("DialogPanelBG"),$(".ui-dialog-title").addClass("DialogPanelTitle"),$(".ui-dialog-buttonpane button").addClass("DialogPanelBut"),$(".ui-widget-content").addClass("DialogPanelFontStyle"),$(".ui-button-text").addClass("DialogPanelButton"),$(".ui-dialog-titlebar-close").attr("title",IC_Localization.close)},onFilterChange:function(){this.filterText=this.subDivInput.val()!==this.DefaultSearchText?this.subDivInput.val():"",this.updateView()},onSearchTextClick:function(){this.subDivInput.val()==this.DefaultSearchText&&(this.subDivInput.val(""),this.subDivInput.removeClass("defaultSearchText"))},onSearchTextBlur:function(){""==this.subDivInput.val()&&(this.subDivInput.val(this.DefaultSearchText),this.subDivInput.addClass("defaultSearchText"))},updateFilteredData:function(){this.quickReplyFiltered=[];for(var j=0;j<this.quickReplies.length;j++){var rep=this.quickReplies[j];rep.skill.hasOwnProperty(this.skillId)&&this.quickReplyFiltered.push(rep)}this.updateView()},isMatchFound:function(value){var matchFound=!0,title=value.title;return IC_Validation.isNotNullOrEmpty(this.filterText)&&this.filterText!==this.DefaultSearchText&&(matchFound=matchFound&&-1!==title.toLowerCase().indexOf(this.filterText.toLowerCase())),matchFound},updateView:function(){this.replyLstDiv.empty();for(var itemCount=0,that=this,i=0;i<this.quickReplyFiltered.length;i++){var item=this.quickReplyFiltered[i];if(this.isMatchFound(item))itemCount++,$('<div quickReplyId = "'+item.id+'" id = "'+item.id+'"/> ').html(item.title).addClass("quickReplyStyle").hoverfn(function(event){$(this).addClass("btnDivHover"),that.showToolTip($(this).attr("quickReplyId"))},function(event){$(this).removeClass("btnDivHover"),that.hideToolTip(event)}).appendTo(this.replyLstDiv).on("click",function(event){var selectedId=event.target.getAttribute("quickReplyId");that.showContentPanel(selectedId)})}itemCount>4&&this.renderCustomScrollBar(this.replyLstDiv)},showToolTip:function(itemId){var currentItem=$.grep(this.quickReplyFiltered,function(item){return item.id==itemId});currentItem[0].content=currentItem[0].content.replace(/background-color:#FF6600/g,"background-color:none"),currentItem.length>0&&$(".emailPnl,.chatMessageEditor").find("#tooltipID").html("").html(currentItem[0].content),$(".emailPnl,.chatMessageEditor").find("#tooltipID").showfn(),this.renderCustomScrollBar($(".emailPnl,.chatMessageEditor").find("#tooltipID"))},hideToolTip:function(e){null!=e.relatedTarget&&(e.target.className==e.relatedTarget.className||"quickReplyStyle"==e.target.className&&"mCSB_buttonUp"==e.relatedTarget.className||"mCSB_dragger_bar"==e.relatedTarget.className||"mCSB_buttonDown"==e.relatedTarget.className||"mCSB_draggerContainer"==e.relatedTarget.className||"mCSB_draggerRail"==e.relatedTarget.className||"mCSB_dragger"==e.relatedTarget.className)?($(".emailPnl,.chatMessageEditor").find("#tooltipID").showfn(),this.renderCustomScrollBar($(".emailPnl,.chatMessageEditor").find("#tooltipID"))):$(".emailPnl,.chatMessageEditor").find("#tooltipID").hide()},renderCustomScrollBar:function(objname){IC_Validation.isNullOrEmpty(objname)&&(objname=this.replyLstDiv),"block"===objname.css("display")&&(objname.mCustomScrollbar("destroy"),objname.mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0}))},quickReplyHover:function(){$(this).addClass("quickReplyHover")},removeDuplicate:function(list){var result=[];return $.each(list,function(i,e){-1==$.inArray(e,result)&&result.push(e)}),result},insertQuickReply:function(){var content=this.selectedQuickReply.content,responseBucket=[],that=this;if(IC_Validation.isValidObject(this.selectedQuickReply)){for(var uniqueListplaceHolder,encodeElement=$("<span>"),newTxt=this.selectedQuickReply.content.split("{"),lstplaceHolder=[],i=1;i<newTxt.length;i++){var strSplit=newTxt[i].split("}");void 0!==strSplit[1]&&lstplaceHolder.push("{"+strSplit[0]+"}")}if(lstplaceHolder.length>0){uniqueListplaceHolder=this.removeDuplicate(lstplaceHolder),this.placeHolderDiv.empty(),this.placeHolderInput=[],this.quickReplyContentDiv=$('<div class="quickReplyContentDiv" id="quickReplyContentDiv"/>').css({height:"auto","max-height":"150px",overflow:"auto","margin-top":"5px"}).html(this.selectedQuickReply.content).appendTo(this.placeHolderDiv),this.multiplePlaceHolderDiv=$('<div id="multiplePlaceHolderDiv" />').css({height:"auto","max-height":"150px",overflow:"auto"}).appendTo(this.placeHolderDiv),this.dialogPanel.dialog("option","height","auto");for(i=0;i<uniqueListplaceHolder.length;i++){var textToDisplay=$('<div class="placeHolderName" />'),decodedText=encodeElement.html(uniqueListplaceHolder[i]).text();textToDisplay.text(decodedText).appendTo(this.multiplePlaceHolderDiv),IC_Common.setTextWithEllipsis(textToDisplay,decodedText+": ",280),this.placeHolderInput[i]=$('<input type="text" class="placeHolderText" name="'+decodedText+'" title="'+IC_Localization.replaceVariables+'" />').appendTo(this.multiplePlaceHolderDiv)}for(i=0;i<lstplaceHolder.length;i++)responseBucket.push({id:lstplaceHolder[i],value:""});$(".placeHolderText").on("keyup",function(){var currentName=encodeElement.html($(this).attr("name")).html(),objResponse=$.grep(responseBucket,function(item,index){return currentName==item.id});if(objResponse.length>0)for(var i=0;i<objResponse.length;i++){(quickReplyTxt=IC_Common.safeTagsReplace($(this).val())).trim().length>0?objResponse[i].value="<b>"+quickReplyTxt+"</b>":objResponse[i].value=quickReplyTxt.trim()}var htmlTemplate=content,isEmpty=!1;for(i=0;i<that.placeHolderInput.length;i++){var quickReplyTxt=IC_Common.safeTagsReplace(that.placeHolderInput[i].val());if(IC_Validation.isNullOrEmpty(quickReplyTxt)&&(isEmpty=!0),!1===isEmpty){var placeHolder=uniqueListplaceHolder[i];htmlTemplate=htmlTemplate.replaceAll(placeHolder,quickReplyTxt)}}that.quickReplyContentDiv.html(htmlTemplate),that.renderCustomScrollBar(that.quickReplyContentDiv)}),this.lstplaceHolder=uniqueListplaceHolder,this.dialogPanel.dialog("open"),this.renderCustomScrollBar(this.quickReplyContentDiv),this.renderCustomScrollBar(this.multiplePlaceHolderDiv)}else this.options.controller.appendQuickReply(this.selectedQuickReply.content)}},showContentPanel:function(selectedId){for(var item,i=0;i<this.quickReplyFiltered.length;i++)if(selectedId===(item=this.quickReplyFiltered[i]).id){this.selectedQuickReply=item,this.insertQuickReply();break}},resetQuickReply:function(){this.contentDiv.hide(),this.subDivTitle.hide(),this.subDivInput.showfn(),this.replyLstDiv.showfn(),this.selectedQuickReply=null},updateData:function(quickReplies,skillId){this.quickReplies=quickReplies,this.skillId=skillId,this.updateFilteredData()}})}(jQuery);