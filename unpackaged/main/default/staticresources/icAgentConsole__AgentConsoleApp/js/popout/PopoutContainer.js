!function($){var logger=IC_Common.getLogger("PopoutContainer");$.widget("AgentConsole.popout",$.AgentConsole.baseContainer,{options:{resourceBase:"",sfSessionId:"",stationId:null,phoneNo:null,username:null,timezoneOffset:0,localeCode:"",localeDateFormat:"",localeDateTimeFormat:"",langCode:"",sfdcOrigin:"",sfMode:"",isPopout:!0,sfNamespace:"",sfUserId:"",sfUsername:""},agentInfo:{cState:{state:"Logging in",reason:"",time:(new Date).getTime(),timeout:0,acw:!1},lgId:"",lgState:"Disconnected",lgMuted:!1,mask:!1},updateSkillListQueue:!1,panelDisplayed:"",isPopout:!0,chatContactIdToTransfer:"",chatContacts:"",chatDisconnectedWidget:[],isChatContactPanel:!1,isPCDialPad:!1,isVMDialPad:!1,chatEmailparkedContacts:[],isWorkItemTransferClicked:!1,isVoiceMailTransferClicked:!1,isChatContactTransferClicked:!1,isEmailContactTransferClicked:!1,isSkillSelectedHere:!1,initLoad:!0,searchKeyStroke:null,lastPreviewedEmail:null,contactType:null,acceptRejectPanelType:"",isPCConfirmErrorMsgDisplayed:!1,isChatTabSelected:!1,isEmailTabSelected:!1,renderedHeight:0,_create:function(){this.resourceBase=this.options.resourceBase,AgentConsoleSalesforce.init({resourceBase:this.resourceBase,namespace:this.options.sfNamespace}),this.options.localeDateFormat=AgentConsoleLocale.getLocaleFormat(this.options.localeCode,"date"),this.options.localeDateTimeFormat=AgentConsoleLocale.getLocaleFormat(this.options.localeCode,""),this.options.localeTimeFormat=AgentConsoleLocale.getLocaleFormat(this.options.localeCode,"time"),this.elements={},IC_Common.isIE11()&&this.element.addClass("ie11or10");var rootDiv=$('<div class="agentConsolePopout brRoundT" />').appendTo(this.element),that=this;this.elements.rootDiv=rootDiv,this.headerPanel=$('<div class="bgHeaderGradient  header"/>').appendTo(rootDiv),this.elements.headerLogo=$('<div class="logo"></div>').text(IC_Localization.salesforceAgent).appendTo(this.headerPanel),this.elements.agentLegState=$('<img class="agentLegState" />').attr("src",this.resourceBase+"/css/images/leg-off.png").appendTo(this.headerPanel),this.elements.agentLegState.on("click",$.proxy(this.onClickAgentLeg,this)),this.elements.loginPopupDiv=$('<div class="popupDiv" align="center"/>').appendTo(rootDiv),this.elements.loginPopupDiv.css({height:"94%","z-index":"1"}),this.elements.loginMsgDiv=$('<div class="loginMsgDiv" />').text(IC_Localization.sessionEnded).appendTo(this.elements.loginPopupDiv),this.elements.loginBtnDiv=$('<input type="button" value='+IC_Localization.login+' class="loginBtnDiv brRoundT brRoundB textEllipsis" align="center" title="'+IC_Localization.login+'"/>').appendTo(this.elements.loginMsgDiv),this.elements.loginPopupDiv.hide(),this.elements.loginBtnDiv.on("click",$.proxy(this.onClickMsgOkBtn,this)),this.elements.popupDiv=$('<div class="popupDiv" align="center"/>').appendTo(rootDiv),this.elements.msgDiv=$('<div class="msgDiv brRoundT brRoundB" tabindex="-1" aria-labelledby="infoMsgInPopout"/>').appendTo(this.elements.popupDiv),this.elements.msgBtn=$('<div class="btnDivEnable okBtn brRoundT brRoundB textEllipsis" title = "'+IC_Localization.ok+'" tabindex = "0" aria-label = "'+IC_Localization.ok+'"  role="button">').text(IC_Localization.ok).appendTo(this.elements.msgDiv),this.elements.msgBtn.on("click",$.proxy(this.onClickMsgOkBtn,this)),IC_Common.enterKeyPress(this.elements.msgBtn,function(){that.onClickMsgOkBtn()}),IC_Common.setFocusToElement(this.elements.msgBtn,"dialog-button-focus"),this.elements.callMsgDiv=$('<div class="msgDiv brRoundT brRoundB" tabindex="-1" aria-labelledby="confirmationPromptInPopout" />').appendTo(this.elements.popupDiv),this.elements.callMsgDiv.css("display","none"),this.elements.callMsgYesBtn=$('<div class="btnDivEnable yesBtn brRoundT brRoundB textEllipsis" title = "'+IC_Localization.yes+'" tabindex = "0" aria-label = "'+IC_Localization.yes+'"  role="button">').text(IC_Localization.yes).appendTo(this.elements.callMsgDiv),this.elements.callMsgNoBtn=$('<div class="btnDivEnable noBtn brRoundT brRoundB textEllipsis" title = "'+IC_Localization.no+'" tabindex = "0" aria-label = "'+IC_Localization.no+'"  role="button">').text(IC_Localization.no).appendTo(this.elements.callMsgDiv),this.elements.callMsgNoBtn.on("click",$.proxy(this.closeCallMsgPopup,this)),this.elements.callMsgNoBtn.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.elements.callMsgYesBtn.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),IC_Common.setFocusToElement(this.elements.callMsgYesBtn,"dialog-button-focus"),IC_Common.setFocusToElement(this.elements.callMsgNoBtn,"dialog-button-focus"),this.elements.contentPanel=$('<div class="bgBodyGradient contentPanel withDialerPanel"/>').appendTo(rootDiv),this.createBaseControls(),this.createAgentConsoleContainer(),this.elements.multiCallControl.multiCallControl("hidePopInIcon"),this.elements.obPhoneSkillsMenu=$('<div id="ic_obskilllistmenu" class="ic_obSkillListMenu btnDivEnable" />').appendTo(rootDiv),this.elements.obPhoneSkillsMenu.on("mouseleave",function(){that.elements.obPhoneSkillsMenu.hide()}),this.elements.obPhoneSkillsMenu.on("mouseenter",function(){clearTimeout(that.obSkillHideTimeout)}),this.elements.obEmailSkillsMenu=$('<div id="ic_obskilllistmenu" class="ic_obSkillListMenu btnDivEnable" />').appendTo(rootDiv),this.elements.obEmailSkillsMenu.on("mouseleave",function(){that.elements.obEmailSkillsMenu.hide()}),this.elements.obEmailSkillsMenu.on("mouseenter",function(){clearTimeout(that.obSkillHideTimeout)}),document.getElementById("renderTextSize")||$('<div id="renderTextSize"/>').addClass("renderTextSize").appendTo("Body")},_init:function(){this.initializeBase();var that=this;$(document).on(AgentConsoleDataStore.ContactResultEvent,$.proxy(this.onContactResultListUpdate,this)),$(document).on(AgentConsoleDataStore.APIErrorEvent,$.proxy(this.onAPIErrorEventUpdate,this)),$(document).on(AgentConsoleDataStore.ContactEvent,$.proxy(this.onContactUpdate,this)),$(document).on(AgentConsoleDataStore.ChatMsgEvent,$.proxy(this.onChatMsgUpdate,this)),$(document).on(AgentConsoleDataStore.AgentInfoEvent,$.proxy(this.onAgentInfoUpdate,this)),$(document).on(AgentConsoleDataStore.SkillQueueEvent,$.proxy(this.onSkillQueueUpdate,this)),$(document).on(AgentConsoleDataStore.AgentSkillListEvent,$.proxy(this.onAgentSkillListUpdate,this)),$(document).on(AgentConsoleDataStore.CustomVariablesEvent,$.proxy(this.onCustomVariablesUpdate,this)),$(document).on(AgentConsoleDataStore.AgentListEvent,$.proxy(this.onAgentListUpdate,this)),$(document).on(AgentConsoleDataStore.AgentStateChangeEvent,$.proxy(this.onAgentStateChange,this)),$(document).on(AgentConsoleDataStore.TeamListEvent,$.proxy(this.onTeamListUpdate,this)),$(document).on(AgentConsoleDataStore.SkillListEvent,$.proxy(this.onSkillListUpdate,this)),$(document).on(AgentConsoleDataStore.AgentSkillAssignmentsEvent,$.proxy(this.onAgentSkillAssignmentsUpdate,this)),$(document).on(AgentConsoleDataStore.AddressBooksEvent,$.proxy(this.onAddressBooksUpdate,this)),$(document).on(AgentConsoleDataStore.DispositionEvent,$.proxy(this.onDispositionUpdate,this)),$(document).on(AgentConsoleDataStore.ContactHistoryEvent,$.proxy(this.ContactHistoryFilterUpdate,this)),$(document).on(AgentConsoleDataStore.SkillClosedHoursEvent,$.proxy(this.onSkillClosedHours,this)),$(document).on(AgentConsoleDataStore.QuickReplyEvent,$.proxy(this.onQuickReplyUpdate,this)),$(document).on(AgentConsoleDataStore.TimeZoneEvent,$.proxy(this.onTimeZoneEvent,this)),$(document).on(AgentConsoleDataStore.PromiseKeeperEvent,$.proxy(this.onPromiseKeeperUpdate,this)),$(document).on(AgentConsoleDataStore.FileExtensionsListEvent,$.proxy(this.onFileExtensionsList,this)),$(document).on(AgentConsoleDataStore.EmailParkEvent,$.proxy(this.onEmailParkUpdate,this)),$(document).on(AgentConsoleDataStore.ChatPatronTypingEvent,$.proxy(this.onChatPatronTypingUpdate,this)),$(document).on(AgentConsoleDataStore.ChatPreviewEvent,$.proxy(this.onChatPreviewUpdate,this)),$(document).on(AgentConsoleDataStore.ParkedEmailLimitValidation,$.proxy(this.onParkEmailLimitValidation,this)),$(document).on(AgentConsoleDataStore.TagsUpdatedContactEvent,$.proxy(this.onTagsUpdatedContactEvent,this)),$(document).on(AgentConsoleDataStore.AgentIndicatorEvent,$.proxy(this.OnAgentIndicatorUpdate,this)),$(document).on(AgentConsoleDataStore.SkillTagsUpdateEvent,$.proxy(this.onSkillTagsUpdate,this)),$(document).on(AgentConsoleDataStore.SkillRunningLowEvent,$.proxy(this.onSkillRunningLowUpdate,this)),$(document).on(AgentConsoleDataStore.PCQueueEvent,$.proxy(this.onPCQueueCountUpdate,this)),$(document).on(AgentConsoleDataStore.PCPreviewNotesUpdate,$.proxy(this.pcPreviewNotesUpdate,this)),$(document).on(AgentConsoleDataStore.VoiceMailPlayBackEvent,$.proxy(this.onVoiceMailPlayBackUpdate,this)),sessionStorage.lastOpenedAcceptRejectId="",AgentConsoleDataStore.sfMode=!1===IC_Validation.isNotNullOrEmpty(that.options.sfMode)?"Classic":that.options.sfMode,$(document).on(AgentConsoleDataStore.AgentSessionEndEvent,$.proxy(this.onAgentSessionEnd,this)),$(window).on("resize",function(){localStorage.popupHeight=$(window).height(),localStorage.popupWidth=$(window).width(),that.continueResizeChatPanel(),IC_Validation.isNullOrEmpty(that.resizeTimeout)&&(that.windowWidth=$(window).width(),that.windowHeight=$(window).height(),that.resizeTimeout=setTimeout($.proxy(that.checkResizeComplete,that),100))}),$(window).on("unload",function(){try{localStorage.setItem("isPopupOpen",!1),!0===AgentConsoleDataStore.canClearPopValues&&(localStorage.popupHeight="",localStorage.popupWidth="")}catch(err){}}),$(document).ready(function(){try{"complete"===document.readyState?that.onDocumentLoadComplete():$(window).on("load",function(){that.onDocumentLoadComplete()})}catch(err){}}),AgentConsoleDataStore.popoutLoadDataStore(),this.onAgentSessionStart()},onDocumentLoadComplete:function(){localStorage.setItem("isPopupOpen",!0),this.resizePopOutPanel()},onAgentSessionStart:function(){var aInfo=AgentConsoleDataStore.agentInfo;if(logger.trace("onAgentSessionStart - session joined : "+aInfo.joinSession),this.agentInfo.id=aInfo.id,this.agentInfo.phNo=aInfo.phNo,this.agentInfo.busNo=aInfo.busNo,this.agentInfo.stationId=aInfo.stationId,this.agentInfo.enabledForMCH=aInfo.enabledForMCH,IC_Validation.isNotNullOrUndefinedString(aInfo.mask)&&(this.agentInfo.mask=aInfo.mask),IC_Validation.isNotNullOrUndefinedString(this.options.agentAudioSettings)){var userCredential=AgentConsoleDataStore.getCustomVar("UserAVSettings");IC_Validation.isValidObject(userCredential)||(userCredential={agentAudioSettings:this.options.agentAudioSettings,agentVisualSettings:this.options.agentVisualSettings},AgentConsoleDataStore.setCustomVar("UserAVSettings",userCredential))}},createAgentConsoleContainer:function(){this.elements.contentPanelWrapper=$("<div/>").appendTo(this.elements.contentPanel),this.createMultiContactControlsPanel(this.elements.contentPanelWrapper),this.createTabControls(this.elements.contentPanelWrapper),this.elements.contentPanelWrapper.css("display","none")},createTabControls:function(parent){var that=this;this.elements.tooltipDiv=$('<div class="tooltipDiv"/>').appendTo(parent),this.tooltipTxt=$("<span>").addClass("tooltipTextSpan").appendTo(this.elements.tooltipDiv),this.elements.tooltipDiv.hoverfn(function(event){that.elements.tooltipDiv.showfn()},function(){that.elements.tooltipDiv.hide()}),this.elements.tabPanel=$('<div class="bgBodyGradient tabPanel"/>').appendTo(parent),this.elements.tabDialpadIconDiv=$('<div class="btnBrRound5 iconDiv btnDivDisable" id="tabDialpadIconIdInPopout"/>').appendTo(this.elements.tabPanel),this.elements.tabDialpadIconImg=$('<img class="icon"/>').attr("src",this.resourceBase+"/css/images/hp-sm-phone.png").appendTo(this.elements.tabDialpadIconDiv),this.elements.tabDialpadIconDiv.hoverfn(function(){that.elements.tabDialpadIconDiv.removeAttr("title"),that.tabPanelMouseEnterButton(this),that.options.isTooltipEnabled?(that.elements.tooltipDiv.css("left",that.elements.tabDialpadIconDiv.offset().left+"px"),that.tabPanelCustomTooltip(IC_Localization.dialPadTooltipTxt)):that.elements.tabDialpadIconDiv.attr("title",IC_Localization.dialPad)},function(){that.mouseLeaveButton(this)}),this.elements.tabAgentsIconDiv=$('<div class="btnBrRound5 iconDiv btnDivEnable" id="tabAgentsIconIdInPopout"/>').appendTo(this.elements.tabPanel),$('<img class="icon"/>').attr("src",this.resourceBase+"/css/images/hp-sm-agents.png").appendTo(this.elements.tabAgentsIconDiv),this.elements.tabAgentsIconDiv.hoverfn(function(){that.elements.tabAgentsIconDiv.removeAttr("title"),that.tabPanelMouseEnterButton(this),that.options.isTooltipEnabled?(that.elements.tooltipDiv.css("left",that.elements.tabAgentsIconDiv.offset().left+"px"),that.tabPanelCustomTooltip(IC_Localization.agentListTooltipTxt)):that.elements.tabAgentsIconDiv.attr("title",IC_Localization.agents)},function(){that.mouseLeaveButton(this)}),this.elements.tabSkillsIconDiv=$('<div class="btnBrRound5 iconDiv btnDivEnable" id = "tabSkillsIconIdInPopout"/>').appendTo(this.elements.tabPanel),$('<img class="skillIcon"/>').attr("src",this.resourceBase+"/css/images/SkillIcon.svg").appendTo(this.elements.tabSkillsIconDiv),this.elements.tabSkillsIconDiv.hoverfn(function(){that.elements.tabSkillsIconDiv.removeAttr("title"),that.tabPanelMouseEnterButton(this),that.options.isTooltipEnabled?(that.elements.tooltipDiv.css("left",that.elements.tabSkillsIconDiv.offset().left+"px"),that.tabPanelCustomTooltip(IC_Localization.skillListTooltipTxt)):that.elements.tabSkillsIconDiv.attr("title",IC_Localization.skills)},function(){that.mouseLeaveButton(this)}),this.elements.tabAddressBookIconDiv=$('<div class="btnBrRound5 iconDiv btnDivEnable" id = "tabAddressBookIconIdInPopout"/>').appendTo(this.elements.tabPanel),$('<img class="icon"/>').attr("src",this.resourceBase+"/css/images/hp-sm-addrbook.png").appendTo(this.elements.tabAddressBookIconDiv),this.elements.tabAddressBookIconDiv.hoverfn(function(){that.elements.tabAddressBookIconDiv.removeAttr("title"),that.tabPanelMouseEnterButton(this),that.options.isTooltipEnabled?(that.elements.tooltipDiv.css("left",that.elements.tabAddressBookIconDiv.offset().left+"px"),that.tabPanelCustomTooltip(IC_Localization.addressBookTooltipTxt)):that.elements.tabAddressBookIconDiv.attr("title",IC_Localization.addressBook)},function(){that.mouseLeaveButton(this)}),this.elements.tabHistoryIconDiv=$('<div class="btnBrRound5 iconDiv btnDivEnable" id = "tabHistoryIconIdInPopout"/>').appendTo(this.elements.tabPanel),$('<img class="icon"/>').attr("src",this.resourceBase+"/css/images/hp-sm-history.png").appendTo(this.elements.tabHistoryIconDiv),this.elements.tabHistoryIconDiv.hoverfn(function(){that.elements.tabHistoryIconDiv.removeAttr("title"),that.tabPanelMouseEnterButton(this),that.options.isTooltipEnabled?(that.elements.tooltipDiv.css("left",that.elements.tabHistoryIconDiv.offset().left+"px"),that.tabPanelCustomTooltip(IC_Localization.contactHistoryTooltipTxt)):that.elements.tabHistoryIconDiv.attr("title",IC_Localization.contactHistory)},function(){that.mouseLeaveButton(this)}),this.elements.tabAgentInfoIconDiv=$('<div class="btnBrRound5 iconDiv btnDivEnable" id = "tabAgentInfoIconIdInPopout"/>').appendTo(this.elements.tabPanel),$('<img class="icon"/>').attr("src",this.resourceBase+"/css/images/hp-sm-agentinfo.png").appendTo(this.elements.tabAgentInfoIconDiv),this.elements.tabAgentInfoIconDiv.hoverfn(function(){that.elements.tabAgentInfoIconDiv.removeAttr("title"),that.tabPanelMouseEnterButton(this),that.options.isTooltipEnabled?(that.elements.tooltipDiv.css("left",that.elements.tabAgentInfoIconDiv.offset().left+"px"),that.tabPanelCustomTooltip(IC_Localization.agentInfoToolitipTxt)):that.elements.tabAgentInfoIconDiv.attr("title",IC_Localization.agentInfo)},function(){that.mouseLeaveButton(this)}),this.elements.tabOBEmailIconDiv=$('<div class="btnBrRound5 iconDiv btnDivEnable" id = "tabOBEmailIconDivIdInPopout"/>').appendTo(this.elements.tabPanel),this.elements.tabOBEmailIconImg=$('<img class="icon"/>').css({width:"22px",height:"20px"}).attr("src",this.resourceBase+"/css/images/mail.png").appendTo(this.elements.tabOBEmailIconDiv),this.elements.tabOBEmailIconDiv.hoverfn(function(event){that.elements.tabOBEmailIconDiv.removeAttr("title"),that.tabPanelMouseEnterButton(this),that.options.isTooltipEnabled?(that.elements.tooltipDiv.css("left",that.elements.tabOBEmailIconDiv.offset().left+"px"),that.tabPanelCustomTooltip(IC_Localization.emailTooltipTxt)):that.elements.tabOBEmailIconDiv.attr("title",IC_Localization.email)},function(){that.mouseLeaveButton(this)}),this.elements.tabPromiseKeeperIconDiv=$('<div class="btnBrRound5 iconDiv btnDivEnable" id = "tabPromiseKeeperIconIdInPopout"/>').appendTo(this.elements.tabPanel),this.elements.tabPromiseKeeperIconImg=$('<img class="icon"/>').attr("src",this.resourceBase+"/css/images/pin.png").appendTo(this.elements.tabPromiseKeeperIconDiv),this.elements.tabPromiseKeeperIconDiv.hoverfn(function(event){that.elements.tabPromiseKeeperIconDiv.removeAttr("title"),that.tabPanelMouseEnterButton(this),that.options.isTooltipEnabled?(that.elements.tooltipDiv.css("left",that.elements.tabPromiseKeeperIconDiv.offset().left+"px"),that.tabPanelCustomTooltip(IC_Localization.commitmentTooltipTxt)):that.elements.tabPromiseKeeperIconDiv.attr("title",IC_Localization.commitmentManager)},function(){that.mouseLeaveButton(this)}),this.elements.dialPadControl=$('<div class="modalDialogPanel"/>').appendTo(parent),this.elements.dialPadControl.dialPad({container:this,resourceBase:this.options.resourceBase}),this.elements.agentListControl=$('<div class="modalDialogPanel"/>').appendTo(parent),this.elements.agentListControl.agentList({container:this,resourceBase:this.options.resourceBase}),this.elements.skillListControl=$('<div class="modalDialogPanel"/>').appendTo(parent),this.elements.skillListControl.skillList({container:this,resourceBase:this.options.resourceBase}),this.elements.addressBookControl=$('<div class="modalDialogPanel"/>').appendTo(parent),this.elements.addressBookControl.addressBook({container:this,resourceBase:this.options.resourceBase}),this.elements.contactHistoryControl=$('<div class="modalDialogPanel"/>').appendTo(parent),this.elements.contactHistoryControl.contactHistory({container:this,resourceBase:this.options.resourceBase}),this.elements.agentInfoControl=$('<div class="modalDialogPanel"/>').appendTo(parent),this.elements.agentInfoControl.agentInformation({container:this,resourceBase:this.options.resourceBase}),this.elements.keyPadControl=$('<div class="modalDialogPanelKeypad"/>').appendTo(parent),this.elements.keyPadControl.keyPad({container:this,resourceBase:this.options.resourceBase}),this.elements.promiseKeeperControl=$('<div id = "promiseKeeperPanelIdInPopout" class="modalDialogPanel"/>').appendTo(parent),this.elements.promiseKeeperControl.promiseKeeper({container:this,resourceBase:this.options.resourceBase}),this.elements.promiseKeeperDetailsControl=$('<div id = "promiseKeeperDetailsPanelIdInPopout" class="modalDialogPanel" role = "dialog" aria-label = "'+IC_Localization.commitmentDetails+'"/>').appendTo(parent),this.elements.promiseKeeperDetailsControl.promiseKeeperDetails({container:this,resourceBase:this.options.resourceBase}),this.elements.promiseKeeperDateTimeControl=$('<div id = "promiseKeeperDateTimePanelIdInPopout" class="modalDialogPanel"/>').appendTo(parent),this.elements.promiseKeeperDateTimeControl.promiseKeeperDateTime({container:this,resourceBase:this.options.resourceBase,dateTimeUpdatedCallback:function(reminderDateTime){that.elements.promiseKeeperDetailsControl.promiseKeeperDetails("updateCallbackTime",reminderDateTime)}}),this.elements.rescheduleDateTimeControl=$('<div id = "rescheduleDateTimePanelIdInPopout" class="modalDialogPanel"/>').appendTo(parent),this.elements.rescheduleDateTimeControl.rescheduleDateTime({container:this,resourceBase:this.options.resourceBase}),this.elements.tabDialpadIconDiv.on("click",$.proxy(this.onClickTabDialPad,this)),this.elements.tabAgentsIconDiv.on("click",$.proxy(this.onClickTabAgents,this)),this.elements.tabSkillsIconDiv.on("click",$.proxy(this.onClickTabSkills,this)),this.elements.tabAddressBookIconDiv.on("click",$.proxy(this.onClickTabAddressBooks,this)),this.elements.tabHistoryIconDiv.on("click",$.proxy(this.onClickTabContactHistory,this)),this.elements.tabAgentInfoIconDiv.on("click",$.proxy(this.onClickTabAgentInfo,this)),this.elements.tabOBEmailIconDiv.on("click",$.proxy(this.onClickTabEmail,this)),this.elements.tabPromiseKeeperIconDiv.on("click",$.proxy(this.onClickTabPromiseKeeper,this)),this.elements.tabPanel.css("display","block")},tabPanelMouseEnterButton:function(that){var btnDiv=$(that);(IC_Common.isButtonEnabled(btnDiv)||IC_Common.isButtonSelected(btnDiv))&&btnDiv.addClass("btnDivHover")},tabPanelCustomTooltip:function(text){var tooltip=this.textMask(text,190);this.tooltipTxt.html(tooltip.value+" "+tooltip.hyper),this.elements.tooltipDiv.css("display","block")},mouseLeaveButton:function(that){$(that).removeClass("btnDivHover"),this.elements.tooltipDiv.css("display","none")},textMask:function(text,width){var moreLink,str,len=0,moreTxt=IC_Localization.more;return void 0!==text&&(len=text.length),width<len?(str=text.substring(0,Math.abs(width-4))+"... ",moreLink='<a href = "https://help.incontact.com/16.1/help.htm#SalesforceAgent/SalesforceAgentOverview.htm" target="_blank" id="goHelp">'+moreTxt+"</a>"):(str=text,moreLink=""),{value:str,hyper:moreLink}},checkResizeComplete:function(){var currHeight=$(window).height(),currWidth=$(window).width();this.windowWidth!==currWidth||this.windowHeight!==currHeight?(this.windowWidth=currWidth,this.windowHeight=currHeight,this.resizeTimeout=setTimeout($.proxy(this.checkResizeComplete,this),100)):(this.resizeTimeout=null,this.resizePopOutPanel()),IC_Validation.isValidObject(this.dispPanel)&&this.resizeDispPanelContainer()},continueResizeChatPanel:function(){IC_Validation.isValidObject(this.contactResultPanel)&&this.contactResultPanel.resultsAndNotesControl("resizeWidget"),IC_Validation.isValidObject(this.elements.endDispositionPanel)&&this.elements.endDispositionPanel.disposition("resizeDispPanel")},getWidgetPanelHeight:function(){return $(window).height()-(this.headerPanel.height()+this.elements.mediaTabsDiv.height()+this.elements.tabPanel.height())},resizePopOutPanel:function(){var tabPnlWidth,tabPnlHeight,multicallcontrolHeight=this.elements.multiCallControl.height(),selectedTab=this.getCurrentSelectedTab(),wndWidth=$(window).width(),wndHeight=$(window).height(),height=0;tabPnlWidth=wndWidth-192,tabPnlHeight=wndHeight-120,this.elements.emailListControlPanel.emailListControl("resize",tabPnlHeight-multicallcontrolHeight,tabPnlWidth),this.resizeCallContactWidgetPanel(tabPnlHeight-multicallcontrolHeight,tabPnlWidth),$(".agentConsolePopout .withDialerPanel").css({height:wndHeight-32+"px"}),wndHeight>509||!0===this.initLoad?(this.initLoad=!1,$(".agentConsolePopout .contentPanel .widgetContentPanel .emailPnl").css({"min-height":wndHeight-116+"px"}),$("#emailEditor_wrap").css({"min-height":wndHeight-160+"px"}),$("#emailEditor_wrap").css({width:$(".agentConsolePopout .ChatPnl").width()-192+"px"}),IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&"block"===this.elements.ContactResultsNotesPanel.css("display")&&(height=this.elements.ContactResultsNotesPanel.height()),$(".agentConsolePopout .contentPanel .ContactRootPnl .ChatPnl .MessagePnl").css({"min-height":wndHeight-(194+height)+"px"}),this.onChatScrollRender(tabPnlWidth,tabPnlHeight),this.elements.dialPadControl.css({width:tabPnlWidth+"px",height:tabPnlHeight+"px"}),this.elements.agentListControl.css({width:tabPnlWidth+"px",height:tabPnlHeight+"px"}),this.elements.skillListControl.css({width:tabPnlWidth+"px",height:tabPnlHeight+"px"}),this.elements.addressBookControl.css({width:tabPnlWidth+"px",height:tabPnlHeight+"px"}),this.elements.contactHistoryControl.css({width:tabPnlWidth+"px",height:tabPnlHeight+"px"}),this.elements.agentInfoControl.css({width:tabPnlWidth+"px",height:tabPnlHeight+"px"}),this.elements.promiseKeeperControl.css({width:tabPnlWidth+"px",height:tabPnlHeight+"px"}),this.elements.promiseKeeperDetailsControl.css({width:tabPnlWidth+"px",height:tabPnlHeight+"px"}),this.elements.promiseKeeperDateTimeControl.css({width:tabPnlWidth+"px",height:tabPnlHeight+"px"}),"agents"===selectedTab?this.elements.agentListControl.agentList("resizeWidget",tabPnlWidth,tabPnlHeight):"skills"===selectedTab?this.elements.skillListControl.skillList("resizeWidget",tabPnlWidth,tabPnlHeight):"addressBook"===selectedTab?this.elements.addressBookControl.addressBook("resizeWidget",tabPnlWidth,tabPnlHeight):"history"===selectedTab?this.elements.contactHistoryControl.contactHistory("resizeWidget",tabPnlWidth,tabPnlHeight):"information"===selectedTab&&this.elements.agentInfoControl.agentInformation("resizeWidget",tabPnlWidth,tabPnlHeight),this.elements.promiseKeeperDetailsControl.promiseKeeperDetails("resize",tabPnlWidth,tabPnlHeight),this.elements.promiseKeeperDateTimeControl.promiseKeeperDateTime("resize",tabPnlWidth,tabPnlHeight)):this.onChatScrollRender(tabPnlWidth,tabPnlHeight),$(".tooltipStyle").css("width",$(".widgetContentPanel").width()-260+"px")},showAddCallPrompt:function(callback,noCallback){logger.debug("showConfirmationPrompt ");var callStateCnt=this.getContactStateCount("CallContactEvent"),workStateCnt=this.getContactStateCount("WorkItemContactEvent"),voiceMailCnt=this.getContactStateCount("VoiceMailContactEvent"),callStates=callStateCnt.states,workItemStates=workStateCnt.states,voiceMailStates=voiceMailCnt.states,prompt="",action="",holdContactId=null,that=this,noDialState={Ringing:!0,Dialing:!0,NaturalCallDialing:!0,NaturalCallRinging:!0,Incoming:!0};for(state in callStates)if(callStates.hasOwnProperty(state)&&noDialState.hasOwnProperty(state))return logger.info("Ignore showAddCallPrompt"),!0;for(state in workItemStates)if(workItemStates.hasOwnProperty(state)&&noDialState.hasOwnProperty(state))return logger.info("Ignore showAddCallPrompt"),!0;for(state in voiceMailStates)if(voiceMailStates.hasOwnProperty(state)&&noDialState.hasOwnProperty(state))return logger.info("Ignore showAddCallPrompt"),!0;if(1===callStateCnt.totalCnt||2===callStateCnt.totalCnt&&IC_Validation.isValidObject(callStates.Disconnected)&&1==callStateCnt.states.Disconnected.count?IC_Validation.isValidObject(callStates.Holding)&&1===callStates.Holding.count||(IC_Validation.isValidObject(callStates.Active)?(prompt=IC_Localization.activeCallShouldBePutOnHold,holdContactId=callStateCnt.states.Active.contacts[0].id,action="hold"):(prompt=IC_Localization.currentContactErrorAttempt,action="acwContact")):2===callStateCnt.totalCnt?IC_Validation.isValidObject(callStates.Joined)&&2===callStates.Joined.count||(prompt=IC_Localization.confTheExistingCalls,action="conference"):1===workStateCnt.totalCnt&&(IC_Validation.isValidObject(workItemStates.Holding)&&1===workItemStates.Holding.count||(prompt=IC_Localization.holdCurrentWorkItemContact,holdContactId=workStateCnt.contacts[0].id,action="hold")),1===voiceMailCnt.totalCnt&&(IC_Validation.isValidObject(voiceMailStates.Holding)&&1===voiceMailStates.Holding.count||(prompt=IC_Localization.activeCallShouldBePutOnHold,holdContactId=voiceMailCnt.contacts[0].id,action="hold")),"acwContact"===action){var messages=[];messages.push({message:prompt,levelCss:"iMsg"}),this.showPopup(0,messages,1e4)}else""!==prompt?(this.elements.callMsgYesBtn.off("click"),this.elements.callMsgYesBtn.on("click",$.proxy(that.onClickCallMsgYesBtn,that,action,holdContactId,callback)),IC_Common.enterKeyPress(this.elements.callMsgYesBtn,function(){that.onClickCallMsgYesBtn(action,holdContactId,callback)}),this.elements.callMsgNoBtn.off("click"),"function"==typeof noCallback?(this.elements.callMsgNoBtn.on("click",function(){that.closeCallMsgPopup(),noCallback()}),IC_Common.enterKeyPress(this.elements.callMsgNoBtn,function(){that.closeCallMsgPopup(),noCallback()})):(this.elements.callMsgNoBtn.on("click",function(){that.closeCallMsgPopup()}),IC_Common.enterKeyPress(this.elements.callMsgNoBtn,function(){that.closeCallMsgPopup()})),this.addCallMessage("iMsg",prompt),this.elements.popupDiv.showfn(),this.elements.callMsgDiv.trigger("focus")):callback()},getContactStateCount:function(type){var typeLen,contactCnt={},contact=null,contacts=AgentConsoleDataStore.contacts,len=contacts.length,typeArray=null,i=0,j=0;for(contactCnt.contacts=[],contactCnt.states={},contactCnt.totalCnt=0,typeLen=(typeArray=IC_Validation.isNotNullOrEmptyArray(type)?type:[type]).length,i=0;i<len;i++)for(contact=contacts[i],j=0;j<typeLen;j++)contact.contactType!==typeArray[j]||"Disconnected"===contact.status&&!1!==contact.finalState&&"Discarded"===contact.status||("object"!=typeof contactCnt.states[contact.status]&&(contactCnt.states[contact.status]={contacts:[],count:0}),contactCnt.contacts.push(contact),contactCnt.states[contact.status].contacts.push(contact),contactCnt.states[contact.status].count++,contactCnt.totalCnt++);return contactCnt},onClickCallMsgYesBtn:function(action,holdContactId,callback){logger.trace("holdContactId: "+holdContactId," onClickCallMsgYesBtn - action :"+action),"conference"===action?AgentConsoleDataStore.conferenceContacts(callback):"hold"===action&&this.holdContact(holdContactId,callback),this.closeCallMsgPopup()},onClickTabDialPad:function(){if(IC_Common.isButtonEnabled(this.elements.tabDialpadIconDiv)||IC_Common.isButtonSelected(this.elements.tabDialpadIconDiv)){var that=this;this.elements.dialPadControl.dialPad("showMaxDialPadcss"),this.showAddCallPrompt(function(){that.switchTab("dialPad")})}},onClickTabAgents:function(){if(this.isWorkItemTransferClicked||this.isVoiceMailTransferClicked||this.isChatContactTransferClicked||this.isEmailContactTransferClicked)return this.hideTab("skills"),this.hideTab("addressBook"),void this.showTab("agents");this.switchTab("agents")},onClickTabSkills:function(){if(this.isWorkItemTransferClicked||this.isVoiceMailTransferClicked||this.isChatContactTransferClicked||this.isEmailContactTransferClicked)return this.hideTab("agents"),this.hideTab("addressBook"),void this.showTab("skills");this.switchTab("skills")},onClickTabAddressBooks:function(){if(this.isChatContactTransferClicked)return this.hideTab("agents"),this.hideTab("skills"),void this.showTab("addressBook");this.switchTab("addressBook")},onClickTabContactHistory:function(){this.switchTab("history")},onClickTabAgentInfo:function(){this.switchTab("information")},onClickTabPromiseKeeper:function(e){(IC_Common.isButtonEnabled(this.elements.tabPromiseKeeperIconDiv)||IC_Common.isButtonSelected(this.elements.tabPromiseKeeperIconDiv))&&(this.switchTab("promiseKeeper"),this.elements.tabPromiseKeeperIconDiv.off("click"))},closeAgentInfoAndShowHome:function(){this.hideAgentInfo()},onAddCallClick:function(){logger.trace("onAddCallClick - clicked "),this.elements.dialPadControl.dialPad("showMaxDialPadcss"),this.onClickTabDialPad()},onkeyPadClose:function(){logger.trace("onkeyPadClose - clicked "),this.elements.keyPadControl.hide()},onkeyPadClick:function(){var that=this;logger.trace("onkeyPadClick - clicked "),this.elements.keyPadControl.toggle("slide",{direction:"up"},500,function(){that.elements.keyPadControl.keyPad("setKeyPadFocus")})},sendDTMFValue:function(dtmfValue){logger.trace("sendDTMFValue - dtmfValue :"+dtmfValue),AgentConsoleDataStore.sendDTMFTones(dtmfValue)},onMuteClick:function(){logger.trace("onMuteClick - leg muted :"+this.agentInfo.lgMuted),!0===this.agentInfo.lgMuted?AgentConsoleDataStore.unmuteAgent():AgentConsoleDataStore.muteAgent()},onTransferClick:function(e){var nonParkedContactLength=AgentConsoleDataStore.getNonParkedContactsCount();logger.trace("onTransferClick - contact count :"+nonParkedContactLength),nonParkedContactLength>1&&AgentConsoleDataStore.transferContacts()},onConferenceClick:function(e){var nonParkedContactLength=AgentConsoleDataStore.getNonParkedContactsCount();logger.trace("onConferenceClick - contact count :"+nonParkedContactLength),nonParkedContactLength>1&&AgentConsoleDataStore.conferenceContacts()},resumeContact:function(contactId){logger.trace("ContactID: "+contactId," resumeContact"),AgentConsoleDataStore.resumeContact(contactId)},resumeVoiceMailContact:function(contact){logger.trace("resumeVoiceMailContact - contactId :"+contact.id),AgentConsoleDataStore.resumeContact(contact.id)},callBackVoiceMailContact:function(contact,onSuccessCallback){logger.trace("callBackVoiceMailContact - contactId : "+contact.id),this.holdContact(contact.id,onSuccessCallback),this.showDialPadVM(contact)},holdContact:function(contactId,onSuccessCallback){logger.trace("ContactID: "+contactId," holdContact"),AgentConsoleDataStore.holdContact(contactId,onSuccessCallback)},endContact:function(contactId){logger.trace("ContactID: "+contactId," endContact"),AgentConsoleDataStore.endContact(contactId)},recordCall:function(contactId){logger.trace("ContactID: "+contactId," recordCall"),AgentConsoleDataStore.recordCall(contactId)},maskCallRecording:function(contactId){logger.trace("ContactID: "+contactId," maskCallRecording"),AgentConsoleDataStore.maskCall(contactId)},unmaskCallRecording:function(contactId){logger.trace("ContactID: "+contactId," unmaskCallRecording"),AgentConsoleDataStore.unmaskCall(contactId)},createNewpromiseKeeper:function(){logger.trace("createNewpromiseKeeper ");this.showTabControl(),this.switchTab("promiseKeeperDetails"),this.elements.promiseKeeperDetailsControl.promiseKeeperDetails("createNewPromise")},hideTab:function(tab){this.panelDisplayed="","dialPad"===tab?(IC_Common.unselectButton(this.elements.tabDialpadIconDiv),"block"===this.elements.dialPadControl.css("display")&&(this.sccPhoneNumber="",this.elements.dialPadControl.toggle("slide",{direction:"down"},250))):"agents"===tab?this.hideAgentList():"skills"===tab?this.hideSkillList():"addressBook"===tab?this.hideAddressBook():"history"===tab?this.hideContactHistory():"information"===tab?this.hideAgentInfo():"promiseKeeper"===tab?this.hidePromiseKeeper():"promiseKeeperDetails"===tab?(this.hidePromiseKeeperDetails(),this.hidePromiseKeeper()):"promiseKeeperDateTime"===tab&&(this.hidePromiseKeeperDateTime(),this.hidePromiseKeeperDetails(),this.hidePromiseKeeper())},showTab:function(tab){this.panelDisplayed=tab,"dialPad"===tab?this.showDialpad():"agents"===tab?this.showAgentList():"skills"===tab?(this.isWorkItemTransferClicked&&this.elements.skillListControl.skillList("updateCSSOnWorkItemTransferInPopout"),this.isChatContactTransferClicked&&this.elements.skillListControl.skillList("updateChatContactTransfer"),this.isEmailContactTransferClicked&&this.elements.skillListControl.skillList("updateEmailContactTransfer"),this.isVoiceMailTransferClicked&&this.elements.skillListControl.skillList("updateVoiceMailContactTransfer"),this.showSkillList()):"addressBook"===tab?this.showAddressBook():"history"===tab?this.showContactHistory():"information"===tab?this.showAgentInfo():"promiseKeeper"===tab?this.showPromiseKeeper():"promiseKeeperDetails"===tab?this.showPromiseKeeperDetails():"promiseKeeperDateTime"===tab&&this.showPromiseKeeperDateTime()},showDialpad:function(){var that=this;if(IC_Common.selectButton(this.elements.tabDialpadIconDiv),"none"===this.elements.dialPadControl.css("display")){var width=this.elements.dialPadControl.width(),height=this.elements.dialPadControl.height();this.elements.dialPadControl.toggle("slide",{direction:"down"},250,function(){that.elements.dialPadControl.dialPad("setDialPhoneNo",that.sccPhoneNumber),that.sccPhoneNumber=""}),this.elements.dialPadControl.css({width:width+"px",height:height+"px"}),this.elements.dialPadControl.dialPad("setFocusToDialPadHeader")}},showAgentList:function(callback){if(IC_Common.selectButton(this.elements.tabAgentsIconDiv),"none"===this.elements.agentListControl.css("display")){var width=this.elements.agentListControl.width(),height=this.elements.agentListControl.height();AgentConsoleDataStore.pollAgentsCache=!0,AgentConsoleDataStore.failureCount=0,this.elements.agentListControl.toggle("slide",{direction:"down"},250,callback),this.elements.agentListControl.agentList("resizeWidget",width,height,!0),this.elements.agentListControl.agentList("setFocusToAgentListHeader")}},hideAgentList:function(callback){var isButtonSelected=IC_Common.isButtonSelected(this.elements.tabAgentsIconDiv);IC_Common.unselectButton(this.elements.tabAgentsIconDiv),"block"===this.elements.agentListControl.css("display")&&!0===isButtonSelected&&(AgentConsoleDataStore.pollAgentsCache=!1,this.elements.agentListControl.toggle("slide",{direction:"down"},250,callback))},showSkillList:function(callback){if(IC_Common.selectButton(this.elements.tabSkillsIconDiv),"none"===this.elements.skillListControl.css("display")){var width=this.elements.skillListControl.width(),height=this.elements.skillListControl.height();this.updateSkillListQueue=!0,this.elements.skillListControl.toggle("slide",{direction:"down"},250,callback),this.elements.skillListControl.skillList("resizeWidget",width,height),this.elements.skillListControl.skillList("setFocusToSkillListHeader")}},hideSkillList:function(callback){var isButtonSelected=IC_Common.isButtonSelected(this.elements.tabSkillsIconDiv);IC_Common.unselectButton(this.elements.tabSkillsIconDiv),"block"===this.elements.skillListControl.css("display")&&!0===isButtonSelected&&(this.updateSkillListQueue=!1,this.elements.skillListControl.toggle("slide",{direction:"down"},250,callback))},showAddressBook:function(callback){if(IC_Common.selectButton(this.elements.tabAddressBookIconDiv),"none"===this.elements.addressBookControl.css("display")){var width=this.elements.addressBookControl.width(),height=this.elements.addressBookControl.height();this.elements.addressBookControl.toggle("slide",{direction:"down"},250,callback),AgentConsoleDataStore.getAddressBook(),this.elements.addressBookControl.addressBook("resizeWidget",width,height),this.elements.addressBookControl.addressBook("setFocusToAddressBookHeader")}},hideAddressBook:function(callback){IC_Common.unselectButton(this.elements.tabAddressBookIconDiv),"block"===this.elements.addressBookControl.css("display")&&this.elements.addressBookControl.toggle("slide",{direction:"down"},250,callback)},showContactHistory:function(callback){if(IC_Common.selectButton(this.elements.tabHistoryIconDiv),this.elements.contactHistoryControl.contactHistory("setVisibility",!0),"none"===this.elements.contactHistoryControl.css("display")){var width=this.elements.contactHistoryControl.width(),height=this.elements.contactHistoryControl.height();this.elements.contactHistoryControl.toggle("slide",{direction:"down"},250,callback),this.elements.contactHistoryControl.contactHistory("resizeWidget",width,height),this.elements.contactHistoryControl.contactHistory("setFocusToContactHistoryHeader")}},hideContactHistory:function(callback){IC_Common.unselectButton(this.elements.tabHistoryIconDiv),this.elements.contactHistoryControl.contactHistory("setVisibility",!1),"block"===this.elements.contactHistoryControl.css("display")&&this.elements.contactHistoryControl.toggle("slide",{direction:"down"},250,callback)},onAddressBooksUpdate:function(){"block"===this.elements.addressBookControl.css("display")&&this.elements.addressBookControl.addressBook("updateMetaData",AgentConsoleDataStore.addressBookList)},getAddressBookEntries:function(addressBookName,callback,searchText,sortField){AgentConsoleDataStore.getAddressBookEntries(addressBookName,callback,searchText,sortField)},getDynamicAddressBookEntries:function(addressBookId,isFullLoad,updatedSince,callback){AgentConsoleDataStore.getDynamicAddressBookEntries(addressBookId,isFullLoad,updatedSince,callback)},getContactHistory:function(from,to,callback){AgentConsoleDataStore.getContactHistory(from,to,callback)},showTabControl:function(callback){var tabPanel=this.elements.tabPanel;logger.trace("showTabControl - fired"),tabPanel.stop(!0,!0),"none"===tabPanel.css("display")&&tabPanel.toggle("slide",{direction:"down"},250,function(){tabPanel.css("border-top","1px solid #D1D1D1"),"function"==typeof callback&&callback()})},showAgentInfo:function(callback){if(IC_Common.selectButton(this.elements.tabAgentInfoIconDiv),"none"===this.elements.agentInfoControl.css("display")){var width=this.elements.agentInfoControl.width(),height=this.elements.agentInfoControl.height();this.elements.agentInfoControl.toggle("slide",{direction:"down"},250,callback),this.elements.agentInfoControl.agentInformation("startTimer"),this.elements.agentInfoControl.agentInformation("resizeWidget",width,height),this.elements.agentInfoControl.agentInformation("setFocusToAgentInfoHeader")}},hideAgentInfo:function(callback){IC_Common.unselectButton(this.elements.tabAgentInfoIconDiv),"block"===this.elements.agentInfoControl.css("display")&&(this.elements.agentInfoControl.toggle("slide",{direction:"down"},250,callback),this.elements.agentInfoControl.agentInformation("clearTimer"))},showPromiseKeeper:function(callback){IC_Common.selectButton(this.elements.tabPromiseKeeperIconDiv),logger.trace("showPromiseKeeper - display "+this.elements.promiseKeeperControl.css("display")),"none"===this.elements.promiseKeeperControl.css("display")&&(this.elements.promiseKeeperControl.toggle("slide",{direction:"down"},250,callback),this.elements.promiseKeeperControl.promiseKeeper("setFocusToCommitmentHeader"))},hidePromiseKeeper:function(callback){IC_Common.unselectButton(this.elements.tabPromiseKeeperIconDiv),logger.trace("hidePromiseKeeper - display "+this.elements.promiseKeeperControl.css("display")),"block"===this.elements.promiseKeeperControl.css("display")&&this.elements.promiseKeeperControl.toggle("slide",{direction:"down"},250,callback),this.elements.tabPromiseKeeperIconDiv.on("click",$.proxy(this.onClickTabPromiseKeeper,this))},closePromiseKeeperAndShowHome:function(){logger.trace("closePromiseKeeperAndShowHome "),this.hidePromiseKeeper(function(){})},showPromiseKeeperDetails:function(callback){logger.trace("showPromiseKeeperDetails - display "+this.elements.promiseKeeperDetailsControl.css("display")),"none"===this.elements.promiseKeeperDetailsControl.css("display")&&(this.elements.promiseKeeperDetailsControl.toggle("slide",{direction:"down"},250,callback),this.elements.promiseKeeperDetailsControl.promiseKeeperDetails("setFocusToCommitmentDetailsHeader"))},hidePromiseKeeperDetails:function(callback){logger.trace("hidePromiseKeeperDetails - display "+this.elements.promiseKeeperDetailsControl.css("display")),"block"===this.elements.promiseKeeperDetailsControl.css("display")&&this.elements.promiseKeeperDetailsControl.toggle("slide",{direction:"down"},250,function(){callback&&callback()})},closePromiseKeeperDetailsAndShowHome:function(){logger.trace("closePromiseKeeperDetailsAndShowHome ");this.hidePromiseKeeperDetails(function(){})},showDialPadVM:function(contact){this.elements.dialPadControl.dialPad("dialPadVM",contact),this.elements.dialPadControl.stop(!0,!0),this.sccPhoneNumber=contact.from,this.showDialpad()},switchTab:function(tab){var currentSelectedTab=this.getCurrentSelectedTab();currentSelectedTab!==tab&&("promiseKeeperDetails"!=tab&&"promiseKeeperDateTime"!=tab&&this.hideTab(currentSelectedTab),this.showTab(tab))},getCurrentSelectedTab:function(){return IC_Common.isButtonSelected(this.elements.tabDialpadIconDiv)?"dialPad":IC_Common.isButtonSelected(this.elements.tabAgentsIconDiv)?"agents":IC_Common.isButtonSelected(this.elements.tabSkillsIconDiv)?"skills":IC_Common.isButtonSelected(this.elements.tabAddressBookIconDiv)?"addressBook":IC_Common.isButtonSelected(this.elements.tabHistoryIconDiv)?"history":IC_Common.isButtonSelected(this.elements.tabAgentInfoIconDiv)?"information":"block"===this.elements.promiseKeeperDateTimeControl.css("display")?"promiseKeeperDateTime":"block"===this.elements.promiseKeeperDetailsControl.css("display")?"promiseKeeperDetails":"block"===this.elements.promiseKeeperControl.css("display")?"promiseKeeper":void 0},closeDialPad:function(callback){if(logger.trace("closeDialPad - display "+this.elements.dialPadControl.css("display")),"block"===this.elements.dialPadControl.css("display")){var that=this;this.elements.dialPadControl.toggle("slide",{direction:"down"},250,function(){that.elements.dialPadControl.dialPad("setDialPhoneNo",""),"function"==typeof callback&&callback()}),IC_Common.unselectButton(this.elements.tabDialpadIconDiv)}},closeAgentListAndShowHome:function(){this.isWorkItemTransferClicked&&(this.isWorkItemTransferClicked=!1,this.activeContactWidgets[this.workItemIdToTransfer].workItemContactPanel("enableDisbleBtnOnTransfer",this.isWorkItemTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isWorkItemTransferClicked,"WorkItem")),this.isVoiceMailTransferClicked&&(this.isVoiceMailTransferClicked=!1,this.activeContactWidgets[this.voiceMailIdToTransfer].voiceMailContactPanel("enableDisbleBtnOnTransfer",this.isVoiceMailTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isVoiceMailTransferClicked,"VoiceMail")),this.isChatContactTransferClicked&&(this.isChatContactTransferClicked=!1,this.activeContactWidgets[this.chatContactIdToTransfer].chatPopoutContactPanel("enableDisbleBtnOnTransfer",this.isChatContactTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isChatContactTransferClicked,"Chat")),this.isEmailContactTransferClicked&&(this.isEmailContactTransferClicked=!1,this.activeContactWidgets[this.emailContactIdToTransfer].emailContactControl("enableDisbleBtnOnTransfer",this.isEmailContactTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isEmailContactTransferClicked,"E-Mail")),this.hideAgentList()},closeSkillListAndShowHome:function(){this.isWorkItemTransferClicked&&(this.isWorkItemTransferClicked=!1,this.elements.skillListControl.skillList("resetFlag"),this.elements.skillListControl.skillList("updateMetaData","skills",AgentConsoleDataStore.allSkillList),this.activeContactWidgets[this.workItemIdToTransfer].workItemContactPanel("enableDisbleBtnOnTransfer",this.isWorkItemTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isWorkItemTransferClicked,"WorkItem")),this.isVoiceMailTransferClicked&&(this.isVoiceMailTransferClicked=!1,this.elements.skillListControl.skillList("resetFlag"),this.elements.skillListControl.skillList("updateMetaData","skills",AgentConsoleDataStore.allSkillList),this.activeContactWidgets[this.voiceMailIdToTransfer].voiceMailContactPanel("enableDisbleBtnOnTransfer",this.isVoiceMailTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isVoiceMailTransferClicked,"VoiceMail")),this.isChatContactTransferClicked&&(this.isChatContactTransferClicked=!1,this.elements.skillListControl.skillList("resetFlag"),this.elements.skillListControl.skillList("updateMetaData","skills",AgentConsoleDataStore.allSkillList),this.activeContactWidgets[this.chatContactIdToTransfer].chatPopoutContactPanel("enableDisbleBtnOnTransfer",this.isChatContactTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isChatContactTransferClicked,"Chat")),this.isEmailContactTransferClicked&&(this.isEmailContactTransferClicked=!1,this.elements.skillListControl.skillList("resetFlag"),this.elements.skillListControl.skillList("updateMetaData","skills",AgentConsoleDataStore.allSkillList),this.activeContactWidgets[this.emailContactIdToTransfer].emailContactControl("enableDisbleBtnOnTransfer",this.isEmailContactTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isEmailContactTransferClicked,"E-Mail")),this.hideSkillList()},closeAddressBookAndShowHome:function(){this.isChatContactTransferClicked&&(this.isChatContactTransferClicked=!1,this.activeContactWidgets[this.chatContactIdToTransfer].chatPopoutContactPanel("enableDisbleBtnOnTransfer",this.isChatContactTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isChatContactTransferClicked,"Chat")),this.hideAddressBook()},closeContactHistoryAndShowHome:function(){this.hideContactHistory()},onAgentStateChange:function(){this.elements.agentListControl.agentList("updateData",AgentConsoleDataStore.agentListMap,AgentConsoleDataStore.agentInfo.id),this.elements.skillListControl.skillList("updateData",AgentConsoleDataStore.agentListMap)},onTeamListUpdate:function(){this.elements.agentListControl.agentList("updateMetaData","teams",AgentConsoleDataStore.teamList),this.elements.skillListControl.skillList("updateMetaData","teams",AgentConsoleDataStore.teamList)},onPromiseKeeperUpdate:function(){logger.trace("onPromiseKeeperUpdate - fired"),this.elements.promiseKeeperControl.promiseKeeper("updatePromiseKeeper","promiseKeeperList",AgentConsoleDataStore.promiseKeeperList)},onFileExtensionsList:function(){this.elements.emailPopoutContentPanel.emailDetailPopoutControl("restrictEmailAttachment",AgentConsoleDataStore.fileExtList)},onSkillListUpdate:function(){AgentConsoleDataStore.contacts;this.elements.agentListControl.agentList("updateMetaData","skills",AgentConsoleDataStore.allSkillList),this.elements.skillListControl.skillList("updateMetaData","skills",AgentConsoleDataStore.allSkillList),this.elements.contactHistoryControl.contactHistory("updateMetaData",AgentConsoleDataStore.allSkillList),this.updateAllContactWidgets()},onAgentListUpdate:function(){logger.trace("onAgentListUpdate - fired"),this.updateAllContactWidgets()},onAgentSkillAssignmentsUpdate:function(){this.elements.agentListControl.agentList("updateMetaData","agentSkill",AgentConsoleDataStore.agentSkillMap),this.elements.skillListControl.skillList("updateMetaData","agentSkill",AgentConsoleDataStore.agentSkillMap)},updateAllContactWidgets:function(){logger.trace("updateAllContactWidgets ...");var i=0,len=AgentConsoleDataStore.contacts.length,contact=null;for(i=0;i<len;i++)contact=AgentConsoleDataStore.contacts[i],IC_Validation.isValidObject(contact)&&(this.activeContactWidgets.hasOwnProperty(contact.id)&&(this.addContactMetaData(contact),"CallContactEvent"===contact.contactType&&(this.activeContactWidgets[contact.id].callContactPanel("setCanMask",this.agentInfo.mask),this.activeContactWidgets[contact.id].callContactPanel("updateData",contact))),IC_Validation.isValidObject(this.acceptRejectPanel)&&"consultAcceptRejectPanel"===this.acceptRejectPanelType&&"Consult"===contact.type&&(this.addContactMetaData(contact),this.acceptRejectPanel.consultAcceptRejectPanel("updateAgentName",contact)))},createMultiContactControlsPanel:function(parent){IC_Localization.search;this.elements.contactsRootPanel=$('<div class="contactsRootPanel"/>').appendTo(parent),this.elements.mediaTabsDiv=$('<div class="mediaTabsDiv"/>').appendTo(this.elements.contactsRootPanel),this.omniTabDiv=$('<div class="mediaIconsDiv" id="omniTab" title="'+IC_Localization.omni+'"/>').css("display","none").on("click",$.proxy(this.showOmniContactTab,this)).appendTo(this.elements.mediaTabsDiv),this.omniTabIcon=$('<img class="omniMediaIcons" src="'+this.resourceBase+'/css/images/omni-icon-disable.png" />').appendTo(this.omniTabDiv);$('<div class="mediaText"/>').text(IC_Localization.omni).appendTo(this.omniTabDiv);this.omniIndicateIcon=$('<div class="mediaStateIcons" />').appendTo(this.omniTabDiv),this.omniTabDiv.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.omniTabDiv.off("mouseenter mouseleave "),this.omniTabDiv.off("click"),this.phoneTabDiv=$('<div class="mediaIconsDiv" id="phoneTab"  title="'+IC_Localization.phone+'"/>').on("click",$.proxy(this.showPhoneContactTab,this)).appendTo(this.elements.mediaTabsDiv),this.phoneTabIcon=$('<img class="phoneMediaIcons" src="'+this.resourceBase+'/css/images/agent-info-skills-phone.png" />').appendTo(this.phoneTabDiv);$('<div class="mediaText textEllipsis"/>').text(IC_Localization.phone).appendTo(this.phoneTabDiv);this.phoneIndicateIcon=$('<div class="mediaStateIcons" />').appendTo(this.phoneTabDiv),this.phoneTabDiv.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.chatTabDiv=$('<div class="mediaIconsDiv"  id="chatTab"  title="'+IC_Localization.chat+'"/>').on("click",$.proxy(this.showChatContactTab,this)).appendTo(this.elements.mediaTabsDiv),this.chatTabIcon=$('<img class="chatMediaIcons" src="'+this.resourceBase+'/css/images/chatIcn-dark.png" />').appendTo(this.chatTabDiv);$('<div class="mediaText textEllipsis"/>').text(IC_Localization.chat).appendTo(this.chatTabDiv);this.chatIndicateIcon=$('<div class="mediaStateIcons" />').appendTo(this.chatTabDiv),this.chatTabDiv.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.emailTabDiv=$('<div class="mediaIconsDiv" id="emailTab"   title="'+IC_Localization.email+'"/>').on("click",$.proxy(this.showEmailContactTab,this)).appendTo(this.elements.mediaTabsDiv),this.emailTabIcon=$('<img class="emailMediaIcons" src="'+this.resourceBase+'/css/images/mail.png" />').appendTo(this.emailTabDiv);$('<div class="mediaText textEllipsis"/>').text(IC_Localization.email).appendTo(this.emailTabDiv);this.emailIndicateIcon=$('<div class="mediaStateIcons"/>').appendTo(this.emailTabDiv),this.emailTabDiv.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.voicemailTabDiv=$('<div class="mediaIconsDiv" id="voicemailTab"   title="'+IC_Localization.voicemail+'"/>').css("width","130px").on("click",$.proxy(this.showVoiceMailContactTab,this)).appendTo(this.elements.mediaTabsDiv),this.voicemailTabIcon=$('<img class="vmMediaIcons" src="'+this.resourceBase+'/css/images/personal-connection-override-answer-machine.png" />').appendTo(this.voicemailTabDiv);$('<div class="mediaText textEllipsis"/>').css("width","60px").text(IC_Localization.voicemail).appendTo(this.voicemailTabDiv);this.voicemailIndicateIcon=$('<div class="mediaStateIcons" />').appendTo(this.voicemailTabDiv),this.voicemailTabDiv.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.workItemTabDiv=$('<div class="mediaIconsDiv"  id="workitemTab"  title="'+IC_Localization.workItem+'"/>').css("width","130px").on("click",$.proxy(this.showWorkItemContactTab,this)).appendTo(this.elements.mediaTabsDiv),this.workItemTabIcon=$('<img class="workItemMediaIcons" src="'+this.resourceBase+'/css/images/agent-info-skills-work-item.png" />').appendTo(this.workItemTabDiv);$('<div class="mediaText textEllipsis"/>').css("width","65px").text(IC_Localization.workItem).appendTo(this.workItemTabDiv);this.workItemIndicateIcon=$('<div class="mediaStateIcons" />').appendTo(this.workItemTabDiv),this.workItemTabDiv.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.elements.multiCallControl.appendTo(this.elements.contactsRootPanel),this.elements.acceptRejectPanelContainer=$("<div>").appendTo(this.elements.contactsRootPanel),this.elements.omniContactTab=$('<div class="activeContactsPanel" id = "mainWin_ActiveContactsPanelId" />').appendTo(this.elements.contactsRootPanel),this.elements.omniContactWidgetPanel=$('<div class="widgetPanel"/>').appendTo(this.elements.omniContactTab),this.elements.phoneContactTab=$('<div class="activeContactsPanel"/>').appendTo(this.elements.contactsRootPanel),this.elements.phoneContactWidgetPanel=$('<div class="widgetPanel callWidgetPanel"/>').appendTo(this.elements.phoneContactTab),this.elements.phoneContacts=$('<div id="phoneContactsWidget"/>').appendTo(this.elements.phoneContactWidgetPanel),this.elements.phoneContainer=$("<div/>").appendTo(this.elements.phoneContacts),this.elements.chatContactTab=$('<div class="widgetPanelChatView"/>').css("display","none").appendTo(this.elements.contactsRootPanel),this.elements.emailContactTab=$('<div class="activeContactsPanel"/>').appendTo(this.elements.contactsRootPanel),this.elements.emailWidgetPanel=$('<div class="widgetPanel"/>').appendTo(this.elements.emailContactTab),this.elements.emailWidgetContentPanel=$("<div class='widgetContentPanel'>").appendTo(this.elements.emailContactTab),this.elements.voiceMailContactTab=$('<div class="activeContactsPanel" />').appendTo(this.elements.contactsRootPanel),this.elements.voiceMailWidget=$('<div class="voiceMailWidget" />').appendTo(this.elements.voiceMailContactTab),this.elements.vmContactWidgetPanel=$('<div class=""/>').appendTo(this.elements.voiceMailWidget),this.elements.workItemContactTab=$('<div class="activeContactsPanel" />').appendTo(this.elements.contactsRootPanel),this.elements.wiContactWidgetPanel=$('<div class="widgetPanel"/>').appendTo(this.elements.workItemContactTab),this.elements.pcInventoryAndRinging=$("<div/>").appendTo(this.elements.phoneContacts),this.element.callQueuePanel=$('<div class="ringName"/>'),this.element.callQueuePanel.appendTo(this.elements.pcInventoryAndRinging),this.element.skillRunningLow=$('<div class="skillRunningLow btnDivEnable" />'),this.element.skillRunningLow.text(IC_Localization.recordInventoryLow),this.element.skillRunningLow.appendTo(this.elements.pcInventoryAndRinging),this.elements.emailListControlPanel.appendTo(this.elements.emailWidgetPanel),this.elements.emailPopoutContentPanel=$("<div/>").emailDetailPopoutControl({controller:this,resourceBase:this.options.resourceBase}).appendTo(this.elements.emailWidgetContentPanel),this.showContactsRootPanel()},chatPopoutMessageEditorController:null,createChatPopoutMessageEditor:function(contact){this.elements.chatMessageEditor=$("<div/>").appendTo(this.elements.contactsRootPanel),this.elements.chatMessageEditor,this.chatPopoutMessageEditorController=this.chatPopoutMsgEditorController(),this.elements.chatMessageEditor.chatPopoutMessageEditor({controller:this.chatPopoutMessageEditorController,contact:{},resourceBase:this.options.resourceBase,container:this})},showOmniContactTab:function(){var getSelected=this.getCurrentSelectedMediaTab();this.isChatTabSelected=!1,this.isEmailTabSelected=!1,this.onChatHide(),"OmniContact"!==getSelected&&(this.hideSelectedMediaTabControl(getSelected),this.elements.omniContactTab.showfn(),this.enableTabBGColor(this.omniTabDiv))},showPhoneContactTab:function(){var getSelected=this.getCurrentSelectedMediaTab();this.isChatTabSelected=!1,this.isEmailTabSelected=!1,this.onChatHide(),"Phone"!==getSelected&&(this.hideSelectedMediaTabControl(getSelected),this.elements.phoneContactTab.showfn(),this.enableTabBGColor(this.phoneTabDiv),this.showResultandNotesforPhone_VM_WI())},showChatContactTab:function(){var getSelected=this.getCurrentSelectedMediaTab();if(this.chatIndicateIcon.addClass("viewedContactTabIndicate"),this.chatIndicateIcon.removeClass("newContactTabIndicate noReplyNewContact"),this.isChatTabSelected=!0,this.isEmailTabSelected=!1,"Chat"!==getSelected){var contact=this.findActiveChat();IC_Validation.isNotNullOrEmpty(contact)&&"Incoming"!==contact.status&&this.onChatShow(contact.status),this.showResultandNotesforChat_Email(contact),this.hideSelectedMediaTabControl(getSelected),this.elements.chatContactTab.showfn(),this.enableTabBGColor(this.chatTabDiv),this.chatIndicateIcon.addClass("viewedContactTabIndicate").removeClass("newContactTabIndicate")}},showEmailContactTab:function(){var getSelected=this.getCurrentSelectedMediaTab();this.isEmailTabSelected=!0,this.isChatTabSelected=!1,this.onChatHide(),"Email"!==getSelected?(this.hideSelectedMediaTabControl(getSelected),this.elements.emailContactTab.showfn(),this.enableTabBGColor(this.emailTabDiv),this.selectEmailTabContact()):this.selectEmailTabContact()},showVoiceMailContactTab:function(){var getSelected=this.getCurrentSelectedMediaTab();this.isChatTabSelected=!1,this.isEmailTabSelected=!1,this.onChatHide(),"VoiceMail"!==getSelected&&(this.hideSelectedMediaTabControl(getSelected),this.elements.voiceMailContactTab.showfn(),this.enableTabBGColor(this.voicemailTabDiv),this.showResultandNotesforPhone_VM_WI())},showWorkItemContactTab:function(){var getSelected=this.getCurrentSelectedMediaTab();this.isChatTabSelected=!1,this.isEmailTabSelected=!1,this.onChatHide(),"WorkItem"!==getSelected&&(this.hideSelectedMediaTabControl(getSelected),this.elements.workItemContactTab.showfn(),this.enableTabBGColor(this.workItemTabDiv),this.showResultandNotesforPhone_VM_WI())},onChatHide:function(){IC_Validation.isValidObject(this.elements.chatMessageEditor)&&"block"===this.elements.chatMessageEditor.css("display")&&this.elements.chatMessageEditor.chatPopoutMessageEditor("hide")},onChatShow:function(status){var height=this.getResultNotesdispHeight();!0!==IC_Common.toBoolean(localStorage.isPanelExpanded)?height+=30:height+=150,"Disconnected"===status&&(height=0),IC_Validation.isValidObject(this.elements.chatMessageEditor)&&this.elements.chatMessageEditor.chatPopoutMessageEditor("show",height)},isChatMessageEditorOverlay:function(contactStatus){var mode="hide";"Disconnected"==contactStatus&&(mode="show"),void 0!=this.elements.chatMessageEditor&&this.elements.chatMessageEditor.chatPopoutMessageEditor("isChatMessageEditorOverlay",mode)},showContactsRootPanel:function(){this.elements.contactsRootPanel.stop(!0,!0),"none"===this.elements.contactsRootPanel.css("display")&&this.elements.contactsRootPanel.toggle("slide",{direction:"down"},250)},hideContactsRootPanel:function(){},onChatScrollRender:function(width,height){if(AgentConsoleDataStore.contacts.length>0){var contact,i=0,contacts=AgentConsoleDataStore.contacts,resultNotesHt=0;for(i=0;i<contacts.length;i++)"ChatContactEvent"===(contact=contacts[i]).contactType&&this.activeContactWidgets.hasOwnProperty(contact.id)?(IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&"block"===this.elements.ContactResultsNotesPanel.css("display")&&(resultNotesHt=this.elements.ContactResultsNotesPanel.height()),this.activeContactWidgets[contact.id].chatPopoutContactPanel("renderCustomScroll",width,height-resultNotesHt),IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&"block"===this.elements.ContactResultsNotesPanel.css("display")&&this.elements.ContactResultsNotesPanel.css({bottom:"46px"})):"EmailContactEvent"===contact.contactType&&this.activeContactWidgets.hasOwnProperty(contact.id)?(this.activeContactWidgets[contact.id],this.elements.emailPopoutContentPanel.emailDetailPopoutControl("resizeWidget",width,height)):"EmailContactEvent"!==contact.contactType&&(this.activeContactWidgets.hasOwnProperty(contact.id)||"pcAcceptRejectControl"===this.acceptRejectPanelType)&&IC_Validation.isValidObject(this.contactResultPanel)&&"block"===this.contactResultPanel.css("display")&&this.contactResultPanel.resultsAndNotesControl("resizeWidget")}},onChatMsgUpdate:function(eventData,isIntialLoad){if(AgentConsoleDataStore.contacts.length>0){var contact,i=0,contacts=Object.clone(AgentConsoleDataStore.contacts),chatWidget=null,lastContactId=AgentConsoleDataStore.chatMsgUpdatedContactId;for(i=0;i<contacts.length;i++)contact=contacts[i],IC_Validation.isNullOrEmpty(lastContactId)||!0===AgentConsoleDataStore.chatMsgIntialLoad?"ChatContactEvent"===contact.contactType&&this.activeContactWidgets.hasOwnProperty(contact.id)&&(chatWidget=this.activeContactWidgets[contact.id],IC_Validation.isNotNullOrEmptyArray(AgentConsoleDataStore.chatMsg[contact.id])&&chatWidget.chatPopoutContactPanel("updateMetaData","chatText",AgentConsoleDataStore.chatMsg[contact.id])):lastContactId===contact.id&&this.activeContactWidgets.hasOwnProperty(contact.id)&&(chatWidget=this.activeContactWidgets[contact.id],IC_Validation.isNotNullOrEmptyArray(AgentConsoleDataStore.chatMsg[contact.id])&&chatWidget.chatPopoutContactPanel("updateMetaData","chatText",AgentConsoleDataStore.chatMsg[contact.id]));!0===isIntialLoad&&(AgentConsoleDataStore.chatMsgIntialLoad=!1)}},chatContactCount:function(){var contact,i=0,chatContactCount=0,contacts=AgentConsoleDataStore.contacts,contactToShow="",lstChatId=[];for(i=0;i<contacts.length;i++)"ChatContactEvent"===(contact=contacts[i]).contactType&&(lstChatId[contact.id]=!0,chatContactCount++),!0===contact.active&&(contact.status,contactToShow=contact.id,contact.lastStateTime);for(contactId in this.chatDisconnectedWidget)this.chatDisconnectedWidget.hasOwnProperty(contactId)&&!lstChatId.hasOwnProperty(contactId)&&chatContactCount++;return{id:contactToShow,count:chatContactCount}},onContactUpdate:function(event,eventType){if(latestContact=null,AgentConsoleDataStore.contacts.length>0){var contact,i=0,contacts=(AgentConsoleDataStore.getNonParkedContacts(),Object.clone(AgentConsoleDataStore.contacts)),aInfo=AgentConsoleDataStore.agentInfo,chatResult=this.chatContactCount();for(this.isChatContactPanel=0!==chatResult.count,aInfo.contacts=AgentConsoleDataStore.contacts,i=0;i<contacts.length;i++)null!==(contact=contacts[i])&&void 0!==contact&&("CallContactEvent"===contact.contactType?(this.onCallContact(contact),this.showResultandNotesforPhone_VM_WI()):"WorkItemContactEvent"===contact.contactType?(this.onWorkItemContact(contact),this.showResultandNotesforPhone_VM_WI()):"ChatContactEvent"===contact.contactType?(this.onChatContact(contact,chatResult.count,chatResult.id),this.showResultandNotesforChat_Email(contact)):"EmailContactEvent"===contact.contactType?this.onEmailContact(contact):"VoiceMailContactEvent"===contact.contactType&&(this.onVoiceMailContact(contact),this.showResultandNotesforPhone_VM_WI()));showPCQueueContact=this.showDialerNotification(),!1===showPCQueueContact?(this.element.callQueuePanel.hide(),this.element.skillRunningLow.hide()):(this.onSkillRunningLowUpdate(),this.onPCQueueCountUpdate()),this.toggleMulticallControls_Base(),this.elements.agentInfoControl.agentInformation("updateMetaData","Info",aInfo)}IC_Validation.isNotNullOrEmpty(this.callContacts)&&1===this.callContacts.length&&this.toggleHpIconDialPad(),this.isTabNeedToShow()||(logger.trace("onContactUpdate : hideContactsRootPanel"),this.hideContactsRootPanel())},onCallContact:function(contact){var callWidget=null,isConsult=this.isNaturalCall(contact)&&"Consult"===contact.type&&("Incoming"===contact.status||"Ringing"===contact.status);if(contact=this.addContactMetaData(contact),this.elements.phoneContacts.mCustomScrollbar("destroy"),this.elements.phoneContacts.removeAttr("style"),logger.debug("ContactID: "+contact.id," onCallContact - status :"+contact.status),"Consult"===contact.type||this.isNaturalCall(contact)&&contact.hasOwnProperty("deliveryType")&&"ClickToCall"===contact.deliveryType){if(("Incoming"===contact.status||"Ringing"===contact.status)&&!1===this.isNaturalCall(contact)&&"Consult"===contact.type)return void(IC_Validation.isValidObject(this.acceptRejectPanel)||(this.onAcceptRejectPanelShow(contact),logger.debug("onCallContact - creating consult accept reject panel"),this.acceptRejectPanel=$('<div class="ContactRootPnl acceptRejectContatier" />').consultAcceptRejectPanel({controller:this,contact:contact,agentLegState:this.agentInfo.lgState,resourceBase:this.options.resourceBase}).appendTo(this.elements.phoneContactTab),this.acceptRejectPanelType="consultAcceptRejectPanel"));if(this.isNaturalCall(contact)&&"Preview"===contact.status||isConsult)return void(IC_Validation.isValidObject(this.acceptRejectPanel)||(this.onAcceptRejectPanelShow(contact),logger.debug("onCallContact - creating PC accept reject panel"),this.accpId=contact.id,this.acceptRejectPanel=$('<div class="ContactRootPnl" />').pcAcceptRejectControl({controller:this,contact:contact,agentLegState:this.agentInfo.lgState,resourceBase:this.options.resourceBase,isConsult:isConsult}).appendTo(this.elements.phoneContainer),this.acceptRejectPanelType="pcAcceptRejectControl",this.renderCustomScroll(this.elements.phoneContacts)));if(IC_Validation.isValidObject(this.acceptRejectPanel))if(logger.trace("ContactID: "+contact.id," onContactUpdate: Valid AcceptRejectPanel"),this.isNaturalCall(contact)&&contact.id===this.acceptRejectPanel.pcAcceptRejectControl("getContactId")){if(logger.debug("ContactID: "+contact.id," onContactUpdate: Destroy AcceptRejectPanel"),this.acceptRejectPanel.pcAcceptRejectControl("destroy"),AgentConsoleDataStore.pcPreviewNotesUpdate(),"Disconnected"===contact.status)return void this.destroyContactWidget(contact)}else if("consultAcceptRejectPanel"===this.acceptRejectPanelType&&contact.id===this.acceptRejectPanel.consultAcceptRejectPanel("getContactId")&&(logger.debug("ContactID: "+contact.id," onContactUpdate: Destroy AcceptRejectPanel"),this.acceptRejectPanel.consultAcceptRejectPanel("destroy"),"Disconnected"===contact.status))return void this.destroyContactWidget(contact)}this.activeContactWidgets.hasOwnProperty(contact.id)?(logger.debug("onContactUpdate- updating : callContactPanel "),callWidget=this.activeContactWidgets[contact.id]):"Disconnected"===contact.status&&!0===contact.finalState||(this.onNewContactWidgetCreated(contact),logger.debug("onContactUpdate- create : callContactPanel "),callWidget=$('<div class="ContactRootPnl contactWidgetInPopout" id = "callContactWidgetIdInPopout" />').callContactPanel({controller:this,resourceBase:this.options.resourceBase,canMask:this.agentInfo.mask,contact:contact,isPopout:this.options.isPopout}).appendTo(this.elements.phoneContainer),this.activeContactWidgets[contact.id]=callWidget,this.activeContactTypes[contact.id]=contact.contactType,this.contactType=contact.contactType),IC_Validation.isNotNull(callWidget)&&(callWidget.callContactPanel("updateData",contact),callWidget.callContactPanel("updatePermissionsList",AgentConsoleDataStore.permissionsList),this.renderCustomScroll(this.elements.phoneContacts)),"Disconnected"===contact.status&&(this.destroyContactWidget(contact),this.onCallContactDisconnect(contact))},onWorkItemContact:function(contact,canRoundTopCorners,canRoundBottomCorners){var workItemWidget=null;return contact=this.addContactMetaData(contact),logger.debug("ContactID: "+contact.id," onWorkItemContact - status :"+contact.status),"Incoming"===contact.status?(IC_Validation.isValidObject(this.acceptRejectPanel)||(logger.debug("onWorkItemContact - creating accept reject panel"),this.onAcceptRejectPanelShow(contact),this.acceptRejectPanel=$('<div class="ContactRootPnl acceptRejectContatier" />').workItemAcceptRejectPanel({controller:this,contact:contact,resourceBase:this.options.resourceBase}).appendTo(this.elements.workItemContactTab),this.acceptRejectPanelType="workItemAcceptRejectPanel"),void this.onWorkItemContactAcceptRejectPanelShow(contact)):IC_Validation.isValidObject(this.acceptRejectPanel)&&contact.id===this.acceptRejectPanel.workItemAcceptRejectPanel("getContactId")&&(logger.debug("onWorkItemContact - destroy accept reject panel"),this.acceptRejectPanel.workItemAcceptRejectPanel("destroy"),"Disconnected"===contact.status)?(this.destroyContactWidget(contact),void this.onWorkItemContactAcceptRejectPanelDestroy(contact)):(this.activeContactWidgets.hasOwnProperty(contact.id)?(logger.debug("onWorkItemContact - updating contact panel"),(workItemWidget=this.activeContactWidgets[contact.id]).workItemContactPanel("updateView",{canRoundTopCorners:canRoundTopCorners,canRoundBottomCorners:canRoundBottomCorners,contact:contact})):"Disconnected"===contact.status&&!0===contact.finalState||(this.onNewContactWidgetCreated(contact),logger.debug("onWorkItemContact - creating contact panel"),workItemWidget=$('<div class="ContactRootPnl" />').workItemContactPanel({controller:this,resourceBase:this.options.resourceBase,canRoundTopCorners:canRoundTopCorners,canRoundBottomCorners:canRoundBottomCorners,contact:contact,isPopout:this.options.isPopout}).appendTo(this.elements.wiContactWidgetPanel),this.activeContactWidgets[contact.id]=workItemWidget,this.activeContactTypes[contact.id]=contact.contactType,this.contactType=contact.contactType),IC_Validation.isNotNull(workItemWidget)&&workItemWidget.workItemContactPanel("updateData",contact),void("Disconnected"===contact.status&&this.destroyContactWidget(contact)))},onVoiceMailPlayBackUpdate:function(){var vmPlayBack=AgentConsoleDataStore.vmPlayBack;for(contactId in vmPlayBack)vmPlayBack.hasOwnProperty(contactId)&&this.activeContactWidgets.hasOwnProperty(contactId)&&this.activeContactWidgets[contactId].voiceMailContactPanel("updateVoiceMailPlayBackData",vmPlayBack[contactId])},onVoiceMailContact:function(contact){var voiceMailWidget=null;if(contact=this.addContactMetaData(contact),this.activeContactWidgets.hasOwnProperty(contact.id)?(logger.debug("onVoiceMailContact - updating voiceMailwidget"),voiceMailWidget=this.activeContactWidgets[contact.id]):"Discarded"===contact.status&&!0===contact.finalState&&"Disconnected"===contact.status||(this.onNewContactWidgetCreated(contact),logger.debug("onVoiceMailContact - creating voiceMailwidget"),voiceMailWidget=$('<div class="ContactRootPnl contactWidgetInPopout" />').voiceMailContactPanel({controller:this,resourceBase:this.options.resourceBase,contact:contact,useSecDisposition:contact.useSecDispositions,enableCallBack:this.enableHpDialIcon}).appendTo(this.elements.vmContactWidgetPanel),this.activeContactWidgets[contact.id]=voiceMailWidget,this.activeContactTypes[contact.id]=contact.contactType,this.contactType=contact.contactType),IC_Validation.isNotNull(voiceMailWidget)){voiceMailWidget.voiceMailContactPanel("updateData",contact);var duration=voiceMailWidget.voiceMailContactPanel("getPlayPosition");"Discarded"!==contact.status&&"Disconnected"!==contact.status||(!0===AgentConsoleDataStore.isVoiceMailDurationSave()?AgentConsoleDataStore.saveLastVoiceMailDuration(duration):(duration=AgentConsoleDataStore.getLastVoiceMailDuration(),voiceMailWidget.voiceMailContactPanel("setPlayPosition",duration)))}"Discarded"!==contact.status&&"Disconnected"!==contact.status||this.destroyContactWidget(contact)},playVoiceMail:function(playTimeStamp,position,contactId){AgentConsoleDataStore.playVoiceMail(playTimeStamp,position,contactId)},pauseVoiceMail:function(contactId){AgentConsoleDataStore.pauseVoiceMail(contactId)},hasOutBoundPhoneSkill:function(){return this.enableHpDialIcon},isNaturalCall:function(contact){var isNaturalCall=!1;return"NaturalCalling"===contact.type&&(isNaturalCall=!0),isNaturalCall},renderCustomScrollforWidget:function(){var targetElement=this.elements.emailWidgetPanel,elementHeight=targetElement.height();targetElement[0].scrollHeight>=elementHeight&&(targetElement.mCustomScrollbar("destroy"),targetElement.mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0,advanced:{autoScrollOnFocus:!1,updateOnContentResize:!0}}))},hasEmailDisposition:function(skillId){var skill=AgentConsoleDataStore.allSkillList[skillId];return IC_Validation.isValidObject(skill)&&(!0===skill.useDisposition||!0===skill.reqDisposition)},hasEmailAcw:function(skillId){var skill=AgentConsoleDataStore.allSkillList[skillId];return IC_Validation.isValidObject(skill)&&!0===skill.useAcw&&!1===skill.useDisposition},OnAgentIndicatorUpdate:function(){for(var contact,contacts=AgentConsoleDataStore.contacts,i=0;i<contacts.length;i++)if(contact=contacts[i],IC_Validation.isValidObject(contact)&&IC_Validation.isNotNullOrEmpty(AgentConsoleDataStore.indicators)&&IC_Validation.isNotNullOrEmpty(AgentConsoleDataStore.indicators.contactIndicator)){if("CallContactEvent"===contact.contactType){if(this.activeContactWidgets.hasOwnProperty(contact.id)){var callWidget=this.activeContactWidgets[contact.id];logger.debug("ContactID: "+contact.id," OnAgentIndicatorUpdate - updating call contact panel"),callWidget.callContactPanel("updateContactIndicator",AgentConsoleDataStore.indicators.contactIndicator)}}else if("WorkItemContactEvent"===contact.contactType){if(this.activeContactWidgets.hasOwnProperty(contact.id)){var workItemWidget=this.activeContactWidgets[contact.id];logger.debug("ContactID: "+contact.id," OnAgentIndicatorUpdate - updating workitem contact panel"),workItemWidget.workItemContactPanel("updateContactIndicator",AgentConsoleDataStore.indicators.contactIndicator)}}else if("ChatContactEvent"===contact.contactType){if(this.activeContactWidgets.hasOwnProperty(contact.id)){var chatWidget=this.activeContactWidgets[contact.id];logger.debug("ContactID: "+contact.id," OnAgentIndicatorUpdate - updating chat contact panel"),chatWidget.chatPopoutContactPanel("updateContactIndicator",AgentConsoleDataStore.indicators.contactIndicator)}}else if("EmailContactEvent"===contact.contactType&&this.activeContactWidgets.hasOwnProperty(contact.id)){var emailWidget=this.activeContactWidgets[contact.id];logger.debug("ContactID: "+contact.id," OnAgentIndicatorUpdate - updating email contact panel"),emailWidget.emailContactControl("updateContactIndicator",AgentConsoleDataStore.indicators.contactIndicator)}this.updateIndicatorInResultsPnl(contact)}},updateIndicatorInResultsPnl:function(contact){"VoiceMailContactEvent"!==contact.contactType&&IC_Validation.isNotNullOrEmpty(AgentConsoleDataStore.indicators)&&IC_Validation.isNotNullOrEmpty(AgentConsoleDataStore.indicators.contactIndicator)&&(IC_Validation.isValidObject(this.contactResultPanel)&&this.contactResultPanel.resultsAndNotesControl("getContactId")===contact.id&&(logger.debug("ContactID: "+contact.id," OnAgentIndicatorUpdate - updating contact result panel"),this.contactResultPanel.resultsAndNotesControl("updateIndicator",AgentConsoleDataStore.indicators.contactIndicator,contact.contactType)))},agentIndicatorAction:function(indicator){if(logger.debug("agentIndicatorAction - Indicator type:"+indicator.type+", action :"+indicator.action),"OpenURL"===indicator.type&&AgentConsoleDataStore.checkAndPopUrl(indicator.action,"indicator"),"SpawnScript"===indicator.type){for(var args=[],contact=indicator.action.split('"'),i=3;i<contact.length;i+=2)args.push(contact[i]);var params=args.join("|");AgentConsoleDataStore.scriptList(contact[1],function(scriptId){AgentConsoleDataStore.spawnScript(scriptId,parseInt(contact[2],10),params,"")})}if("SignalScript"===indicator.type){args=null;var intermediateArgs={},processedArgs={};i=0,args=indicator.action.split('"');for(intermediateArgs=[],i=0;i<args.length;i++)""!==args[i]&&" "!==args[i]&&intermediateArgs.push(args[i]);for(i=1;i<intermediateArgs.length;i++)processedArgs[i]=intermediateArgs[i];AgentConsoleDataStore.signalScript(intermediateArgs[0],processedArgs)}},chatPopoutMsgEditorCreated:!1,onChatContact:function(contact,chatContactCount,contactIdToShow){var that=this,chatWidget=null;if("Incoming"!==(contact=this.addContactMetaData(contact)).status){if(IC_Validation.isValidObject(this.acceptRejectPanel)&&contact.id===this.acceptRejectPanel.chatAcceptRejectPanel("getContactId")&&(this.acceptRejectPanel.chatAcceptRejectPanel("destroy"),"Disconnected"===contact.status&&!0===contact.finalState))return this.destroyContactWidget(contact),void(sessionStorage.lastOpenedAcceptRejectId="");if(IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&this.elements.ContactResultsNotesPanel.showfn(),this.activeContactWidgets.hasOwnProperty(contact.id)?(chatWidget=this.activeContactWidgets[contact.id]).chatPopoutContactPanel("updateMetaData","chatViewData",{chatCount:chatContactCount,canRoundTopCorners:!0,canRoundBottomCorners:!0,idToShow:contactIdToShow}):"Disconnected"===contact.status&&!0===contact.finalState||(this.onNewContactWidgetCreated(contact),chatWidget=$('<div class="ContactRootPnl" id="chatID_'+contact.id+'"/>').chatPopoutContactPanel({controller:this,resourceBase:this.options.resourceBase,chatContactCount:chatContactCount,idToShow:contactIdToShow,contact:contact,isChatPanel:!0,useSecDisposition:contact.useSecDispositions,reqDisposition:contact.reqDisposition,isPopout:this.options.isPopout}).appendTo(this.elements.chatContactTab),this.chatPopoutMsgEditorCreated||(this.createChatPopoutMessageEditor(contact),this.chatPopoutMsgEditorCreated=!0),contact.active&&this._setChatPopoutController(chatWidget)),!0,IC_Validation.isNotNull(chatWidget)){this.activeContactWidgets[contact.id]=chatWidget,chatWidget.chatPopoutContactPanel("updateData",contact),contact.active&&this._setChatPopoutController(chatWidget);var wndWidth=$(window).width(),wndHeight=$(window).height(),height=0;wndWidth-192,wndHeight-120,IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&"block"===this.elements.ContactResultsNotesPanel.css("display")&&(height=this.elements.ContactResultsNotesPanel.height()),$(".agentConsolePopout .contentPanel .ContactRootPnl .ChatPnl .MessagePnl").css({"min-height":wndHeight-(194+height)+"px"}),this.onChatMsgUpdate(),"Active"===contact.status&&AgentConsoleDataStore.getSkillDetails(contact.skillId,function(skillDetails){0!==Object.keys(skillDetails).length?(chatWidget.chatPopoutContactPanel("isTypingPreviewEnabled",skillDetails.agentTypingIndicator,skillDetails.patronTypingPreview),that.elements.chatMessageEditor.chatPopoutMessageEditor("setContactId",contact.id)):(chatWidget.chatPopoutContactPanel("isTypingPreviewEnabled",!1,!1),that.elements.chatMessageEditor.chatPopoutMessageEditor("setContactId",contact.id))})}"Disconnected"===contact.status&&(sessionStorage.lastOpenedAcceptRejectId="",this.destroyContactWidget(contact))}else!0===this.showChatAcceptReject()?sessionStorage.lastOpenedAcceptRejectId!=contact.id&&(sessionStorage.lastOpenedAcceptRejectId=contact.id,IC_Validation.isValidObject(this.acceptRejectPanel)||(this.onAcceptRejectPanelShow(contact),IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&this.elements.ContactResultsNotesPanel.hide(),this.acceptRejectPanel=$('<div class="ContactRootPnl acceptRejectContatier" />').chatAcceptRejectPanel({controller:this,contact:contact,resourceBase:this.options.resourceBase}).appendTo(this.elements.chatContactTab),$(window).on("unload.lastOpenedAcceptRejectId",function(){IC_Validation.isNotNull(that.acceptRejectPanel)&&(sessionStorage.lastOpenedAcceptRejectId=""),$(window).off("unload.lastOpenedAcceptRejectId")}))):AgentConsoleDataStore.acceptContact(contact.id)},onEmailContact:function(contact){this.elements.emailListControlPanel.emailListControl("onEmailContactUpdate",contact)},refreshEmailContentWidget:function(contact){IC_Common.isSupportedIEVersion()&&(contact=Object.clone(contact));var emailContentWidget=this.elements.emailPopoutContentPanel;emailContentWidget.emailDetailPopoutControl("restrictEmailAttachment",AgentConsoleDataStore.fileExtList),emailContentWidget.emailDetailPopoutControl("refresh",contact,this.agentInfo),emailContentWidget.emailDetailPopoutControl("resizeWidget",this.elements.emailWidgetContentPanel.width(),this.elements.emailWidgetContentPanel.height()),this.showResultandNotesforChat_Email(contact)},showResultsPanelforEmail:function(contact){var getSelected=this.getCurrentSelectedMediaTab();if(this.elements.ContactResultsNotesPanel.showfn(),"Email"===getSelected)if(this.contactResultPanel.showfn(),"Parked"===contact.status||"Interrupted"===contact.status)this.contactResultPanel.resultsAndNotesControl("showEmailPanelOnly");else{this.contactResultPanel.resultsAndNotesControl("showAllControls");var sfResult=AgentConsoleDataStore.getSfResult(contact.id);IC_Validation.isValidObject(sfResult)&&(this.contactResultPanel.resultsAndNotesControl("updateData",sfResult),this.updateIndicatorInResultsPnl(contact))}},notificationIcon:function(chatType){"Client"==chatType?"Chat"!==this.getCurrentSelectedMediaTab()&&this.chatIndicateIcon.removeClass("viewedContactTabIndicate noReplyNewContact").addClass("newContactTabIndicate"):"Agent"==chatType&&"Chat"===this.getCurrentSelectedMediaTab()&&this.chatIndicateIcon.removeClass("newContactTabIndicate noReplyNewContact").addClass("viewedContactTabIndicate")},statusColor:function(status){"System"===status&&"Chat"!==this.getCurrentSelectedMediaTab()&&this.chatIndicateIcon.removeClass("newContactTabIndicate viewedContactTabIndicate").addClass("noReplyNewContact")},submitTags:function(contact){if(0!=contact.finalState){if(IC_Validation.isNotNullOrEmpty(contact.tags)&&contact.tags.length>0){for(var tag={tags:[]},i=0;i<contact.tags.length;i++)tag.tags.push({tagId:contact.tags[i].tagId});AgentConsoleDataStore.updateTagsForContact(tag,contact.id),IC_Validation.isValidObject(this.elements.tagControlPanel)&&("block"===this.elements.tagControlPanel.css("display")&&this.elements.tagControlPanel.toggle("slide",{direction:"down"},250),this.elements.tagControlPanel.tagControl("destroy"))}AgentConsoleDataStore.removeSkillTags(contact.skillId)}},onAPIErrorEventUpdate:function(){if(IC_Validation.isNotNullOrEmpty(this.currentPopupId)){if(logger.trace("onAPIErrorEventUpdate - currentPopupId :"+this.currentPopupId),0===this.currentPopupId)return;0!==AgentConsoleDataStore.errorList.length&&AgentConsoleDataStore.errorList[0].id===this.currentPopupId||this.hidePopup()}this.showEventErrorMessages()},showEventErrorMessages:function(){if(IC_Validation.isNotNullOrUndefinedString(AgentConsoleDataStore.errorList)&&AgentConsoleDataStore.errorList.length>0){logger.trace("showEventErrorMessages - Error length :"+AgentConsoleDataStore.errorList.length);var errMsgObj,message,timeOut,errorMessages=AgentConsoleDataStore.errorList[0].messages,i=0,messages=[],levelCss="";for(i=0;i<errorMessages.length;i++)levelCss="Medium"===(errMsgObj=errorMessages[i]).level||"Critical"===errMsgObj.level?"eMsg":"iMsg","Custom_GetNextErrorAttemptWarn"===errMsgObj.code&&(timeOut=25e3,this.elements.msgDiv.addClass("msgWithNoBtns")),IC_EventErrorMessages[errMsgObj.code]?message=IC_EventErrorMessages[errMsgObj.code]:(logger.trace("Unexpected Agent Error:"+errMsgObj.code),message=IC_EventErrorMessages.Generic_Custom_Error),IC_Validation.isNotNullOrEmpty(message)&&messages.push({message:message,levelCss:levelCss});messages.length>0&&this.showPopup(AgentConsoleDataStore.errorList[0].id,messages,timeOut)}},showPopup:function(id,messages,timeout){var i=0,message="",levelCss="";if(logger.trace("showPopup - id :"+id+", messages :",messages),IC_Validation.isNotNullOrEmptyArray(messages)){if(this.elements.msgDiv.children("span, br").remove(),"block"!==this.elements.loginPopupDiv.css("display")){for(i=0;i<messages.length;i++)message=messages[i].message,levelCss=messages[i].levelCss,this.addMessage(levelCss,message);this.currentPopupId=id}if("Logged out"===this.agentInfo.cState.state)this.elements.popupDiv.hide();else if("block"!==this.elements.loginPopupDiv.css("display")){if(logger.trace("showPopup : popup div"),this.elements.msgDiv.children("span").text()===IC_EventErrorMessages.Custom_SessionEnd)return;this.elements.popupDiv.showfn(),this.elements.msgDiv.css("display","block"),this.elements.msgDiv.trigger("focus"),IC_Validation.isNumber(timeout)&&setTimeout($.proxy(this.hidePopup,this),timeout)}}},hidePopup:function(){var popupDiv,removeDiv,msgDiv=this.elements.msgDiv,loginmsg=this.elements.loginMsgDiv,that=this;"block"===this.elements.loginPopupDiv.css("display")?(logger.trace("hidePopup : login popup div"),popupDiv=this.elements.loginPopupDiv,removeDiv=loginmsg.children("div, button")):(logger.trace("hidePopup : popup div"),popupDiv=this.elements.popupDiv,removeDiv=msgDiv.children("span, br")),popupDiv.fadeOut(function(){IC_Validation.isNotNullOrEmpty(removeDiv)&&(removeDiv.remove(),that.elements.msgDiv.removeClass("msgWithNoBtns")),0===that.currentPopupId?that.currentPopupId=null:(AgentConsoleDataStore.removeErrorFromStore(that.currentPopupId),that.currentPopupId=null),setTimeout($.proxy(that.showEventErrorMessages,that),0)})},sendEmail:function(emailContent,replyType,callBack){AgentConsoleDataStore.sendEmail(emailContent,replyType,callBack)},getAttachmentFiles:function(fileServerPath,callBack){AgentConsoleDataStore.getFile(fileServerPath,callBack)},addContactMetaData:function(contact){var skillObj=AgentConsoleDataStore.allSkillList[contact.skillId],agentId="";return IC_Validation.isNotNullOrEmpty(skillObj)&&(contact.skillName=skillObj.name,contact.useAcw=skillObj.useAcw,contact.useDisposition=skillObj.useDisposition,contact.reqDisposition=skillObj.reqDisposition,contact.useSecDispositions=skillObj.useSecDispositions,contact.emailFromAddress=skillObj.emailFromAddress,contact.emailFromEditable=skillObj.emailFromEditable,!0!==skillObj.useDisposition&&!0!==skillObj.reqDisposition||IC_Validation.isNotNullOrEmptyArray(skillObj.dispositions)||AgentConsoleDataStore.getDispositions(skillObj)),"CallContactEvent"===contact.contactType&&("Consult"!==contact.type&&"PersonalQueue"!==contact.type||(agentId=!0===contact.inbound?contact.ani:contact.dnis,IC_Validation.isNotNullOrEmpty(AgentConsoleDataStore.agentListMap[agentId])&&(contact.consultAgentName=AgentConsoleDataStore.agentListMap[agentId].fn+" "+AgentConsoleDataStore.agentListMap[agentId].ln))),contact},hideChatDisposition:function(contactId){var that=this;logger.debug("ContactID: "+contactId," hideChatDisposition"),IC_Validation.isValidObject(this.dispPanel)&&this.dispPanel.toggle("slide",{direction:"down"},250,function(){var chatWidget=that.activeContactWidgets[contactId];IC_Validation.isValidObject(chatWidget)&&chatWidget.chatPopoutContactPanel("updateMetaData","dispositionPanel",!1),that.showContactsRootPanel()})},hideEmailDisposition:function(contactId){var that=this;logger.debug("ContactID: "+contactId," hideEmailDisposition"),IC_Validation.isValidObject(this.dispPanel)&&this.dispPanel.toggle("slide",{direction:"down"},250,function(){var emailWidget=that.activeContactWidgets[contactId];IC_Validation.isValidObject(emailWidget)&&emailWidget.emailContactControl("updateMetaData","dispositionPanel",!1),that.showContactsRootPanel()})},showDispositionPanel:function(contact){logger.debug("ContactID: "+contact.id," showDispositionPanel");var that=this;if(0!==Object.keys(AgentConsoleDataStore.allSkillList).length){var skill=AgentConsoleDataStore.allSkillList[contact.skillId];this.showDispositionPanelContent(contact,skill)}else AgentConsoleDataStore.getSkillDetails(contact.skillId,function(skillDetails){that.showDispositionPanelContent(contact,skillDetails)})},showDispositionPanelContent:function(contact,skill){var isChatPanel=!1;if(("Discarded"===contact.status||"Disconnected"===contact.status)&&!1===contact.finalState&&IC_Validation.isValidObject(skill)&&(!0===skill.useDisposition||!0===skill.reqDisposition)){IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&this.elements.ContactResultsNotesPanel.hide(),IC_Validation.isValidObject(this.dispPanel)?this.elements.endDispositionPanel.disposition("updateContact",contact,skill):(this.dispPanel=$('<div class="endDispoPanel" />').appendTo(this.elements.contactsRootPanel),this.elements.endDispositionPanel=$('<div class="dispositionPnlDialer" />'),this.elements.endDispositionPanel.disposition({container:this,resourceBase:this.options.resourceBase,contact:contact,useSecDisposition:skill.useSecDispositions,reqDisposition:skill.reqDisposition,agentInfo:this.agentInfo}).appendTo(this.dispPanel),this.dispPanel.showfn()),this.hideAllTabs(),"ChatContactEvent"===contact.contactType&&(isChatPanel=!0),this.elements.endDispositionPanel.disposition("populateDispositions",skill.dispositions,contact.type),this.elements.endDispositionPanel.disposition("updateMetaData",isChatPanel,contact.id),this.updateDispositionPanel(contact);var sfResult=AgentConsoleDataStore.getSfResult(contact.id);IC_Validation.isValidObject(sfResult)&&this.elements.endDispositionPanel.disposition("updateData",sfResult),this.elements.endDispositionPanel.disposition("setFocusToDispositionHeader"),this.showTagsInDisposition(contact),"none"===this.dispPanel.css("display")&&this.dispPanel.showfn(),this.elements.endDispositionPanel.disposition("resizeDispPanel")}},showTagsInDisposition:function(contact){this.isTagsAssigned(contact.skillId)&&(this.elements.endDispositionPanel.disposition("updateTagsCount",contact,!0),this.elements.endDispositionPanel.disposition("updateDispositionTagData",contact))},isDisconnectedChat:function(){for(var isDisconnectedChat=!1,contact=null,contacts=AgentConsoleDataStore.contacts,len=contacts.length,i=0;i<len;i++)if("ChatContactEvent"===(contact=contacts[i]).contactType&&!0===contact.active&&"Disconnected"===contact.status){isDisconnectedChat=!0;break}return logger.debug("isDisconnectedChat - "+isDisconnectedChat),isDisconnectedChat},onSkillTagsUpdate:function(){var contact=this.getFirstContactForContactResult();IC_Validation.isNotNullOrEmpty(contact)&&this.isTagsAssigned(contact.skillId)&&(IC_Validation.isValidObject(this.contactResultPanel)&&this.contactResultPanel.resultsAndNotesControl("updateTagsContent",contact),IC_Validation.isValidObject(this.elements.endDispositionPanel)&&this.elements.endDispositionPanel.disposition("updateTagsContent",contact))},findActiveChat:function(){var contact,chatResult=this.chatContactCount();return IC_Validation.isValidObject(chatResult)&&!0===this.isChatTabSelected&&(contact=(contact=$.grep(AgentConsoleDataStore.contacts,function(item){return item.id===chatResult.id}))[0]),contact},showResultNotesPanel:function(){this.elements.ContactResultsNotesPanel.showfn(),!0!==this.isChatTabSelected&&!0!==this.isEmailTabSelected||(resultNotesHt=190,this.elements.ContactResultsNotesPanel.css("height",resultNotesHt+"px"),this.resizeResultsNotes())},resizeResultsNotes:function(){var tabPnlHeight,wndWidth=$(window).width(),wndHeight=$(window).height(),isPanelExpanded=this.getPanelExpanded();tabPnlHeight=wndHeight-111;var contact=this.findActiveChat();if(!0===this.isChatTabSelected){if(this.contactResultPanel.resultsAndNotesControl("showAllControls"),IC_Validation.isNotNull(contact)&&"ChatContactEvent"===contact.contactType&&"Incoming"!==contact.status){if(isPanelExpanded&&this.updateIndicatorInResultsPnl(contact),this.resizeChatTabPanel(contact),$(".agentConsolePopout .contentPanel .ContactRootPnl .ChatPnl .MessagePnl").css({"min-height":wndHeight-(194+this.elements.ContactResultsNotesPanel.height())+"px"}),"Disconnected"!==contact.status&&this.elements.chatMessageEditor.chatPopoutMessageEditor("resizeMessageEditor",this.elements.ContactResultsNotesPanel.height()),this.activeContactWidgets.hasOwnProperty(contact.id))this.activeContactWidgets[contact.id].chatPopoutContactPanel("renderCustomScroll",wndWidth,tabPnlHeight-this.elements.ContactResultsNotesPanel.height());this.hideEmailInterruptOverlay()}}else if(!0===this.isEmailTabSelected){var contactId=this.contactResultPanel.resultsAndNotesControl("getContactId");contact=this.getContact(contactId);IC_Validation.isNotNullOrEmpty(contact)&&"EmailContactEvent"===contact.contactType&&"Active"===contact.status&&this.resizeEmailTabPanel(contact),this.elements.emailPopoutContentPanel.emailDetailPopoutControl("resizeWidget",this.elements.emailWidgetContentPanel.width(),this.elements.emailWidgetContentPanel.height())}},parkedEmailCustomScroll:function(){var emailContentWidget=this.elements.emailPopoutContentPanel;emailContentWidget.emailDetailPopoutControl("resizeWidget",emailContentWidget.width(),emailContentWidget.height())},getContactsCount:function(){var contact,nonParkedContacts=AgentConsoleDataStore.getNonParkedContacts(),count=0;if(nonParkedContacts.length>0)for(var i=0;i<nonParkedContacts.length;i++)"CallContactEvent"!==(contact=nonParkedContacts[i]).contactType&&"VoiceMailContactEvent"!==contact.contactType&&"WorkItemContactEvent"!==contact.contactType||count++;return count},resizeDispPanelContainer:function(){var queryPnlHeight,queryPnlWidth=window.innerWidth-195;queryPnlHeight=this.getWidgetPanelHeight(),this.dispPanel.css({width:queryPnlWidth-1+"px",height:queryPnlHeight-12+"px"})},ondispositionSelected:function(){var obj=this.dispSelect.comboBox("getSelectedItem");$("#"+this.resultNotesDispDivId+" .txtSpn").removeClass("dispComboText"),this.selectedDisposition=obj,this.contactResultChanged(this.dispContactId,IC_Util.Disposition,this.selectedDisposition),this.useSecDisposition&&("none"===this.secDispPanel.css("display")&&(this.secDispPanel.showfn(),this.setResultNotesPnlHeight(),this.resizeResultsNotes(),this.contactResultPanel.resultsAndNotesControl("resizeWidget")),this.populateSecDispInResultNotes(this.disposition,this.selectedDisposition))},populateDispInResultNotes:function(dispositions,secDisposition){var isAmount,isDate,filteredList=[],primDisposition=[];if(this.disposition=dispositions,primDisposition=IC_Validation.isNotNullOrUndefinedString(secDisposition)?dispositions.filter(function(item){return item.id!==secDisposition.id&&!1===item.isPreviewDisposition}):dispositions.filter(function(item){return!1===item.isPreviewDisposition}),IC_Validation.isNotNullOrEmptyArray(primDisposition)){for(var i=0;i<primDisposition.length;i++){isAmount=!1,isDate=!1,IC_Validation.isNullOrEmpty(primDisposition[i].isAmount)||(isAmount=primDisposition[i].isAmount,isDate=primDisposition[i].isDate);var obj={id:primDisposition[i].id,value:primDisposition[i].name,order:primDisposition[i].order,isPreviewDisposition:primDisposition[i].isPreviewDisposition,isAmount:isAmount,isDate:isDate};filteredList.push(obj)}filteredList.sort(function(a,b){return a.order-b.order}),this.dispSelect.comboBox("setStore",filteredList)}},populateSecDispInResultNotes:function(dispositions,selectedDisposition){var isAmount,isDate,secDisposition,i=0,filteredList=[];if(this.secDisposition=dispositions.filter(function(item){return item.id!==selectedDisposition.id&&!1===item.isPreviewDisposition}),secDisposition=this.secDisposition,IC_Validation.isNotNullOrEmptyArray(secDisposition)){for(i=0;i<secDisposition.length;i++){isAmount=!1,isDate=!1,IC_Validation.isNullOrEmpty(secDisposition[i].isAmount)||(isAmount=secDisposition[i].isAmount,isDate=secDisposition[i].isDate);var obj={id:secDisposition[i].id,value:secDisposition[i].name,order:secDisposition[i].order,isAmount:isAmount,isPreviewDisposition:secDisposition[i].isPreviewDisposition,isDate:isDate};filteredList.push(obj)}filteredList.sort(function(a,b){return a.order-b.order}),this.secDispSelect.comboBox("setStore",filteredList)}else this.secDispSelect.comboBox("setStore",filteredList)},updateResultNotesDisposition:function(sfResult,disposition){sfResult.task.disp,sfResult.task.secDisp;this.disposition=disposition,this.contactResultPanel.resultsAndNotesControl("resizeWidget")},destroyContactResultPanel:function(canDestroyDispo){IC_Validation.isValidObject(this.dispPanel)&&!1!==canDestroyDispo&&(this.elements.endDispositionPanel.disposition("destroy"),this.elements.endDispositionPanel=null,delete this.dispPanel),IC_Validation.isValidObject(this.contactResultPanel)&&"inline-block"===this.contactResultPanel.css("display")&&(this.contactResultPanel.toggle("slide",{direction:"down"},250),this.elements.ContactResultsNotesPanel.css({height:"auto",top:"36px"}),this.contactResultPanel.resultsAndNotesControl("resetPanel"))},hideContactResultPnl:function(){IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&"block"===this.elements.ContactResultsNotesPanel.css("display")&&this.elements.ContactResultsNotesPanel.hide()},setResultNotesPnlHeight:function(){this.getResultNotesdispHeight()},getResultNotesdispHeight:function(){var height=0;return IC_Validation.isValidObject(this.contactResultPanel)&&"block"===this.contactResultPanel.css("display")&&(height=this.contactResultPanel.resultsAndNotesControl("getDispPanelHeight"),height+=10),height},getChatPanelHeight:function(){return this.elements.ContactResultsNotesPanel.height()},addCallCommitment:function(callInfo){var that=this,sfResult=AgentConsoleDataStore.getSfResult(callInfo.id),canPopulateFirstandLastName=!1,record={};function getPromiseKeeperRecord(firstName,lastName){return{firstName:firstName||"",lastName:lastName||"",target:"A",dialNumber:callInfo.inbound?callInfo.ani:callInfo.dnis,skillId:callInfo.inbound?that.obPhoneSkillsList[0].id:callInfo.skillId,notes:"",callbackTime:(new Date).getTime()}}function showPromiseKeeper(record){that.viewPromiseKeeperDetails(record),that.elements.promiseKeeperDetailsControl.promiseKeeperDetails("editView");var onPromiseHide=that.hidePromiseKeeperDetails;that.hidePromiseKeeperDetails=function(){that.hidePromiseKeeperDetails=onPromiseHide,that.hidePromiseKeeperDetails(function(){})}}sfResult&&(sfResult.task.who?"003"===sfResult.task.who.substring(0,3)?record={id:sfResult.task.who,objectType:"Contact"}:"00Q"===sfResult.task.who.substring(0,3)&&(record={id:sfResult.task.who,objectType:"Lead"}):record=function(sfResult){if(sfResult.results&&sfResult.results.result){for(var record,records=sfResult.results.result,keys=Object.keys(records),contactorLeadRecordIds=[],idx=0,length=keys.length;idx<length;idx++){record=records[keys[idx]];var recordType="Lightning"===AgentConsoleDataStore.sfMode?record.RecordType:record.object;"contact"!=recordType.toLowerCase()&&"lead"!=recordType.toLowerCase()||contactorLeadRecordIds.push({id:keys[idx],objectType:recordType})}if(1==contactorLeadRecordIds.length)return contactorLeadRecordIds[0]}}(sfResult),record&&AgentConsoleDataStore.getFirstandLastName(record.id,record.objectType,function(result){IC_Validation.isNotNullOrUndefinedString(result)&&(canPopulateFirstandLastName=!0,showPromiseKeeper(getPromiseKeeperRecord(result.FirstName,result.LastName)))})),0==canPopulateFirstandLastName&&showPromiseKeeper(getPromiseKeeperRecord("",""))},viewPromiseKeeperDetails:function(data){logger.trace("viewPromiseKeeperDetails "),this.showTabControl(),this.switchTab("promiseKeeperDetails"),this.elements.promiseKeeperDetailsControl.promiseKeeperDetails("refresh",data,AgentConsoleDataStore.agentSkillList)},createScheduledCallback:function(firstName,lastName,phone,skillId,targetId,callbackTime,notes,successCallback,failureCallback){logger.debug("createScheduledCallback - fired"),AgentConsoleDataStore.createScheduledCallback(firstName,lastName,phone,skillId,targetId,callbackTime,notes,successCallback,failureCallback)},updateScheduledCallback:function(callbackId,firstName,lastName,phone,skillId,targetId,callbackTime,notes,successCallback,failureCallback){logger.debug("updateScheduledCallback - fired"),AgentConsoleDataStore.updateScheduledCallback(callbackId,firstName,lastName,phone,skillId,targetId,callbackTime,notes,successCallback,failureCallback)},dateTimePicker:function(callbackTime){logger.trace("dateTimePicker "),this.showTabControl(),this.switchTab("promiseKeeperDateTime"),this.elements.promiseKeeperDateTimeControl.promiseKeeperDateTime("setDate",callbackTime)},showPromiseKeeperDateTime:function(callback){logger.trace("showPromiseKeeperDateTime - display "+this.elements.promiseKeeperDateTimeControl.css("display")),"none"===this.elements.promiseKeeperDateTimeControl.css("display")&&(this.elements.promiseKeeperDateTimeControl.toggle("slide",{direction:"down"},250,callback),this.elements.promiseKeeperDateTimeControl.promiseKeeperDateTime("setFocusToCommitmentDateHeader"))},hideRescheduleDateTime:function(){logger.trace("hideRescheduleDateTime - display "+this.elements.rescheduleDateTimeControl.css("display")),"block"===this.elements.rescheduleDateTimeControl.css("display")&&this.elements.rescheduleDateTimeControl.toggle("slide",{direction:"down"},250)},hidePromiseKeeperDateTime:function(){logger.trace("hidePromiseKeeperDateTime - display "+this.elements.promiseKeeperDateTimeControl.css("display")),"block"===this.elements.promiseKeeperDateTimeControl.css("display")&&this.elements.promiseKeeperDateTimeControl.toggle("slide",{direction:"down"},250)},closePromiseKeeperDateTimeAndShowHome:function(){logger.trace("closePromiseKeeperDateTimeAndShowHome "),this.hidePromiseKeeperDateTime(),this.elements.promiseKeeperDetailsControl.promiseKeeperDetails("setFocusToDateTimeDiv")},closeRescheduleDateTime:function(){logger.trace("closeRescheduleDateTime"),this.hideRescheduleDateTime()},setAgentState:function(state){logger.debug("setAgentState - state :"+state),AgentConsoleDataStore.setAgentState(state.state,state.reason)},getContactResults:function(contact){this.updateDispositionPanel(contact,!1);var sfResult=AgentConsoleDataStore.getSfResult(contact.id);IC_Validation.isValidObject(sfResult)&&this.onContactResultListUpdate()},hideAllTabs:function(){this.panelDisplayed="","block"===this.elements.dialPadControl.css("display")&&(IC_Common.unselectButton(this.elements.tabDialpadIconDiv),this.elements.dialPadControl.toggle("slide",{direction:"down"},250)),this.hideAgentList(),this.hideSkillList(),this.hideAddressBook(),this.hideContactHistory(),this.hideAgentInfo(),this.hidePromiseKeeper(),this.hidePromiseKeeperDetails(),this.hidePromiseKeeperDateTime(),this.hideTagsPanel()},onContactResultListUpdate:function(){var contact,sfResult,contacts=AgentConsoleDataStore.contacts;if(IC_Validation.isNotNullOrEmptyArray(AgentConsoleDataStore.sfResult)){for(var chatResult=this.chatContactCount(),i=0;i<contacts.length;i++)if(contact=contacts[i],sfResult=AgentConsoleDataStore.getSfResult(contact.id),IC_Validation.isValidObject(sfResult))if(AgentConsoleDataStore.allSkillList[contact.skillId],"ChatContactEvent"===contact.contactType){var chatWidget=this.activeContactWidgets[contact.id];"Disconnected"===contact.status&&!1===contact.finalState?IC_Validation.isValidObject(chatResult)&&chatResult.id===contact.id&&IC_Validation.isValidObject(this.elements.endDispositionPanel)?(logger.trace("ContactID: "+contact.id," onContactResultListUpdate - update disposition panel"),this.elements.endDispositionPanel.disposition("updateData",sfResult)):!1===IC_Validation.isValidObject(chatWidget)&&(this.showDispositionPanel(contact),logger.trace("ContactID: "+contact.id,"Contact is disconnect state before active onContactResultListUpdate - update disposition panel"),this.elements.endDispositionPanel.disposition("updateData",sfResult),this.elements.endDispositionPanel.disposition("updateMetaData",!0,contact.id)):IC_Validation.isValidObject(this.contactResultPanel)&&IC_Validation.isValidObject(chatResult)&&chatResult.id===contact.id&&(logger.trace("ContactID: "+contact.id," updateContactResultPanel - contactResultPanel"),IC_Validation.isValidObject(this.dispPanel)&&this.dispPanel.hide(),this.contactResultPanel.resultsAndNotesControl("updateResultsNotesContent",contact),this.updateIndicatorInResultsPnl(contact))}else{if("EmailContactEvent"!==contact.contactType){this.updateContactResultPanel(contact,sfResult);break}if("Parked"!==contact.status&&"Interrupted"!==contact.status){this.activeContactWidgets[contact.id];"Discarded"===contact.status&&!1===contact.finalState&&IC_Validation.isValidObject(this.elements.endDispositionPanel)?(logger.trace("ContactID: "+contact.id," onContactResultListUpdate - update disposition panel"),this.elements.endDispositionPanel.disposition("updateData",sfResult)):IC_Validation.isValidObject(this.contactResultPanel)&&(logger.trace("ContactID: "+contact.id," onContactResultListUpdate - contactResultPanel"),this.contactResultPanel.resultsAndNotesControl("updateData",sfResult),this.contactResultPanel.resultsAndNotesControl("updateTagsContent",contact),this.updateIndicatorInResultsPnl(contact),"block"===this.contactResultPanel.css("display")&&this.updateResultNotesDisposition(sfResult,this.disposition))}}}else logger.trace("onContactResultListUpdate - No result exist")},updateContactResultPanel:function(contact,sfResult){IC_Validation.isValidObject(this.elements.endDispositionPanel)?(logger.trace("ContactID: "+contact.id," updateContactResultPanel - dispositionPanel"),this.elements.endDispositionPanel.disposition("updateData",sfResult)):!IC_Validation.isValidObject(this.acceptRejectPanel)||"Preview"!==contact.status||"ClickToCall"!==contact.deliveryType&&"TenDigitDialAuto"!==contact.deliveryType?IC_Validation.isValidObject(this.contactResultPanel)&&(logger.trace("ContactID: "+contact.id," updateContactResultPanel - contactResultPanel"),this.contactResultPanel.resultsAndNotesControl("updateData",sfResult),this.contactResultPanel.resultsAndNotesControl("updateResultsNotesContent",contact),this.updateIndicatorInResultsPnl(contact)):(this.contactResultPanel.resultsAndNotesControl("updateData",sfResult),this.updateDispositionPanel(contact))},updateSfResult:function(sfResult){IC_Validation.isValidObject(this.contactResultPanel)&&this.contactResultPanel.resultsAndNotesControl("updateData",sfResult)},updateDispositionPanel:function(contact,doNotUpdate){var skill=AgentConsoleDataStore.allSkillList[contact.skillId],that=this,validPCContact=$.grep(AgentConsoleDataStore.contacts,function(item){return"ClickToCall"===item.deliveryType||"TenDigitDialAuto"===item.deliveryType||"TenDigitDial"===item.deliveryType});logger.trace("updateDispositionPanel - contact :"+contact.id+" skill "+JSON.stringify(skill)),IC_Validation.isValidObject(skill)&&"Consult"!==contact.type&&(IC_Validation.isValidObject(this.contactResultPanel)&&"Disconnected"!==contact.status&&"Discarded"!==contact.status&&IC_Validation.isNotNullOrEmptyArray(skill.dispositions)&&IC_Validation.isNullOrEmpty(doNotUpdate)&&this.contactResultPanel.resultsAndNotesControl("populateDispositions",skill.dispositions,contact.type),IC_Validation.isValidObject(this.elements.endDispositionPanel)&&IC_Validation.isNotNullOrEmptyArray(skill.dispositions)&&IC_Validation.isNullOrEmpty(doNotUpdate)?(logger.debug("updateDispositionPanel fired "),this.elements.endDispositionPanel.disposition("populateDispositions",skill.dispositions,contact.type)):validPCContact.length>0&&IC_Validation.isValidObject(this.acceptRejectPanel)&&this.acceptRejectPanel.pcAcceptRejectControl?AgentConsoleDataStore.getSkillDetails(contact.skillId,function(skillDetails){0!==Object.keys(skillDetails).length&&IC_Validation.isValidObject(that.acceptRejectPanel)&&that.acceptRejectPanel.pcAcceptRejectControl&&that.acceptRejectPanel.pcAcceptRejectControl("updatePanel",skillDetails),IC_Validation.isNotNullOrEmptyArray(skill.dispositions)&&IC_Validation.isNotNullOrUndefinedString(that.acceptRejectPanel)&&(that.acceptRejectPanel.pcAcceptRejectControl("updatePreviewNotes",AgentConsoleDataStore.pcPreviewNotes),that.acceptRejectPanel.pcAcceptRejectControl("updateDispositions",skill.dispositions,contact.type))}):validPCContact.length>0&&"Preview"===contact.status&&AgentConsoleDataStore.getSkillDetails(contact.skillId,function(skillDetails){0!==Object.keys(skillDetails).length&&(IC_Validation.isNotNullOrEmptyArray(skill.dispositions)&&IC_Validation.isNotNullOrUndefinedString(that.activeContactWidgets[contact.id])&&(that.activeContactWidgets[contact.id].callContactPanel("updatePreviewNotes",AgentConsoleDataStore.pcPreviewNotes),that.activeContactWidgets[contact.id].callContactPanel("updateDispositions",skill.dispositions,contact.type)),IC_Validation.isValidObject(that.activeContactWidgets[contact.id])&&"Preview"===contact.status&&that.activeContactWidgets[contact.id].callContactPanel("updatePanel",skillDetails))})),validPCContact.length>0&&this.resizePCPanel()},resizePCPanel:function(){var validPCContact=$.grep(AgentConsoleDataStore.contacts,function(item){return("ClickToCall"===item.deliveryType||"TenDigitDialAuto"===item.deliveryType||"TenDigitDial"===item.deliveryType)&&"Preview"===item.status}),skill="";validPCContact.length>0&&(skill=AgentConsoleDataStore.allSkillList[validPCContact[0].skillId],IC_Validation.isValidObject(this.acceptRejectPanel)&&this.acceptRejectPanel.pcAcceptRejectControl?(this.acceptRejectPanel.pcAcceptRejectControl("resizePanel",this.isDialerPanel),IC_Validation.isNotNullOrEmptyArray(skill.dispositions)&&IC_Validation.isNotNullOrUndefinedString(this.acceptRejectPanel)&&(this.acceptRejectPanel.pcAcceptRejectControl("updatePreviewNotes",AgentConsoleDataStore.pcPreviewNotes),this.acceptRejectPanel.pcAcceptRejectControl("updateDispositions",skill.dispositions,validPCContact[0].type))):IC_Validation.isValidObject(this.activeContactWidgets[validPCContact[0].id])&&"Preview"===validPCContact[0].status&&(this.activeContactWidgets[validPCContact[0].id].callContactPanel("resizePanel",this.isDialerPanel),IC_Validation.isNotNullOrEmptyArray(skill)&&IC_Validation.isNotNullOrEmptyArray(skill.dispositions)&&IC_Validation.isNotNullOrUndefinedString(this.activeContactWidgets[validPCContact[0].id])&&(this.activeContactWidgets[validPCContact[0].id].callContactPanel("updatePreviewNotes",AgentConsoleDataStore.pcPreviewNotes),this.activeContactWidgets[validPCContact[0].id].callContactPanel("updateDispositions",skill.dispositions,validPCContact[0].type))))},setDisposition:function(contactId,notesResult,callbackNumber){logger.debug("ContactID: "+contactId," Setting disposition for dialer");var contact=null,len=AgentConsoleDataStore.contacts.length,secDispId="";for(i=0;i<len&&(contact=AgentConsoleDataStore.contacts[i]).id!==contactId;i++);IC_Validation.isValidObject(contact)&&("CallContactEvent"===contact.contactType&&this.isNaturalCall(contact)?(IC_Validation.isNotNullOrUndefinedString(callbackNumber)||(callbackNumber=contact.inbound?contact.ani:contact.dnis),AgentConsoleDataStore.setDisposition(contactId,notesResult.disp.id,"",notesResult.dispPayload,callbackNumber,notesResult.notes,"Dialer")):(IC_Validation.isNotNullOrUndefinedString(notesResult.secDisp)&&(secDispId=notesResult.secDisp.id),AgentConsoleDataStore.setDisposition(contactId,notesResult.disp.id,secDispId,"","",notesResult.notes,"Regular")))},contactResultChanged:function(contactId,changedData,value){AgentConsoleDataStore.contactResultUpdate(contactId,changedData,value)},onPopoutClick:function(){window.close()},showChatAcceptReject:function(){var contact,i=0,chatContactCount=0,contacts=AgentConsoleDataStore.contacts;for(i=0;i<contacts.length;i++)"ChatContactEvent"===(contact=contacts[i]).contactType&&!0!==contact.finalState&&chatContactCount++;return 1===chatContactCount},onAgentInfoUpdate:function(){var aInfo=AgentConsoleDataStore.agentInfo,muteState="disabled";if(IC_Validation.isNotNullOrEmpty(aInfo.cState)&&(this.agentInfo.cState=aInfo.cState,this.agentInfo.nState=aInfo.nState,"Logged out"===aInfo.cState.state?this.hideContentPanelWrapper():"Logging in"!==aInfo.cState.state&&(this.showContentPanelWrapper(),this.elements.agentLegState.hide())),IC_Validation.isNotNullOrEmpty(aInfo.lgState)){this.agentInfo.lgState=aInfo.lgState,this.agentInfo.lgId=aInfo.lgId,"Dialing"===this.agentInfo.lgState?(this.elements.agentLegState.attr("src",this.resourceBase+"/css/images/leg-ring.png"),this.elements.agentLegState.attr("title",IC_Localization.agentLegDialing)):"Active"===this.agentInfo.lgState?(this.elements.agentLegState.attr("src",this.resourceBase+"/css/images/leg-oncall.png"),this.elements.agentLegState.attr("title",IC_Localization.agentLegConnected)):(this.elements.agentLegState.attr("src",this.resourceBase+"/css/images/leg-off.png"),this.elements.agentLegState.attr("title",IC_Localization.agentLegDisconnected));try{IC_Validation.isValidObject(this.acceptRejectPanel)&&("consultAcceptRejectPanel"===this.acceptRejectPanelType?this.acceptRejectPanel.consultAcceptRejectPanel("updateData","agentLeg",this.agentInfo.lgState):"pcAcceptRejectControl"===this.acceptRejectPanelType&&this.acceptRejectPanel.pcAcceptRejectControl("updateData","agentLeg",this.agentInfo.lgState))}catch(e){logger.error("Error while updating agentLegStatus on acceptRejectPanel:"+e.message)}}if(void 0!==this.callContacts&&(muteState=this.callContacts.length>0?"enabled":muteState),IC_Validation.isNotNullOrEmpty(aInfo.lgMuted)&&(this.agentInfo.lgMuted=aInfo.lgMuted,muteState=!0===aInfo.lgMuted?"selected":muteState,IC_Validation.isValidObject(this.activeContactWidgets)))for(i=0;i<aInfo.contacts.length;i++)"CallContactEvent"===aInfo.contacts[i].contactType&&this.activeContactWidgets.hasOwnProperty(aInfo.contacts[i].id)&&this.activeContactWidgets[aInfo.contacts[i].id].callContactPanel("onMute",aInfo.lgMuted);this.elements.multiCallControl&&this.elements.multiCallControl.multiCallControl("setVisibilityMute",muteState),"Disconnected"===AgentConsoleDataStore.agentInfo.lgState&&(AgentConsoleDataStore.agentInfo.lgId=""),this.elements.agentInfoControl.agentInformation("updateMetaData","Info",AgentConsoleDataStore.agentInfo),this.elements.promiseKeeperDetailsControl.promiseKeeperDetails("updateMetaData","Info",AgentConsoleDataStore.agentInfo),this.elements.emailListControlPanel.emailListControl("updateControlPanel")},onAgentSessionEnd:function(){},closeOBSkillsMenu:function(){"block"===this.elements.obPhoneSkillsMenu.css("display")&&this.elements.obPhoneSkillsMenu.hide()},showContentPanelWrapper:function(callback){"none"===this.elements.contentPanelWrapper.css("display")&&(this.elements.contentPanelWrapper.toggle("slide",{direction:"down"},250,callback),this.elements.agentLegState.showfn()),IC_Validation.isNotNullOrEmpty(this.panelDisplayed)},hideContentPanelWrapper:function(callback){"block"===this.elements.contentPanelWrapper.css("display")&&(this.elements.contentPanelWrapper.toggle("slide",{direction:"down"},250,callback),this.elements.agentLegState.hide())},getServerTimestamp:function(){return AgentConsoleDataStore.getServerTimestamp()},enableDisableClickEvent:function(type,domObj){"disable"===type?domObj.off("mouseenter mouseleave click"):"enable"===type&&domObj.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton)},toggleDialPadDiv:function(btnState){var iconEnabled=this.options.resourceBase+"/css/images/hp-sm-phone.png",iconDisabled=this.options.resourceBase+"/css/images/hp-sm-phone-disabled.png";logger.trace("toggleDialPadDiv - button state :"+btnState),this.elements.multiCallControl.multiCallControl("changeButtonState",this.elements.tabDialpadIconDiv,this.elements.tabDialpadIconImg,btnState,iconEnabled,iconDisabled)},addChat:function(){AgentConsoleDataStore.addChat()},endContact:function(contactId){AgentConsoleDataStore.endContact(contactId)},onChatContactTransfer:function(chatContactId){this.chatContactIdToTransfer=chatContactId,this.isChatContactTransferClicked=!0,this.activeContactWidgets[this.chatContactIdToTransfer].chatPopoutContactPanel("enableDisbleBtnOnTransfer",this.isChatContactTransferClicked),this.switchTab("agents"),this.changeBtnStateOnWorkItemTransfer(this.isChatContactTransferClicked,"Chat")},onEmailContactTransfer:function(emailContactId){this.emailContactIdToTransfer=emailContactId,this.isEmailContactTransferClicked=!0,this.activeContactWidgets[this.emailContactIdToTransfer].emailContactControl("enableDisbleBtnOnTransfer",this.isEmailContactTransferClicked),this.switchTab("agents"),this.changeBtnStateOnWorkItemTransfer(this.isEmailContactTransferClicked,"E-Mail")},onVoiceMailTransfer:function(voiceMailId){this.voiceMailIdToTransfer=voiceMailId,this.isVoiceMailTransferClicked=!0,this.activeContactWidgets[this.voiceMailIdToTransfer].voiceMailContactPanel("enableDisbleBtnOnTransfer",this.isVoiceMailTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isVoiceMailTransferClicked,"VoiceMail"),this.switchTab("agents")},onWorkItemTransfer:function(workItemId){logger.trace("ContactID: "+workItemId," onWorkItemTransfer"),this.workItemIdToTransfer=workItemId,this.isWorkItemTransferClicked=!0,this.activeContactWidgets[this.workItemIdToTransfer].workItemContactPanel("enableDisbleBtnOnTransfer",this.isWorkItemTransferClicked),this.changeBtnStateOnWorkItemTransfer(this.isWorkItemTransferClicked,"WorkItem"),this.showTab("agents")},changeBtnStateOnWorkItemTransfer:function(isTransferClicked,transferType){logger.trace("changeBtnStateOnWorkItemTransfer - Transfer clicked :"+isTransferClicked+", Type :"+transferType),!0===isTransferClicked&&"Chat"===transferType?(IC_Common.disableButton(this.elements.tabDialpadIconDiv,"",""),IC_Common.disableButton(this.elements.tabHistoryIconDiv,"",""),IC_Common.disableButton(this.elements.tabAgentInfoIconDiv,"",""),IC_Common.disableButton(this.elements.tabAddressBookIconDiv,"",""),this.elements.tabDialpadIconDiv.off("click"),this.elements.tabHistoryIconDiv.off("click"),this.elements.tabAgentInfoIconDiv.off("click"),this.elements.tabAddressBookIconDiv.off("click")):!0===isTransferClicked&&"E-Mail"===transferType?(IC_Common.disableButton(this.elements.tabDialpadIconDiv,"",""),IC_Common.disableButton(this.elements.tabHistoryIconDiv,"",""),IC_Common.disableButton(this.elements.tabAddressBookIconDiv,"",""),IC_Common.disableButton(this.elements.tabAgentInfoIconDiv,"",""),this.elements.tabDialpadIconDiv.off("click"),this.elements.tabHistoryIconDiv.off("click"),this.elements.tabAddressBookIconDiv.off("click"),this.elements.tabAgentInfoIconDiv.off("click")):!0===isTransferClicked&&"VoiceMail"===transferType?(IC_Common.disableButton(this.elements.tabDialpadIconDiv,"",""),IC_Common.disableButton(this.elements.tabHistoryIconDiv,"",""),IC_Common.disableButton(this.elements.tabAgentInfoIconDiv,"",""),IC_Common.disableButton(this.elements.tabAddressBookIconDiv,"",""),this.elements.tabDialpadIconDiv.off("click"),this.elements.tabHistoryIconDiv.off("click"),this.elements.tabAgentInfoIconDiv.off("click"),this.elements.tabAddressBookIconDiv.off("click")):isTransferClicked?(IC_Common.disableButton(this.elements.tabDialpadIconDiv,"",""),IC_Common.disableButton(this.elements.tabAddressBookIconDiv,"",""),IC_Common.disableButton(this.elements.tabHistoryIconDiv,"",""),IC_Common.disableButton(this.elements.tabAgentInfoIconDiv,"",""),this.elements.tabDialpadIconDiv.off("click"),this.elements.tabAddressBookIconDiv.off("click"),this.elements.tabHistoryIconDiv.off("click"),this.elements.tabAgentInfoIconDiv.off("click")):(this.enableHpDialIcon?(IC_Common.enableButton(this.elements.tabDialpadIconDiv,"",""),this.elements.tabDialpadIconDiv.on("click",$.proxy(this.onClickTabDialPad,this))):(IC_Common.disableButton(this.elements.tabDialpadIconDiv,"",""),this.elements.tabDialpadIconDiv.off("click")),IC_Common.enableButton(this.elements.tabAddressBookIconDiv,"",""),IC_Common.enableButton(this.elements.tabHistoryIconDiv,"",""),IC_Common.enableButton(this.elements.tabAgentInfoIconDiv,"",""),this.elements.tabAddressBookIconDiv.on("click",$.proxy(this.onClickTabAddressBooks,this)),this.elements.tabHistoryIconDiv.on("click",$.proxy(this.onClickTabContactHistory,this)),this.elements.tabAgentInfoIconDiv.on("click",$.proxy(this.onClickTabAgentInfo,this)))},onSkillSelected:function(skillName,skillId){this.isSkillSelectedHere=!0;var chatContactId,that=this;if(this.isWorkItemTransferClicked){var workItemId=AgentConsoleDataStore.getNonParkedContacts()[0].id;this.showConfirmationPrompt(IC_Localization.areYouSure,function(){that.transferWorkItemToSkill(workItemId,skillName)},function(){that.switchTab("skills")},245)}else if(this.isVoiceMailTransferClicked){var voiceMailId=this.voiceMailIdToTransfer;this.showConfirmationPrompt(IC_Localization.areYouSure,function(){that.transferVoiceMailToSkill(voiceMailId,skillId)},function(){that.switchTab("skills")},245)}else{if(this.isChatContactTransferClicked)return chatContactId=this.chatContactIdToTransfer,void this.showConfirmationPrompt(IC_Localization.areYouSure,function(){that.transferChatToSkill(chatContactId,skillName)},function(){that.switchTab("skills")},245);if(this.isEmailContactTransferClicked){var emailContactId=this.emailContactIdToTransfer;this.showConfirmationPrompt(IC_Localization.areYouSure,function(){that.transferEmailToSkill(emailContactId,skillId)},function(){that.switchTab("skills")},245)}else this.isMaxConferenceLimitNotReached()&&this.showAddCallPrompt(function(){that.isWorkItemTransferClicked=!1,that.isVoiceMailTransferClicked=!1,that.isChatContactTransferClicked=!1,that.isEmailContactTransferClicked=!1,AgentConsoleDataStore.dialSkill(skillName)},function(){that.switchTab("skills")})}},onEmailContactEnd:function(contactId,isInbound){var that=this;return emailContactWidget=this.activeContactWidgets[contactId],emailContactWidget.emailContactControl("enableDisbleBtnOnTransfer",!0),isInbound?void this.showConfirmationPrompt(IC_Localization.alertMessageEndContact,function(){that.endContact(contactId)},function(){emailContactWidget=that.activeContactWidgets[contactId],emailContactWidget.emailContactControl("enableDisbleBtnOnTransfer",!1)},245):void that.endContact(contactId)},onAgentSelected:function(agentId){var emailContactId,workItemId,voiceMailId,agentUserName,that=this;if(logger.trace("onAgentSelected - agent id :"+agentId+", WorkItem :"+this.isWorkItemTransferClicked+", VoiceMail :"+this.isVoiceMailTransferClicked+", Chat :"+this.isChatContactTransferClicked+", E-Mail : "+this.isEmailContactTransferClicked),this.isWorkItemTransferClicked)return workItemId=AgentConsoleDataStore.getNonParkedContacts()[0].id,agentUserName=AgentConsoleDataStore.agentListMap[agentId].un,void this.showConfirmationPrompt(IC_Localization.areYouSure,function(){that.transferWorkItemToAgent(workItemId,agentUserName)},function(){that.switchTab("agents")},245);if(this.isVoiceMailTransferClicked)return voiceMailId=this.voiceMailIdToTransfer,agentId=agentId,void this.showConfirmationPrompt(IC_Localization.areYouSure,function(){that.transferVoiceMailToAgent(voiceMailId,agentId)},function(){that.switchTab("agents")},245);if(this.isEmailContactTransferClicked)return emailContactId=this.emailContactIdToTransfer,void this.showConfirmationPrompt(IC_Localization.areYouSure,function(){that.transferEmailToAgent(emailContactId,agentId)},function(){that.switchTab("agents")},245);if(this.isChatContactTransferClicked){var chatContactId=this.chatContactIdToTransfer;this.showConfirmationPrompt(IC_Localization.areYouSure,function(){that.transferChatToAgent(chatContactId,agentId)},function(){that.switchTab("agents")},245)}else this.isMaxConferenceLimitNotReached()&&this.showAddCallPrompt(function(){that.isWorkItemTransferClicked=!1,that.isVoiceMailTransferClicked=!1,that.isEmailContactTransferClicked=!1,"Available"===AgentConsoleDataStore.agentListMap[agentId].asn||"Unavailable"===AgentConsoleDataStore.agentListMap[agentId].asn&&"False"===AgentConsoleDataStore.agentListMap[agentId].acw?AgentConsoleDataStore.dialConsultAgent(AgentConsoleDataStore.agentListMap[agentId].un):AgentConsoleDataStore.dialAgentPersonalQueue(AgentConsoleDataStore.agentListMap[agentId].un)},function(){that.switchTab("agents")})},showConfirmationPrompt:function(message,yesCallback,noCallback,topPadding){var that=this;IC_Validation.isNotNullOrEmpty(topPadding)&&this.elements.callMsgDiv.css("margin-top",topPadding+"px"),IC_Validation.isNotNullOrEmpty(message)&&(this.elements.callMsgYesBtn.off("click"),this.elements.callMsgYesBtn.on("click",function(){that.closeCallMsgPopup(),yesCallback()}),IC_Common.enterKeyPress(this.elements.callMsgYesBtn,function(){that.closeCallMsgPopup(),yesCallback()}),"function"==typeof noCallback&&(this.elements.callMsgNoBtn.off("click"),this.elements.callMsgNoBtn.on("click",function(){that.closeCallMsgPopup(),noCallback()}),IC_Common.enterKeyPress(this.elements.callMsgNoBtn,function(){that.closeCallMsgPopup(),noCallback()})),this.addCallMessage("iMsg",message),this.elements.popupDiv.showfn(),this.elements.callMsgDiv.trigger("focus"))},addCallMessage:function(msgClass,message){this.elements.msgDiv.css("display","none").removeClass("msgWithNoBtns"),this.elements.callMsgDiv.css("display","block"),this.elements.callMsgDiv.children().length>1&&$("<br/><br/>").appendTo(this.elements.callMsgDiv),$('<span class="'+msgClass+'" id="confirmationPromptInPopout"/>').text(message).appendTo(this.elements.callMsgDiv)},showErrorMsg:function(message){this.addMessage("eMsg",message),this.elements.popupDiv.showfn(),this.elements.msgDiv.trigger("focus")},clearMsgDetails:function(){this.elements.msgDiv.children("span, br").remove()},onClickMsgOkBtn:function(){logger.trace("onClickMsgOkBtn"),AgentConsoleDataStore.resetGetNextFailureCount(),this.hidePopup()},addMessage:function(msgClass,message){logger.trace("addMessage - message :"+message),this.elements.msgDiv.css("display","block"),this.elements.callMsgDiv.css("display","none"),this.clearMsgDetails(),this.elements.msgDiv.children().length>1&&$("<br/><br/>").appendTo(this.elements.msgDiv),$('<span class="'+msgClass+'" id="infoMsgInPopout"/>').text(message).appendTo(this.elements.msgDiv)},closeCallMsgPopup:function(){var self=this;this.elements.popupDiv.fadeOut(function(){self.elements.callMsgDiv.children("span, br").remove()}),this.elements.callMsgDiv.css("display","none")},transferChatToSkill:function(chatContactId,skillName){AgentConsoleDataStore.transferChat(chatContactId,skillName)},transferChatToAgent:function(chatContactId,agentId){AgentConsoleDataStore.transferChatToAgent(chatContactId,agentId)},transferEmailToSkill:function(emailContactId,skillId){AgentConsoleDataStore.transferEmailToSkill(emailContactId,skillId)},transferEmailToAgent:function(emailContactId,agentId){AgentConsoleDataStore.transferEmailToAgent(emailContactId,agentId)},transferWorkItemToSkill:function(workItemId,skillName){logger.trace("ContactID: "+workItemId," transferWorkItemToSkill - skill :"+skillName);var that=this;AgentConsoleDataStore.transferWorkItemContactToSkill(workItemId,skillName,function(){that.closeSkillListAndShowHome()})},transferWorkItemToAgent:function(workItemId,agentUserName){logger.trace("ContactID: "+workItemId," transferWorkItemToAgent - agent :"+agentUserName);var that=this;AgentConsoleDataStore.transferWorkItemContactToAgent(workItemId,agentUserName,function(){that.closeAgentListAndShowHome()})},transferVoiceMailToSkill:function(voiceMailId,skillId){logger.trace("transferVoiceMailToSkill - contactId :"+voiceMailId+", skill :"+skillId);var that=this;AgentConsoleDataStore.transferVoiceMailContactToSkill(voiceMailId,skillId,function(){that.closeSkillListAndShowHome()})},transferVoiceMailToAgent:function(voiceMailId,agentId){logger.trace("transferVoiceMailToAgent - contactId :"+voiceMailId+", agent :"+agentId);var that=this;AgentConsoleDataStore.transferVoiceMailContactToAgent(voiceMailId,agentId,function(){that.closeAgentListAndShowHome()})},emailRequeue:function(){for(var contact,that=this,selectedParkedEmail=this.elements.emailListControlPanel.emailListControl("getSelectedParkedEmails"),i=(selectedParkedEmail[selectedParkedEmail.length-1].id,0),length=selectedParkedEmail.length;i<length;i++)contact=selectedParkedEmail[i],this.parkedContactWidgets.hasOwnProperty(contact.id)&&AgentConsoleDataStore.transferEmailToSkill(contact.id,contact.skillId,function(contactId){that.forceDestroyPersonalQueueParkedEmail(that.parkedContactWidgets,contactId)})},destroyContactWidget:function(contact){var contactId=IC_Validation.isNotNullOrUndefinedString(contact.id)?contact.id:contact.contactId;if(this.contactType=contact.contactType,IC_Validation.isValidObject(contact)&&("ChatContactEvent"===contact.contactType&&this.chatContactIdToTransfer===contactId?(this.closeSkillListAndShowHome(),this.closeAgentListAndShowHome(),this.closeAddressBookAndShowHome(),this.closeCallMsgPopup()):"EmailContactEvent"===contact.contactType&&this.emailContactIdToTransfer===contactId&&(this.closeSkillListAndShowHome(),this.closeAgentListAndShowHome(),this.closeCallMsgPopup()),!0===contact.finalState)){var widget=this.activeContactWidgets[contactId];if(IC_Validation.isNotNullOrUndefinedString(widget))if("block"===this.elements.popupDiv.css("display")&&!0===this.isPCConfirmErrorMsgDisplayed&&(this.isPCConfirmErrorMsgDisplayed=!1,this.hidePopup()),"CallContactEvent"===contact.contactType)widget.callContactPanel("destroy");else if("WorkItemContactEvent"===contact.contactType)this.closeSkillListAndShowHome(),this.closeAgentListAndShowHome(),this.closeCallMsgPopup(),widget.workItemContactPanel("destroy");else if("ChatContactEvent"===contact.contactType){if(IC_Validation.isValidObject(this.elements.endDispositionPanel)){var dispContactId=this.elements.endDispositionPanel.disposition("getContactId");contact.id===dispContactId&&this.destroyContactResultPanel()}AgentConsoleDataStore.clearChatPatronId(contact.roomId),widget.chatPopoutContactPanel("destroy"),this.chatDisconnectedWidget[contact.id]=!0}else if("EmailContactEvent"===contact.contactType){if(IC_Validation.isValidObject(this.elements.endDispositionPanel)){dispContactId=this.elements.endDispositionPanel.disposition("getContactId");contact.id===dispContactId&&this.destroyContactResultPanel()}widget.emailContactControl("destroy")}else"VoiceMailContactEvent"===contact.contactType&&(this.closeSkillListAndShowHome(),this.closeAgentListAndShowHome(),widget.voiceMailContactPanel("destroy"));this.submitTags(contact),IC_Validation.isValidObject(this.acceptRejectPanel)&&(logger.debug("ContactID: "+contact.id," destroyContactWidget - accept reject panel"),this.accpId="",this.acceptRejectPanel=null,AgentConsoleDataStore.pcPreviewNotesUpdate()),AgentConsoleDataStore.removeContactFromStore(contactId)}},chatSendTxt:function(contactId,msg){AgentConsoleDataStore.chatSendTxt(contactId,msg)},enableActiveChat:function(contactId){var currentSelectedTab=this.getCurrentSelectedTab();this.hideTab(currentSelectedTab),AgentConsoleDataStore.enableActiveChat(contactId)},triggerContactEvent:function(){AgentConsoleDataStore.triggerContactEvent()},_setChatPopoutController:function(activeWidget){var orignalCtrl=activeWidget.data("AgentConsoleChatPopoutContactPanel"),contact=orignalCtrl.options.contact;logger.trace("active contact - contactId :"+contact.id);var editor=this.elements.chatMessageEditor.data("AgentConsoleChatPopoutMessageEditor");this.chatPopoutMessageEditorController.setTarget(orignalCtrl,editor),"Disconnected"!=contact.status&&IC_Validation.isNotNullOrEmpty(orignalCtrl.typedChatText)?this.elements.chatMessageEditor.chatPopoutMessageEditor("restoreChatText",orignalCtrl.typedChatText):this.elements.chatMessageEditor.chatPopoutMessageEditor("clearChatText"),this.elements.chatMessageEditor.chatPopoutMessageEditor("updateQuickReplyData","quickReply",{quickReply:AgentConsoleDataStore.quickReply,skillId:contact.skillId})},onCustomVariablesUpdate:function(){var value,customVar=AgentConsoleDataStore.customVariables;for(key in customVar)customVar.hasOwnProperty(key)&&(value=customVar[key],"ChatTextChanged"===key&&this.activeContactWidgets.hasOwnProperty(value.id)&&(logger.debug("ContactID: "+value.id," onCustomVariablesUpdate - updating chat message"),this.activeContactWidgets[value.id].chatPopoutContactPanel("updateMetaData","userInput",value.msg)))},chatTextChanged:function(contactId,msg){var message={id:contactId,msg:msg};AgentConsoleDataStore.setCustomVar("ChatTextChanged",message)},loadChatTranscript:function(contactId){var that=this;AgentConsoleDataStore.getChatConversation(contactId,function(messages){that.activeContactWidgets.hasOwnProperty(contactId)&&that.activeContactWidgets[contactId].chatPopoutContactPanel("updateMetaData","loadChatText",messages)})},onAgentSkillListUpdate:function(){var skill,menuItem,agentSkills=AgentConsoleDataStore.agentSkillList,skillMenu=this.elements.obPhoneSkillsMenu,emailSkillMenu=this.elements.obEmailSkillsMenu,length=agentSkills.length,obPhoneSkills=[],obEmailSkills=[],that=this;for(this.elements.agentInfoControl.agentInformation("updateMetaData","Skill",agentSkills),this.elements.promiseKeeperDetailsControl.promiseKeeperDetails("updateMetaData","Skill",agentSkills),this.elements.promiseKeeperControl.promiseKeeper("updateMetaData",agentSkills),skillMenu.empty(),emailSkillMenu.empty(),agentSkills=agentSkills.sort(this.sortOBSkillName),i=0;i<length;i++)4===(skill=agentSkills[i]).typeId&&!0===skill.isOutbound&&"Manual"===skill.strategy&&(logger.debug("onAgentSkillListUpdate - Ob skill name : "+skill.name),obPhoneSkills.push(skill),(menuItem=$('<div class="menuItem"/>').appendTo(skillMenu)).hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),IC_Common.setTextWithEllipsis(menuItem,skill.name,145),menuItem.on("click",function(){var skillName=$(this).text();IC_Validation.isNotNullOrEmpty(that.numberToDial)&&that.showAddCallPrompt(function(){AgentConsoleDataStore.dialPhone(that.numberToDial,skillName),delete that.numberToDial},function(){delete that.numberToDial}),that.elements.obPhoneSkillsMenu.hide()})),1===skill.typeId&&!0===skill.isOutbound&&(logger.debug("onAgentSkillListUpdate - Ob skill name : "+skill.name),obEmailSkills.push(skill),(menuItem=$('<div class="menuItem"  id="'+skill.id+'"/>').appendTo(emailSkillMenu)).attr({cus_skillID:skill.id}),menuItem.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),IC_Common.setTextWithEllipsis(menuItem,skill.name,145),menuItem.on("click",function(){var skillId=this.attributes.cus_skillID.value;AgentConsoleDataStore.createEmailOB(skillId,that.toAddress),that.elements.obEmailSkillsMenu.hide()}));this.enableHpDialIcon=obPhoneSkills.length>0,this.toggleHpIconDialPad(),this.toggleHpIconPromiseKeeper(),this.obPhoneSkillsList=obPhoneSkills,this.enableHpEmailIcon=obEmailSkills.length>0,this.toggleHpIconEmail(),obPhoneSkills.length>7?skillMenu.addClass("ic_obSkillListMenuScroll"):skillMenu.removeClass("ic_obSkillListMenuScroll"),obEmailSkills.length>7?emailSkillMenu.addClass("ic_obSkillListMenuScroll"):emailSkillMenu.removeClass("ic_obSkillListMenuScroll"),this.onSkillListUpdate()},updateContactViews:function(){var contact,i=0,len=(AgentConsoleDataStore.getNonParkedContacts(),AgentConsoleDataStore.contacts.length),chatContactCount=this.chatContactCount().count;for(this.isChatContactPanel=0!==chatContactCount,i=0;i<len;i++)contact=AgentConsoleDataStore.contacts[i],0===i,i===len-1,this.activeContactWidgets.hasOwnProperty(contact.id)&&this.activeContactWidgets[contact.id];this.toggleMulticallControls_Base()},onSkillQueueUpdate:function(){this.updateSkillListQueue&&this.elements.skillListControl.skillList("updateQueueData",AgentConsoleDataStore.skillQueueMap),this.updateQueueCount()},onDispositionUpdate:function(event,skillId){logger.debug("Disposition Changed for skill id :",skillId);var contact,sfResult,contacts=AgentConsoleDataStore.contacts;if(IC_Validation.isNotNullOrEmptyArray(AgentConsoleDataStore.sfResult)){for(i=0;i<contacts.length;i++)if(contact=contacts[i],sfResult=AgentConsoleDataStore.getSfResult(contact.id),IC_Validation.isValidObject(sfResult)&&contact.skillId===skillId.toString()){this.updateDispositionPanel(contact);break}}else this.resizePCPanel()},acceptAgentConsult:function(contactId){logger.trace("ContactID: "+contactId," acceptAgentConsult"),AgentConsoleDataStore.acceptAgentConsult(contactId)},acceptContact:function(contactId){AgentConsoleDataStore.acceptContact(contactId)},rejectContact:function(contactId){AgentConsoleDataStore.rejectContact(contactId)},updateQueueCount:function(){var i,skillQueue=null,skill="",chatCount=0,personalQChat=0;for(i=0;i<AgentConsoleDataStore.agentSkillList.length;i++)skill=AgentConsoleDataStore.agentSkillList[i],skillQueue=AgentConsoleDataStore.skillQueueMap[skill.id],IC_Validation.isValidObject(skillQueue)&&3===skill.typeId&&(chatCount+=IC_Common.toNumber(skillQueue.QueueCount)),skillQueue=null;if(skillQueue=AgentConsoleDataStore.skillQueueMap[0],IC_Validation.isValidObject(skillQueue))for(len=skillQueue.length,i=0;i<len;i++){"3"===(skill=skillQueue[i]).MediaType&&(personalQChat+=IC_Common.toNumber(skill.QueueCount))}0===AgentConsoleDataStore.lastNewSkillQueueUpdateTime&&(chatCount>0||personalQChat>0)&&!IC_Validation.isValidObject(this.acceptRejectPanel)?AgentConsoleDataStore.lastNewSkillQueueUpdateTime=(new Date).getTime():0===chatCount&&0===personalQChat&&(AgentConsoleDataStore.lastNewSkillQueueUpdateTime=0),"Chat"===this.getCurrentSelectedMediaTab()&&(chatCount>0&&this.chatContacts.length<AgentConsoleDataStore.agentInfo.maxChatsAllowed&&!IC_Validation.isValidObject(this.acceptRejectPanel)||!IC_Validation.isValidObject(this.acceptRejectPanel)&&personalQChat>0)?(this.elements.multiCallControl.multiCallControl("setVisibilityAddChat","enabled"),this.setVisibilityAddChatOnEmailInterrupted()):this.elements.multiCallControl.multiCallControl("setVisibilityAddChat","disabled")},setVisibilityAddChatOnEmailInterrupted:function(){var contact=this.getEmailContact();IC_Validation.isValidObject(contact)&&"EmailContactEvent"===contact.contactType&&"Interrupted"===contact.status&&this.elements.multiCallControl.multiCallControl("setVisibilityAddChat","disabled")},getEmailContact:function(){var emailContact=null;if(AgentConsoleDataStore.contacts.length>0){var i=0;for(i=0;i<AgentConsoleDataStore.contacts.length;i++){var contact=AgentConsoleDataStore.contacts[i];if("EmailContactEvent"===contact.contactType&&("Disconnected"!==contact.status&&"Parked"!==contact.status||!0!==contact.finalState)){emailContact=contact;break}}}return emailContact},getChatContact:function(){var chatContact=null;if(AgentConsoleDataStore.contacts.length>0){var i=0;for(i=0;i<AgentConsoleDataStore.contacts.length;i++){var contact=AgentConsoleDataStore.contacts[i];if("ChatContactEvent"===contact.contactType&&("Disconnected"!==contact.status||!0!==contact.finalState)){chatContact=contact;break}}}return chatContact},isIndicatorVisible:function(){},toggleHpIconPromiseKeeper:function(){this.enableHpDialIcon?(logger.debug("toggleHpIconPromiseKeeper : Enable"),IC_Common.enableButton(this.elements.tabPromiseKeeperIconDiv,this.elements.tabPromiseKeeperIconImg,this.resourceBase+"/css/images/pin.png")):(logger.debug("toggleHpIconPromiseKeeper : Disable"),IC_Common.disableButton(this.elements.tabPromiseKeeperIconDiv,this.elements.tabPromiseKeeperIconImg,this.resourceBase+"/css/images/pin-disabled.png"))},toggleHpIconDialPad:function(){!this.enableHpDialIcon||!0===this.isChatContactPanel&&!0===this.isChatContact()||!0===this.isEmailContact()||!0!==AgentConsoleDataStore.isSkillRunningLow&&!1!==this.isPCQueueContactActive?(IC_Common.disableButton(this.elements.tabDialpadIconDiv,this.elements.tabDialpadIconImg,this.resourceBase+"/css/images/hp-sm-phone-disabled.png"),this.elements.multiCallControl.multiCallControl("setVisibilityAdd","disabled")):this.onMultiConferenceEnabled()},getPersistEmailInfo:function(id){return AgentConsoleDataStore.getPersistEmailInfo(id)},setPersistEmailInfo:function(data){AgentConsoleDataStore.setPersistEmailInfo(data)},persistContactHistoryFilterData:function(sortByItem,filterItem,searchText){logger.debug("persistContactHistoryFilterData - SortBy :"+sortByItem+", Filter :"+filterItem+", Search Text :"+searchText),AgentConsoleDataStore.persistContactHistoryFilterData(sortByItem,filterItem,searchText)},ContactHistoryFilterUpdate:function(){var sortByItem=AgentConsoleDataStore.cHistory.sortByItem;filterItem=AgentConsoleDataStore.cHistory.filterItem,searchText=AgentConsoleDataStore.cHistory.searchText,logger.debug("ContactHistoryFilterUpdate - sortByItem:"+sortByItem+", filterItem :"+filterItem+", searchText :"+searchText),this.elements.contactHistoryControl.contactHistory("updateMetaFilterData",sortByItem,filterItem,searchText)},onContactDestroy:function(contact,widgetReference){if(this.chatDisconnectedWidget.hasOwnProperty(contact.id)&&delete this.chatDisconnectedWidget[contact.id],this.updateContactViews(),this.toggleHpIconDialPad(),"consultAcceptRejectPanel"===widgetReference.widgetName||"workItemAcceptRejectPanel"===widgetReference.widgetName||"chatAcceptRejectPanel"===widgetReference.widgetName||"pcAcceptRejectControl"===widgetReference.widgetName)IC_Validation.isValidObject(this.acceptRejectPanel)&&(IC_Validation.isNullOrEmpty(this.accpId)?(logger.debug("onContactDestroy : accept reject panel destroyed"),this.acceptRejectPanel=null,this.acceptRejectPanelType=""):this.accpId===contact.id&&(this.accpId="",this.acceptRejectPanel=null,this.acceptRejectPanelType=""));else if(IC_Validation.isValidObject(contact)){logger.debug("onContactDestroy : remove active contact widget");var removeWidget=this.activeContactWidgets[contact.id];IC_Validation.isValidObject(removeWidget)&&removeWidget.remove(),delete this.activeContactWidgets[contact.id],delete this.activeContactTypes[contact.id],this.contactType=null}this.isNaturalCall(contact)&&(this.containsDialerCall=!1),this.isTabNeedToShow()||(logger.debug("onContactDestroy : hideContactsRootPanel"),localStorage.isPanelExpanded=!1,this.toggleHpIconEmail())},toggleHpIconEmail:function(){AgentConsoleDataStore.isEmailFeatureEnabled?(logger.debug("toggleHpIconEmail: Email Feature Is Enabled"),this.enableHpEmailIcon?(logger.debug("toggleHpIconEmail : Enable Email"),IC_Common.enableButton(this.elements.tabOBEmailIconDiv,this.elements.tabOBEmailIconImg,this.resourceBase+"/css/images/mail.png")):(logger.debug("toggleHpIconEmail : Disable Email"),IC_Common.disableButton(this.elements.tabOBEmailIconDiv,this.elements.tabOBEmailIconImg,this.resourceBase+"/css/images/mail-disable.png"))):logger.debug("toggleHpIconEmail: Email Feature Is NOT Enabled")},onSkillClosedHours:function(showReskillPrompt){if(this.isEmailContactTransferClicked||this.isChatContactTransferClicked){var that=this;logger.trace("onSkillClosedHours - fired"),IC_Validation.isNullOrEmpty(AgentConsoleDataStore.skillClosed)||!0!==AgentConsoleDataStore.skillClosed.showPrompt?this.closeCallMsgPopup():(logger.debug("onSkillClosedHours - show prompt"),this.showConfirmationPrompt(IC_Localization.alertMessageHOP,function(){AgentConsoleDataStore.continueReskill(!0)},function(){AgentConsoleDataStore.continueReskill(!1),that.switchTab("skills")}))}},onQuickReplyUpdate:function(){},chatPopoutMsgEditorController:function(){var controller={},target=null,that=this;return controller.setTarget=function(original,replacewith){target=original,original.getRawChatText=function(){return replacewith.getRawChatText()},original.getChatText=function(){return replacewith.getChatText()},original.setChatText=function(data){replacewith.setChatText(data)},original.clearChatText=function(){return replacewith.clearChatText()},original.getTargetElemet=function(){return replacewith.getTargetElemet()}},controller.canShowChatMessageEditor=function(){if(that.isChatTabSelected)for(var currContact,contacts=AgentConsoleDataStore.contacts,i=0,length=contacts.length;i<length;i++)if("ChatContactEvent"===(currContact=contacts[i]).contactType&&("Active"===currContact.status||"Disconnected"===currContact.status&&!1===currContact.finalState))return!0;return!1},controller.placeHolderColor=function(){target.placeHolderColor()},controller.setMaxLengthConstraints=function(){target.setMaxLengthConstraints()},controller.setChatEditorSetting=function(chatEditorSetting){localStorage.persistChatEditorSetting=JSON.stringify(chatEditorSetting)},controller.getChatEditorSetting=function(){return IC_Common.parseJSON(localStorage.persistChatEditorSetting)},controller.enterOptionClick=function(){target.enterOptionClick()},controller.onChatAgentTyping=function(typing,contactId,callback){AgentConsoleDataStore.onChatAgentTyping(typing,contactId,callback)},controller.onChatTextChange=function(chatText){target.typedChatText=chatText},controller},getSkillAgents:function(skillId,callback){AgentConsoleDataStore.getSkillAgents(skillId,callback)},getSkillDetails:function(skillId,callback){AgentConsoleDataStore.getSkillDetails(skillId,callback)},onChatPatronTypingUpdate:function(){var contact,contacts=AgentConsoleDataStore.getNonParkedContacts(),chatPatron=AgentConsoleDataStore.chatPatronTyping,i=0,j=0;for(i=0;i<contacts.length;i++)if(contact=contacts[i],this.activeContactWidgets.hasOwnProperty(contact.id))for(j=0;j<chatPatron.length;j++)if(("True"===chatPatron[j].isTyping||"True"===chatPatron[j].isTextEntered)&&contact.roomId===chatPatron[j].roomId){this.activeContactWidgets[contact.id].chatPopoutContactPanel("chatPatronTypingUpdate",chatPatron[j]);break}},onChatPreviewUpdate:function(){var contact,contacts=AgentConsoleDataStore.getNonParkedContacts(),chatPreview=AgentConsoleDataStore.chatPreview,i=0,j=0;for(i=0;i<contacts.length;i++)if(contact=contacts[i],this.activeContactWidgets.hasOwnProperty(contact.id))for(j=0;j<chatPreview.length;j++)if(contact.roomId===chatPreview[j].roomId){this.activeContactWidgets[contact.id].chatPopoutContactPanel("chatPreviewUpdate",chatPreview[j]);break}},onChatAgentTyping:function(typing,contactId,callback){AgentConsoleDataStore.onChatAgentTyping(typing,contactId,callback)},onTimeZoneEvent:function(){this.elements.promiseKeeperDateTimeControl.promiseKeeperDateTime("setTimezones",AgentConsoleDataStore.timeZoneList),this.elements.rescheduleDateTimeControl.rescheduleDateTime("setTimezones",AgentConsoleDataStore.timeZoneList)},deleteCallback:function(callbackId,notes){var that=this;this.showConfirmationPrompt(IC_Localization.deleteCommitmentConfirmation,function(){AgentConsoleDataStore.deleteCallback(callbackId,notes,function(){that.hidePromiseKeeperDetails()})},function(){that.elements.promiseKeeperDetailsControl.promiseKeeperDetails("hideDeleteCommitmentPage")},175)},onParkedContact:function(contact){return this.activeContactWidgets.hasOwnProperty(contact.id)?parkedWidget=this.activeContactWidgets[contact.id]:"Parked"==contact.status&&(parkedWidget=$('<div class="ContactRootPnl" data-contact-id="'+contact.id+'" />').emailContactControl({controller:this,resourceBase:this.options.resourceBase}).appendTo(this.elements.emailWidgetPanel),this.activeContactWidgets[contact.id]=parkedWidget),parkedWidget&&parkedWidget.emailContactControl("refresh",contact),parkedWidget},onEmailParkUpdate:function(){var contactId=AgentConsoleDataStore.parkEmailId;this.activeContactWidgets[contactId].emailContactControl("parkEmailClick")},callParkEmailonWidget:function(contactId){this.elements.emailPopoutContentPanel.emailDetailPopoutControl("parkEmail",contactId)},callnotesPanelonEmailWidget:function(contact){"Parked"==contact.status?this.isTagsAssigned(contact.skillId)&&this.showTagsDetailsPnl(contact.id):this.elements.emailPopoutContentPanel.emailDetailPopoutControl("notesPanelDisplay",contact.id)},parkEmail:function(contactId,emailContent){var that=this;AgentConsoleDataStore.parkEmail(contactId,emailContent,function(){that.forceDestroyPersonalQueueParkedEmail(that.activeContactWidgets,contactId)})},onParkEmailLimitValidation:function(){var message;message=[{message:"Maximum Inbox size has been exceeded.",levelCss:"iMsg"}],this.showPopup(0,message,1e4)},hasChatContacts:function(){var contacts=AgentConsoleDataStore.contacts;contact=null;for(var i=0,length=contacts.length;i<length;i++)if(contact=contacts[i],"Incoming"!=contact.status&&"ChatContactEvent"==contact.contactType&&!0!==contact.finalState)return!0;return!1},getSFResult:function(contactId){return AgentConsoleDataStore.getSfResult(contactId)},emailRestore:function(contactId){AgentConsoleDataStore.emailRestore(contactId)},getEmailQuickReplyData:function(contact){return{quickReply:AgentConsoleDataStore.quickReply,skillId:contact.skillId}},getContact:function(contactID){var contact,contacts=AgentConsoleDataStore.getNonParkedContacts();return(contact=$.grep(contacts,function(item){return item.id==contactID})).length>0?contact[0]:null},showTagsDetailsPnl:function(contactId){if(IC_Validation.isNotNullOrEmpty(contactId)){var contact=$.grep(AgentConsoleDataStore.contacts,function(item,index){return item.id==contactId}),skillId=contact[0].skillId,skillTags=AgentConsoleDataStore.skillTagsMap[skillId].length>0?AgentConsoleDataStore.skillTagsMap[skillId]:[];IC_Validation.isNullOrEmpty(this.elements.tagControlPanel)&&(this.elements.tagControlPanel=$('<div id="tagControlPanel"/>').appendTo(this.elements.contactsRootPanel),this.elements.tagControlPanel.tagControl({container:this,resourceBase:this.options.resourceBase,contact:contact[0],skillTags:skillTags})),this.elements.tagControlPanel.tagControl("updateData",skillTags,contact[0]),this.elements.tagControlPanel.toggle("slide",{direction:"down"},250),this.elements.tagControlPanel.tagControl("onResizeTagsPanel"),this.elements.tagControlPanel.tagControl("setFocusToTagsHeader")}},hideTagsPanel:function(){IC_Validation.isValidObject(this.elements.tagControlPanel)&&"block"===this.elements.tagControlPanel.css("display")&&this.elements.tagControlPanel.toggle("slide",{direction:"down"},250)},isTagsAssigned:function(skillId){return AgentConsoleDataStore.isTagsAssigned(skillId)},updateTagsforContact:function(contact){AgentConsoleDataStore.tags.updateContact(contact),this.updateTagsforContactUI(contact)},updateTagsforContactUI:function(contact){IC_Validation.isValidObject(this.contactResultPanel)&&this.contactResultPanel.resultsAndNotesControl("updateTagsContent",contact),IC_Validation.isValidObject(this.elements.endDispositionPanel)&&(this.elements.endDispositionPanel.disposition("updateDispositionTagData",contact),this.elements.endDispositionPanel.disposition("updateTagsCount",contact))},isAllTagsAddedtoContact:function(contactId){return AgentConsoleDataStore.tags.isAllTagsAddedtoContact(contactId)},hideTagsControlPanel:function(){IC_Validation.isValidObject(this.elements.tagControlPanel)&&"block"===this.elements.tagControlPanel.css("display")&&this.elements.tagControlPanel.hide()},onTagsUpdatedContactEvent:function(){var contactId=AgentConsoleDataStore.tagsUpdatedContact.contactId,contacts=$.grep(AgentConsoleDataStore.contacts,function(item){if(item.id==contactId)return item});if(contacts.length>0){var contact=contacts[0];this.updateTagsforContactUI(contact)}},dialPCContact:function(phNumber,dnis,contactId){if(phNumber!==dnis){if("block"===this.elements.popupDiv.css("display"))return;return this.addMessage("eMsg",IC_EventErrorMessages.Custom_DialNoError),this.isPCConfirmErrorMsgDisplayed=!0,this.elements.popupDiv.showfn(),void this.elements.msgDiv.trigger("focus")}AgentConsoleDataStore.acceptContact(contactId)},isPhoneNumberCharValid:function(currChar){var char=currChar.toString(),regexp=new RegExp(/^([0-9|a-z|A-Z|*|#|,|+])$/g);return!!char.match(regexp)},formatPhoneNumber:function(phNumber){var formatedNumber=phNumber.toString(),unformattedPhoneNumber="";for(i=0;i<phNumber.length;i++){var currChar=phNumber[i];!0===this.isPhoneNumberCharValid(currChar)&&(unformattedPhoneNumber+=formatedNumber[i])}return unformattedPhoneNumber},ValidatePhoneNumber:function(phNumber){if(!/^(\+[0-9])?([0-9\*#]{0,28})$/.test(phNumber))return this.addMessage("eMsg",IC_Localization.enterValidPhoneNumber),void this.elements.popupDiv.showfn()},dialPhoneNumber:function(phNumber,clientX,clientY){logger.trace("dialPhoneNumber - phNumber:"+phNumber+", clientX :"+clientX+", clientY :"+clientY);var x,y,menuH,menuW,skillMenu=this.elements.obPhoneSkillsMenu,skillMenuItems=skillMenu.find(".menuItem"),maxW=$(window).width()-20,that=this;skillMenuItems.length>0&&(skillMenu.finish(),this.numberToDial=phNumber,1==skillMenuItems.length?skillMenuItems.trigger("click"):(x=clientX+document.body.scrollLeft,y=clientY+document.body.scrollTop,menuH=skillMenu.height(),menuW=skillMenu.width(),y+menuH>=600&&(y-=menuH),x+menuW>=maxW&&(x=menuW>maxW?10:maxW-menuW),skillMenu.css("left",x+"px"),skillMenu.css("top",y+"px"),skillMenu.mCustomScrollbar("destroy"),skillMenu.show(0,function(){skillMenu.mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0}),clearTimeout(that.obSkillHideTimeout),that.obSkillHideTimeout=setTimeout(function(){skillMenu.fadeOut()},5e3),that.obPhoneSkillsMenuFlag=!0})))},onPCQueueCountUpdate:function(){if(IC_Validation.isNotNullOrUndefinedString(this.element.callQueuePanel))if(AgentConsoleDataStore.pcQueueContacts.length>0){for(this.isPCQueueContactActive=!0,this.initialTimerVal=0,this.lastServerTimestamp=this.getServerTimestamp(),this.startTimer(),$(".ringNameTemp.callQueuePanel").remove(),i=0;i<AgentConsoleDataStore.pcQueueContacts.length;i++)if("Active"===AgentConsoleDataStore.pcQueueContacts[i].status||"Disconnected"===AgentConsoleDataStore.pcQueueContacts[i].status)AgentConsoleDataStore.pcQueueContacts.splice(i,1),this.isPCQueueContactActive=!1;else{var callQueuePanelRingName=$('<div class="ringNameTemp callQueuePanel btnDivEnable" />'),callQueueInfo=$('<div class="callQueueInfo" />'),ringTimer=$('<div id="ringTimerId" class="ringTimer" />');if(callQueueInfo.text(AgentConsoleDataStore.pcQueueContacts[i].name),callQueuePanelRingName.append(callQueueInfo),callQueuePanelRingName.append(ringTimer),0===i){var dnis=$('<div class="dnis" />');dnis.text(AgentConsoleDataStore.pcQueueContacts[i].dnis),callQueuePanelRingName.append(dnis),callQueuePanelRingName.css("height","40px")}this.element.callQueuePanel.append(callQueuePanelRingName)}$(".callQueueInfo").each(function(index){var callQueueInfoWith=$(this).css("width").replace("px",""),name=$(this).text();$(this).css("height").replace("px","")!=$(this).prop("scrollHeight")&&(IC_Common.setTextWithEllipsis($(this),name,callQueueInfoWith,!0),$(this).attr("title",name))}),this.onNewContactWidgetCreated(),this.isPCQueueContactActive?(this.element.callQueuePanel.showfn(),this.showPhoneContactTab(),this.enableDisableMediaTab(),"none"===this.elements.multiCallControl.css("display")&&this.elements.multiCallControl.showfn()):this.element.callQueuePanel.hide(),logger.trace("onPCQueueCountUpdate : callQueuePanel show")}else this.clearTimer(),this.isPCQueueContactActive=!1,this.element.callQueuePanel.hide(),this.isTabNeedToShow()||(logger.trace("onPCQueueCountUpdate : hideContactsRootPanel hide"),this.hideContactsRootPanel())},pcPreviewNotesUpdate:function(data,isSet){logger.trace("ContactID: "+data.id," pcPreviewNotesUpdate"),$.grep(AgentConsoleDataStore.contacts,function(item){return"ClickToCall"===item.deliveryType||"TenDigitDialAuto"===item.deliveryType||"TenDigitDial"===item.deliveryType}).length>0&&(isSet?AgentConsoleDataStore.pcPreviewNotesUpdate(data):this.acceptRejectPanel&&this.acceptRejectPanel.pcAcceptRejectControl?this.acceptRejectPanel.pcAcceptRejectControl("updatePreviewNotes",AgentConsoleDataStore.pcPreviewNotes):IC_Validation.isValidObject(AgentConsoleDataStore.pcPreviewNotes)&&this.activeContactWidgets[AgentConsoleDataStore.pcPreviewNotes.contactId]&&this.activeContactWidgets[AgentConsoleDataStore.pcPreviewNotes.contactId].callContactPanel("updatePreviewNotes",AgentConsoleDataStore.pcPreviewNotes))},showDialerNotification:function(){var nonParkedContacts=AgentConsoleDataStore.getNonParkedContacts(),nonParkedContactsLength=nonParkedContacts.length;if(AgentConsoleDataStore.pcQueueContacts.length||!1===AgentConsoleDataStore.isSkillRunningLow)if(1===nonParkedContactsLength){var status=nonParkedContacts[0].status;if("NaturalCallRinging"===status||"NaturalCallDialing"===status||"NaturalCallAMD"===status||"Disconnected"===status)return logger.trace("showDialerNotification : true"),!0}else if(0===nonParkedContactsLength)return logger.trace("showDialerNotification : true"),!0;return logger.trace("showDialerNotification : false"),!1},snoozeContact:function(contactId){logger.trace("ContactID: "+contactId," snoozeContact"),AgentConsoleDataStore.snoozeContact(contactId)},disposeBadNumberCall:function(contactId,type){logger.trace("ContactID: "+contactId," disposeBadNumberCall - type :"+type),AgentConsoleDataStore.disposeBadNumberCall(contactId,type)},dialerAMDOverrideContact:function(contactId,type){logger.trace("ContactID: "+contactId," dialerAMDOverrideContact - type :"+type),AgentConsoleDataStore.dialerAMDOverrideContact(contactId,type)},showRescheduleDateTime:function(contactId,dnis){logger.trace("showRescheduleDateTime - display "+this.elements.rescheduleDateTimeControl.css("display")),"none"===this.elements.rescheduleDateTimeControl.css("display")&&(this.elements.rescheduleDateTimeControl.toggle("slide",{direction:"down"},250),this.elements.rescheduleDateTimeControl.rescheduleDateTime("setDate",new Date),this.elements.rescheduleDateTimeControl.rescheduleDateTime("setFocusToRescheduleHeader",contactId,dnis))},doScreenPop:function(id){},parkedContactsUpdateComplete:function(){this.selectEmailTabContact()},onSelectedEmailsChanged:function(contact,selectedParkedEmails){var selectedParkedEmailsLength=selectedParkedEmails.length;!0===this.isEmailTabSelected&&(selectedParkedEmailsLength<=1?0==selectedParkedEmailsLength||1==selectedParkedEmails.length&&selectedParkedEmails[0].id==contact.id?this.refreshEmailContentWidget(contact):this.refreshEmailContentWidget(selectedParkedEmails[0]):(this.elements.emailPopoutContentPanel.emailDetailPopoutControl("showSelectedParkedEmailsRange",selectedParkedEmails),this.elements.ContactResultsNotesPanel.hide()))},selectEmailTabContact:function(){this.elements.emailListControlPanel.emailListControl("selectEmailTabContact")},createResultNotesPanel:function(contact,isChatOrEmail){IC_Validation.isValidObject(this.contactResultPanel)?(this.contactResultPanel.resultsAndNotesControl("resetDispDatas"),this.contactResultPanel.resultsAndNotesControl("updateResultsNotesContent",contact)):(this.elements.ContactResultsNotesPanel=$("<div class='widgetContentPanel'>").appendTo(this.elements.contactsRootPanel),this.contactResultPanel=$('<div class="contactResultNotes callResultNotes"/>').appendTo(this.elements.ContactResultsNotesPanel),this.contactResultPanel.resultsAndNotesControl({container:this,resourceBase:this.options.resourceBase,contact:contact,sfMode:this.options.sfMode,isPopout:this.options.isPopout,agentInfo:this.agentInfo})),isChatOrEmail?this.elements.ContactResultsNotesPanel.css({top:"inherit",height:"auto"}):this.elements.ContactResultsNotesPanel.css({top:"36px"}),this.contactResultPanel.resultsAndNotesControl("updateMetaData",contact,this.agentInfo),this.contactResultPanel.resultsAndNotesControl("resetResultsNotes"),"Discarded"!==contact.status&&"Disconnected"!==contact.status&&"Parked"!==contact.status&&"Interrupted"!==contact.status&&!1===contact.finalState&&(this.elements.ContactResultsNotesPanel.showfn(),this.contactResultPanel.showfn(),this.getContactResults(contact),this.hideEmailInterruptOverlay())},showResultandNotesforPhone_VM_WI:function(){var contact=this.getFirstContactForContactResult();if(IC_Validation.isValidObject(contact)){var skill=AgentConsoleDataStore.allSkillList[contact.skillId],phoneVMWICount=this.getContactsCount();if(this.createResultNotesPanel(contact,!1),("Disconnected"===contact.status||"Discarded"===contact.status)&&!1===contact.finalState&&IC_Validation.isValidObject(skill)&&(!0===skill.useDisposition||!0===skill.reqDisposition)&&1==phoneVMWICount){var isDispSumbit=contact.id===AgentConsoleDataStore.lastDispContactId;this.destroyContactResultPanel(isDispSumbit),!1===isDispSumbit&&this.showDispositionPanel(contact)}"WorkItemContactEvent"===contact.contactType&&"Incoming"===contact.status?IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&this.elements.ContactResultsNotesPanel.hide():(phoneVMWICount>1&&("Disconnected"===contact.status||"Discarded"===contact.status)||"Disconnected"!==contact.status&&"Discarded"!==contact.status||!IC_Validation.isValidObject(skill)||!0!==skill.useDisposition||!1!==skill.useAcw)&&IC_Validation.isValidObject(this.contactResultPanel)&&(this.showResultNotes(contact),this.contactResultPanel.resultsAndNotesControl("updateResultsNotesContent",contact))}else null!==AgentConsoleDataStore.sfResult&&IC_Validation.isNotNullOrEmptyArray(AgentConsoleDataStore.sfResult)&&AgentConsoleDataStore.removeContactResult(),this.destroyContactResultPanel()},toggleContactResult:function(isPanelExpanded){logger.trace("toggleContactResult - isPanelExpanded"+isPanelExpanded),localStorage.isPanelExpanded=isPanelExpanded,this.resizeResultsNotes()},getPanelExpanded:function(){return!0===IC_Common.toBoolean(localStorage.isPanelExpanded)},agentInfo:function(){return this.agentInfo},resizeEmailTabPanel:function(contact){var isPanelExpanded=this.getPanelExpanded(),winHeight=$(window).height();IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&("Active"===contact.status&&(resultNotesHt=isPanelExpanded?190:28,msgPanel=winHeight-(194+resultNotesHt),this.elements.ContactResultsNotesPanel.css({height:resultNotesHt+"px",top:"initial"}),this.contactResultPanel.resultsAndNotesControl("resizeWidget")),this.elements.ContactResultsNotesPanel.showfn())},resizeChatTabPanel:function(contact){var isPanelExpanded=this.getPanelExpanded(),winHeight=$(window).height(),resultNotesHt=isPanelExpanded?190:28,msgPanel=0;this.elements.chatMessageEditor.chatPopoutMessageEditor("resizeMessageEditor",resultNotesHt),this.activeContactWidgets.hasOwnProperty(contact.id)&&(msgPanel=winHeight-(194+resultNotesHt),this.activeContactWidgets[contact.id].chatPopoutContactPanel("resizeMessagePanel",msgPanel)),IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&(this.elements.ContactResultsNotesPanel.css({height:resultNotesHt+"px",bottom:"46px"}),this.contactResultPanel.resultsAndNotesControl("resizeWidget"),this.elements.ContactResultsNotesPanel.showfn())},showResultandNotesforChat_Email:function(contact){var skill=AgentConsoleDataStore.allSkillList[contact.skillId];this.getPanelExpanded(),$(window).height();if("EmailContactEvent"===contact.contactType){if(this.createResultNotesPanel(contact,!0),"Discarded"===contact.status&&!1===contact.finalState){var isDispSumbit=contact.id===AgentConsoleDataStore.lastDispContactId;isDispSumbit&&this.destroyContactResultPanel(isDispSumbit),this.showEmailInterruptOverlay()}IC_Validation.isValidObject(skill)&&("Discarded"===contact.status||"Interrupted"===contact.status||"Discarded"===contact.status&&!0===skill.useDisposition&&!1===skill.useAcw?"Discarded"===contact.status&&!0===skill.useAcw&&this.showResultsPanelforEmail(contact):(this.resizeEmailTabPanel(contact),this.addContactMetaData(contact),this.showResultsPanelforEmail(contact))),"Interrupted"==contact.status&&(this.elements.ContactResultsNotesPanel.hide(),this.showEmailInterruptOverlay())}else if("ChatContactEvent"===contact.contactType)if(contact.active&&"Incoming"!==contact.status&&"Disconnected"!==contact.status&&this.createResultNotesPanel(contact,!0),"Incoming"===contact.status)IC_Validation.isValidObject(this.elements.ContactResultsNotesPanel)&&this.elements.ContactResultsNotesPanel.hide();else if(IC_Validation.isValidObject(skill)&&("Incoming"!==contact.status&&"Interrupted"!==contact.status&&"Disconnected"!==contact.status||!0!==skill.useDisposition||!1!==skill.useAcw)){var chatResult=this.chatContactCount();IC_Validation.isValidObject(this.contactResultPanel)&&IC_Validation.isValidObject(chatResult)&&chatResult.id===contact.id&&(logger.trace("ContactID: "+contact.id," updateContactResultPanel - contactResultPanel"),this.contactResultPanel.resultsAndNotesControl("updateResultsNotesContent",contact),this.updateIndicatorInResultsPnl(contact)),this.resizeChatTabPanel(contact)}},showdispComboInResults:function(contact){var skill=AgentConsoleDataStore.allSkillList[contact.skillId];!IC_Validation.isValidObject(skill)||!0!==skill.useDisposition&&!0!==skill.reqDisposition?IC_Validation.isValidObject(this.dispPanelDiv)&&"block"===this.dispPanelDiv.css("display")&&this.dispPanelDiv.hide():(logger.debug("Populate disposition in results and notes fired "),this.dispContactId=contact.id,this.useSecDisposition=skill.useSecDispositions)},showOrHideTagsPanel:function(contact){},showResultNotes:function(contact){this.contactResultPanel.resultsAndNotesControl("showAllControls"),this.showdispComboInResults(contact);var that=this;this.getResultNotesdispHeight();this.resizeResultsInFullView(),"none"===this.contactResultPanel.css("display")&&this.contactResultPanel.toggle("slide",{direction:"down"},250,function(){that.setResultNotesPnlHeight()}),this.elements.ContactResultsNotesPanel.showfn()},getFirstContactForContactResult:function(){var i=0,contacts=AgentConsoleDataStore.contacts;for(i=0;i<contacts.length;i++)if("Consult"!==contacts[i].type&&"ChatContactEvent"!==contacts[i].contactType&&"EmailContactEvent"!==contacts[i].contactType&&!1!==contacts[i].canUpdateResult)return contacts[i];return null},mediaTabs:function(){return this.elements.mediaTabsDiv.height()},resizeResultsInFullView:function(){$(window).width(),$(window).height(),dispHeight=this.getResultNotesdispHeight(),IC_Validation.isValidObject(this.contactResultPanel)&&this.contactResultPanel.resultsAndNotesControl("resizeWidget")},renderCustomScroll:function(element){element.mCustomScrollbar("destroy"),element.mCustomScrollbar({scrollButtons:{enable:!0},advanced:{autoScrollOnFocus:!1,updateOnContentResize:!0},scrollInertia:0})},resizeCallContactWidgetPanel:function(availableHeight,availableWidth){this.renderedHeight!=availableHeight&&(this.renderedHeight=availableHeight,this.elements.phoneContacts.height(this.renderedHeight),this.renderCustomScroll(this.elements.phoneContacts))},showAgentLegAcceptRejectPanel:function(){IC_Validation.isValidObject(this.agentLegAcceptRejectPanel)||(this.agentLegAcceptRejectPanel=$('<div class="ContactRootPnl" />').agentLegAcceptRejectControl({controller:this})),this.agentLegAcceptRejectPanel.appendTo(this.elements.contactsRootPanel)}})}(jQuery);