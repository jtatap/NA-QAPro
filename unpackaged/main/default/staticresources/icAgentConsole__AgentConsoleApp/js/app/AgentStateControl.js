!function($){IC_Common.getLogger("AgentState");$.widget("AgentConsole.agentState",{options:{container:null},agentInfo:{cState:{state:"Logging in",stateText:"",reason:"",time:0,timeout:0,acw:!1},nState:[]},isEnabled:!0,isLoaded:!1,unavailableList:[],seqNo:0,renderFlag:!1,nextStateTimerCount:0,priorityBlendingSkills:{},manualSelectNNState:!1,outboundSkillList:{},_init:function(){var that=this;this.agentOutboundSkillMap={},this.initialTimerVal=0,this.agentStateTimer=setInterval(function(){that.updateTimer()},1e3),this.skillLoginTimer=setInterval(function(){that.updateDialerLoginTimer()},1e3),document.getElementById("renderTextSize")||$('<div id="renderTextSize"/>').addClass("renderTextSize").appendTo("Body"),this.agentStateLocal={Unavailable:IC_Localization.unavailable,Available:IC_Localization.available,"Logging in":IC_Localization.loggingIn,InboundContact:IC_Localization.inboundContact,OutboundContact:IC_Localization.outboundContact,HeldPartyAbandoned:IC_Localization.heldPartyAbandoned,"Logged out":IC_Localization.loggedOut,InboundConsult:IC_Localization.inboundConsult,OutboundConsult:IC_Localization.outboundConsult,Refused:IC_Localization.refused,PromisePending:IC_Localization.commitmentPending},this.enableDialerPanel()},_create:function(){var agentStatePanel=$("<div/>").addClass("agentStatePanel").appendTo(this.element);this.cStatePanel=$('<div id="cStatePanelId"/>').addClass("bgBodyGradient cStatePanel").appendTo(agentStatePanel),this.cStateIcon=$('<div id = "agentStateIconId"/>').addClass("stateIcon").appendTo(this.cStatePanel),this.cStateDesc=$('<div id = "stateDescId"/>').addClass("stateDesc").appendTo(this.cStatePanel),this.ddIcon=$("<div/>").addClass("ddIcon arrow-left").appendTo(this.cStatePanel),this.ddMenu=$('<div id="cStateMenuId"/>').addClass("menu").appendTo(agentStatePanel);var nStatePanel=$('<div id = "nStatePanelId"/>').addClass("bgBodyGradient nStatePanel").appendTo(agentStatePanel);this.stateTimer=$('<div id = "stateTimerId"/>').addClass("stateTimer").appendTo(nStatePanel),this.nStateIcon=$('<div id = "nStateIconId"/>').addClass("stateIcon").appendTo(nStatePanel),this.nStateDesc=$('<div id = "nStateDescId"/>').addClass("stateDesc").appendTo(nStatePanel),this.nnStateDesc=$("<div/>").addClass("stateDescSlide").appendTo(nStatePanel),this.cSkillPanel=$('<div id = "cSkillPanelId"/>').addClass("bgBodyGradient cStatePanel").appendTo(agentStatePanel),this.cSkillIcon=$("<div/>").addClass("stateIcon").appendTo(this.cSkillPanel),this.cSkillDesc=$("<div/>").addClass("stateDesc").css("float","left").appendTo(this.cSkillPanel),this.cSkillTimer=$("<div/>").addClass("skillTimer").css("display","none").appendTo(this.cSkillPanel),this.ddSkillIcon=$("<div/>").addClass("ddIcon arrow-left").appendTo(this.cSkillPanel),this.ddSkillMenu=$('<div id = "ddSkillMenuId"/>').addClass("menu").appendTo(agentStatePanel),this.cStatePanel.on("click",$.proxy(this.toggleMenu,this)),this.cSkillPanel.on("click",$.proxy(this.closeSkillPanelMenu,this)),$("body").on("click",$.proxy(this.closeOutSide,this))},closeSkillPanelMenu:function(){var that=this;"none"===this.ddSkillMenu.css("display")?(this.ddSkillIcon.removeClass("arrow-left"),this.ddSkillIcon.addClass("arrow-down")):"block"===this.ddSkillMenu.css("display")&&(this.ddSkillIcon.removeClass("arrow-down"),this.ddSkillIcon.addClass("arrow-left")),"block"===this.ddMenu.css("display")&&this.closeMenuDropdown(),this.ddSkillMenu.toggle("slide",{direction:"up"},250,function(){that.ddSkillMenu.mCustomScrollbar("destroy"),that.renderCustomScrollBar(that.ddSkillMenu)}),this.closeOutSideFlag=!1},toggleMenu:function(){"block"===this.ddSkillMenu.css("display")&&!1===this.agentInfo.isDialerLogin&&this.closeSkillPanelMenu(),this.closeMenuDropdown(),this.closeOutSideFlag=!1},textMask:function(objName,text,limit){$("#renderTextSize").text(text),objName.attr("title",""),objName.addClass("textEllipsis"),$("#renderTextSize").width()>limit&&objName.attr("title",text),$("#renderTextSize").text("")},createMenuItem:function(iconName,descName,descId){var elementId,that=this;this.menuItemCount++,this.ddMenuItem=$("<div/>").addClass("menuItem").appendTo(this.ddMenuDiv),this.ddMenuItem.attr({id:this._generateId("agentStates"),menuId:descId,menuText:descName}),this.ddMenuIcon=$('<div id = "menuItemIconId"/>').appendTo(this.ddMenuItem),this.ddMenuIcon.addClass(this.getCssClass(iconName)),this.ddMenuIcon.addClass("icon"),this.ddMenuDesc=$('<div id  = "'+descId+'"/>').addClass("desc").appendTo(this.ddMenuItem),this.ddMenuDesc.text(descName),this.ddMenuItem.hoverfn(function(){elementId=$(this).attr("id"),$("#"+elementId).addClass("cStatePanelHover")},function(){elementId=$(this).attr("id"),$("#"+elementId).removeClass("cStatePanelHover")}),this.ddMenuItem.on("click",function(){elementId=$(this).attr("id"),that.agentStateMenuClick($("#"+elementId).attr("menuId"))}),$("#renderTextSize").text(descName),this.ddMenuItem.attr("title",""),this.ddMenuDesc.addClass("textEllipsis"),$("#renderTextSize").width()>110&&this.ddMenuItem.attr("title",descName),$("#renderTextSize").text("")},loadAgentStateMenu:function(){var isAvailable=!1,showACW=this.showACW(),cStateText=this.agentInfo.cState.stateText,nStateText="",nnStateText="";(!0===this.agentInfo.cState.acw&&this.agentInfo.cState.timeout>0||"Refused"===this.agentInfo.cState.stateText)&&(isAvailable=!0),this.menuItemCount=0,IC_Validation.isNotNullOrEmpty(this.ddMenuDiv)&&this.ddMenuDiv.empty(),IC_Validation.isNotNullOrEmpty(this.ddMenuDiv)||(this.ddMenuDiv=$("<div/>").appendTo(this.ddMenu)),this.ddMenuDiv.removeClass("menuDiv"),void 0!==this.agentInfo.nState&&(nStateText=this.agentInfo.nState.stateText),void 0!==this.agentInfo.nnState&&(nnStateText=this.agentInfo.nnState.stateText),("Available"!==cStateText&&"Available"!==nStateText&&"Available"!==nnStateText||isAvailable)&&this.createMenuItem("Available",IC_Localization.available,"Available");for(var count=0;count<this.unavailableList.length&&!0===this.unavailableList[count].active&&this.unavailableList[count].acw;){var temp=count;if(count++,showACW)cStateText!==(unavailObj=this.unavailableList[temp]).desc&&nStateText!==unavailObj.desc&&nnStateText!==unavailObj.desc&&this.createMenuItem("ACW",unavailObj.desc,unavailObj.desc)}for(("Unavailable"!==cStateText&&"Unavailable"!==nStateText&&"Unavailable"!==nnStateText||isAvailable)&&this.createMenuItem("Unavailable",IC_Localization.unavailable,"Unavailable");count<this.unavailableList.length;){var unavailObj;if(!0===this.unavailableList[count].active)(cStateText!==(unavailObj=this.unavailableList[count]).desc&&nStateText!==unavailObj.desc&&nnStateText!==unavailObj.desc||isAvailable)&&this.createMenuItem("Unavailable",this.unavailableList[count].desc,this.unavailableList[count].desc);count++}this.menuItemCount>17?this.ddMenuDiv.css("width","182px"):this.ddMenuDiv.css("width","198px"),"PromisePending"===this.agentInfo.cState.stateText&&this.agentStateHoverCtrl("agent",!1)},showACW:function(){return"InboundContact"===this.agentInfo.cState.state||"Inbound"===this.agentInfo.cState.state||"Outbound"===this.agentInfo.cState.state||"OutboundContact"===this.agentInfo.cState.state||"Unavailable"===this.agentInfo.cState.state&&!0===this.agentInfo.cState.acw},getCssStateCode:function(state){return"Unavailable"===this.agentInfo[state].state?this.agentInfo[state].acw?"ACW":"Unavailable":this.agentInfo[state].state},getCssClass:function(stateCode){return"ACW"===stateCode?"orange":"Dialer"===stateCode||!0===this.agentInfo.isDialerLogin&&!this.priorityBlendingSkills.hasOwnProperty(this.agentInfo.dialerCampaign)&&"Unavailable"!==stateCode&&"Available"!==stateCode&&"OutboundConsult"!==stateCode&&"OutboundContact"!==stateCode&&"InboundContact"!==stateCode||"Personal Connection Pending"===stateCode||"Personal Connection"===stateCode?"blue":"Outbound"===stateCode||"OutboundContact"===stateCode||"OutboundConsult"===stateCode?"yellow":"Inbound"===stateCode||"InboundContact"===stateCode||"InboundConsult"===stateCode?"purple":"Available"===stateCode?"green":"Supervisor"===stateCode?"orange":"Unavailable"===stateCode?"red":""},updateTimer:function(){var timeText,diff=0,currentTimerVal=0;IC_Validation.isNotNullOrEmpty(this.lastServerTimestamp)&&(diff=parseInt((this.options.container.getServerTimestamp()-this.lastServerTimestamp)/1e3)),!0===this.agentInfo.cState.acw&&this.agentInfo.cState.timeout>0?((currentTimerVal=this.initialTimerVal-diff)<0&&(currentTimerVal=0),timeText=this.secondsToTime(currentTimerVal)):timeText=(currentTimerVal=this.initialTimerVal+diff)>345600?">96 "+IC_Localization.hours:this.secondsToTime(currentTimerVal),this.stateTimer.text(timeText)},updateDialerLoginTimer:function(){var timeText,diff=0,currentTimerVal=0;IC_Validation.isNotNullOrUndefinedString(this.agentInfo.dialerLoginTime)&&(diff=parseInt((this.options.container.getServerTimestamp()-this.agentInfo.dialerLoginTime)/1e3)),(currentTimerVal=diff)<0&&(currentTimerVal=0),timeText=currentTimerVal>345600?">96 "+IC_Localization.hours:this.secondsToTime(currentTimerVal),this.cSkillTimer.text(timeText),this.skillTimeDisplay()},agentStateLoginCtrl:function(){"Logging in"===this.agentInfo.cState.state||"Logged out"===this.agentInfo.cState.state?(this.agentStateHoverCtrl("agent",!1),this.agentStateHoverCtrl("skill",!1)):this.priorityBlendingSkills.hasOwnProperty(this.agentInfo.dialerCampaign)&&this.agentStateHoverCtrl("agent",!0),this.priorityBlendingSkills.hasOwnProperty(this.agentInfo.dialerCampaign)&&this.agentStateHoverCtrl("skill",!1)},updateAgentState:function(){var stateTxt,nstateTxt,nnstateTxt,agentStateDesc,that=this;if(this.agentNNStateDesc="",this.agentNStateDesc="",clearInterval(this.slideTimerVal),this.cStateIcon.removeClass(),this.cStateIcon.addClass(this.getCssClass(this.getCssStateCode("cState"))+" stateIcon"),"Logging in"===this.agentInfo.cState.state||"Logged out"===this.agentInfo.cState.state)this.agentStateLoginCtrl(),this.cState=this.agentInfo.cState.state,this.cStateIcon.hide(),this.nStateIcon.hide(),this.stateTimer.hide(),this.cSkillPanel.hide(),this.nStateDesc.text(""),this.nStateDesc.attr("title",""),!0===this.agentStateDDFlag&&(this.agentStateDDFlag=!1,this.closeOutSideFlag=!1,this.closeMenuDropdown());else{if(this.agentStateLoginCtrl(),this.stateTimer.showfn(),this.cStateIcon.showfn(),this.cSkillPanel.showfn(),void 0===this.cState||this.cState!==this.agentInfo.cState.stateText){var cStateInTime=0;this.options.container.getServerTimestamp()>this.agentInfo.cState.time&&(cStateInTime=Math.round(Math.abs(this.options.container.getServerTimestamp()-this.agentInfo.cState.time)/1e3)),!0===this.agentInfo.cState.acw&&this.agentInfo.cState.timeout>0?this.agentInfo.cState.timeout>cStateInTime?this.initialTimerVal=this.agentInfo.cState.timeout-cStateInTime:this.initialTimerVal=0:this.initialTimerVal=cStateInTime,this.lastServerTimestamp=this.options.container.getServerTimestamp(),this.cState=this.agentInfo.cState.stateText,this.updateTimer()}IC_Validation.isNotNullOrUndefinedString(this.agentInfo.nnState)&&0!==$.trim(this.agentInfo.nnState.stateText).length&&(nnstateTxt=this.agentInfo.nnState.stateText,this.agentNNStateDesc=IC_Validation.isNotNullOrUndefinedString(this.agentStateLocal[nnstateTxt])?this.agentStateLocal[nnstateTxt]:nnstateTxt),IC_Validation.isNotNullOrUndefinedString(this.agentInfo.nState)&&0!==$.trim(this.agentInfo.nState.stateText).length&&(nstateTxt=this.agentInfo.nState.stateText,this.agentNStateDesc=IC_Validation.isNotNullOrUndefinedString(this.agentStateLocal[nstateTxt])?this.agentStateLocal[nstateTxt]:nstateTxt),void 0===this.agentInfo.nState||this.agentInfo.nState.stateText===this.agentInfo.cState.stateText?(this.nStateIcon.hide(),this.nStateDesc.text(""),this.nStateDesc.attr("title","")):void 0!==this.agentInfo.nnState&&0!==$.trim(this.agentInfo.nnState.stateText).length&&!0===this.manualSelectNNState?this.setNextNextState():void 0!==this.agentInfo.nState&&0!==$.trim(this.agentInfo.nState.stateText).length&&(this.nStateIcon.showfn(),this.nStateDesc.showfn(),this.setNextState())}this.manualSelectNNState=!1,stateTxt=this.agentInfo.cState.stateText,agentStateDesc=IC_Validation.isNotNullOrUndefinedString(this.agentStateLocal[stateTxt])?this.agentStateLocal[stateTxt]:stateTxt,this.cStateDesc.text(agentStateDesc),"block"===this.ddMenu.css("display")&&!0===this.closeOutSideFlag&&($(".cStatePanelHover").removeClass("cStatePanelHover"),this.ddMenu.slideUp(250,function(){that.ddIcon.removeClass("arrow-down"),that.ddIcon.addClass("arrow-left"),that.refreshDropdownMenu.apply(that)}),this.closeOutSideFlag=!1),this.textMask(this.cStateDesc,this.cStateDesc.text(),120)},stateSlideFallBack:function(){$(this.stateTimer).is(":visible")&&this.stateTimer.hide(),$(this.nStateIcon).is(":visible")&&this.nStateIcon.hide(),$(this.nStateDesc).is(":visible")&&this.nStateDesc.hide()},slideNNStateTimer:function(){var that=this;this.stateSlideFallBack(),this.nextStateTimerCount<=7?(this.slideTimerVal=setTimeout($.proxy(this.slideNNStateTimer,this),1e3),this.nextStateTimerCount++):(this.nextStateTimerCount=0,this.nnStateDesc.hide("slide",{direction:"up"},500,function(){that.stateTimer.show("slide",{direction:"left"},500),that.setNextState(),that.nStateDesc.show("slide",{direction:"down"},600),that.nStateIcon.show("slide",{direction:"down"},500)}))},setNextNextState:function(){var that=this;0===this.nextStateTimerCount?(this.stateTimer.hide("slide",{direction:"left"},500),this.nStateIcon.hide("slide",{direction:"down"},500),this.nStateDesc.hide("slide",{direction:"down"},600,function(){that.stateSlideFallBack(),that.nnStateDesc.text(IC_Localization.nextNextStateLabel.replace("{0}",that.agentNNStateDesc)),that.nnStateDesc.attr({title:IC_Localization.nextNextStateLabel.replace("{0}",that.agentNNStateDesc)}),that.nnStateDesc.show("slide",{direction:"up"},500),that.slideNNStateTimer()})):(this.stateSlideFallBack(),this.stateTimer.hide(),this.nextStateTimerCount=0,this.nnStateDesc.text(IC_Localization.nextNextStateLabel.replace("{0}",this.agentNNStateDesc)),this.nnStateDesc.attr({title:IC_Localization.nextNextStateLabel.replace("{0}",this.agentNNStateDesc)}),this.slideNNStateTimer())},setNextState:function(){this.nStateIcon.removeClass(),this.nStateIcon.addClass(this.getCssClass(this.getCssStateCode("nState"))+" stateIcon"),this.nStateDesc.empty(),this.nStateDesc.text(this.agentNStateDesc),this.textMask(this.nStateDesc,this.nStateDesc.text(),80),IC_Validation.isNotNullOrUndefinedString(this.agentNNStateDesc)?$(this.nStateDesc).attr({title:IC_Localization.nextStateTooltip.replace("{0}",this.agentNStateDesc).replace("{1}",this.agentNNStateDesc)}):(this.nStateDesc.attr("title",""),this.nStateDesc.attr("title",this.agentNStateDesc))},updateOutboundSkillList:function(list){this.outboundSkillList=list,IC_Validation.isNotNullOrEmpty(this.mainOutboundDiv)&&this.ddOutboundMenuDiv.empty(),IC_Validation.isNotNullOrEmpty(this.mainOutboundDiv)||(this.mainOutboundDiv=$("<div/>").appendTo(this.ddSkillMenu),this.logOutMenu=$('<div id="logout" title="'+IC_Localization.logout+'"/>').on("click",$.proxy(this.agentOutboundSkillLogout,this)).text(IC_Localization.logout).css({display:"none","padding-left":"10px"}).addClass("menuItem").appendTo(this.mainOutboundDiv),this.logOutMenuLineDiv=$("<div />").appendTo(this.logOutMenu),this.logOutMenuLineDiv.addClass("logOutMenuLineDiv"),this.ddOutboundMenuDiv=$("<div/>").appendTo(this.mainOutboundDiv),this.ddSkillMenu.addClass("menuSkillDiv")),this.updateSkillList()},updateSkillList:function(){var agentSkillList=this.agentOutboundSkillMap,that=this;if(this.dialerSkillDiv=!1,IC_Validation.isNotNullOrEmpty(this.ddOutboundMenuDiv)&&(this.ddOutboundMenuDiv.empty(),this.priorityBlendingSkills={}),IC_Validation.isNotNullOrEmpty(agentSkillList))for(i=0;i<agentSkillList.length;i++)agentSkillList[i].isOutbound&&agentSkillList[i].isNatural&&("Natural Calling"===agentSkillList[i].strategy||"Personal Connection"===agentSkillList[i].strategy)&&(agentSkillList[i].isPriorityBlending?this.priorityBlendingSkills[agentSkillList[i].name]=!0:(this.dialerSkillDiv=!0,agentSkillList[i].name!==this.agentInfo.dialerCampaign&&(this.ddOutboundMenuItem=$("<div/>").addClass("menuItem").appendTo(this.ddOutboundMenuDiv),this.ddOutboundMenuItem.attr({id:this._generateId("outboundStates"),menuText:agentSkillList[i].name}),this.ddMenuIcon1=$("<div/>").appendTo(this.ddOutboundMenuItem),this.ddMenuIcon1.addClass(this.getCssClass("Dialer")),this.ddMenuIcon1.addClass("icon"),this.ddMenuDesc1=$('<div id = "'+agentSkillList[i].name+'"/>').addClass("desc").appendTo(this.ddOutboundMenuItem),this.ddMenuDesc1.text(agentSkillList[i].name),this.agentInfo.isDialerLogin||this.ddOutboundMenuItem.hoverfn(function(){elementId=$(this).attr("id"),$("#"+elementId).addClass("cStatePanelHover")},function(){elementId=$(this).attr("id"),$("#"+elementId).removeClass("cStatePanelHover")}),this.ddOutboundMenuItem.on("click",function(){elementId=$(this).attr("id"),that.agentOutboundSkillMenuClick($("#"+elementId).attr("menuText"))}),$("#renderTextSize").text(agentSkillList[i].name),this.ddOutboundMenuItem.attr("title",""),this.ddMenuDesc1.addClass("textEllipsis"),$("#renderTextSize").width()>110&&this.ddOutboundMenuItem.attr("title",agentSkillList[i].name),$("#renderTextSize").text(""))));!0===this.dialerSkillDiv?(this.element.css("height","90px"),!1===this.agentInfo.isDialerLogin&&IC_Validation.isValidObject(this.logOutMenu)?this.logOutMenu.css("display","none"):(IC_Validation.isValidObject(this.logOutMenu)&&this.logOutMenu.css("display","block"),this.priorityBlendingSkills.hasOwnProperty(this.agentInfo.dialerCampaign)?this.loadAgentStateMenu():("OutboundContact"===this.agentInfo.cState.state&&(this.agentInfo.cState.stateText=IC_Localization.personalConnection,this.cStateIcon.addClass(this.getCssClass("Personal Connection")),this.cStateDesc.text(this.agentInfo.cState.stateText),this.textMask(this.cStateDesc,this.cStateDesc.text(),120)),this.agentStateHoverCtrl("agent",!1),this.agentStateHoverCtrl("skill",!0)))):(this.element.css("height","60px"),this.ddSkillMenu.hide()),this.options.container.isDialerAlive(this.dialerSkillDiv),"PromisePending"===this.agentInfo.cState.stateText&&this.agentStateHoverCtrl("agent",!1)},agentStateHoverCtrl:function(type,action){var that=this;IC_Validation.isValidObject(this.logOutMenu)&&"skill"===type&&!1===action?this.logOutMenu.hoverfn(function(){that.logOutMenu.removeClass("cStatePanelHover")},function(){that.logOutMenu.removeClass("cStatePanelHover")}):IC_Validation.isValidObject(this.logOutMenu)&&"skill"===type&&!0===action?(this.logOutMenu.hoverfn(function(){that.logOutMenu.addClass("cStatePanelHover")},function(){that.logOutMenu.removeClass("cStatePanelHover")}),this.ddSkillIcon.showfn()):IC_Validation.isValidObject(this.cStatePanel)&&"agent"===type&&!1===action?(this.cStatePanel.hoverfn(function(){that.cStatePanel.removeClass("cStatePanelHover")},function(){that.cStatePanel.removeClass("cStatePanelHover")}),this.ddIcon.hide()):IC_Validation.isValidObject(this.cStatePanel)&&"agent"===type&&!0===action&&(this.cStatePanel.hoverfn(function(){that.cStatePanel.addClass("cStatePanelHover")},function(){that.cStatePanel.removeClass("cStatePanelHover")}),this.ddIcon.showfn())},agentOutboundSkillLogout:function(){this.priorityBlendingSkills.hasOwnProperty(this.agentInfo.dialerCampaign)||(this.options.container.setDialerLogout(),this.closeSkillPanelMenu())},agentOutboundSkillMenuClick:function(menuText){!1===this.agentInfo.isDialerLogin?(this.options.container.setDialerLogin(menuText),this.closeSkillPanelMenu()):this.closeOutSideFlag=!1},_generateId:function(prefix){return this.seqNo++,prefix+"_"+this.seqNo},agentStateMenuClick:function(menuText){var state={state:"Unavailable",reason:""};"Available"===menuText?state.state="Available":"Unavailable"!==menuText&&(state.reason=menuText),this.manualSelectNNState=!0,this.closeMenuDropdown(),this.options.container.setAgentState(state),this.closeOutSideFlag=!1},closeOutSide:function(event){"mCSB_draggerRail"!==event.target.className&&"mCSB_draggerContainer"!==event.target.className&&"mCSB_buttonUp"!==event.target.className&&"mCSB_dragger_bar"!==event.target.className&&"mCSB_buttonDown"!==event.target.className&&("block"===this.ddMenu.css("display")&&!0===this.closeOutSideFlag?(this.agentStateDDFlag=!0,this.closeMenuDropdown(),this.closeOutSideFlag=!1):"block"===this.ddSkillMenu.css("display")&&!0===this.closeOutSideFlag?(this.closeSkillPanelMenu(),this.closeOutSideFlag=!1):this.closeOutSideFlag=!0)},closeMenuDropdown:function(){this.menuHeight;var that=this;if("Logging in"!==this.agentInfo.cState.state&&"Logged out"!==this.agentInfo.cState.state&&!1===this.agentInfo.isDialerLogin||this.priorityBlendingSkills.hasOwnProperty(this.agentInfo.dialerCampaign)){if("PromisePending"===this.agentInfo.cState.stateText)return;"none"===this.ddMenu.css("display")?(this.agentStateDDFlag=!1,this.ddIcon.removeClass("arrow-left"),this.ddIcon.addClass("arrow-down")):"block"===this.ddMenu.css("display")&&(this.agentStateDDFlag=!0,this.ddIcon.removeClass("arrow-down"),this.ddIcon.addClass("arrow-left")),$(".cStatePanelHover").removeClass("cStatePanelHover"),this.ddMenu.toggle("slide",{direction:"up"},250,function(){that.refreshDropdownMenu.apply(that)})}},refreshDropdownMenu:function(){this.ddMenu.height()>497&&(this.ddMenu.removeClass("menuDiv"),this.ddMenuDiv.removeClass("menuDiv"),this.ddMenu.addClass("menuDiv"),this.ddMenuDiv.addClass("menuDiv"),this.ddMenu.mCustomScrollbar("destroy"),this.renderCustomScrollBar(this.ddMenu))},renderCustomScrollBar:function(objName){"block"===objName.css("display")&&objName.mCustomScrollbar({scrollButtons:{enable:!0},advanced:{updateOnContentResize:!0},scrollInertia:0})},secondsToTime:function(seconds){var hours,mins,secs,time=":00";return null!==seconds&&void 0!==seconds&&"number"==typeof seconds?(hours=Math.floor(seconds/3600),mins=Math.floor(seconds/60)%60,secs=seconds%60,time=hours>0?hours+":"+(mins>9?mins:"0"+mins)+":"+(secs>9?secs:"0"+secs):mins<=0?":"+(secs>9?secs:"0"+secs):mins+":"+(secs>9?secs:"0"+secs)):time},sortByArray:function(unavailableList){return Array.prototype.sortBy=function(){function _sortByAttr(attr){var sortOrder=1;return"-"==attr[0]&&(sortOrder=-1,attr=attr.substr(1)),function(a,b){var x=a[attr],y=b[attr];return isNaN(x)&&(x=x.toLowerCase(),y=y.toLowerCase()),(x<y?-1:x>y?1:0)*sortOrder}}return this.sort(function(){if(0==arguments.length)throw"Zero length arguments not allowed for Array.sortBy()";var args=arguments;return function(a,b){for(var result=0,i=0;0==result&&i<args.length;i++)result=_sortByAttr(args[i])(a,b);return result}}.apply(null,arguments))},unavailableList.sortBy("-active","-acw","desc")},enable:function(){this.isEnabled=!0,this.priorityBlendingSkills.hasOwnProperty(this.agentInfo.dialerCampaign)&&!0===this.agentInfo.cState.acw&&(this.isEnabled=!1),this.updateAgentState()},disable:function(){this.isEnabled=!1,this.priorityBlendingSkills.hasOwnProperty(this.agentInfo.dialerCampaign)&&!1===this.agentInfo.cState.acw&&(this.isEnabled=!0),this.updateAgentState()},updateMetaData:function(type,list){"skills"===type?this.updateOutboundSkillList(list):"teamUnavailable"===type?(this.unavailableList=this.sortByArray(Object.clone(list)),this.loadAgentStateMenu()):"agentSkill"===type?this.agentOutboundSkillMap=list:"Info"===type&&(this.agentInfoId=list),this.updateSkillList()},skillTimeDisplay:function(){var diffTimer=150-(this.cSkillTimer.width()+5);IC_Validation.isNotNullOrUndefinedString(this.agentInfo.isDialerLogin)&&!0===this.agentInfo.isDialerLogin?(this.cSkillDesc.css("width",diffTimer+"px"),this.cSkillTimer.css({display:"block"}),this.cSkillDesc.attr("title",this.agentInfo.dialerCampaign)):(this.cSkillDesc.css("width","76%"),this.cSkillTimer.css({display:"none"}))},agentStates:function(state){return"Dialer"===state?state=IC_Localization.personalConnection:"DialerPending"===state&&(state=IC_Localization.personalConnectionPending),state},hideDialerPanel:function(chatPanel){!0===this.dialerSkillDiv&&(!0===chatPanel?this.element.css("height","60px"):this.element.css("height","90px"))},disableDialerPanel:function(){this.cSkillPanel.off("mouseenter mouseleave click").removeClass("cStatePanelHover"),this.ddSkillIcon.hide()},enableDialerPanel:function(){var that=this;this.cSkillPanel.off("mouseenter mouseleave click").on("click",$.proxy(this.closeSkillPanelMenu,this)).hoverfn(function(){that.cSkillPanel.addClass("cStatePanelHover")},function(){that.cSkillPanel.removeClass("cStatePanelHover")}),this.ddSkillIcon.showfn()},updateData:function(agentInfo){if(this.agentInfo.cState.state=this.agentStates(agentInfo.cState.state),this.agentInfo.cState.reason=this.agentStates(agentInfo.cState.reason),this.agentInfo.cState.stateText=this.agentStates(0!==$.trim(agentInfo.cState.reason).length?agentInfo.cState.reason:agentInfo.cState.state),this.agentInfo.cState.time=agentInfo.cState.time,this.agentInfo.cState.timeout=agentInfo.cState.timeout,this.agentInfo.cState.acw=agentInfo.cState.acw,this.agentInfo.nnState={},this.agentInfo.dialerCampaign=agentInfo.dialerCampaign,this.agentInfo.isDialerLogin=!IC_Validation.isNullOrEmpty(this.agentInfo.dialerCampaign),this.agentInfo.dialerLoginTime=agentInfo.dialerLoginTime,this.updateDialerLoginTimer(),this.agentInfo.isDialerLogin?(this.cSkillIcon.addClass(this.getCssClass("Personal Connection")),this.cSkillDesc.text(this.agentInfo.dialerCampaign),this.textMask(this.cSkillDesc,this.cSkillDesc.text(),100)):(this.agentStateHoverCtrl("agent",!0),this.cSkillIcon.removeClass(this.getCssClass("Personal Connection")),this.cSkillDesc.text(IC_Localization.selectOutboundSkills),this.textMask(this.cSkillDesc,this.cSkillDesc.text(),120)),void 0!==agentInfo.nState)for(var i=0;i<agentInfo.nState.length;i++)0===i?this.agentInfo.nState={state:this.agentStates(agentInfo.nState[i].state),reason:this.agentStates(agentInfo.nState[i].reason),stateText:this.agentStates(0!==$.trim(agentInfo.nState[i].reason).length?agentInfo.nState[i].reason:agentInfo.nState[i].state),acw:agentInfo.nState[i].acw}:this.agentInfo.nnState={state:this.agentStates(agentInfo.nState[i].state),reason:this.agentStates(agentInfo.nState[i].reason),stateText:this.agentStates(0!==$.trim(agentInfo.nState[i].reason).length?agentInfo.nState[i].reason:agentInfo.nState[i].state),acw:agentInfo.nState[i].acw};this.updateAgentState(),this.agentInfo.isDialerLogin||this.loadAgentStateMenu()},updateNextStateTimerOnLogout:function(){this.nextStateTimerCount>0&&this.nextStateTimerCount<8&&(this.nextStateTimerCount=8,this.slideNNStateTimer())}})}(jQuery);