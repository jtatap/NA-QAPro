!function($){$.widget("AgentConsole.agentReportsPerformance",{options:{container:null,resourceBase:""},_create:function(){var parent=this.element;this.resourceBase=this.options.resourceBase;var that=this;parent.addClass("agentReportsPerformance"),$('<span class="dialogHidden">'+IC_Localization.begin+" "+IC_Localization.agent+" "+IC_Localization.performance+"</span>").appendTo(parent),this.rootPanel=$('<div class="modalDialogBackground"/>').appendTo(parent),this.headerPanel=$('<div class="modalDialogHeader" tabindex="-1" aria-labelledby="agentReportsPerformance_Header" role="dialog"/>').appendTo(this.rootPanel),this.headerText=$('<div id = "agentReportsPerformance_Header" class="agentReportdHeaderTxt"/>').appendTo(this.headerPanel),this.percentageInHeader=$("<div>").addClass("percentageInHeader").appendTo(this.headerPanel),this.closeBtn=$('<div id = "agentReportsCloseId" title="'+IC_Localization.close+'" role="button" aria-label = "'+IC_Localization.close+'" tabindex = "0" />').appendTo(this.headerPanel),this.closeBtnIcon=$("<img/>").addClass("closeBtnIcon").attr("src",this.resourceBase+"/css/images/section-close.png").attr("alt",IC_Localization.close+" "+IC_Localization.agentPerformanceReport).appendTo(this.closeBtn),this.closeBtn.on("click",$.proxy(this.closeBtnClick,this)),IC_Common.enterKeyPress(this.closeBtn,function(){that.closeBtnClick()}),IC_Common.setFocusToCloseIcon(this.closeBtn,this.closeBtnIcon,"closeBtnFocus","closeBtnIconFocus"),this.loadingDiv=$('<div class="loadingDiv"/>').appendTo(this.rootPanel),this.loadingIcn=$('<div class="icn"><div id = "loadingDivId" class="loadingTxt textEllipsis">'+IC_Localization.loading+"</div></div>").appendTo(this.loadingDiv),dateRangeDiv=$('<div id = "dateRangeDivId"/>').addClass("dateRangeDiv").appendTo(this.rootPanel),this.todayDiv=$('<div aria-label="'+IC_Localization.today+'"/>').addClass("todayDiv").appendTo(dateRangeDiv),IC_Common.setTextWithEllipsis(this.todayDiv,IC_Localization.today,56,!0),this.yesterdayDiv=$('<div aria-label="'+IC_Localization.yesterday+'"/>').text(IC_Localization.yesterday).addClass("yesterdayDiv").appendTo(dateRangeDiv),this.last7DaysDiv=$('<div aria-label="'+IC_Localization.last7days+" "+IC_Localization.days+'"/>').addClass("last7DaysDiv").appendTo(dateRangeDiv),IC_Common.setTextWithEllipsis(this.last7DaysDiv,IC_Localization.last7days,56,!0),this.agentPerformanceGridDiv=$("<div/>").appendTo(this.rootPanel),table=$("<table>").appendTo(this.agentPerformanceGridDiv),tableHeaderDiv=$('<div id = "tableHeaderDivId"/>').addClass("performanceGridHeader").appendTo(table),tableHeaderRow=$("<tr>").appendTo(tableHeaderDiv),stateDiv=$("<td/>").css("width","68px").appendTo(tableHeaderRow),youDiv=$("<th scope='col' aria-label = '"+IC_Localization.you+"'/>").text(IC_Localization.you).addClass("youDiv").appendTo(tableHeaderRow),IC_Common.setTextWithEllipsis(youDiv,IC_Localization.you,10,!0),teamDiv=$("<th scope='col' aria-label = '"+IC_Localization.team+"'/>").text(IC_Localization.team).addClass("teamDiv").appendTo(tableHeaderRow),IC_Common.setTextWithEllipsis(teamDiv,IC_Localization.team,20,!0),teamPercentageDiv=$("<th scope='col' aria-label = '"+IC_Localization.teamPercentage+"'/>").text(IC_Localization.teamPercentage).addClass("teamPercentageDiv").appendTo(tableHeaderRow),IC_Common.setTextWithEllipsis(teamPercentageDiv,IC_Localization.teamPercentage,45,!0),inboundStateDiv=$('<div id= "inboundStateDivId"/>').addClass("performanceGridRow").appendTo(table),inboundRow=$("<tr>").appendTo(inboundStateDiv),inboundLabel=$("<th scope = 'row' aria-label='"+IC_Localization.inbound+"'/>").text(IC_Localization.inbound).addClass("performanceStateLabelDiv").appendTo(inboundRow),this.youInboundCell=$("<td/>").addClass("youCell").appendTo(inboundRow),this.teamInboundCell=$("<td/>").addClass("teamCell").appendTo(inboundRow),this.percentageInboundCell=$("<td/>").addClass("percentageCell").appendTo(inboundRow),outboundStateDiv=$('<div id= "outboundStateDivId"/>').addClass("performanceGridRow").appendTo(table),outboundRow=$("<tr>").appendTo(outboundStateDiv),outboundLabel=$("<th scope = 'row' aria-label='"+IC_Localization.outbound+"'/>").text(IC_Localization.outbound).addClass("performanceStateLabelDiv").appendTo(outboundRow),this.youOutboundCell=$("<td/>").addClass("youCell").appendTo(outboundRow),this.teamOutboundCell=$("<td/>").addClass("teamCell").appendTo(outboundRow),this.percentageOutboundCell=$("<td/>").addClass("percentageCell").appendTo(outboundRow),overallDiv=$('<div id= "overallDivId"/>').addClass("performanceOverallGridRow").appendTo(table),overallHandledRow=$("<tr>").appendTo(overallDiv),overallLabel=$("<th scope = 'row' aria-label='"+IC_Localization.overall+"'/>").text(IC_Localization.overall).addClass("performanceStateLabelDiv").appendTo(overallHandledRow),this.youOverallCell=$("<td/>").addClass("OverallCell").appendTo(overallHandledRow),this.teamOverallCell=$("<td/>").addClass("OverallCell").appendTo(overallHandledRow),this.percentageOverallCell=$("<td/>").addClass("percentageOverallCell").appendTo(overallHandledRow),this.todayDiv.on("click",$.proxy(this.onClickDateRange,this,"Today",this.todayDiv)),this.yesterdayDiv.on("click",$.proxy(this.onClickDateRange,this,"Yesterday",this.yesterdayDiv)),this.last7DaysDiv.on("click",$.proxy(this.onClickDateRange,this,"Last7days",this.last7DaysDiv)),this.agentProductivityGridDiv=$("<div/>").css("display","none").appendTo(this.rootPanel),prod_AvailableTable=$("<table>").addClass("productivityTable").appendTo(this.agentProductivityGridDiv),prod_AvailableRow=$("<tr>").appendTo(prod_AvailableTable),prod_AvailableStateLbl=$("<td>").addClass("availableBarDiv").css("font-size","10px").text(IC_Localization.available).appendTo(prod_AvailableRow),prod_AvailableAgentBarDiv=$("<td rowspan='2'>").css({"padding-top":"6px"}).appendTo(prod_AvailableRow),this.prod_AvailableAgentBar=$("<div/>").addClass("availableAgentBarGradient").appendTo(prod_AvailableAgentBarDiv),this.prod_AvailableAgentPercDiv=$("<td rowspan='2'>").addClass("availableAgentPercDiv").appendTo(prod_AvailableRow),prod_AvailableAgentRow=$("<tr>").appendTo(prod_AvailableTable),this.prod_AvailableAgentTime=$("<td>").addClass("availableBarDiv").css("font-size","12px").appendTo(prod_AvailableAgentRow),prod_AvailableTeamRow=$("<tr>").appendTo(prod_AvailableTable),this.prod_AvailableTeamTime=$("<td>").addClass("availableBarDiv").css("font-size","10px").appendTo(prod_AvailableTeamRow),prod_AvailableTeamBarDiv=$("<td>").appendTo(prod_AvailableTeamRow),this.prod_AvailableTeamBar=$("<div/>").addClass("availableTeamBarGradient").appendTo(prod_AvailableTeamBarDiv),this.prod_AvailableTeamPercDiv=$("<td>").addClass("availableTeamPercDiv").appendTo(prod_AvailableTeamRow),prod_WorkingTable=$("<table>").addClass("productivityTable").appendTo(this.agentProductivityGridDiv),prod_WorkingRow=$("<tr>").appendTo(prod_WorkingTable),prod_WorkingStateLbl=$("<td>").addClass("workingBarDiv").css({"font-size":"10px",display:"inline-block"}).appendTo(prod_WorkingRow),IC_Common.setTextWithEllipsis(prod_WorkingStateLbl,IC_Localization.working,55,!0),prod_WorkingAgentBarDiv=$("<td rowspan='2'>").css({"padding-top":"6px"}).appendTo(prod_WorkingRow),this.prod_WorkingAgentBar=$("<div/>").addClass("workingAgentBarGradient").appendTo(prod_WorkingAgentBarDiv),this.prod_WorkingAgentPercDiv=$("<td rowspan='2'>").addClass("workingAgentPercDiv").appendTo(prod_WorkingRow),prod_WorkingAgentRow=$("<tr>").appendTo(prod_WorkingTable),this.prod_WorkingAgentTime=$("<td>").addClass("workingBarDiv").css("font-size","12px").appendTo(prod_WorkingAgentRow),prod_WorkingTeamRow=$("<tr>").appendTo(prod_WorkingTable),this.prod_WorkingTeamTime=$("<td>").addClass("workingBarDiv").css("font-size","10px").appendTo(prod_WorkingTeamRow),prod_WorkingTeamBarDiv=$("<td>").appendTo(prod_WorkingTeamRow),this.prod_WorkingTeamBar=$("<div/>").addClass("workingTeamBarGradient").appendTo(prod_WorkingTeamBarDiv),this.prod_WorkingTeamPercDiv=$("<td>").addClass("workingTeamPercDiv").appendTo(prod_WorkingTeamRow),prod_UnavailableTable=$("<table>").addClass("productivityTable").appendTo(this.agentProductivityGridDiv),prod_UnavailableRow=$("<tr>").appendTo(prod_UnavailableTable),prod_UnavailableStateLbl=$("<td>").addClass("unavailableBarDiv").css("font-size","10px").text(IC_Localization.unavailable).appendTo(prod_UnavailableRow),prod_UnavailableAgentBarDiv=$("<td rowspan='2'>").css({"padding-top":"6px"}).appendTo(prod_UnavailableRow),this.prod_UnavailableAgentBar=$("<div/>").addClass("unavailableAgentBarGradient").appendTo(prod_UnavailableAgentBarDiv),this.prod_UnavailableAgentPercDiv=$("<td rowspan='2'>").addClass("unavailableAgentPercDiv").appendTo(prod_UnavailableRow),prod_UnavailableAgentRow=$("<tr>").appendTo(prod_UnavailableTable),this.prod_UnavailableAgentTime=$("<td>").addClass("unavailableBarDiv").css("font-size","12px").appendTo(prod_UnavailableAgentRow),prod_UnavailableTeamRow=$("<tr>").appendTo(prod_UnavailableTable),this.prod_UnavailableTeamTime=$("<td>").addClass("unavailableBarDiv").css("font-size","10px").appendTo(prod_UnavailableTeamRow),prod_UnavailableTeamBarDiv=$("<td>").appendTo(prod_UnavailableTeamRow),this.prod_UnavailableTeamBar=$("<div/>").addClass("unavailableTeamBarGradient").appendTo(prod_UnavailableTeamBarDiv),this.prod_UnavailableTeamPercDiv=$("<td>").addClass("unavailableTeamPercDiv").appendTo(prod_UnavailableTeamRow),$('<span class="dialogHidden">'+IC_Localization.end+" "+IC_Localization.agent+" "+IC_Localization.performance+"</span>").appendTo(parent)},onClickDateRange:function(dateRange,btnDivDOM){var startDate,endDate,minutes,from,to,today,loadingHeight;if(!btnDivDOM.hasClass("dateRangeDivSelect")){switch("block"===this.agentPerformanceGridDiv.css("display")?(loadingHeight=71,this.loadingDiv.removeClass("loadingDivInProductivity")):(loadingHeight=79,this.loadingDiv.addClass("loadingDivInProductivity")),loadingHeight=this.isDialerPanel||this.isShowIndicator?loadingHeight-2:loadingHeight,loadingHeight=this.isDialerPanel&&this.isShowIndicator?loadingHeight-2:loadingHeight,this.loadingDiv.css("height",loadingHeight+"%"),this.loadingDiv.fadeIn(500),today=new Date,dateRange){case"Today":this.selectRangeButton(this.todayDiv),this.unselectRangeButton(this.yesterdayDiv),this.unselectRangeButton(this.last7DaysDiv),startDate=new Date(today.getFullYear(),today.getMonth(),today.getDate(),0,0,0),(minutes=today.getMinutes())>0&&minutes<15?today.setMinutes(0):minutes>15&&minutes<30?today.setMinutes(15):minutes>30&&minutes<45?today.setMinutes(30):minutes>45&&today.setMinutes(45),today.setSeconds(0),today.setMinutes(today.getMinutes()+15),endDate=today;break;case"Yesterday":this.selectRangeButton(this.yesterdayDiv),this.unselectRangeButton(this.todayDiv),this.unselectRangeButton(this.last7DaysDiv),today.setDate(today.getDate()-1),startDate=this.getStartDate(today),endDate=this.getEndDate(today);break;case"Last7days":this.selectRangeButton(this.last7DaysDiv),this.unselectRangeButton(this.todayDiv),this.unselectRangeButton(this.yesterdayDiv),today.setDate(today.getDate()-7),startDate=this.getStartDate(today),today.setDate(today.getDate()+6),endDate=this.getEndDate(today)}from=IC_Common.toISODateString(startDate),to=IC_Common.toISODateString(endDate),this.getDateRange(from,to)}},getStartDate:function(input){var output=new Date(input.getTime());return output.setHours(0),output.setMinutes(0),output.setSeconds(0),output},getEndDate:function(input){var output=new Date(input.getTime());return output.setDate(output.getDate()+1),output.setHours(0),output.setMinutes(0),output.setSeconds(0),output},getDateRange:function(from,to){var that=this;this.options.container.getAgentPerformanceHistory(from,to,function(data){that.agentPerformance=data,that.options.container.getTeamPerformanceHistory(from,to,function(data){that.teamPerformance=data,that.showAgentReports(that.agentPerformance,that.teamPerformance)})})},showAgentReports:function(agentData,teamData,reports){var performanceInboundPercentage=0,performanceOutboundPercentage=0,performancePercentage=0,teamInboundHandled=0,teamOutboundHandled=0,teamTotalHandled=0,productivityAgentAvailableMilliseconds=0,productivityAgentUnavailableMilliseconds=0,productivityAgentWorkingMilliseconds=0,productivityAgentTotalMilliseconds=(productivityAgentUnavailableMilliseconds=0,0),productivityTeamAvailableMilliseconds=0,productivityTeamWorkingMilliseconds=0,productivityTeamUnavailableMilliseconds=0,productivityTeamTotalMilliseconds=0,productivityAgentAvailablePercentage=0,productivityAgentUnavailablePercentage=0,productivityTeamAvailablePercentage=0,productivityTeamUnavailablePercentage=0,productivityAgentWorkingPercentage=0,productivityTeamWorkingPercentage=0,productivityHighestPercent=0;this.loadingDiv.fadeOut(500),"Performance"==reports?(IC_Common.setTextWithEllipsis(this.headerText,IC_Localization.performance,110,!0),this.agentProductivityGridDiv.css("display","none"),this.agentPerformanceGridDiv.css("display","block"),this.selectRangeButton(this.todayDiv),this.unselectRangeButton(this.yesterdayDiv),this.unselectRangeButton(this.last7DaysDiv)):"Productivity"==reports&&(IC_Common.setTextWithEllipsis(this.headerText,IC_Localization.productivity,110,!0),this.agentPerformanceGridDiv.css("display","none"),this.agentProductivityGridDiv.css("display","block"),this.selectRangeButton(this.todayDiv),this.unselectRangeButton(this.yesterdayDiv),this.unselectRangeButton(this.last7DaysDiv)),"block"===this.agentPerformanceGridDiv.css("display")&&(IC_Validation.isNotNullOrUndefinedString(teamData)&&"0"!==teamData.inboundHandled&&(performanceInboundPercentage=Math.round(agentData.inboundHandled/teamData.inboundHandled*100),teamInboundHandled=teamData.inboundHandled),IC_Validation.isNotNullOrUndefinedString(teamData)&&"0"!==teamData.outboundHandled&&(performanceOutboundPercentage=Math.round(agentData.outboundHandled/teamData.outboundHandled*100),teamOutboundHandled=teamData.outboundHandled),IC_Validation.isNotNullOrUndefinedString(teamData)&&"0"!==teamData.totalHandled&&(performancePercentage=Math.round(agentData.totalHandled/teamData.totalHandled*100),teamTotalHandled=teamData.totalHandled),this.percentageInHeader.text(performancePercentage+"%"),this.youInboundCell.text(agentData.inboundHandled).attr("title",agentData.inboundHandled),this.teamInboundCell.text(teamInboundHandled).attr("title",teamInboundHandled),this.percentageInboundCell.text(performanceInboundPercentage+"%").attr("title",performanceInboundPercentage+"%"),this.youOutboundCell.text(agentData.outboundHandled).attr("title",agentData.outboundHandled),this.teamOutboundCell.text(teamOutboundHandled).attr("title",teamOutboundHandled),this.percentageOutboundCell.text(performanceOutboundPercentage+"%").attr("title",performanceOutboundPercentage+"%"),this.youOverallCell.text(agentData.totalHandled).attr("title",agentData.totalHandled),this.teamOverallCell.text(teamTotalHandled).attr("title",teamTotalHandled),this.percentageOverallCell.text(performancePercentage+"%").attr("title",performancePercentage+"%")),"block"===this.agentProductivityGridDiv.css("display")&&(productivityAgentAvailableMilliseconds=IC_Common.getMilliseconds(agentData.availableTime),productivityAgentUnavailableMilliseconds=IC_Common.getMilliseconds(agentData.unavailableTime),productivityAgentWorkingMilliseconds=IC_Common.getMilliseconds(agentData.inboundTalkTime)+IC_Common.getMilliseconds(agentData.outboundTalkTime),productivityAgentTotalMilliseconds=IC_Common.getMilliseconds(agentData.loginTime),IC_Validation.isNotNullOrUndefinedString(teamData)&&(productivityTeamAvailableMilliseconds=IC_Common.getMilliseconds(teamData.availableTime),productivityTeamUnavailableMilliseconds=IC_Common.getMilliseconds(teamData.unavailableTime),productivityTeamWorkingMilliseconds=IC_Common.getMilliseconds(teamData.inboundTalkTime)+IC_Common.getMilliseconds(teamData.outboundTalkTime),productivityTeamTotalMilliseconds=IC_Common.getMilliseconds(teamData.loginTime)),productivityAgentTotalMilliseconds>=1e3&&(productivityAgentAvailablePercentage=Math.round(productivityAgentAvailableMilliseconds/productivityAgentTotalMilliseconds*100),productivityAgentUnavailablePercentage=Math.round(productivityAgentUnavailableMilliseconds/productivityAgentTotalMilliseconds*100),productivityAgentWorkingPercentage=Math.round(productivityAgentWorkingMilliseconds/productivityAgentTotalMilliseconds*100)),productivityTeamTotalMilliseconds>=1e3&&(productivityTeamAvailablePercentage=Math.round(productivityTeamAvailableMilliseconds/productivityTeamTotalMilliseconds*100),productivityTeamUnavailablePercentage=Math.round(productivityTeamUnavailableMilliseconds/productivityTeamTotalMilliseconds*100),productivityTeamWorkingPercentage=Math.round(productivityTeamWorkingMilliseconds/productivityTeamTotalMilliseconds*100)),this.percentageInHeader.text(productivityAgentWorkingPercentage+"%"),this.prod_AvailableAgentTime.text(this.getTimeFromMS(productivityAgentAvailableMilliseconds)),this.prod_AvailableTeamTime.text(this.getTimeFromMS(productivityTeamAvailableMilliseconds)),this.prod_AvailableAgentPercDiv.text(productivityAgentAvailablePercentage+"%"),this.prod_AvailableTeamPercDiv.text(productivityTeamAvailablePercentage+"%"),this.prod_UnavailableAgentTime.text(this.getTimeFromMS(productivityAgentUnavailableMilliseconds)),this.prod_UnavailableTeamTime.text(this.getTimeFromMS(productivityTeamUnavailableMilliseconds)),this.prod_UnavailableAgentPercDiv.text(productivityAgentUnavailablePercentage+"%"),this.prod_UnavailableTeamPercDiv.text(productivityTeamUnavailablePercentage+"%"),this.prod_WorkingAgentTime.text(this.getTimeFromMS(productivityAgentWorkingMilliseconds)),this.prod_WorkingTeamTime.text(this.getTimeFromMS(productivityTeamWorkingMilliseconds)),this.prod_WorkingAgentPercDiv.text(productivityAgentWorkingPercentage+"%"),this.prod_WorkingTeamPercDiv.text(productivityTeamWorkingPercentage+"%"),productivityHighestPercent<productivityAgentAvailablePercentage&&(productivityHighestPercent=productivityAgentAvailablePercentage),productivityHighestPercent<productivityTeamAvailablePercentage&&(productivityHighestPercent=productivityTeamAvailablePercentage),productivityHighestPercent<productivityAgentWorkingPercentage&&(productivityHighestPercent=productivityAgentWorkingPercentage),productivityHighestPercent<productivityTeamWorkingPercentage&&(productivityHighestPercent=productivityTeamWorkingPercentage),productivityHighestPercent<productivityAgentUnavailablePercentage&&(productivityHighestPercent=productivityAgentUnavailablePercentage),productivityHighestPercent<productivityTeamUnavailablePercentage&&(productivityHighestPercent=productivityTeamUnavailablePercentage),0===productivityHighestPercent?(this.prod_AvailableAgentBar.css("width","0px"),this.prod_AvailableTeamBar.css("width","0px"),this.prod_UnavailableAgentBar.css("width","0px"),this.prod_UnavailableTeamBar.css("width","0px"),this.prod_WorkingAgentBar.css("width","0px"),this.prod_WorkingTeamBar.css("width","0px")):(this.prod_AvailableAgentBar.css("width",productivityAgentAvailablePercentage/productivityHighestPercent*70+"px"),this.prod_AvailableTeamBar.css("width",productivityTeamAvailablePercentage/productivityHighestPercent*70+"px"),this.prod_UnavailableAgentBar.css("width",productivityAgentUnavailablePercentage/productivityHighestPercent*70+"px"),this.prod_UnavailableTeamBar.css("width",productivityTeamUnavailablePercentage/productivityHighestPercent*70+"px"),this.prod_WorkingAgentBar.css("width",productivityAgentWorkingPercentage/productivityHighestPercent*70+"px"),this.prod_WorkingTeamBar.css("width",productivityTeamWorkingPercentage/productivityHighestPercent*70+"px")))},getTimeFromMS:function(milliseconds){var seconds,minutes,totalSeconds=Math.floor(milliseconds/1e3);return totalSeconds<0&&(totalSeconds=0),seconds=("0"+totalSeconds%60).slice(-2),minutes=("0"+Math.floor(totalSeconds/60)%60).slice(-2),("0"+Math.floor(totalSeconds/3600)).slice(-2)+":"+minutes+":"+seconds},selectRangeButton:function(btnDivDOM){btnDivDOM.hasClass("dateRangeDivSelect")||btnDivDOM.addClass("dateRangeDivSelect"),btnDivDOM.addClass("dateRangeTextColor")},unselectRangeButton:function(btnDivDOM){btnDivDOM.removeClass("dateRangeDivSelect"),btnDivDOM.removeClass("dateRangeTextColor")},closeBtnClick:function(){this.options.container.closeAgentReportsPerformanceAndShowHome(),IC_Common.removeFocusFromCloseIcon(this.closeBtnIcon,"closeBtnIconFocus")},setFocusToPerformanceHeader:function(){this.headerPanel.trigger("focus")},updatePanelHeight:function(isDialerPanel,isShowIndicator){this.isDialerPanel=isDialerPanel,this.isShowIndicator=isShowIndicator}})}(jQuery);