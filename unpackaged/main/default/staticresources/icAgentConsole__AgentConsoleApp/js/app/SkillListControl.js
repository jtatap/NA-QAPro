!function($){$.widget("AgentConsole.skillList",{options:{container:null,resourceBase:""},_create:function(){var searchPanel,that=this;this.isWorkItemTransferClicked=!1,this.isVoiceMailTransferClicked=!1,this.isChatContactTransferClicked=!1,this.isEmailContactTransferClicked=!1,this.options.container.isPopout?(this.gridScrollHeight=292,this.rowLimit=15):(this.gridScrollHeight=275,this.rowLimit=3),this.DefaultSearchText=IC_Localization.search+" ...",this.resourceBase=this.options.resourceBase,this.element.addClass("skillList"),$('<span class="dialogHidden">'+IC_Localization.begin+" "+IC_Localization.skillList+"</span>").appendTo(this.element),this.infoPnlOnTransfer=$("<div/>").addClass("infoTransfer textEllipsis").text(IC_Localization.toTransferSelectAnAgentOrSkill).attr("title",IC_Localization.toTransferSelectAnAgentOrSkill).appendTo(this.element),this.skillListPanel=$("<div/>").addClass("modalDialogBackground").appendTo(this.element),this.headerPanel=$('<div tabindex="-1" aria-labelledby="skillList_HeaderText"/>').addClass("modalDialogHeader").appendTo(this.skillListPanel),$('<div id = "skillList_HeaderText" />').addClass("modalDialogHeaderText textEllipsis").text(IC_Localization.skillList).appendTo(this.headerPanel),this.closeBtn=$('<div id = "skillList_CloseIcon" role="button" aria-label = "'+IC_Localization.close+'" tabindex = "0"/>').on("click",$.proxy(this.onClose,this)).attr("title",IC_Localization.close).appendTo(this.headerPanel),this.closeBtnIcon=$("<img/>").addClass("closeBtnIcon").attr("src",this.resourceBase+"/css/images/section-close.png").appendTo(this.closeBtn),IC_Common.enterKeyPress(this.closeBtn,function(){that.onClose()}),IC_Common.setFocusToCloseIcon(this.closeBtn,this.closeBtnIcon,"closeBtnFocus","closeBtnIconFocus"),this.contentPanel=$('<div class="skillListContentPnl"/>').appendTo(this.skillListPanel),this.searchAndFilterPanel=$('<div id = "skillLstSearchAndFilterPanelId" />').addClass("searchAndFilterPanel").appendTo(this.contentPanel),searchPanel=$('<div id = "skillLstSearchPnlId" />').addClass("searchPanel").appendTo(this.searchAndFilterPanel),this.searchText=$("<div/>").addClass("searchText").appendTo(searchPanel),this.searchTextInput=$('<input id = "skillLstSearchTextInputId" type="text" title = "'+IC_Localization.search+" "+IC_Localization.skillList+'">').addClass("searchTextInput defaultSearchText").appendTo(this.searchText),this.searchTextInput.val(this.DefaultSearchText),this.searchTextInput.trigger("focus"),this.searchTextInput.on("keyup",$.proxy(this.onFilterChange,this)),this.searchTextInput.on("focus",$.proxy(this.onSearchTextClick,this)),this.searchTextInput.on("click",$.proxy(this.onSearchTextClick,this)),this.searchTextInput.on("blur",$.proxy(this.onSearchTextBlur,this)),this.options.container.isPopout?(this.skillNameColWidth=150,this.queueColWidth=111,this.waitTimeColWidth=111):(this.skillNameColWidth=58,this.queueColWidth=58,this.waitTimeColWidth=58),this.setGridColumn(),this.gridId=IC_Common.generateUniqueId("skillList"),this.skillListGrid=$('<div id="'+this.gridId+'"></div>').addClass("skillListGrid").appendTo(this.contentPanel),this.createSkillListGrid(),$('<span class="dialogHidden">'+IC_Localization.end+" "+IC_Localization.skillList+"</span>").appendTo(this.element)},_init:function(){this.inboundSkillList=[],this.workItemSkillList=[],this.chatSkillList=[],this.emailSkillList=[],this.voiceMailSkillList=[],this.skillQueueList={},this.filter={},this.teamList=[],this.sortGrid={},this.agentSkillMap={}},setGridColumn:function(){var that=this,skillNameColWidth=this.skillNameColWidth,queueColWidth=this.queueColWidth,waitTimeColWidth=this.waitTimeColWidth,skillNameTextWidth=skillNameColWidth-14,queueTextWidth=queueColWidth-17,waitTimeTextWidth=waitTimeColWidth-24;this.colModel=[{id:"SkillName",field:"SkillName",name:IC_Common.textMask(IC_Localization.skill,skillNameTextWidth),width:skillNameColWidth,sortable:!0,resizable:!1,headerCssClass:"decorationHeader",cssClass:"alignLeft",toolTip:IC_Localization.skill,formatter:function(row,col,value,columnDef,data){var infoDiv=$('<div class="infoCol"/>'),infoLine1Div=$('<div id = "line1SkillNamelId" class="line1"/>').appendTo(infoDiv),infoLine2Div=$('<div id = "line2QueueId" class="line2"/>').appendTo(infoDiv),infoLine3Div=$('<div id = "line3WaitId" class="line3"/>').appendTo(infoDiv),mediaDOMId=($('<div id = "queueId" ></div>').text(IC_Localization.queue+" : ").attr("title",IC_Localization.queue).addClass("queueLabelDiv textEllipsis").appendTo(infoLine2Div),$('<div id = "waitId" ></div>').text(IC_Localization.wait+" : ").attr("title",IC_Localization.wait).addClass("waitLabelDiv textEllipsis").appendTo(infoLine3Div),IC_Common.generateUniqueId("skillListRowState")),seconds=IC_Common.secondsToTime(data.WaitTime),secDOMId=IC_Common.generateUniqueId("skillSeconds");return that.tableRow[row].MediaInfo.MediaDOMId=mediaDOMId,$('<div id="'+mediaDOMId+'"></div>').addClass("gridItem").addClass(data.MediaInfo.CssState+"-hover").appendTo(infoLine1Div),$('<div id = "skillLstSkillNameDivId" ></div>').addClass("gridItem").addClass("skillName textEllipsis").text(data.SkillName).attr("title",data.SkillName).appendTo(infoLine1Div),$('<div id = "queueValueDivId" ></div>').text(data.SkillQueue).appendTo(infoLine2Div),that.tableRow[row].MediaInfo.secDOMId=secDOMId,$('<div id="'+secDOMId+'"></div>').addClass("gridItem").appendTo(infoLine3Div),$('<div id = "waitValueDivId" style="display: inline-block;"></div>').text(seconds).attr("title",seconds).appendTo(infoLine3Div),infoDiv.html()}},{id:"SkillQueue",field:"SkillQueue",name:IC_Common.textMask(IC_Localization.queue,queueTextWidth),width:queueColWidth,sortable:!0,resizable:!1,cssClass:"decoration",toolTip:IC_Localization.queue},{id:"WaitTime",field:"WaitTime",name:IC_Common.textMask(IC_Localization.wait,waitTimeTextWidth),width:waitTimeColWidth,sortable:!0,resizable:!1,headerCssClass:this.headerCss,cssClass:"decoration",toolTip:IC_Localization.wait}]},gridSorter:function(a,b){var sortDir=1,x=a[this.sortGrid.sortCol],y=b[this.sortGrid.sortCol];return"SkillName"===this.sortGrid.sortCol&&(x=x.toLowerCase(),y=y.toLowerCase()),void 0!==this.sortGrid.sortDir&&null!==this.sortGrid.sortDir&&(sortDir=this.sortGrid.sortDir),sortDir*(x==y?0:x>y?1:-1)},createSkillListGrid:function(){var that=this;this.dataView=new Slick.Data.DataView,this.dataView.getItemMetadata=function(row){return{columns:{SkillName:{colspan:3}}}},this.grid=new Slick.Grid("#"+this.gridId,this.dataView,this.colModel,{rowHeight:45,enableColumnReorder:!1}),this.dataView.onRowCountChanged.subscribe(function(e,args){that.grid.updateRowCount(),that.grid.render()}),this.dataView.onRowsChanged.subscribe(function(e,args){that.grid.invalidateRows(args.rows),that.grid.render()}),this.grid.onCellChange.subscribe(function(e,args){that.dataView.updateItem(args.item.id,args.item),that.grid.render()}),this.grid.onSort.subscribe(function(e,args){that.sortGrid.sortDir=args.sortAsc?1:-1,that.sortGrid.sortCol=args.sortCol.field,that.tableRow=[],that.tableRow=IC_Common.parseJSON(JSON.stringify(that.sortGridRow)),that.tableRow.sort($.proxy(that.gridSorter,that)),that.dataView.beginUpdate(),that.dataView.setItems(that.tableRow),that.dataView.endUpdate()}),this.grid.onMouseLeave.subscribe($.proxy(this.onGridRowMouseLeave,this)),this.grid.onMouseEnter.subscribe($.proxy(this.onGridRowMouseEnter,this)),this.grid.onClick.subscribe($.proxy(this.onGridRowClick,this)),this.columnBorderDiv=$('<div style="height: '+this.gridScrollHeight+'px"></div>').addClass("columnBorderDiv"),$(".skillList .slick-viewport").append(this.columnBorderDiv)},onSearchTextClick:function(){this.searchTextInput.val()===this.DefaultSearchText&&(this.searchTextInput.val(""),this.searchTextInput.removeClass("defaultSearchText"))},onSearchTextBlur:function(){""===this.searchTextInput.val()&&(this.searchTextInput.val(this.DefaultSearchText),this.searchTextInput.addClass("defaultSearchText"))},onFilterChange:function(){var filter={};filter.searchText=this.searchTextInput.val(),filter.filterType="SkillName",this.filter=filter,this.updateGrid()},onGridRowMouseEnter:function(e,args){var cell=args.grid.getCellFromEvent(e),mediaInfo=this.tableRow[cell.row].MediaInfo,contactType=this.options.container.contactType;"EmailContactEvent"===contactType||"VoiceMailContactEvent"===contactType||"ChatContactEvent"===contactType||"WorkItemContactEvent"===contactType?1!=this.options.container.isChatContactTransferClicked&&1!=this.options.container.isEmailContactTransferClicked&&1!=this.options.container.isVoiceMailTransferClicked&&1!=this.options.container.isWorkItemTransferClicked&&($(e.currentTarget.parentNode).addClass("gridRowDisabled"),$("#"+mediaInfo.MediaDOMId).addClass("phone-disabled-hover"),$(".grid-canvas").addClass("removePointer")):!1===this.options.container.isChatContactTransferClicked&&!1===this.options.container.isEmailContactTransferClicked&&!1===this.options.container.isVoiceMailTransferClicked&&("ib-Chat"!==mediaInfo.CssState&&"ib-Mail"!==mediaInfo.CssState&&"ib-VoiceMail"!==mediaInfo.CssState&&!0!==this.options.container.isPopout||$(".grid-canvas").addClass("removePointer"))},onGridRowMouseLeave:function(e,args){var cell=args.grid.getCellFromEvent(e),mediaInfo=this.tableRow[cell.row].MediaInfo;IC_Validation.isNotNullOrEmpty(mediaInfo.CssState)&&($("#"+mediaInfo.MediaDOMId).removeClass("phone-disabled-hover"),$(".grid-canvas").removeClass("removePointer")),$(e.currentTarget.parentNode).removeClass("gridRowDisabled"),!1===this.options.container.isChatContactTransferClicked&&!1===this.options.container.isEmailContactTransferClicked&&!1===this.options.container.isVoiceMailTransferClicked&&("ib-Chat"!==mediaInfo.CssState&&"ib-Mail"!==mediaInfo.CssState&&"ib-VoiceMail"!==mediaInfo.CssState&&!0!==this.options.container.isPopout||$(".grid-canvas").removeClass("removePointer"))},onGridRowClick:function(e,args){var cell=args.grid.getCellFromEvent(e),skillName=this.tableRow[cell.row].SkillName,skillId=this.tableRow[cell.row].SkillId,contactType=this.options.container.contactType;if(("EmailContactEvent"===contactType||"VoiceMailContactEvent"===contactType||"ChatContactEvent"===contactType||"WorkItemContactEvent"===contactType)&&1!=this.options.container.isChatContactTransferClicked&&1!=this.options.container.isEmailContactTransferClicked&&1!=this.options.container.isVoiceMailTransferClicked&&1!=this.options.container.isWorkItemTransferClicked)return!1;(!1!==this.options.container.isPopout||!1!==this.options.container.isChatContactTransferClicked||0!=this.options.container.isVoiceMailTransferClicked||0!=this.options.container.isEmailContactTransferClicked||!IC_Validation.isNotNullOrUndefinedString(this.tableRow[cell.row].MediaInfo.CssState)||"ib-Chat"!==this.tableRow[cell.row].MediaInfo.CssState&&"ib-Mail"!==this.tableRow[cell.row].MediaInfo.CssState&&"ib-VoiceMail"!==this.tableRow[cell.row].MediaInfo.CssState)&&this.options.container.onSkillSelected(skillName,skillId)},resizeWidget:function(width,height){var totGridWidth;IC_Validation.isNotNullOrEmpty(width)||(width=408),IC_Validation.isNotNullOrEmpty(height)||(height=392),this.gridHeight=height-80,this.gridScrollHeight=this.gridHeight-25,this.contentPanel.css("height",this.gridHeight+"px"),this.rowLimit=Math.round(this.gridScrollHeight/19),totGridWidth=this.skillListGrid.width(),this.totGridWidth=totGridWidth,$(".agentConsolePopout .skillList .columnBorderDiv").css({width:totGridWidth+"px"}),$(".agentConsolePopout .skillList .columnBorderDiv .border1").css({width:this.skillNameColWidth-1+"px"}),this.updateGrid()},isMatchFound:function(skill){var matchFound=!0,agentMap=this.agentListMap,agentSkillMap=this.agentSkillMap,agentId="";if(IC_Validation.isNotNullOrEmpty(this.filter.filterValue))for(agentId in matchFound=!1,agentMap)if(agentMap.hasOwnProperty(agentId)&&agentMap[agentId].teamId==this.filter.filterValue&&IC_Validation.isValidObject(agentSkillMap[agentId])&&agentSkillMap[agentId].hasOwnProperty(skill.SkillId)){matchFound=!0;break}return IC_Validation.isNotNullOrEmpty(this.filter.searchText)&&this.filter.searchText!==this.DefaultSearchText&&(matchFound=matchFound&&-1!==skill.SkillName.toLowerCase().indexOf(this.filter.searchText.toLowerCase())),matchFound},updateGrid:function(){var skillList,len,skill,cssState,i=0;for(len=(skillList=!0===this.isWorkItemTransferClicked?this.workItemSkillList:!0===this.isChatContactTransferClicked?this.chatSkillList:!0===this.isEmailContactTransferClicked?this.emailSkillList:!0===this.isVoiceMailTransferClicked?this.voiceMailSkillList:this.inboundSkillList).length,delete this.tableRow,delete this.sortGridRow,this.tableRow=[],this.sortGridRow=[],i=0;i<len;i++)this.isMatchFound(skillList[i])&&(4===skillList[i].typeId?cssState="ib-Phone":6===skillList[i].typeId?cssState="workItem":3===skillList[i].typeId?cssState="ib-Chat":1===skillList[i].typeId?cssState="ib-Mail":5===skillList[i].typeId&&(cssState="ib-VoiceMail"),skill={id:i,SkillId:skillList[i].SkillId,MediaInfo:{CssState:cssState},SkillName:$.trim(skillList[i].SkillName),SkillQueue:this.getQueueCount(skillList[i].SkillId),WaitTime:this.getWaitTimeCount(skillList[i].SkillId)},this.sortGridRow.push(skill),this.tableRow.push(skill));this.tableRow.length>this.rowLimit?(this.headerCss="",this.options.container.isPopout?(this.skillNameColWidth=this.totGridWidth-(this.queueColWidth+this.waitTimeColWidth),this.columnBorderDiv.hide()):(this.skillNameColWidth=58,this.queueColWidth=58,this.waitTimeColWidth=58)):(this.headerCss="headerDecorationTopRight",this.options.container.isPopout?(this.skillNameColWidth=this.totGridWidth-(this.queueColWidth+this.waitTimeColWidth),$(".agentConsolePopout .skillList .columnBorderDiv .border1").css({width:this.skillNameColWidth+"px"}),this.columnBorderDiv.showfn()):(this.skillNameColWidth=58,this.queueColWidth=58,this.waitTimeColWidth=58),$(".skillList .grid-canvas").css({height:this.gridScrollHeight+"px"})),IC_Validation.isNotNullOrEmpty(this.skillNameColWidth)&&IC_Validation.isNumber(this.skillNameColWidth)||(this.skillNameColWidth=150,this.queueColWidth=111,this.waitTimeColWidth=111),this.setGridColumn(),document.getElementById(this.gridId)&&(IC_Validation.isNotNullOrUndefinedString(this.sortGrid.sortDir)||(this.sortGrid.sortCol="SkillName",this.grid.setSortColumn(this.sortGrid.sortCol,!0)),this.tableRow.sort($.proxy(this.gridSorter,this)),this.options.container.isPopout?this.gridHeight=this.gridHeight||292:this.gridHeight=this.gridHeight||275,this.skillListGrid.css("height",this.gridHeight+"px"),this.columnBorderDiv.css("height",this.gridScrollHeight+"px"),this.dataView.beginUpdate(),this.dataView.setItems(this.tableRow),this.dataView.endUpdate(),this.grid.setColumns(this.colModel),this.grid.invalidate(),this.grid.render()),$(".skillList .slick-viewport").css("height",this.gridScrollHeight+"px")},getQueueCount:function(skillId){var queueList=this.skillQueueList,queueCount="0";return queueList.hasOwnProperty(skillId)&&(queueCount=queueList[skillId].QueueCount),queueCount},getWaitTimeCount:function(skillId){var queueList=this.skillQueueList,waitTimeinSecs=0;return queueList.hasOwnProperty(skillId)&&(waitTimeinSecs=parseInt(queueList[skillId].LongestQueueTimeInSeconds)),waitTimeinSecs},updateData:function(agentListMap){IC_Validation.isNotNullOrEmpty(this.inboundSkillList)&&IC_Validation.isNotNullOrEmpty(this.workItemSkillList)&&IC_Validation.isNotNullOrEmpty(this.chatSkillList)&&IC_Validation.isNotNullOrEmpty(this.emailSkillList)&&IC_Validation.isNotNullOrEmpty(this.voiceMailSkillList)&&(this.agentListMap=agentListMap,this.updateGrid())},updateMetaData:function(type,list){"skills"===type&&this.updateSkillList(list),this.updateGrid()},updateQueueData:function(skillQueueMap){this.skillQueueList=skillQueueMap,this.updateGrid()},updateTeamList:function(teamList){var teamLen=0,i=0;if(this.teamList=[],IC_Validation.isNotNullOrEmptyArray(teamList)){for(teamLen=teamList.length,i=0;i<teamLen;i++)this.teamList.push({id:teamList[i].id,value:teamList[i].name});this.teamList.sort(function(a,b){var x=a.value.toLowerCase(),y=b.value.toLowerCase();return 1*(x==y?0:x>y?1:-1)}),this.teamList.splice(0,0,{id:"",value:IC_Localization.allTeams}),this.bindTeamComboBox()}},updateSkillList:function(allSkillList){for(var skillId in this.inboundSkillList=[],this.workItemSkillList=[],this.chatSkillList=[],this.emailSkillList=[],this.voiceMailSkillList=[],allSkillList)allSkillList.hasOwnProperty(skillId)&&(allSkillList[skillId].isOutbound||"Phone Call"!==allSkillList[skillId].typeName?allSkillList[skillId].isOutbound||"Work Item"!==allSkillList[skillId].typeName?allSkillList[skillId].isOutbound||"Chat"!==allSkillList[skillId].typeName?allSkillList[skillId].isOutbound||"E-Mail"!==allSkillList[skillId].typeName?allSkillList[skillId].isOutbound||"Voice Mail"!==allSkillList[skillId].typeName||this.voiceMailSkillList.push({SkillId:allSkillList[skillId].id,SkillName:allSkillList[skillId].name,Queue:"0",WaitTime:":00",typeId:allSkillList[skillId].typeId}):this.emailSkillList.push({SkillId:allSkillList[skillId].id,SkillName:allSkillList[skillId].name,Queue:"0",WaitTime:":00",typeId:allSkillList[skillId].typeId}):this.chatSkillList.push({SkillId:allSkillList[skillId].id,SkillName:allSkillList[skillId].name,Queue:"0",WaitTime:":00",typeId:allSkillList[skillId].typeId}):this.workItemSkillList.push({SkillId:allSkillList[skillId].id,SkillName:allSkillList[skillId].name,Queue:"0",WaitTime:":00",typeId:allSkillList[skillId].typeId}):this.inboundSkillList.push({SkillId:allSkillList[skillId].id,SkillName:allSkillList[skillId].name,Queue:"0",WaitTime:":00",typeId:allSkillList[skillId].typeId}))},bindTeamComboBox:function(){this.filterCombo.comboBox("setStore",this.teamList),this.filterCombo.comboBox("setSelectedItem",{id:"",value:IC_Localization.allTeams}),this.onFilterChange()},updateCSSOnWorkItemTransfer:function(remainingHeight,paddingValue){var modalDialogHeight;this.isWorkItemTransferClicked=!0,this.rowLimit=5,modalDialogHeight=this.actualModalDialogHeight-paddingValue,this.gridHeight=this.actualGridHeight-(paddingValue+this.infoPnlHeight),this.contentPanel.css("height",this.gridHeight+"px"),this.gridScrollHeight=this.gridHeight-(this.actualGridHeight-this.actualScrollHeight),this.skillListGrid.css("height",this.gridHeight+"px"),this.grid.resizeCanvas(),this.infoPnlOnTransfer.css("display","block"),this.skillListPanel.css("height",modalDialogHeight+"px"),this.columnBorderDiv.css("height",this.gridScrollHeight+"px"),this.updateGrid()},updateCSSOnWorkItemTransferInPopout:function(){this.isWorkItemTransferClicked=!0,this.updateGrid()},updateChatContactTransfer:function(){this.isChatContactTransferClicked=!0,this.updateGrid()},updateEmailContactTransfer:function(){this.isEmailContactTransferClicked=!0,this.updateGrid()},updateVoiceMailContactTransfer:function(){this.isVoiceMailTransferClicked=!0,this.updateGrid()},resetFlag:function(){this.isWorkItemTransferClicked=!1,this.isVoiceMailTransferClicked=!1,this.isChatContactTransferClicked=!1,this.isEmailContactTransferClicked=!1},resetCSSToOriginal:function(){this.isWorkItemTransferClicked=!1,this.isVoiceMailTransferClicked=!1,this.rowLimit=11;this.gridHeight=this.actualGridHeight,this.gridScrollHeight=this.actualScrollHeight,this.skillListPanel.css("height","100%"),this.contentPanel.css("height",this.gridHeight+"px"),this.skillListGrid.css("height",this.gridHeight+"px"),this.grid.resizeCanvas(),this.infoPnlOnTransfer.css("display","none"),this.columnBorderDiv.css("height",this.gridScrollHeight+"px"),$(".skillList .slick-viewport").css("height",this.gridScrollHeight+"px")},updatePanelHeight:function(height){this.infoPnlHeight=25,this.adjustFor=7;var searchPnlHt=this.searchAndFilterPanel.outerHeight(!0);this.gridHeight=height-(searchPnlHt+this.adjustFor),this.actualGridHeight=height-(searchPnlHt+this.adjustFor),this.actualModalDialogHeight=height,this.actualScrollHeight=height-(searchPnlHt+this.adjustFor+25),this.gridScrollHeight=this.actualScrollHeight,this.contentPanel.css("height",this.gridHeight+"px")},onClose:function(){this.options.container.closeSkillListAndShowHome(),IC_Common.removeFocusFromCloseIcon(this.closeBtnIcon,"closeBtnIconFocus")},setFocusToSkillListHeader:function(){this.headerPanel.trigger("focus")},destroy:function(){}})}(jQuery);