!function($){var logger=IC_Common.getLogger("ChatContact");$.widget("AgentConsole.chatContactPanel",{options:{controller:null,resourceBase:"",chatContactCount:0,idToShow:"",contact:null,canRoundTopCorners:!1,canRoundBottomCorners:!1,isPopout:!1},stopDestroy:!1,transcriptLoaded:!1,intialLoad:!1,chatRef:[],contactActiveTime:0,PrimayNotificationSec:9e4,SecondaryNotificationSec:18e4,isDispositionPnlShow:!1,isResetTimer:!0,manualClose:!1,prevTxtValue:"",enterPlaceHolderFlag:!1,isMsgExist:{},isActivateChatCalled:!1,isAgentTypingIndicator:!1,isPatronTypingPreview:!1,patronTypingNotify:null,patronTypingInterval:null,patronTextEnteredInterval:null,patronMessageDiv:null,patronMessage:{},chatPreview:{},typingMsgDots:null,patronIndicate:"",isAgentTyping:!1,chatPreviewDiv:null,contactIndicator:[],typedChatText:"",_init:function(){document.getElementById("renderTextSize")||$('<div id="renderTextSize"/>').addClass("renderTextSize").appendTo("Body"),this.chatStatusLocal={Active:IC_Localization.active,Disconnected:IC_Localization.disconnected}},_create:function(){this.contactTime=this.options.contact.time,this.agentLabel=IC_Localization.you,this.clientLabel=IC_Localization.contact,this.systemLabel=IC_Localization.system,logger.debug("Contact Time on start : "+this.contactTime),this.resourceBase=this.options.resourceBase,this.options.isPopout?this.consoleOptions=this.options.controller.options:this.consoleOptions=this.options.controller.consoleOptions(),this.root=this.createRootPanels(),this.root.appendTo(this.element),this.postCreate()},_agentStateTimerId:"Duration",_durationStateTimerId:"DurationInState",_timerLst:[],callDurationWidth:20,stopHoverSlide:!1,postCreate:function(){this.contactIndicatorPanel=$('<div class="contactIndicator"/>').appendTo(this.stateControlsPanel),this.contactIndicatorPanel.indicator({container:this,isContact:!0}),this.contactIndicatorPanel.hide(),this.statusColor("Agent")},createRootPanels:function(){this.options;var that=this;return this.rootPanel=$('<div class="ChatPnl"/>'),this.ctrlPanel=$('<div class="ctrlPanel"/>'),this.statePanel=$('<div class="StatePnl"/>'),this.bumberPanelLeft=$('<div class="BumperPnlLeft" id = "chatBumperPnlLeftId"/>'),this.stateControlsPanel=$('<div class="StateCtrlPnl btnDivEnable" />'),this.mediaTypeImgPnlL=$('<img class="MediaType" src="'+this.resourceBase+'/css/images/chatIcn.png" />'),this.rightArrowPnl=$('<img class="RightArrowInBumberBox" src="'+this.resourceBase+'/css/images/bumber-arrow-right.png" />'),this.rightArrowPnl.hide(),this.bumberPanelLeft.append(this.mediaTypeImgPnlL).append(this.rightArrowPnl),this.skillAndDurationHolder=$('<div class="skillAndDurationPnl"/>'),this.skillNamePnl=$('<div class="ContactType" />'),this.callDurationPnl=$('<div class="ContactTypeTime" align="right" />'),this.chatStatusDiv=$('<div class="ChatStatusDiv" align="center" />'),this.chatStatusImg=$("<img />"),this.chatStatusImg.hide(),this.chatStatusDiv.append(this.chatStatusImg),this.skillAndDurationHolder.append(this.skillNamePnl).append(this.chatStatusDiv).append(this.callDurationPnl),this.stausAndTimeHolder=$('<div class="statusAndTimePnl"/>'),this.contactStatus=$('<div class="ContactStatus StatusActive textEllipsis" align="left" id = "chatContactStatusId" />'),this.contactStatusTime=$('<div class="ContactStatusTime" align="right" />'),this.stausAndTimeHolder.append(this.contactStatus).append(this.contactStatusTime),this.stateControlsPanel.append(this.skillAndDurationHolder).append(this.stausAndTimeHolder),this.statePanel.append(this.bumberPanelLeft).append(this.stateControlsPanel),this.controlsPanel=$('<div class="ControlsPnl"/>'),this.bumberPanelRight=$('<div class="BumperPnlRight" id = "chatBumperPnlRightId"/>'),this.contactControlsPanel=$('<div class="ContactCtrlPnl" id = "chatContactControlsPanelId"/>'),this.mediaTypeImgPnlR=$('<img class="MediaType" src="'+this.resourceBase+'/css/images/chatIcn.png"/>'),this.LeftArrowPnl=$('<img class="LeftArrowInBumberBox" src="'+this.resourceBase+'/css/images/bumber-arrow-left.png" />'),this.bumberPanelRight.append(this.mediaTypeImgPnlR).append(this.LeftArrowPnl),this.dropDiv=$('<div id = "chatDropDivId" class="btnBrRound5 DropBtnPnl btnDivDisable" title="'+IC_Localization.disconnect+'" align="center" />'),this.dropImg=$('<img src="'+this.resourceBase+'/css/images/bumber-drop-disabled.png" class="ImgDrop" />'),this.dropDiv.append(this.dropImg),this.dropDiv.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.dropDiv.on("click",$.proxy(this.dropClick,this)),this.transferDiv=$('<div class="btnBrRound5 DropBtnPnl btnDivDisable" title="'+IC_Localization.transfer+'" align="center" />'),this.transferImg=$('<img src="'+this.resourceBase+'/css/images/bumber-workitem-transfer-disabled.png" class="ImgTransfer" />'),this.transferDiv.append(this.transferImg),this.transferDiv.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.transferDiv.on("click",$.proxy(this.transferClick,this)),this.contactControlsPanel.append(this.dropDiv).append(this.transferDiv),this.controlsPanel.append(this.bumberPanelRight).append(this.contactControlsPanel),this.contentPnl=$('<div class="contentPnl" />'),this.messagePnl=$('<div class="MessagePnl" />').appendTo(this.contentPnl),this.typingPnl=$('<div id = "typingPnlId" class="TypingPnl btnDivEnable" />').appendTo(this.contentPnl),this.textPnl=$('<div id = "textPnlId" class="TextPnl" />'),this.notesTxt=$('<textarea id = "notesTxtId" class="NotesTxt" title="'+IC_Localization.enterMessage+'"/>'),this.textPnl.append(this.notesTxt),this.enterPnl=$('<div id = "enterPnlId" class="EnterPnl" title="'+IC_Localization.send+'"/>'),this.enterImg=$("<img />").addClass("ImgEnter"),this.enterPnl.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),this.enterPnl.append(this.enterImg),this.changeButtonState(this.enterPnl,this.enterImg,"disabled",this.resourceBase+"/css/images/enter.png",this.resourceBase+"/css/images/enter-disable.png"),this.typingPnl.append(this.textPnl).append(this.enterPnl),this.tooltip=$("<div>").addClass("chatCopyTextDiv").appendTo(this.contentPnl),this.tooltipText=$("<span>").text(IC_Localization.ctrl_C_ToCopy).addClass("chatCopyTextSpan").appendTo(this.tooltip),this.ctrlPanel.append(this.statePanel).append(this.controlsPanel),this.rootPanel.append(this.ctrlPanel).append(this.contentPnl),this.bumberPanelLeft.addClass("TopLeftRound BottomLeftRound"),this.stateControlsPanel.addClass("TopRightRound BottomRightRound"),this.bumberPanelRight.addClass("TopRightRound BottomRightRound"),this.controlsPanel.addClass("TopLeftRound TopRightRound"),this.contactControlsPanel.addClass("TopLeftRound BottomLeftRound"),this.notesTxt.on("keyup",function(){that.setEnterEnable()}),this.chatPlaceholderMsg=IC_Localization.enterMessage+"...",this.notesTxt.placeholder(this.chatPlaceholderMsg),this.notesTxt.on("focusout",$.proxy(this.notesChanged,this)),this.notesTxt.on("keypress",function(e){13===e.which?(that.enterOptionClick(),e.preventDefault()):e.which>=32&&e.which<=126&&that.onChatAgentTypingInterval(),that.setEnterEnable()}),this.notesTxt.on("keydown",function(e){var content=that.getChatTextEntered();8!==e.which&&46!==e.which||0==content.length||that.onChatAgentTypingInterval()}),this.notesTxt.on("paste",function(e){that.onChatAgentTypingInterval()}),this.setMaxLengthConstraints(),this.contentPnl.hide(),this.rootPanel.on("click",$.proxy(this.enableActiveChat,this)),this.enterPnl.on("click",$.proxy(this.enterOptionClick,this)),this.bumberPanelRight.on("click",$.proxy(this.rightBumberClick,this)),this.bumberPanelRight.on("mouseenter",$.proxy(this.rightBumberMouseEnter,this)),this.bumberPanelRight.on("mouseleave",$.proxy(this.rightBumberMouseLeave,this)),this.stateControlsPanel.on("click",$.proxy(this.statePnlClick,this)),this.bumberPanelLeft.on("click",$.proxy(this.leftBumberClick,this)),this.bumberPanelLeft.on("mouseover",$.proxy(this.leftBumberMouseEnter,this)),this.controlsPanel.on("mouseleave",$.proxy(this.ctrsPnlClickMouseLeave,this)),this.contactControlsPanel.on("click",$.proxy(this.ctrsPnlClick,this)),this.contactControlsPanel.on("mouseleave",$.proxy(this.ctrsPnlMouseLeave,this)),this.rootPanel},onChatAgentTypingInterval:function(){var that=this;clearTimeout(this.patronTypingInterval),clearTimeout(this.patronTextEnteredInterval),this.isAgentTypingIndicator&&(this.patronTypingInterval=setTimeout(function(){that.isAgentTyping||that.onChatAgentTyping(!0,!1,function(){that.isAgentTyping=!0}),that.patronTextEnteredInterval=setTimeout(function(){that.isAgentTyping&&that.onChatAgentTyping(!1,!0,function(){that.isAgentTyping=!1})},5e3)},300))},onChatAgentTyping:function(isTyping,isTextEntered,callback){this.options.controller.onChatAgentTyping({isTyping:isTyping,isTextEntered:isTextEntered},this._contactInfo.id,callback)},getChatTextEntered:function(){return $.trim(IC_Common.removePlaceholderText(this.getChatText(),this.chatPlaceholderMsg))},setMaxLengthConstraints:function(){var that=this;that.getTargetElemet().on("input",function(){var enteredText=that.getChatText();if(enteredText.length<=8e3)return;that.setChatText(that.restrictTxt(enteredText,8e3))})},notesPanelDisplay:function(){"Disconnected"===this._contactInfo.status&&!1===this.isDispositionPnlShow&&!0===this.options.controller.isDisconnectedChat()&&!1===this.manualClose&&(this.isDispositionPnlShow=!0)},closeNotesPanel:function(){!0===this.isDispositionPnlShow?(this.options.controller.hideChatDisposition(),this.isDispositionPnlShow=!1):this.manualClose=!1},transferClick:function(e){e.stopPropagation(),e.preventDefault(),(IC_Common.isButtonEnabled(this.transferDiv)||IC_Common.isButtonSelected(this.transferDiv))&&this.options.controller.onChatContactTransfer(this._contactInfo.id)},restrictTxt:function(txt,limit){return txt.length>limit&&(txt=txt.substring(0,limit)),txt},truncateTxt:function(txt,limit){return txt.length>limit&&(txt=txt.substring(0,limit)+"..."),txt},leftBumberClick:function(){var status=this._contactInfo.status,active=this._contactInfo.active;!0===this.stopHoverSlide&&"Interrupted"!==status&&!0===active&&this.showContactCtrlsPnl()},rightBumberClick:function(){!0===this.stopHoverSlide&&this.showContactStatePnl()},leftBumberMouseEnter:function(){var active=this._contactInfo.active;if(!0===this.stopHoverSlide){this.bumberPanelLeft.addClass("bumperBoxHover").removeClass("BumberPnlLeft");"block"!=this.bumberPanelLeft.css("display")&&"inline"!=this.bumberPanelLeft.css("display")||!1===this.leftBumberMouseFlag||!0!==active||(this.leftBumberMouseFlag=!1,this.controlsPanel.animate({width:"toggle"},{duration:250,specialEasing:{width:"linear",height:"easeOutBounce"}}))}},ctrsPnlClickMouseLeave:function(){if(!0!==this.maskingFlag&&!0!==this.rightBumberMouseFlag&&!0===this.stopHoverSlide){this.bumberPanelLeft.removeClass("bumperBoxHover").addClass("BumberPnlLeft");"block"!=this.controlsPanel.css("display")&&"inline"!=this.controlsPanel.css("display")||!1!==this.leftBumberMouseFlag||(this.leftBumberMouseFlag=!0,this.bumberPanelLeft.showfn(),this.controlsPanel.animate({width:"toggle"},{duration:250,specialEasing:{width:"linear",height:"easeOutBounce"}}))}},ctrsPnlMouseLeave:function(){this.rightBumberMouseFlag=!1},rightBumberMouseEnter:function(){this.bumberPanelRight.addClass("bumperBoxHoverSelected")},rightBumberMouseLeave:function(){this.bumberPanelRight.removeClass("bumperBoxHoverSelected"),this.rightBumberMouseFlag=!0},statePnlClick:function(){},ctrsPnlClick:function(e){e.stopPropagation()},dropClick:function(e){(IC_Common.isButtonEnabled(this.dropDiv)||IC_Common.isButtonSelected(this.dropDiv))&&("Holding"===this._contactInfo.status?(e.stopPropagation(),e.preventDefault()):(this.options.controller.endContact(this._contactInfo.id),this.showContactStatePnl()))},setEnterEnable:function(){var state="disabled";$.trim(this.getChatText()).length>0&&(state="enabled"),this.changeButtonState(this.enterPnl,this.enterImg,state,this.resourceBase+"/css/images/enter.png",this.resourceBase+"/css/images/enter-disable.png")},notesChanged:function(){if("Disconnected"!==this._contactInfo.status){var chatText=this.getRawChatText();this.prevTxtValue!==chatText&&(this.prevTxtValue=chatText,this.options.controller.chatTextChanged(this._contactInfo.id,chatText))}},enableActiveChat:function(){if("Disconnected"===this._contactInfo.status){this.isActivateChatCalled=!1;var contacts=AgentConsoleDataStore.contacts;for(i=0,length=contacts.length;i<length;i++)contacts[i].id==this._contactInfo.id&&(contacts[i].activeChatAPICalledTime=(new Date).getTime());this.options.controller.triggerContactEvent()}"Active"!==this._contactInfo.status&&!1===this.isActivateChatCalled&&(this.prevContactStatus=this._contactInfo.status,this.isActivateChatCalled=!0,this.options.controller.enableActiveChat(this._contactInfo.id))},getRawChatText:function(){return this.notesTxt.val()},getChatText:function(){return this.notesTxt.val()},setChatText:function(value){this.notesTxt.val(value)},clearChatText:function(){this.notesTxt.val("")},enterOptionClick:function(e){var content=this.getChatTextEntered();if(0!==content.length){var chatText=this.getRawChatText(),that=this;0!=content.length&&this.isAgentTypingIndicator&&(this.isAgentTyping=!0,this.onChatAgentTyping(!1,!0,function(){that.isAgentTyping=!1})),this.enterPlaceHolderFlag=!0,IC_Validation.isNotNullOrUndefinedString(e)?this.enterButFlag=!0:this.enterButFlag=!1,this.chatNotification("Agent",this.agentLabel,chatText,0,!0),this.loadChatText=!1,this.options.controller.chatSendTxt(this._contactInfo.id,chatText),this.clearChatText(),this.options.controller.chatTextChanged(this._contactInfo.id,""),this.changeButtonState(this.enterPnl,this.enterImg,"disabled",this.resourceBase+"/css/images/enter.png",this.resourceBase+"/css/images/enter-disable.png")}},chatPatronTypingUpdate:function(patron){this.patronMessage=!0===IC_Validation.isValidObject(patron)?patron:{},this.chatTypeNotification()},chatPreviewUpdate:function(chatPreview){this.chatPreview=!0===IC_Validation.isValidObject(chatPreview)?chatPreview:{},this.chatTypeNotification()},chatTypeNotification:function(){var message="";this.isPatronTypingPreview&&IC_Validation.isValidObject(this.chatPreview)&&!IC_Validation.isNullOrEmpty(this.chatPreviewDiv)&&(this.chatPreviewMsgTxt.text(this.chatPreview.previewText),this.renderCustomScroll()),IC_Validation.isValidObject(this.patronMessage)&&("True"===this.patronMessage.isTyping?message=IC_Localization.typingMsg:"True"===this.patronMessage.isTextEntered&&(message=IC_Localization.enteredTheText),IC_Validation.isNotNullOrEmpty(message)&&this.chatNotification(this.patronMessage.partyType,this.patronMessage.label,message,"",!1,this.patronMessage))},chatPatronTypingNotification:function(message,patron){if(IC_Validation.isNullOrEmpty(this.patronTypingNotify)){this.patronTypingNotify=$('<div id="patronTypingNotify" class="chatNotify">').appendTo(this.messagePnl);var setLabel=$('<div id="setLabel">').addClass("labelDiv  textEllipsis").appendTo(this.patronTypingNotify),messageDiv=$('<div id="patronMessage">').addClass("messageDiv").appendTo(this.patronTypingNotify);this.patronMessageDiv=$('<div id="patronMessageDiv"/>').appendTo(messageDiv),this.patronMessageTxt=$('<span id="patronMessageTxt"></span>').appendTo(this.patronMessageDiv),this.typingMsgDots=$('<span id="patronTypingImg" class="typingMsgDots"></span>').appendTo(this.patronMessageDiv),this.chatPreviewDiv=$('<div id="previewMsg">').addClass("messageDiv").appendTo(messageDiv),this.chatPreviewMsgTxt=$('<span id="patronTypingTxt"></span>').appendTo(this.chatPreviewDiv),this.chatPreviewMsgDots=$('<span id="chatPreviewMsgDots" class="typingMsgDots"></sapn>').appendTo(this.chatPreviewDiv),$('<span style="height:0px"></span>').appendTo(this.messagePnl),this.notificationPointer=$("<div>").appendTo(this.messagePnl),this.patronTypingNotify.addClass("clientChat"),this.notificationPointer.addClass("clientNotifyPointer"),setLabel.text(this.clientLabel).addClass("clientLabel"),this.textMask(setLabel,this.clientLabel,62),$('<img src="'+this.resourceBase+'/css/images/Tail-L.png"/>').appendTo(this.notificationPointer)}this.patronMessageTxt.text(message),this.typingMsgDots.append($('<span class="one">.</span><span class="two">.</span><span class="three">.</span>')),this.chatPreviewMsgDots.append($('<span class="one">.</span><span class="two">.</span><span class="three">.</span>')),"True"===patron.isTyping&&"ISTYPING"!=this.patronIndicate?(this.patronIndicate="ISTYPING",this.typingMsgDots.addClass("typingMsgDots")):"HASENTERED"!=this.patronIndicate&&(this.patronIndicate="HASENTERED",this.typingMsgDots.removeClass("typingMsgDots"))},chatNotification:function(chatType,label,message,time,isLoading,patron){var chatNotify,timerDiv,messageDiv,notificationPoint,localeTimeFormat,that=this,imgURL="",setTimeoutVal=0,idleTime=0,renderScroll=!1,orgMessage=message;if(message=IC_Common.blockScriptInjection(message),!IC_Validation.isNotNullOrUndefinedString(patron)||"True"!==patron.isTyping&&"True"!==patron.isTextEntered){if(IC_Validation.isNotNullOrUndefinedString(this.patronTypingNotify)&&(this.patronTypingNotify.hide(),this.notificationPointer.hide()),chatNotify=$('<div id="chatNotify" class="chatNotify">').appendTo(this.messagePnl),setLabel=$('<div id="setLabel">').addClass("labelDiv  textEllipsis").appendTo(chatNotify),timerDiv=$('<div id="timerDiv">').addClass("timerDiv").appendTo(chatNotify),messageDiv=$('<div id="messageDiv">').addClass("messageDiv").appendTo(chatNotify),$('<span style="height:0px"></span>').appendTo(this.messagePnl),notificationPoint=$("<div>").appendTo(this.messagePnl),IC_Validation.isNotNullOrUndefinedString(this.patronTypingNotify)&&("Client"===chatType||!IC_Validation.isNotNullOrUndefinedString(this.patronMessage)||"True"!==this.patronMessage.isTyping&&"True"!==this.patronMessage.isTextEntered||(this.patronTypingNotify.appendTo(this.messagePnl),this.notificationPointer.appendTo(this.messagePnl),this.patronTypingNotify.showfn(),this.notificationPointer.showfn())),messageDiv.html(this.chatChangeDesc(message).replace(/\n/g,"<br/>")),this.chatStatusImg.showfn(),this.chatStatusImg.removeClass("ChatStatusAgent ChatStatusClient ChatStatusSystem"),IC_Validation.isNullOrEmpty(label)||("Agent"===chatType&&(this.agentLabel=label),"System"===chatType&&(this.systemLabel=label),"Client"===chatType&&(this.clientLabel=label)),"Client"==chatType?(this.patronMessage={},this.patronIndicate="",chatNotify.addClass("clientChat"),notificationPoint.addClass("clientNotifyPointer"),setLabel.text(this.clientLabel).addClass("clientLabel"),this.textMask(setLabel,this.clientLabel,62),$('<img src="'+this.resourceBase+'/css/images/Tail-L.png"/>').appendTo(notificationPoint),imgURL="/css/images/SFDC-Chat-Icons_r5_c3_trans.png",this.chatStatusDiv.attr("title",IC_Localization.contact),this.chatStatusImg.addClass("ChatStatusClient"),idleTime=this.getIdleTime(time),this.options.controller.notificationIcon(chatType)):"Agent"==chatType?(clearTimeout(this.changeStatusColor),chatNotify.addClass("agentChat"),notificationPoint.addClass("agentNotifyPointer"),setLabel.text(this.agentLabel).addClass("agentLabel"),this.textMask(setLabel,this.agentLabel,62),$('<img src="'+this.resourceBase+'/css/images/Tail-R.png" width="14px" height="11px"/>').appendTo(notificationPoint),imgURL="/css/images/SFDC-Chat-Icons_r1_c2_trans.png",this.chatStatusImg.addClass("ChatStatusAgent"),this.chatStatusDiv.attr("title",IC_Localization.agent),this.statusColor("Agent"),this.isResetTimer=!0,this.options.controller.notificationIcon(chatType)):"System"==chatType?(chatNotify.addClass("agentChat"),notificationPoint.addClass("agentNotifyPointer"),setLabel.text(this.systemLabel).addClass("systemLabel"),this.textMask(setLabel,this.systemLabel,62),$('<img src="'+this.resourceBase+'/css/images/Tail-R.png" width="14px" height="11px" />').appendTo(notificationPoint),imgURL="/css/images/SFDC-Chat-Icons_r3_c1.png",this.chatStatusDiv.attr("title",IC_Localization.system),this.chatStatusImg.addClass("ChatStatusSystem"),idleTime=this.getIdleTime(time)):(this.statusColor("Agent"),this.chatStatusImg.hide()),"Disconnected"!==this._contactInfo.status||!1!==this._contactInfo.finalState?this.changeButtonState(this.chatStatusDiv,this.chatStatusImg,"unselected",this.resourceBase+imgURL,this.resourceBase+imgURL):(this.chatStatusDiv.attr("title",IC_Localization.acw),this.chatStatusImg.addClass("ChatStatusAcw")),"Agent"!==chatType&&!0===this.isResetTimer&&(!0!==IC_Validation.isNullOrEmpty(this.changeStatusColor)&&clearTimeout(this.changeStatusColor),idleTime<=this.PrimayNotificationSec?(setTimeoutVal=this.PrimayNotificationSec-idleTime,this.statusColor("Agent"),this.changeNotificationColor(setTimeoutVal,"Client")):idleTime>this.PrimayNotificationSec&&(setTimeoutVal=idleTime>this.SecondaryNotificationSec?0:this.SecondaryNotificationSec-idleTime,this.statusColor("Client"),this.changeNotificationColor(setTimeoutVal,"System")),this.isResetTimer=!1),localeTimeFormat=this.localeTimeFormat(),!1===isLoading)timerDiv.text(IC_Common.getLocaleTime(time,localeTimeFormat,this.consoleOptions.localeCode));else{var img=$('<img src="'+this.resourceBase+'/css/images/spinner.gif"/>').appendTo(timerDiv),reflen=this.chatRef.length;this.chatRef[reflen]={msg:orgMessage,img:img,timerDiv:timerDiv,label:setLabel}}this.renderCustomScroll(),chatNotify.on("mouseup click",function(e){var top=$(".ActiveCtrlPanel .MessagePnl .mCSB_container").position().top,contentPnWidth=$(".contentPnl").width(),toolTipOffset=$(this).parent().offset(),X=e.pageX-toolTipOffset.left-15,Y=e.pageY-toolTipOffset.top+top+60,msgSelected="";if(!0===that.options.isPopout?(Y=e.pageY-toolTipOffset.top+top+20,X+130>contentPnWidth&&(X-=130)):X>45&&(X=45),void 0!==window.getSelection){var sel=window.getSelection();if(sel.rangeCount){for(var container=document.createElement("div"),i=0,len=sel.rangeCount;i<len;++i)container.appendChild(sel.getRangeAt(i).cloneContents());msgSelected=container.innerHTML}}else void 0!==document.selection&&"Text"==document.selection.type&&(msgSelected=document.selection.createRange().htmlText);msgSelected?that.tooltip.css({display:"block",left:X+"px",top:Y+"px",position:"absolute"}):that.tooltip.css("display","none")}),chatNotify.on("mouseleave",function(e){"block"===that.tooltip.css("display")&&that.tooltip.css("display","none")}),chatNotify.on("mousedown",function(e){IC_Common.isIE11()||window.getSelection().removeAllRanges()})}else{var setLabel;IC_Validation.isNullOrEmpty(this.patronTypingNotify)?(this.chatPatronTypingNotification(message,patron),renderScroll=!0):IC_Validation.isNotNullOrEmpty(this.patronTypingNotify)&&"True"===patron.isTyping&&"ISTYPING"!=this.patronIndicate?(this.patronIndicate="ISTYPING",this.patronMessageTxt.text(IC_Localization.typingMsg),this.typingMsgDots.addClass("typingMsgDots"),renderScroll=!0):IC_Validation.isNotNullOrEmpty(this.patronTypingNotify)&&"True"===patron.isTextEntered&&"HASENTERED"!=this.patronIndicate&&(this.patronIndicate="HASENTERED",this.patronMessageTxt.text(IC_Localization.enteredTheText),this.typingMsgDots.removeClass("typingMsgDots"),renderScroll=!0),this.isPatronTypingPreview&&IC_Validation.isValidObject(this.chatPreview)?(this.chatPreviewMsgDots.css("color","rgba(0, 0, 0)"),this.chatPreviewMsgDots.addClass("typingMsgDots"),"block"===this.patronMessageDiv.css("display")&&this.patronMessageDiv.hide(),IC_Validation.isNotNullOrEmpty(this.chatPreviewMsgTxt.text())||"HASENTERED"!==this.patronIndicate?IC_Validation.isNotNullOrEmpty(this.chatPreviewMsgTxt.text())||"ISTYPING"!==this.patronIndicate||(this.chatPreviewMsgTxt.text(IC_Localization.typingMsg),this.chatPreviewMsgDots.addClass("typingMsgDots")):(this.chatPreviewMsgTxt.text(IC_Localization.enteredTheText),this.chatPreviewMsgDots.removeClass("typingMsgDots"))):(this.patronMessageDiv.showfn(),this.chatPreviewMsgDots.css("color","rgba(255, 255, 255, 0)")),1==renderScroll&&(this.patronTypingNotify.appendTo(this.messagePnl),this.notificationPointer.appendTo(this.messagePnl),(setLabel=this.patronTypingNotify.find("#setLabel")).text(this.clientLabel),this.textMask(setLabel,this.clientLabel,62),this.patronTypingNotify.showfn(),this.notificationPointer.showfn(),this.renderCustomScroll())}},localeTimeFormat:function(){return this.consoleOptions.localeDateTimeFormat.replace(":mm",":mm:ss")},changeNotificationColor:function(setTimeoutVal,statusColor){var that=this;this.changeStatusColor=setTimeout(function(){"Disconnected"!==that._contactInfo.status&&(that.statusColor(statusColor),that.renderCustomScroll(),"System"!==statusColor&&that.changeNotificationColor(that.PrimayNotificationSec,"System"))},setTimeoutVal)},renderCustomScroll:function(){var that=this,minMessagePnl=parseInt(this.messagePnl.css("min-height"))-20;this.messagePnl.height()>minMessagePnl&&(this.messagePnl.mCustomScrollbar("destroy"),this.messagePnl.mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0,callbacks:{whileScrolling:function(){that.whileScrolling()}}}),this.isScrollToBottom=!0,!0!==this.loadChatText&&this.messagePnl.mCustomScrollbar("scrollTo","span:last"))},whileScrolling:function(){if(!0===this.isScrollToBottom)return mcs.topPct>90&&(this.isScrollToBottom=!1),!0;!1===this.transcriptLoaded&&mcs.topPct<15&&(this.transcriptLoaded=!0,this.options.controller.loadChatTranscript(this._contactInfo.id))},textMask:function(objName,text,limit){$("#renderTextSize").text(text),$("#renderTextSize").width()>=limit?(objName.attr("title",objName.text()),objName.addClass("textEllipsis")):(objName.attr("title",""),objName.removeClass("textEllipsis")),objName.css("width",limit+"px"),$("#renderTextSize").text("")},showContactCtrlsPnl:function(){var that=this;this.controlsPanel.animate({width:"toggle"},{duration:250,complete:function(){that.bumberPanelLeft.hide()}})},showContactStatePnl:function(){(0===this.callDurationPnl.width()||IC_Validation.isNotNullOrUndefinedString(this.callDurationPnl.width()))&&(this.callDurationWidth=this.callDurationPnl.width()),"none"==this.bumberPanelLeft.css("display")&&(this.bumberPanelLeft.showfn(),this.controlsPanel.animate({width:"toggle"},{duration:250,specialEasing:{width:"linear",height:"easeOutBounce"}}))},closeContactCtrlsPnl:function(){this.showContactStatePnl()},updateCSS:function(contactInfo){var dropState="disabled",status=contactInfo.status,transferState="disabled",idToShow=this.options.idToShow;"Incoming"!==status&&("Holding"!==status&&"Disconnected"!==status&&(dropState="enabled"),"Dialing"!==status&&"Ringing"!==status&&idToShow===contactInfo.id&&(this.rightArrowPnl.showfn(),this.stopHoverSlide=!0),"Active"===status&&(transferState="enabled")),this.prevContactStatus!==contactInfo.status&&(this.isActivateChatCalled=!1),this.changeButtonState(this.dropDiv,this.dropImg,dropState,this.resourceBase+"/css/images/bumber-workitem-drop.png",this.resourceBase+"/css/images/bumber-workitem-drop-disabled.png"),this.changeButtonState(this.transferDiv,this.transferImg,transferState,this.resourceBase+"/css/images/bumber-workitem-transfer.png",this.resourceBase+"/css/images/bumber-workitem-transfer-disabled.png"),this.contactStatus.removeClass("BumpPnlLeftGradientIncoming BumpPnlLeftGradientActive BumpPnlLeftGradientHoldDiconnect"),this.contactStatus.text(this.chatChangeDesc(status,!0)),this.statusColor(status),this.contactStatusWidth=this.contactStatus.width(),this.loadChatUI(status),this.renderCustomScroll()},updateStatePnlHeight:function(status){"Active"===status||"Disconnected"===status&&this.options.chatContactCount<4||"Disconnected"===status&&this.options.chatContactCount>3&&this.options.idToShow===this._contactInfo.id?this.resizeContentPanel(this.contactIndicatorPanel.indicator("getIndicatorShown")):this.resizeContentPanel(!1)},agentIndicatorAction:function(indicator){this.options.controller.agentIndicatorAction(indicator)},enableDisbleBtnOnTransfer:function(isTransferClicked){var dropState="enabled",transferState="enabled";isTransferClicked?(dropState="disabled",transferState="disabled"):isTransferClicked||"Disconnected"!==this._contactInfo.status||(dropState="disabled",transferState="disabled"),this.changeButtonState(this.dropDiv,this.dropImg,dropState,this.resourceBase+"/css/images/bumber-workitem-drop.png",this.resourceBase+"/css/images/bumber-workitem-drop-disabled.png"),this.changeButtonState(this.transferDiv,this.transferImg,transferState,this.resourceBase+"/css/images/bumber-workitem-transfer.png",this.resourceBase+"/css/images/bumber-workitem-transfer-disabled.png")},chatChangeDesc:function(chatDesc,isStatusMsg){var res;return isStatusMsg&&"Interrupted"===chatDesc?(res=IC_Localization.paused,"block"===this.controlsPanel.css("display")&&(this.rightBumberMouseFlag=!1,this.ctrsPnlClickMouseLeave())):res="$Localized:ChatSessionEnded"===chatDesc?IC_Localization.chatSessionEnded:"$Localized:AgentLeftChat"===chatDesc?IC_Localization.agentHasLeftTheChat:chatDesc,res=IC_Validation.isNotNullOrUndefinedString(this.chatStatusLocal[res])?this.chatStatusLocal[res]:res},loadChatUI:function(status){var messagePnlHeight=0,contactId=this._contactInfo.id,idToShow=this.options.idToShow,isActive=(this.options.controller.isIndicator(),this._contactInfo.active);this.bumberPanelLeft.removeClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound"),this.stateControlsPanel.removeClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound"),this.bumberPanelRight.removeClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound"),this.statePanel.removeClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound"),this.contactControlsPanel.removeClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound"),this.controlsPanel.removeClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound"),this.bumberPanelLeft.removeClass("BumperPnlLeftSmall bumberPnlLeftLarge"),this.bumberPanelRight.removeClass("bumberPnlRightSmall bumberPnlRightLarge"),this.statePanel.removeClass("StatePnlSamll statePnlLarge"),this.stateControlsPanel.removeClass("StateCtrlPnlSmall stateCtrlPnlLarge"),this.controlsPanel.removeClass("ctrlPnlLarge"),this.element.addClass("Separator"),this.options.chatContactCount;if(messagePnlHeight=this.options.controller.getContentPanelHeightWithOutStatePnl(),messagePnlHeight-=243,this.element.css("margin-top","5px"),this.rightArrowPnl.css("display","block"),this.stausAndTimeHolder.css("display","block"),this.messagePnl.css({"min-height":messagePnlHeight+"px"}),this.messagePnl.css({height:messagePnlHeight+"px"}),!0===isActive&&(1===this.options.chatContactCount||IC_Validation.isNullOrEmpty(idToShow)&&"Active"===status||idToShow===contactId)){if(this.statePanel.addClass("TopLeftRound TopRightRound"),this.contactControlsPanel.addClass("TopRightRound TopLeftRound"),this.stateControlsPanel.addClass("TopRightRound"),this.controlsPanel.addClass("TopRightRound TopLeftRound"),this.bumberPanelLeft.addClass("TopLeftRound"),this.bumberPanelRight.addClass("TopRightRound"),this.renderCustomScroll(),"Disconnected"===status&&!0===this._contactInfo.finalState)this.hideContentPnl();else if("Disconnected"===status){var imgURL="/css/images/SFDC-Chat-Icons_r2_c2_trans.png";this.chatStatusDiv.attr("title",IC_Localization.acw),this.chatStatusImg.addClass("ChatStatusAcw"),this.changeButtonState(this.chatStatusDiv,this.chatStatusImg,"unselected",this.resourceBase+imgURL,this.resourceBase+imgURL),this.notesPanelDisplay(),this.contentPnl.hide()}}else this.hideContentPnl();this.updateStatePnlHeight(status),this.setCornersCss()},showChatMsgPanel:function(isShow){isShow?this.contentPnl.showfn():this.contentPnl.hide()},hideChatMessageEditor:function(){var that=this;"block"===this.contentPnl.css("display")&&this.contentPnl.toggle("slide",{direction:"up"},250,function(){that.contentPnl.hide()})},hideContentPnl:function(status){this.closeNotesPanel(),this.contentPnl.hide(),"block"===this.contentPnl.css("display")&&this.contentPnl.toggle("slide",{direction:"up"},250),this.bumberPanelLeft.addClass("TopLeftRound BottomLeftRound"),this.stateControlsPanel.addClass("TopRightRound BottomRightRound"),this.bumberPanelRight.addClass("TopRightRound BottomRightRound"),this.contactControlsPanel.addClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound"),this.controlsPanel.addClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound"),this.statePanel.addClass("TopRightRound BottomRightRound TopLeftRound BottomLeftRound")},setCornersCss:function(status){!0===this.options.canRoundTopCorners&&(this.element.css("margin-top","5px"),this.bumberPanelLeft.addClass("TopLeftRound"),this.stateControlsPanel.addClass("TopRightRound"),this.controlsPanel.addClass("TopLeftRound TopRightRound"),this.bumberPanelRight.addClass("TopRightRound"),this.contactControlsPanel.addClass("TopLeftRound")),!0===this.options.canRoundBottomCorners&&"Active"!==status?(this.bumberPanelLeft.addClass("BottomLeftRound"),this.stateControlsPanel.addClass("BottomRightRound"),this.controlsPanel.addClass("BottomLeftRound BottomRightRound"),this.bumberPanelRight.addClass("BottomRightRound"),this.contactControlsPanel.addClass("BottomLeftRound")):!1===this.options.canRoundBottomCorners&&"Active"===status&&this.typingPnl.removeClass("BottomLeftRound BottomRightRound")},statusColor:function(status){IC_Validation.isNotNullOrUndefinedString(this._contactInfo)&&"Disconnected"===this._contactInfo.status?(this.notesTxt.attr("readonly","readonly"),this.contactStatus.addClass("BumpPnlLeftGradientHoldDiconnect"),this.bumberPanelLeft.addClass("BumpPnlLeftGradientHoldDiconnect"),this.bumberPanelRight.addClass("BumpPnlRightGradientHoldDisconnect"),this._contactInfo.id===this.options.idToShow&&this.contentPnl.addClass("ActiveCtrlPanel"),IC_Validation.isNotNullOrUndefinedString(this.patronTypingNotify)&&"block"===this.patronTypingNotify.css("display")&&(this.patronTypingNotify.hide(),this.notificationPointer.hide(),this.renderCustomScroll())):("System"===status||"Client"===status||"Agent"===status?(this.bumberPanelLeft.removeClass("BumpPnlLeftGradientIncoming BumpPnlLeftGradientActive BumpPnlLeftGradientHoldDiconnect GradientRed GradientYellow"),this.bumberPanelRight.removeClass("BumpPnlRightGradientIncoming BumpPnlRightGradientActive BumpPnlLeftGradientHoldDiconnect GradientRed GradientYellow")):this.contentPnl.removeClass("ActiveCtrlPanel"),"Active"===status?(this.contactStatus.addClass("BumpPnlLeftGradientActive"),this.contentPnl.addClass("ActiveCtrlPanel")):"Incoming"===status||"Dialing"===status||"Ringing"===status||"Interrupted"===status?this.contactStatus.addClass("BumpPnlLeftGradientIncoming"):"System"===status?(this.bumberPanelLeft.addClass("GradientRed"),this.bumberPanelRight.addClass("GradientRed"),this.options.controller.statusColor(status)):"Client"===status?(this.bumberPanelLeft.addClass("GradientYellow"),this.bumberPanelRight.addClass("GradientYellow")):"Agent"===status?(this.bumberPanelLeft.addClass("BumpPnlLeftGradientActive"),this.bumberPanelRight.addClass("BumpPnlRightGradientActive")):(this.contactStatus.addClass("BumpPnlLeftGradientHoldDiconnect"),this.bumberPanelLeft.addClass("BumpPnlLeftGradientHoldDiconnect"),this.bumberPanelRight.addClass("BumpPnlRightGradientHoldDisconnect")))},updateView:function(options){this.options.canRoundTopCorners=void 0!==typeof options.canRoundTopCorners&&options.canRoundTopCorners,this.options.canRoundBottomCorners=void 0!==typeof options.canRoundBottomCorners&&options.canRoundBottomCorners,this.options.chatContactCount=options.chatCount,this.options.idToShow=options.hasOwnProperty("idToShow")?options.idToShow:"",this.loadChatUI(this._contactInfo.status)},updateMetaData:function(options,data){if(this.loadChatText=!1,"chatText"===options){var i,j,localeTimeFormat,skipLoad=!1;if((chatmsg=data[data.length-1]).time>this.contactActiveTime?this.contactTime=chatmsg.time:this.contactTime=this.contactActiveTime,logger.debug("Contact chat message time:"+this.contactTime),localeTimeFormat=this.localeTimeFormat(),!1===this.intialLoad)for(this.intialLoad=!0,skipLoad=!1,i=0;i<data.length;i++){if(chatmsg=data[i],IC_Validation.isNullOrEmpty(chatmsg.label)||("Agent"===chatmsg.type&&(this.agentLabel=chatmsg.label),"System"===chatmsg.type&&(this.systemLabel=chatmsg.label),"Client"===chatmsg.type&&(this.clientLabel=chatmsg.label)),"Agent"===chatmsg.type)for(j=0;i<this.chatRef.length;j++){if((chatnoti=this.chatRef[j]).msg===chatmsg.msg){chatnoti.label.text(this.agentLabel),this.textMask(chatnoti.label,this.agentLabel,72),chatnoti.img.hide(),this.isMsgloaded(chatmsg.id),chatnoti.timerDiv.text(IC_Common.getLocaleTime(chatmsg.time,localeTimeFormat,this.consoleOptions.localeCode)),this.chatRef.splice(j,1),skipLoad=!0;break}}!1===skipLoad&&!0===this.isMsgloaded(chatmsg.id)&&this.chatNotification(chatmsg.type,chatmsg.label,chatmsg.msg,chatmsg.time,!1)}else{if(IC_Validation.isNullOrEmpty(chatmsg.label)||("Agent"===chatmsg.type&&(this.agentLabel=chatmsg.label),"System"===chatmsg.type&&(this.systemLabel=chatmsg.label),"Client"===chatmsg.type&&(this.clientLabel=chatmsg.label)),"Agent"===chatmsg.type)for(i=0;i<this.chatRef.length;i++){var chatnoti;if((chatnoti=this.chatRef[i]).msg===chatmsg.msg){chatnoti.label.text(this.agentLabel),this.textMask(chatnoti.label,this.agentLabel,72),chatnoti.img.hide(),this.isMsgloaded(chatmsg.id),chatnoti.timerDiv.text(IC_Common.getLocaleTime(chatmsg.time,localeTimeFormat,this.consoleOptions.localeCode)),this.chatRef.splice(i,1),skipLoad=!0;break}}!1===skipLoad&&!0===this.isMsgloaded(chatmsg.id)&&this.chatNotification(chatmsg.type,chatmsg.label,chatmsg.msg,chatmsg.time,!1)}}else if("userInput"===options)this.setChatText(data),this.placeHolderColor();else if("loadChatText"===options){var chatmsg;if(IC_Validation.isNotNullOrEmptyArray(data))for(this.messagePnl.empty(),this.isMsgExist={},this.loadChatText=!0,i=0;i<data.length;i++)chatmsg=data[i],!0===this.isMsgloaded(chatmsg.id)&&this.chatNotification(chatmsg.type,chatmsg.label,chatmsg.msg,chatmsg.time,!1)}else"chatViewData"===options?(this.options.chatContactCount=data.chatCount,this.options.canRoundTopCorners=void 0!==typeof data.canRoundTopCorners&&data.canRoundTopCorners,this.options.canRoundBottomCorners=void 0!==typeof data.canRoundBottomCorners&&data.canRoundBottomCorners,this.options.idToShow=data.hasOwnProperty("idToShow")?data.idToShow:"",this.setCornersCss()):"sfResult"===options?this.options.controller.updateSfResult(data):"dispositionPanel"===options&&(!1===data&&(this.manualClose=!0),this.isDispositionPnlShow=data);this.renderCustomScroll(),this.options.controller.isIndicatorVisible()},isMsgloaded:function(msgId){return!IC_Validation.isNotNullOrUndefinedString(this.isMsgExist[msgId])&&(this.isMsgExist[msgId]=msgId,!0)},getTargetElemet:function(){return this.notesTxt},placeHolderColor:function(){var targetElement=this.getTargetElemet();!1===this.enterPlaceHolderFlag&&""===this.getChatText()||!0===this.enterButFlag?(this.setChatText(this.chatPlaceholderMsg),targetElement.removeClass("addTextColor"),targetElement.addClass("addPlaceHolderColor"),targetElement.attr("spellcheck","false")):!0===this.enterPlaceHolderFlag&&""===this.getChatText()||this.chatPlaceholderMsg!==this.getChatText()?(targetElement.removeClass("addPlaceHolderColor"),targetElement.addClass("addTextColor"),targetElement.attr("spellcheck","true")):this.chatPlaceholderMsg===this.getChatText()&&(targetElement.removeClass("addTextColor"),targetElement.addClass("addPlaceHolderColor"),targetElement.attr("spellcheck","false")),this.enterButFlag=!1,this.enterPlaceHolderFlag=!1},changeButtonState:function(div,img,state,iconEnabled,iconDisabled){"enabled"===(state=state||"disabled")?IC_Common.enableButton(div,img,iconEnabled):"disabled"===state?IC_Common.disableButton(div,img,iconDisabled):"selected"===state?IC_Common.selectButton(div,img,iconEnabled):"unselected"===state&&IC_Common.unselectButton(div,img,iconEnabled)},startContactDurationTimer:function(contactInfo){var that=this,timerId=this._agentStateTimerId+contactInfo.id;this.contactDuration=0,null!==this._timerLst[timerId]&&void 0!==this._timerLst[timerId]&&clearInterval(this._timerLst[timerId]),this.contactDuration>=0&&(this._timerLst[timerId]=setInterval(function(){that.updateTimer(that.callDurationPnl,"contactDuration")},1e3),that.updateTimer(that.callDurationPnl,"contactDuration"))},startContactDurationInStateTimer:function(contactInfo){var that=this,timerId=this._durationStateTimerId+contactInfo.id;this.contactStateDuration=0,null!==this._timerLst[timerId]&&void 0!==this._timerLst[timerId]&&clearInterval(this._timerLst[timerId]),this.contactStateDuration>=0&&(this._timerLst[timerId]=setInterval(function(){that.updateTimer(that.contactStatusTime,"contactState")},1e3),that.updateTimer(that.contactStatusTime,"contactState"))},contactStatusEllipsis:function(){var statusAndTimePnlWidth=this.stausAndTimeHolder.width(),contactTimerWidth=this.contactStatusTime.width(),contactStatusWidth=this.contactStatusWidth,diffTimerWidth=statusAndTimePnlWidth-contactTimerWidth;contactStatusWidth+=10;contactStatusWidth>diffTimerWidth?this.contactStatus.css({width:diffTimerWidth-20+"px"}):contactStatusWidth>0&&this.contactStatus.css({width:"auto"})},getIdleTime:function(chatTime){return chatTime<this.contactActiveTime&&(chatTime=this.contactActiveTime),1e3*this.timeDiff(chatTime)},timeDiff:function(contactStateTime){var ms=Math.abs(this.options.controller.getServerTimestamp()-contactStateTime);return Math.round(ms/1e3)},updateTimer:function(timerPnlObj,type){var calculatedTime=0;"contactDuration"===type?(this.contactDuration=this.timeDiff(this.contactTime),calculatedTime=this.contactDuration<345600?IC_Common.secondsToTime(this.contactDuration):">96 "+IC_Localization.hours,timerPnlObj.text(calculatedTime)):"contactState"===type&&(this.contactStateDuration=this.timeDiff(this._contactInfo.lastStateTime),calculatedTime=this.contactStateDuration<345600?IC_Common.secondsToTime(this.contactStateDuration):">96 "+IC_Localization.hours,timerPnlObj.text(calculatedTime));var hours,contactDuration=this.contactDuration;IC_Validation.isNotNullOrUndefinedString(contactDuration)&&"number"==typeof contactDuration&&(hours=Math.floor(contactDuration/3600),contactDuration%60,(Math.floor(contactDuration/60)%60<=10&&0===hours||hours<=10)&&(this.calculateEllipsisSpace(this._contactInfo),this.contactStatusEllipsis()))},updateData:function(contactInfo){this._contactInfo=contactInfo,this.startContactDurationTimer(contactInfo),this.startContactDurationInStateTimer(contactInfo),this.calculateEllipsisSpace(contactInfo),this.updateCSS(contactInfo),contactInfo.hasOwnProperty("activeTime")&&(this.contactActiveTime=contactInfo.activeTime,this.contactTime<this.contactActiveTime&&(this.contactTime=this.contactActiveTime))},updateContactIndicator:function(contactIndicator){this.contactIndicator=contactIndicator,this.contactIndicatorPanel.indicator("updateData","contactId",this._contactInfo.id),this.contactIndicatorPanel.indicator("updateData","indicator",contactIndicator)},resizeContentPanel:function(showIndicator){IC_Validation.isNotNullOrEmptyArray(this.contactIndicator)&&this.options.controller.contactIndicatorResizeResult(showIndicator,this._contactInfo.id),!0===showIndicator?"Interrupted"!==this._contactInfo.status&&(this.removeStatePnlSmall(),this.statePanel.addClass("statePnlLarge"),this.stateControlsPanel.addClass("stateCtrlPnlLarge"),this.bumberPanelLeft.addClass("bumberPnlLeftLarge"),this.bumberPanelRight.addClass("bumberPnlRightLarge"),this.controlsPanel.addClass("ctrlPnlLarge"),this.dropDiv.css({"margin-top":"17px"}),this.transferDiv.css({"margin-top":"17px"}),this.contactIndicatorPanel.showfn()):(this.contactIndicatorPanel.hide(),this.statePanel.removeClass("statePnlLarge"),this.stateControlsPanel.removeClass("stateCtrlPnlLarge"),this.bumberPanelLeft.removeClass("bumberPnlLeftLarge"),this.bumberPanelRight.removeClass("bumberPnlRightLarge"),this.controlsPanel.removeClass("ctrlPnlLarge"),this.dropDiv.css({"margin-top":"11px"}),this.transferDiv.css({"margin-top":"11px"})),1===this.options.chatContactCount&&this.setMessagePnlHeight()},setMessagePnlHeight:function(){for(var chatContact,chatContacts=this.options.controller.getChatContacts(),messagePnlHeight=0,i=0;i<chatContacts.length;i++)("Active"===(chatContact=chatContacts[i]).status||"Disconnected"===chatContact.status&&this.options.chatContactCount<4)&&"block"===this.contactIndicatorPanel.css("display")&&(messagePnlHeight+=17);this.messagePnl.css({"min-height":this.messagePnl.height()-messagePnlHeight+"px"}),this.messagePnl.css({height:this.messagePnl.css("min-height")})},removeStatePnlSmall:function(){this.statePanel.removeClass("StatePnlSamll"),this.stateControlsPanel.removeClass("StateCtrlPnlSmall"),this.bumberPanelLeft.removeClass("BumperPnlLeftSmall"),this.bumberPanelRight.removeClass("bumberPnlRightSmall")},getContact:function(){return this._contactInfo},calculateEllipsisSpace:function(contactInfo){this.skillNamePnl.css("width","auto");var skillPnlWidth,callDurationWidth=0===this.callDurationPnl.width()?this.callDurationWidth:this.callDurationPnl.width(),name="";name="Consult"===contactInfo.type&&IC_Validation.isNotNullOrEmpty(contactInfo.consultAgentName)?contactInfo.consultAgentName:contactInfo.skillName,callDurationWidth=128-parseInt(callDurationWidth),this.skillNamePnl.text(name),skillPnlWidth=(skillPnlWidth=this.skillNamePnl.css("width")).replace("px",""),this.skillNamePnl.css("width",callDurationWidth+"px"),skillPnlWidth>=callDurationWidth&&(this.skillNamePnl.addClass("textEllipsis"),this.skillNamePnl.attr("title",name))},updateChatHeight:function(showIndicator){this.indicator=showIndicator,this.loadChatUI(this._contactInfo.status),this.renderCustomScroll()},isTypingPreviewEnabled:function(isAgentTypingIndicator,isPatronTypingPreview){this.isAgentTypingIndicator=isAgentTypingIndicator,this.isPatronTypingPreview=isPatronTypingPreview,1!=this.isAgentTypingIndicator&&!0!==this.isPatronTypingPreview||this.chatTypeNotification()},setCornerAfterCall:function(){this.bumberPanelLeft.addClass("TopLeftRound BottomLeftRound"),this.stateControlsPanel.addClass("TopRightRound BottomRightRound"),this.bumberPanelRight.addClass("TopRightRound BottomRightRound"),this.controlsPanel.addClass("TopLeftRound TopRightRound BottomLeftRound BottomRightRound"),this.contactControlsPanel.addClass("TopLeftRound BottomLeftRound")},destroy:function(){var that=this,contactId=that._contactInfo.id;!0!==this.stopDestroy&&(this.stopDestroy=!0,setTimeout(function(){logger.trace("ContactID: "+contactId," :contactInfo before"),null!==that._timerLst[that._agentStateTimerId+that._contactInfo.id]&&clearInterval(that._timerLst[that._agentStateTimerId+that._contactInfo.id]),null!==that._timerLst[that._durationStateTimerId+that._contactInfo.id]&&clearInterval(that._timerLst[that._durationStateTimerId+that._contactInfo.id]),that.element.slideUp(250,function(){that.options.controller.onContactDestroy(that._contactInfo,that);try{that.statePanel.remove(),that.controlsPanel.remove(),$(that).children().each(function(){IC_Common.discardElement(this)}),that.rootPanel.remove(),that.element.remove()}catch(ex){logger.error("destroy :",ex)}logger.trace("ContactID: "+contactId," :contactInfo after")})},3e3))}})}(jQuery);