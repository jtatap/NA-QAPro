!function($){var logger=IC_Common.getLogger("AgentFeedbackControl");$.widget("AgentConsole.agentFeedback",{containerId:"agentConsoleContainer",options:{container:null,resourceBase:""},_create:function(){var rootPanel,btnDiv,parent=this.element;that=this,this.resourceBase=this.options.resourceBase,parent.addClass("feedback"),$('<span class="dialogHidden">'+IC_Localization.begin+" "+IC_Localization.agent+" "+IC_Localization.feedback+"</span>").appendTo(parent),rootPanel=$('<div class="modalDialogBackground"/>').appendTo(parent),this.headerPanel=$('<div class="modalDialogHeader" tabindex="-1" aria-labelledby="feedbackHeader"/>').appendTo(rootPanel),this.errorMsg=$('<div class="feedbackValidation textEllipsis"></div>').appendTo(rootPanel),IC_Common.setTextWithEllipsis(this.errorMsg,IC_Localization.error+": "+IC_Localization.allFieldsAreRequired,180,!0),this.categoryPanel=$('<div class="categoryPanel"/>').appendTo(rootPanel),this.PriorityPanel=$('<div class="PriorityPanel"/>').appendTo(rootPanel),this.commentsPanel=$('<div class="commentsPanel"/>').appendTo(rootPanel),btnDiv=$('<div class="btnDiv"></div>').appendTo(rootPanel),$('<div class="modalDialogHeaderText textEllipsis" id="feedbackHeader"/>').text(IC_Localization.feedback).appendTo(this.headerPanel),this.closeBtn=$('<div role="button" aria-label = "'+IC_Localization.close+'" tabindex = "0"/>').attr("title",IC_Localization.close).appendTo(this.headerPanel),this.closeBtnIcon=$("<img/>").addClass("closeBtnIcon").attr("src",this.resourceBase+"/css/images/section-close.png").appendTo(this.closeBtn),this.closeBtn.on("click",$.proxy(this.feedbackCancelClick,this)),IC_Common.enterKeyPress(this.closeBtn,function(){that.feedbackCancelClick()}),IC_Common.setFocusToCloseIcon(this.closeBtn,this.closeBtnIcon,"closeBtnFocus","closeBtnIconFocus"),this.categoryLabel=$('<div class="categoryLabel textEllipsis">'+IC_Localization.category+"</div>").appendTo(this.categoryPanel),this.categoryDiv=$('<div class="categoryPanelDiv btnDivEnable"/>').appendTo(this.categoryPanel),this.categoryDiv.comboBox({onDataChange:$.proxy(this.onCategoryChanged,this),resourceBase:this.resourceBase}),this.priorityLabel=$('<div class="PriorityLabel textEllipsis">'+IC_Localization.priority+"</div>").appendTo(this.PriorityPanel),this.PriorityDiv=$('<div class="PriorityPanelDiv btnDivEnable"/>').appendTo(this.PriorityPanel),this.PriorityDiv.comboBox({onDataChange:$.proxy(this.onPriorityChanged,this),resourceBase:this.resourceBase}),this.commentsLabel=$('<div class="commentsLabel textEllipsis">'+IC_Localization.comments+"</div>").appendTo(this.commentsPanel),this.commentsPlaceholderMsg=IC_Localization.enterComments+"...",this.commentsText=$('<textarea class="commentsPanelText btnDivEnable" title= "'+IC_Localization.enterComments+'" />').appendTo(this.commentsPanel),this.commentsText.placeholder(this.commentsPlaceholderMsg),cancelBtn=$('<div class="btnDivEnable btnStyle"></div>').appendTo(btnDiv),$('<div class="feedbackCancelBtn textEllipsis">'+IC_Localization.cancel+"</div>").appendTo(cancelBtn),$('<div class="feedbackCancelIcon" />').appendTo(cancelBtn),cancelBtn.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),cancelBtn.on("click",$.proxy(this.feedbackCancelClick,this)),submitBtn=$('<div class="btnDivEnable btnStyle"></div>').appendTo(btnDiv),$('<div class="feedbackSubmitBtn textEllipsis">'+IC_Localization.submit+"</div>").appendTo(submitBtn),$('<div class="feedbackSubmitIcon" />').appendTo(submitBtn),submitBtn.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),submitBtn.on("click",$.proxy(this.feedbackSubmitClick,this)),$('<span class="dialogHidden">'+IC_Localization.end+" "+IC_Localization.agent+" "+IC_Localization.feedback+"</span>").appendTo(parent),this.commentsText.on("input",function(e){that.commentsText.val(that.restrictTxt(that.commentsText.val(),2e3))})},_init:function(){},restrictTxt:function(txt,limit){return txt.length>limit&&(txt=txt.substring(0,limit)),txt},localizePriority:function(priority){priority=priority||[];var localizedValue="";try{for(var i=0,length=priority.length;i<length;i++)localizedValue=IC_Localization[priority[i].value.toLowerCase()],IC_Validation.isNotNullOrUndefinedString(localizedValue)&&(priority[i].value=localizedValue)}catch(ex){logger.error("Exception in localizePriority method ",ex.message)}},localizeCategory:function(category){category=category||[];var localizedValue="";try{for(var i=0,length=category.length;i<length;i++)localizedValue=IC_Localization["agentFeedbackCategoryId"+category[i].id],IC_Validation.isNotNullOrUndefinedString(localizedValue)&&(category[i].value=localizedValue)}catch(ex){logger.error("Exception in localizeCategory method",ex.message)}},updateMetaData:function(category,priority){this.categoryItem={id:"-1",value:"---"+IC_Localization.select+"---"},this.priorityItem={value:"---"+IC_Localization.select+"---",name:""},this.localizeCategory(category),this.localizePriority(priority),this.categoryDiv.comboBox("setStore",category),this.PriorityDiv.comboBox("setStore",priority),this.categoryDiv.comboBox("setSelectedItem",this.categoryItem),this.PriorityDiv.comboBox("setSelectedItem",this.priorityItem)},feedbackCancelClick:function(){this.categoryDiv.comboBox("setSelectedItem",this.categoryItem),this.PriorityDiv.comboBox("setSelectedItem",this.priorityItem),this.commentsText.val(""),this.commentsText.placeholder(this.commentsPlaceholderMsg),this.errorMsg.hide();var diffHeight=this.calculateTextPanelHeight();this.commentsText.css("height",this.commentsTextHt-diffHeight+"px"),this.commentsPanel.css("height",this.commentsPnlHt-diffHeight+"px"),this.options.container.closefeedbackPnlAndShowHome(),IC_Common.removeFocusFromCloseIcon(this.closeBtnIcon,"closeBtnIconFocus")},feedbackSubmitClick:function(){this.categoryId=this.categoryDiv.comboBox("getSelectedItem"),this.priorityVal=this.PriorityDiv.comboBox("getSelectedItem"),this.comments=$.trim(IC_Common.removePlaceholderText(this.commentsText.val(),this.commentsPlaceholderMsg)),"-1"!==this.categoryId.id&&""!==this.comments&&this.priorityVal.name!==this.priorityItem.name?(this.options.container.setFeedbackForm(this.categoryId.id,this.priorityVal.name,this.comments,""),this.feedbackCancelClick()):this.errorMsg.css("display","block");var diffHeight=this.calculateTextPanelHeight();this.commentsText.css("height",this.commentsTextHt-diffHeight+"px"),this.commentsPanel.css("height",this.commentsPnlHt-diffHeight+"px")},updatePanelHeight:function(isDialerAlive,isShowIndicator){this.isDialerAlive=isDialerAlive,this.isShowIndicator=isShowIndicator,this.commentsPnlHt=188,this.commentsTextHt=156;var diffHeight=this.calculateTextPanelHeight();this.commentsText.css("height",this.commentsTextHt-diffHeight+"px"),this.commentsPanel.css("height",this.commentsPnlHt-diffHeight+"px")},calculateTextPanelHeight:function(){var diffHeight=0;return diffHeight=this.isDialerAlive?diffHeight+29:diffHeight,diffHeight=this.isShowIndicator?diffHeight+24:diffHeight,diffHeight="block"===this.errorMsg.css("display")?diffHeight+24:diffHeight},setFocusToFeedbackHeader:function(){this.headerPanel.trigger("focus")}})}(jQuery);