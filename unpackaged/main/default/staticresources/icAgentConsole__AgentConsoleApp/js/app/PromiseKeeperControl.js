!function($){$.widget("AgentConsole.promiseKeeper",{options:{container:null,resourceBase:""},promiseKeeper:[],_create:function(){var headerText,newBtnDiv,newBtn,parent=this.element;this.resourceBase=this.options.resourceBase,parent.addClass("promiseKeeper"),$('<span class="dialogHidden">'+IC_Localization.begin+" "+IC_Localization.commitmentManager+"</span>").appendTo(parent),this.rootPanel=$('<div class="modalDialogBackground"/>').appendTo(parent),this.headerPanel=$('<div class="modalDialogHeader" tabindex="-1" aria-labelledby="promiseKeeper_Header" role="dialog"/>').appendTo(this.rootPanel),headerText=$('<div id = "promiseKeeper_Header" class="modalDialogHeaderText"/>').appendTo(this.headerPanel),IC_Common.setTextWithEllipsis(headerText,IC_Localization.commitmentManager,150,!0),this.closeBtn=$('<div id = "PK_CloseBtnId" title="'+IC_Localization.close+'" aria-label = "'+IC_Localization.close+'" role="button" tabindex = "0"/>').appendTo(this.headerPanel),this.closeBtnIcon=$("<img/>").addClass("closeBtnIcon").attr("src",this.resourceBase+"/css/images/section-close.png").attr("alt",IC_Localization.close+" "+IC_Localization.commitmentManager).appendTo(this.closeBtn),this.closeBtn.on("click",$.proxy(this.closeBtnClick,this)),IC_Common.enterKeyPress(this.closeBtn,function(){that.closeBtnClick()}),IC_Common.setFocusToCloseIcon(this.closeBtn,this.closeBtnIcon,"closeBtnFocus","closeBtnIconFocus"),createNew_PM=$('<div class="newBtnDiv">').css("padding","0px 7px").appendTo(this.rootPanel),newBtnDiv=$('<div class="btnDivEnable btnStyle" id = "newBtnId" tabindex="0"></div>').on("click",$.proxy(this.createNewPromiseKeeper,this)).appendTo(createNew_PM),newBtn=$('<div class="newBtn"></div>').appendTo(newBtnDiv),IC_Common.setTextWithEllipsis(newBtn,IC_Localization.new,30),$("<img/>").addClass("newBtnIcon").attr("src",this.resourceBase+"/css/images/arrow-right.png").attr("alt",IC_Localization.newCommitment).appendTo(newBtnDiv),newBtnDiv.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),IC_Common.enterKeyPress(newBtnDiv,function(){that.createNewPromiseKeeper()}),IC_Common.setFocusToElement(newBtnDiv,"element-focus"),$("<hr/>").appendTo(this.rootPanel),this.promiseForPnl=$('<div class="pkInfoHeader">').appendTo(this.rootPanel),this.assignTo=$('<div class="promiseForDiv">').appendTo(this.promiseForPnl),$('<div class="pkHeader textEllipsis">'+IC_Localization.assignedTo+":</div>").appendTo(this.assignTo),this.forMe=$('<div class="radionBtnPnl textEllipsis">').appendTo(this.assignTo),this.me_Rbtn=$('<input type="radio" name="promiseKeeperRbtn" value = "A" checked="true" />').attr("title",IC_Localization.assignTo+" "+IC_Localization.me).css({float:"left"}).appendTo(this.forMe),this.me_BtnLbl=$("<div> </div>").css({"padding-top":"3px"}).appendTo(this.forMe),IC_Common.setTextWithEllipsis(this.me_BtnLbl,IC_Localization.me,28),this.forSkill=$('<div class="radionBtnPnl textEllipsis">').appendTo(this.assignTo),this.skill_Rbtn=$('<input type="radio" name="promiseKeeperRbtn" value = "S" />').attr("title",IC_Localization.assignTo+" "+IC_Localization.skill).css({float:"left"}).appendTo(this.forSkill),this.skill_BtnLbl=$("<div> </div>").text(IC_Localization.skill).css({"padding-top":"3px"}).appendTo(this.forSkill),IC_Common.setTextWithEllipsis(this.skill_BtnLbl,IC_Localization.skill,28),this.assignToValue=$('<div class="pkValue"></div>').appendTo(this.promiseForPnl);var that=this;$("input[name=promiseKeeperRbtn]:radio").on("change",function(){that.updatePromiseKeeper("promiseKeeperList",that.promiseKeeper)}),this.noPromiseKeeper=$('<div id="noPromises" class = "noPromiseKeeper"/>').appendTo(this.assignTo),this.listPromiseKeeper=$('<div id = "infoPanelId" class="infoPanel"/>').appendTo(this.rootPanel),$('<span class="dialogHidden">'+IC_Localization.end+" "+IC_Localization.commitmentManager+"</span>").appendTo(parent),this.forMe.text().length<=2&&this.forMe.css("width","40px")},_init:function(){this.localeDateFormat=this.options.container.options.localeDateFormat.replace("yy","yyyy")},closeBtnClick:function(){this.options.container.closePromiseKeeperAndShowHome(),IC_Common.removeFocusFromCloseIcon(this.closeBtnIcon,"closeBtnIconFocus")},createNewPromiseKeeper:function(){this.options.container.createNewpromiseKeeper(!1)},updatePromiseKeeper:function(type,data){var i=0,j=0,that=this,me=this.me_Rbtn.val(),isPCSkill=!1,selectedtarget=$("input[name=promiseKeeperRbtn]:radio:checked").val();if(this.promiseKeeper=[],this.listPromiseKeeper.empty(),IC_Validation.isNotNullOrEmpty(data)&&data.length>0)for(j=0;j<data.length;j++){for(isPCSkill=!1,k=0;k<this.agentPCSkills.length;k++)data[j].skillId===this.agentPCSkills[k].id&&(isPCSkill=!0);isPCSkill||this.promiseKeeper.push(data[j])}IC_Validation.isNotNullOrEmpty(this.promiseKeeper)&&this.promiseKeeper.length>0?($("#noPromises").hide(),function(records){var container,header,child,groupedRecords=function(records){var dateValue,key,item,groupedData={},dataLength=records.length,weekdays=[IC_Localization.sunday,IC_Localization.monday,IC_Localization.tuesday,IC_Localization.wednesday,IC_Localization.thursday,IC_Localization.friday,IC_Localization.saturday],today=(new Date).format(that.localeDateFormat);for(i=0;i<dataLength;i++)(item=records[i]).target===selectedtarget&&(dateValue=new Date(item.callbackTime),key=(key=dateValue.format(that.localeDateFormat))===today?IC_Localization.today+" "+key:weekdays[dateValue.getDay()]+" "+key,groupedData.hasOwnProperty(key)?groupedData[key].push(item):groupedData[key]=[item]);return groupedData}(records),noPromise=!0;for(var o in groupedRecords){noPromise=!1;break}for(var key in groupedRecords)container=$("<div id = 'panelContainerId_"+key+"'>").css("width","100%"),header=$("<div id = 'panelHeaderId' class='panelHeader'/>").appendTo(container),child=$("<div>").appendTo(container),header.text(key),populatePromiseItems(groupedRecords[key],child),that.listPromiseKeeper.append(container);return noPromise}(this.promiseKeeper)?($("#noPromises").showfn(),this.listPromiseKeeper.css("display","none"),me===selectedtarget?$("#noPromises").text(IC_Localization.noPromisesAgent):$("#noPromises").text(IC_Localization.noPromisesSkill)):($("#noPromises").hide(),this.listPromiseKeeper.css("display","block"))):($("#noPromises").showfn(),this.listPromiseKeeper.css("display","none"),me===selectedtarget?$("#noPromises").text(IC_Localization.noPromisesAgent):$("#noPromises").text(IC_Localization.noPromisesSkill));function populatePromiseItems(records,parent){var promiseKeeperDiv,label,nameDiv,notes,date,record=null;for(i=0,length=records.length;i<length;i++)record=records[i],promiseKeeperDiv=$('<div id = "promiseKeeper_'+record.callbackId+'" class="promiseKeeperDiv"/>').appendTo(parent),label=record.firstName+" "+record.lastName,$("<b id = 'timeDivId' class=timeDiv>").text((date=new Date(record.callbackTime),IC_Common.getAMPMLocale(date.format(that.options.container.options.localeTimeFormat),that.options.container.options.localeCode)+" - ")).appendTo(promiseKeeperDiv),nameDiv=$('<div id = "nameDivId" class="nameDiv"/>').appendTo(promiseKeeperDiv),IC_Common.setTextWithEllipsis(nameDiv,label,71),notes=$('<div id = "notesDivId" class="notesDiv"/>').appendTo(promiseKeeperDiv),IC_Common.setTextWithEllipsis(notes,record.notes,160),promiseKeeperDiv.on("click",$.proxy(that.onPromiseKeeperClick,that,record))}},onPromiseKeeperClick:function(data){this.options.container.viewPromiseKeeperDetails(data,!1)},updatePanelHeight:function(height){height-=80,this.listPromiseKeeper.css({height:height+"px"})},updateMetaData:function(agentSkills){for(var skillId in this.agentPCSkills=[],agentSkills)agentSkills.hasOwnProperty(skillId)&&"Natural Calling"===agentSkills[skillId].strategy&&this.agentPCSkills.push({id:agentSkills[skillId].id.toString(),value:$.trim(agentSkills[skillId].name)})},setFocusToCommitmentHeader:function(){this.headerPanel.trigger("focus")}})}(jQuery);