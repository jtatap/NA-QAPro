!function($){$.widget("AgentConsole.agentMessage",{options:{container:null,resourceBase:""},_init:function(){document.getElementById("renderTextSize")||$('<div id="renderTextSize"/>').addClass("renderTextSize").appendTo("Body")},_create:function(){var rootPanel,that=this,parent=this.element;parent.addClass("agentMessagePanel"),$('<span class="dialogHidden">'+IC_Localization.begin+" "+IC_Localization.agent+" "+IC_Localization.message+"</span>").appendTo(parent),rootPanel=$('<div class="modalDialogBackground"/>').appendTo(parent),this.headerPanel=$('<div class="modalDialogHeader" tabindex="-1" aria-label="'+IC_Localization.agent+IC_Localization.message+'"/>').appendTo(rootPanel),$('<div class="modalDialogHeaderText"/>').text(IC_Localization.message).appendTo(this.headerPanel),this.closeBtn=$('<div role="button" aria-label = "'+IC_Localization.close+'" tabindex = "0"/>').attr("title",IC_Localization.close).appendTo(this.headerPanel),this.closeBtnIcon=$("<img/>").addClass("closeBtnIcon").attr("src",this.options.resourceBase+"/css/images/section-close.png").appendTo(this.closeBtn),this.closeBtn.on("click",$.proxy(this.messagePnlClose,this)),IC_Common.enterKeyPress(this.closeBtn,function(){that.messagePnlClose()}),IC_Common.setFocusToCloseIcon(this.closeBtn,this.closeBtnIcon,"closeBtnFocus","closeBtnIconFocus"),this.contentPanel=$('<div id="agentMsgContentPnl" class="agentMsgContentPnl"/>').appendTo(rootPanel),$('<span class="dialogHidden">'+IC_Localization.end+" "+IC_Localization.agent+" "+IC_Localization.message+"</span>").appendTo(parent)},messagePnlClose:function(){this.options.container.closeMessagePnl(),IC_Common.removeFocusFromCloseIcon(this.closeBtnIcon,"closeBtnIconFocus")},updateMetaData:function(agentMessage){if(this.contentPanel.children().each(function(){IC_Common.discardElement(this)}),0!==agentMessage.length)for(var i=0;i<agentMessage.length;i++){var agentMsgCon,openWFM,agentMsgPnl=$('<div class="agentMsgPnl" />'),stateIcon=agentMessage[i].isEvolve&&"false"===agentMessage[i].readMsg?$('<div class="green" />'):$("<div/>"),msgHeader=agentMessage[i].isEvolve&&"false"===agentMessage[i].readMsg?"msgHeader":"msgHeaderNoIndicator",agentMsgSub=$('<div class="agentMsgSub" msgID='+agentMessage[i].id+' ><div class= "msgFontBold '+msgHeader+'">'+agentMessage[i].sub+"</div></div>");stateIcon.appendTo(agentMsgPnl),agentMsgSub.appendTo(agentMsgPnl),agentMsgCon=$('<div class="agentMsgCon" />').html(agentMessage[i].msg),agentMsgPublisher=$('<div class="agentMsgPublisher" />').html(agentMessage[i].publisher),agentMessage[i].isEvolve&&(agentMsgCon.appendTo(agentMsgSub),agentMessage[i].msg!=IC_Localization.evaluationCompletedOrDisputeMessage&&agentMessage[i].msg!=IC_Localization.evaluationAcknowledgeMessage&&agentMessage[i].sub!=IC_Localization.coachingSubject&&agentMsgPublisher.appendTo(agentMsgSub)),currentDate=new Date,yesterday=new Date(currentDate),yesterday.setDate(currentDate.getDate()-1),agentmsgDateString=new Date(agentMessage[i].receivedTime).setHours(0,0,0,0),agentmsgDateString==currentDate.setHours(0,0,0,0)?$('<div class="agentMsgDate"><div class="msgFontBold" style="float:left; margin-right: 2px">'+IC_Localization.today+" - </div>"+agentMessage[i].receivedTime+"</div>").appendTo(agentMsgSub):agentmsgDateString==yesterday.setHours(0,0,0,0)?$('<div class="agentMsgDate"><div class="msgFontBold" style="float:left; margin-right: 2px">'+IC_Localization.yesterday+" - </div>"+agentMessage[i].receivedTime+"</div>").appendTo(agentMsgSub):$('<div class="agentMsgDate"/>').text(agentMessage[i].receivedTime).appendTo(agentMsgSub),agentMessage[i].isEvolve||agentMsgCon.appendTo(agentMsgSub),agentMessage[i].isEvolve&&agentMessage[i].evolveNotificationurl&&(openWFM=$('<div class="btnDivEnable openWFM"></div>').appendTo(agentMsgSub),IC_Common.setTextWithEllipsis(openWFM,IC_Localization.openWFM,70),openWFM.hoverfn(IC_Common.mouseEnterButton,IC_Common.mouseLeaveButton),openWFM.on("click",$.proxy(this.openWFMClick,this,agentMessage[i].evolveNotificationurl))),agentMsgPnl.on("click",$.proxy(this.agentMessageClick,this,agentMessage,agentMessage[i])),agentMsgPnl.appendTo(this.contentPanel)}else this.messagePnlClose();this.setScroll(agentMessage)},getHHMMDate:function(date){return IC_Common.getAMPMLocale(date.format(that.options.container.options.localeTimeFormat),that.options.container.options.localeCode)},setScroll:function(agentMessage){var that=this;this.contentPanel.mCustomScrollbar("destroy"),this.contentPanel.mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0,advanced:{autoScrollOnFocus:!1,updateOnContentResize:!0},callbacks:{onTotalScroll:function(){that.onTotalScroll(agentMessage)}}})},agentMessageClick:function(agentMessage,agentMessageId){var triggerUpdate=!1;"false"===agentMessageId.readMsg&&(agentMessageId.readMsg="true",triggerUpdate=!0,this.sendAcknowledge(agentMessageId)),triggerUpdate&&(this.options.container.clearFlashMsgTimer(),this.options.container.updateEvolveNotifications(agentMessage))},onTotalScroll:function(agentMessage){var triggerUpdate=!1;if(100==mcs.topPct){for(var i=0;i<agentMessage.length;i++)"false"===agentMessage[i].readMsg&&(agentMessage[i].readMsg="true",triggerUpdate=!0,this.sendAcknowledge(agentMessage[i]));triggerUpdate&&(this.options.container.clearFlashMsgTimer(),this.options.container.updateEvolveNotifications(agentMessage))}},updatePanelHeight:function(height){this.contentPanel.css({height:height+"px"})},setFocusToAgentMsgHeader:function(){this.headerPanel.trigger("focus")},sendAcknowledge:function(agentMessage){var objAcknowledgeNotification={command:"ACKNOWLEDGE",headers:{notificationUuid:""}};objAcknowledgeNotification.headers.notificationUuid=agentMessage.id,AgentConsoleDataStore.sock.send(JSON.stringify(objAcknowledgeNotification))},openWFMClick:function(wfmURL){this.options.container.openWFM(wfmURL)}})}(jQuery);