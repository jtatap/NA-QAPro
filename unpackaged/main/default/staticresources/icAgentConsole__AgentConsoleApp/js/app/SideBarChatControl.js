!function($){var logger=IC_Common.getLogger("sideBarChatControl");$.widget("AgentConsole.sideBarChatControl",{options:{container:null,contact:null,chatContactCount:"",idToShow:""},_create:function(){this.container=this.options.container},_init:function(){this.contact=this.options.contact,this.rootElement=$('<div class="" />').appendTo(this.element),this.chatWidget=$('<div class="" id = "chatContactWidget'+this.contact.id+'" />').chatContactPanel({controller:this,resourceBase:this.container.options.resourceBase,chatContactCount:this.options.chatContactCount,idToShow:this.options.idToShow,contact:this.contact,isPopout:this.container.options.isPopout}).appendTo(this.rootElement),this.updateData(this.contact),this.createResultAndNotes(this.contact)},updateData:function(contact){var skill=AgentConsoleDataStore.allSkillList[contact.skillId];this.contact=contact,this.chatWidget.chatContactPanel("updateData",this.contact),"Disconnected"!==contact.status||!1!==contact.finalState||!IC_Validation.isValidObject(skill)||!0!==skill.useDisposition&&!0!==skill.reqDisposition||(this.container.hideAllTabs(),this.container.showHomeOrContactsRootPanel(),this.hideContactResult(),this.createDispositionPanel(contact,skill))},updateMetaData:function(options,data){this.chatWidget.chatContactPanel("updateMetaData",options,data)},updateView:function(canRoundTopCorner,canRoundBottomCorners){this.chatWidget.chatContactPanel("updateView",{canRoundTopCorners:canRoundTopCorner,canRoundBottomCorners:canRoundBottomCorners})},isTypingPreviewEnabled:function(isAgentTypingIndicator,isPatronTypingPreview){this.chatWidget.chatContactPanel("isTypingPreviewEnabled",isAgentTypingIndicator,isPatronTypingPreview)},updatePanel:function(skillDetails){this.chatWidget.chatContactPanel("updatePanel",skillDetails)},updatePreviewNotesAndDisposition:function(skillDisposition,contactType){this.updatePreviewNotes(),this.chatWidget.chatContactPanel("updateDispositions",skillDisposition,contactType)},updatePreviewNotes:function(){this.chatWidget.chatContactPanel("updatePreviewNotes",AgentConsoleDataStore.pcPreviewNotes)},updateContactIndicator:function(){this.chatWidget.chatContactPanel("updateContactIndicator",AgentConsoleDataStore.indicators.contactIndicator)},showContactStatePnl:function(){this.chatWidget.chatContactPanel("showContactStatePnl")},enableDisbleBtnOnTransfer:function(isChatContactTransferClicked){this.chatWidget.chatContactPanel("enableDisbleBtnOnTransfer",isChatContactTransferClicked)},updateChatHeight:function(_boolean){this.chatWidget.chatContactPanel("updateChatHeight",_boolean)},getContact:function(){return this.chatWidget.chatContactPanel("getContact")},resizePanel:function(isDialerPanel){this.chatWidget.chatContactPanel("resizePanel",isDialerPanel)},getContentPanelHeightWithOutStatePnl:function(){return this.options.container.elements.contentPanel.height()},getContentPanelHeight:function(){return this.options.container.elements.contentPanel.height()-this.chatWidget.height()},chatContactCount:function(){return this.options.container.chatContactCount()},chatPatronTypingUpdate:function(chatPatron){this.chatWidget.chatContactPanel("chatPatronTypingUpdate",chatPatron)},chatPreviewUpdate:function(chatPreview){this.chatWidget.chatContactPanel("chatPreviewUpdate",chatPreview)},loadChatTranscript:function(contactId){this.container.loadChatTranscript(contactId)},resizeContactWidget:function(){"Disconnected"===this.contact.status?IC_Validation.isValidObject(this.dispositionPanel)&&(this.dispositionPanel.disposition("resizeDispositionPanel"),this.dispositionPanel.disposition("renderCustomScrollBar",this.dispositionPanel,!0)):this.chatWidget.chatContactPanel("setMessagePnlHeight")},getChatContacts:function(){var nonParkedContacts=AgentConsoleDataStore.getNonParkedContacts();return $.grep(nonParkedContacts,function(contact){if("ChatContactEvent"===contact.contactType&&"Incoming"!=contact.status&&"Interrupted"!=contact.status)return contact})},showChatMsgPanel:function(isShow){this.chatWidget.chatContactPanel("showChatMsgPanel",isShow)},createResultAndNotes:function(activeContact){this.contactResultPanel=$("<div />").appendTo(this.rootElement),this.contactResultNotesPanel=$('<div class="contactResultNotes callResultNotes"/>').appendTo(this.contactResultPanel),this.contactResultNotesPanel.resultsAndNotesControl({container:this,resourceBase:this.container.options.resourceBase,contact:activeContact,sfMode:this.container.options.sfMode,isPopout:this.container.options.isPopout,agentInfo:this.container.agentInfo}),"Incoming"!=activeContact.status&&"Interrupted"!=activeContact.status||this.contactResultPanel.hide()},agentInfo:function(){return this.options.container.agentInfo},showContactResult:function(){IC_Validation.isValidObject(this.contactResultPanel)&&this.contactResultPanel.showfn()},hideContactResult:function(){IC_Validation.isValidObject(this.contactResultPanel)&&this.contactResultPanel.hide()},updateSfResult:function(sfResult){IC_Validation.isValidObject(this.contactResultNotesPanel)&&"block"===this.contactResultNotesPanel.css("display")&&this.contactResultNotesPanel.resultsAndNotesControl("updateData",sfResult),IC_Validation.isValidObject(this.contactResultNotesPanel)&&IC_Validation.isValidObject(this.dispPanel)&&this.dispositionPanel.disposition("updateData",sfResult)},updateTagsContent:function(contact){IC_Validation.isValidObject(this.contactResultNotesPanel)&&"block"===this.contactResultNotesPanel.css("display")&&this.contactResultNotesPanel.resultsAndNotesControl("updateTagsContent",contact),IC_Validation.isValidObject(this.contactResultNotesPanel)&&IC_Validation.isValidObject(this.dispositionPanel)&&this.dispositionPanel.disposition("updateTagsCount",contact,!0)},getContactId:function(){if(IC_Validation.isValidObject(this.contactResultPanel))return this.contactResultNotesPanel.resultsAndNotesControl("getContactId")},setContactId:function(contactId){this.options.contactId=contactId},updateIndicatorInResultsPnl:function(contact){IC_Validation.isNotNullOrEmpty(AgentConsoleDataStore.indicators)&&IC_Validation.isNotNullOrEmpty(AgentConsoleDataStore.indicators.contactIndicator)&&(IC_Validation.isValidObject(this.contactResultNotesPanel)&&this.getContactId()===contact.id&&(logger.debug("ContactID: "+contact.id," OnAgentIndicatorUpdate - updating contact result panel"),this.contactResultNotesPanel.resultsAndNotesControl("updateIndicator",AgentConsoleDataStore.indicators.contactIndicator,contact.contactType),!IC_Validation.isValidObject(this.dispPanel)||"Disconnected"!==contact.status&&"Discarded"!==contact.status||(this.dispositionPanel.disposition("resizeDispositionPanel"),this.dispositionPanel.disposition("renderCustomScrollBar",this.dispositionPanel,!0))))},contactIndicatorResizeResult:function(showIndicator,contactId){this.container.contactIndicatorResizeResult(showIndicator,contactId)},chatTextChanged:function(contactId,msg){this.container.chatTextChanged(contactId,msg)},triggerContactEvent:function(){this.container.triggerContactEvent()},enableActiveChat:function(contactId){this.container.enableActiveChat(contactId)},getCurrentSelectedMediaTab:function(){return this.container.getCurrentSelectedMediaTab()},chatSendTxt:function(contactId,msg){this.container.chatSendTxt(contactId,msg)},isIndicator:function(){return this.options.container.showIndicator},notificationIcon:function(chatType){"Client"==chatType?"Chat"!==this.options.container.getCurrentSelectedMediaTab()&&this.options.container.chatIndicateIcon.removeClass("viewedContactTabIndicate noReplyNewContact").addClass("newContactTabIndicate"):"Agent"==chatType&&"Chat"===this.options.container.getCurrentSelectedMediaTab()&&this.options.container.chatIndicateIcon.removeClass("newContactTabIndicate noReplyNewContact").addClass("viewedContactTabIndicate")},statusColor:function(status){"System"===status&&"Chat"!==this.options.container.getCurrentSelectedMediaTab()&&this.options.container.chatIndicateIcon.removeClass("newContactTabIndicate viewedContactTabIndicate").addClass("noReplyNewContact")},isIndicatorVisible:function(){this.container.isIndicatorVisible()},onChatAgentTyping:function(typing,contactId,callback){this.container.onChatAgentTyping(typing,contactId,callback)},createDispositionPanel:function(contact,skill){IC_Validation.isValidObject(this.dispPanel)||(this.dispPanel=$('<div class="endDispoPanel" />').appendTo(this.rootElement),this.dispositionPanel=$('<div class="dispositionPnlDialer" />').appendTo(this.dispPanel),this.dispositionPanel.disposition({container:this,resourceBase:this.container.options.resourceBase,contact:contact,useSecDisposition:skill.useSecDispositions,reqDisposition:skill.reqDisposition}),this.dispositionPanel.showfn()),IC_Validation.isValidObject(this.contactResultNotesPanel)&&this.contactResultNotesPanel.hide(),"Disconnected"==contact.status&&1==contact.finalState&&this.dispPanel.hide(),this.showChatMsgPanel(!1);var sfResult=AgentConsoleDataStore.getSfResult(contact.id);IC_Validation.isValidObject(sfResult)&&this.dispositionPanel.disposition("updateData",sfResult),this.dispositionPanel.disposition("populateDispositions",skill.dispositions,contact.type),this.isTagsAssigned(contact.skillId)&&(this.dispositionPanel.disposition("updateTagsCount",contact,!0),this.dispositionPanel.disposition("updateDispositionTagData",contact)),this.dispositionPanel.disposition("resizeDispositionPanel"),this.dispositionPanel.disposition("renderCustomScrollBar",this.dispositionPanel,!0)},isTagsAssigned:function(skillId){return this.options.container.isTagsAssigned(skillId)},hideChatDisposition:function(contactId){logger.debug("ContactID: "+contactId," hideChatDisposition"),this.options.container.isTabNeedToShow()&&this.options.container.showContactsRootPanel()},hideDispoPanel:function(){this.dispPanel.hide()},onChatContactTransfer:function(chatContactId){this.container.onChatContactTransfer(chatContactId)},isDisconnectedChat:function(){for(var isDisconnectedChat=!1,contact=null,contacts=AgentConsoleDataStore.contacts,len=contacts.length,i=0;i<len;i++)if("ChatContactEvent"===(contact=contacts[i]).contactType&&!0===contact.active&&"Disconnected"===contact.status){isDisconnectedChat=!0;break}return logger.debug("isDisconnectedChat - "+isDisconnectedChat),isDisconnectedChat},destroyContactResultPanel:function(canDestroyDispo){IC_Validation.isValidObject(this.dispPanel)&&!1!==canDestroyDispo&&(this.dispositionPanel.disposition("destroy"),this.dispPanel=null,delete this.dispPanel,this.container.showHomeOrContactsRootPanel())},setAgentState:function(state){this.container.setAgentState(state)},updateTagsforContact:function(contact){this.container.updateTagsforContact(contact)},updateResultAndNotes:function(contact){if(IC_Validation.isValidObject(this.contactResultNotesPanel)&&"block"===this.contactResultNotesPanel.css("display")&&(this.contactResultNotesPanel.resultsAndNotesControl("updateResultsNotesContent",contact),this.contactResultNotesPanel.resultsAndNotesControl("isResultNoteShow")),IC_Validation.isValidObject(this.contactResultNotesPanel)&&IC_Validation.isValidObject(this.dispPanel)){var sfResult=AgentConsoleDataStore.getSfResult(contact.id);IC_Validation.isValidObject(sfResult)&&this.dispositionPanel.disposition("updateData",sfResult)}},recordResultNotesPanel:function(contact){var sfResult,skill=AgentConsoleDataStore.allSkillList[contact.skillId];!IC_Validation.isValidObject(skill)||!0!==skill.useDisposition&&!0!==skill.reqDisposition||(logger.debug("Populate disposition in results and notes fired "),IC_Validation.isNotNullOrEmptyArray(skill.dispositions)&&(sfResult=AgentConsoleDataStore.getSfResult(contact.id),IC_Validation.isValidObject(sfResult)&&this.updateResultAndNotes(contact)))},endContact:function(contactId){this.container.endContact(contactId)},getServerTimestamp:function(){return AgentConsoleDataStore.getServerTimestamp()},agentIndicatorAction:function(indicator){this.container.agentIndicatorAction(indicator)},showRescheduleDateTime:function(contactId,dnis){this.container.showRescheduleDateTime(contactId,dnis)},mediaTabs:function(){return this.container.elements.mediaTabsDiv.height()},acceptContact:function(contactId){this.container.acceptContact(contactId)},rejectContact:function(contactId){this.container.rejectContact(contactId)},setDisposition:function(contactId,notesResult,callbackNumber){var that=this;IC_Validation.isValidObject(this.dispPanel)&&this.dispPanel.slideUp(250,function(){that.canRoundBottomCorners=!0}),this.container.setDisposition(contactId,notesResult,callbackNumber)},onContactDestroy:function(contact,widgetReference){this.container.onContactDestroy(contact,widgetReference)},contactResultChanged:function(contactId,changedData,value){this.container.contactResultChanged(contactId,changedData,value)},doScreenPop:function(url,type){this.container.doScreenPop(url,"",type)},isAllTagsAddedtoContact:function(contactId){return AgentConsoleDataStore.tags.isAllTagsAddedtoContact(contactId)},localeDateTimeFormat:function(){return this.container.options.localeDateTimeFormat},localeDateFormat:function(){return this.container.localeDateFormat},consoleOptions:function(){return this.container.options},destroy:function(){var that=this;this.chatWidget.chatContactPanel("destroy"),setTimeout(function(){that.rootElement.remove()},3e3),IC_Validation.isValidObject(this.contactResultPanel)&&(this.contactResultNotesPanel="",this.dispositionPanel="",this.contactResultPanel.remove())}})}(jQuery);