!function($){var logger=IC_Common.getLogger("DispositionControl");$.widget("AgentConsole.disposition",{options:{container:null,resourceBase:"",contact:"",isChatPanel:!1,useSecDisposition:!1,reqDisposition:!1},selectedWhoId:"",notesChangedTimer:null,selectedWhatId:"",selectedDisposition:"",selectedSecDisposition:"",isDialer:!1,disposition:[],isDialer:!1,isIndicator:!1,currentDropDownHeight:0,resizedNotesHeight:0,scrollbarVisible:!1,notesTxtHeight:0,_create:function(){var dispPanel,whoPanel,whatPanel,divSubmit,submitContainer,dateTxt,dateImg,decimalValidator=/\./,that=this;this.DefaultDispText=IC_Localization.selectDisposition,this.DefaultSecDispText=IC_Localization.additionalDisp,this.DefaultWhoText=IC_Localization.selectWho,this.DefaultWhatText=IC_Localization.selectWhat,this.DefaultAmntText=IC_Localization.enterAmount,this.dispDivId=IC_Common.generateUniqueId("disp"),this.secDispDivId=IC_Common.generateUniqueId("secDisp"),this.whoDivId=IC_Common.generateUniqueId("who"),this.whatDivId=IC_Common.generateUniqueId("what"),this.options.contactId=this.options.contact.id,this.options.container.isPopout?this.consoleOptions=this.options.container.options:this.consoleOptions=this.options.container.consoleOptions(),this.localeDateTimeFormat=this.consoleOptions.localeDateTimeFormat.replace("yy","yyyy"),this.element.addClass("dispositionPnl").attr("id","dispositionPnlId"),this.dispHeader=$('<div class="dispHeader" />').appendTo(this.options.container.dispPanel),this.dispHeaderTxt=$('<span class="dispHeaderTxt" />').text(IC_Localization.disposition),this.dispHeaderTxt.appendTo(this.dispHeader),this.contentPanel=$('<div class = "contentPnl" />').appendTo(this.element),this.dispAndWhoWhat=$("<div />").appendTo(this.contentPanel),this.dateContainerPanel=$('<div class = "dispContentPnl" />').appendTo(this.element),this.dateContainerPanel.hide(),dispPanel=$('<div class = "container" id = "'+this.dispDivId+'"/>').appendTo(this.dispAndWhoWhat),this.dispSelect=$('<div id = "dispSelectId" class="selectBox dispSelect"> </div>').appendTo(dispPanel),this.dispSelect.comboBox({onDataChange:$.proxy(this.ondispositionSelected,this),resourceBase:this.options.resourceBase}),this.dispError=$("<div/>").addClass("dispErrorDiv textEllipsis").appendTo(this.dispAndWhoWhat),this.dispError.hide(),this.datePanel=$('<div class = "container searchText datePnl"/>').appendTo(this.dispAndWhoWhat),dateTxt=$('<div class = "dateTxt"/>').appendTo(this.datePanel),this.dateValue=$('<input class = "searchTextInput dateVal" type="text" title="'+IC_Localization.date+'"/>').appendTo(dateTxt),this.dateValue.on("blur",$.proxy(this.onDateTextBlur,this)),dateImg=$('<div class = "divImgCalendar"/>').appendTo(this.datePanel),$('<div class = "imgCalendar"></div>').on("click",$.proxy(this.onDateTxtClick,this)).appendTo(dateImg),this.datePanel.hide(),this.dispDateError=$("<div/>").addClass("dispErrorDiv textEllipsis").appendTo(this.dispAndWhoWhat),this.dispDateError.hide(),this.amntPanel=$('<div class = "container searchText amntDiv"/>').appendTo(this.dispAndWhoWhat),this.amntValue=$('<input class = "searchTextInput" type="text" title="'+IC_Localization.enterAmount+'"/>').appendTo(this.amntPanel),this.amntValue.on("click",$.proxy(this.onAmntTxtChange,this)),this.amntValue.on("focus",$.proxy(this.onAmntTxtChange,this)),this.amntValue.on("blur",$.proxy(this.onAmntTextBlur,this)),this.amntPanel.hide(),this.dispAmountError=$("<div/>").addClass("dispErrorDiv textEllipsis").appendTo(this.dispAndWhoWhat),this.dispAmountError.hide(),this.secDispPanel=$('<div class = "container" id = "'+this.secDispDivId+'"/>').appendTo(this.dispAndWhoWhat),this.secDispSelect=$('<div id = "secDispSelectId" class="selectBox secDispSelect"> </div>').appendTo(this.secDispPanel),this.secDispSelect.comboBox({onDataChange:$.proxy(this.onsecDispositionSelected,this),resourceBase:this.options.resourceBase}),this.options.useSecDisposition||this.secDispPanel.hide(),whoPanel=$('<div class = "container" id = "'+this.whoDivId+'"/>').appendTo(this.dispAndWhoWhat),this.whoSelect=$('<div id = "whoSelectId" class = "selectBox whoSelect"> </div>').appendTo(whoPanel),this.whoSelect.comboBox({onDataChange:$.proxy(this.onWhoIdSelected,this),resourceBase:this.options.resourceBase}),whatPanel=$('<div class = "container" id = "'+this.whatDivId+'"/>').appendTo(this.dispAndWhoWhat),this.whatSelect=$('<div id = "whatSelectId" class = "selectBox whatSelect"> </div>').appendTo(whatPanel),this.whatSelect.comboBox({onDataChange:$.proxy(this.onWhaIdSelected,this),resourceBase:this.options.resourceBase}),this.notesPnl=$('<div id = "notesPnlId" class="container notesDiv" />').appendTo(this.contentPanel),this.notesTxt=$('<textarea id = "dispNotesTxtId" class="notesTxt" title="'+IC_Localization.disposition+" "+IC_Localization.notes+'"/>').appendTo(this.notesPnl),this.notesTxt.on("keyup",$.proxy(this.notesChanged,this)),this.options.container.isPopout||(this.notesTxt.on("blur",$.proxy(this.onNotesTxtBlur,this)),this.notesTxt.on("focus",$.proxy(this.closeTagPanel,this,!0)),this.notesTxtReadOnly=$('<div id = "dispNotesTxtReadOnlyId" class="notesTxt notesTxtReadOnly" title="'+IC_Localization.disposition+" "+IC_Localization.notes+'"/>').appendTo(this.notesPnl).hide(),this.notesTxtReadOnly.on("click",$.proxy(this.setNotesPanelHeight,this,!0)),this.notesTxt.on("keydown paste focus",function(){var el=this,currentHeight=0,maxNotesHeight=108;notesTxtHeight=0,setTimeout(function(){$(el).css("height","auto"),currentHeight=el.scrollHeight;$(el).val();that.notesTxtHeight>maxNotesHeight&&(maxNotesHeight=that.notesTxtHeight),that.notesTxtHeight<maxNotesHeight&&that.notesTxtHeight<currentHeight?notesTxtHeight=currentHeight<maxNotesHeight?currentHeight:maxNotesHeight:notesTxtHeight=that.notesTxtHeight,that.setNotesTxtHeight(notesTxtHeight),that.notesPnl.css("height",notesTxtHeight+6+"px"),that.scrollbarVisible=!1,that.element.mCustomScrollbar("update")},0)})),this._initDatePicker(),this.setDefaultText(),this.amntValue.on("keypress",function(e){if(8!==e.which&&0!==e.which&&(e.which<48||e.which>57)&&46!==e.which)return!1;var amnt=that.amntValue.val();return!(46===e.which&&amnt.length>0&&decimalValidator.test(amnt))&&void 0}),this.createTagsPanel(),this.tagsPanel.appendTo(this.contentPanel),this.updateTagsCount(this.options.contact),this.isTagsAssigned(),submitContainer=$('<div class="container submitDiv" />').appendTo(this.contentPanel),divSubmit=$('<div id = "divSubmitId" class="submitPanel submitGradient"></div>').on("mousedown",$.proxy(this.saveDisposition,this)).appendTo(submitContainer),$('<div class="submitText textEllipsis" title="'+IC_Localization.dispSubmitBtn+'">'+IC_Localization.dispSubmitBtn+"</div>").appendTo(divSubmit),divSubmit.hoverfn(function(){$(this).addClass("submitHover")},function(){$(this).removeClass("submitHover")}),$('<img class="imgRightArrow" src="'+this.options.resourceBase+'/css/images/arrow-right.png" />').appendTo(divSubmit)},_init:function(){this.localeDateFormat=this.consoleOptions.localeDateFormat.replace(/M/g,"m"),this.options.contactId=this.options.contact.id},_initDatePicker:function(){new Date(this.options.container.getServerTimestamp()+18e4);var dpDoneBtn,divDoneBtn,that=this;this.dpStartDateCal=$('<div class="startDateCal" />').appendTo(this.dateContainerPanel),this.dpStartDateCal.datepicker({minDate:"0",inline:!0,onSelect:function(){var selectedData=that.dpStartDateCal.datepicker("getDate");$.datepicker.formatDate("D "+that.localeDateFormat,selectedData);that._hideInvalidTimeError()},onChangeMonthYear:function(){that._hideInvalidTimeError()}}),this.expiredTimeError=$("<div class='errorPanel'>").appendTo(this.dateContainerPanel).hide(),this.timePickerLabel=$("<div class='timePickerLabel'>").text(IC_Localization.time).appendTo(this.dateContainerPanel);var selectTimePicker=$("<div>").appendTo(this.dateContainerPanel);this.timePickerOptions=$("<div id = 'timePickerId' class='timeZoneSelect'>").appendTo(selectTimePicker),this.timePickerOptions.comboBox({onDataChange:function(){that._hideInvalidTimeError(),that.timePickerOptionsTxt.val(that.timePickerOptions.comboBox("getSelectedItem").id)},resourceBase:this.options.resourceBase}),this.timePickerOptionsTxt=$("<input type='text' class='timePickerSelect timePickerOptionsTxt' title='"+IC_Localization.time+"'>").appendTo(selectTimePicker).on("keydown",$.proxy(that._onTimeType,that)),this.timePickerOptions.find(".txtDiv .txtSpn").css({opacity:0}),this.timeZoneLabel=$("<div class='timeZoneLabel'/>").text(IC_Localization.timezone).appendTo(this.dateContainerPanel),this.timeZoneOptions=$("<div id = 'dispTimeZone' class='timeZoneSelect'/>").appendTo(this.dateContainerPanel),this.timeZoneOptions.comboBox({resourceBase:this.options.resourceBase}),divDoneBtn=$('<div class="divDoneBtn" />').appendTo(this.dateContainerPanel),(dpDoneBtn=$('<div class="btnDone submitGradient textEllipsis" title="'+IC_Localization.done+'">'+IC_Localization.done+"</div>").appendTo(divDoneBtn)).hoverfn(function(){$(this).addClass("submitHover")},function(){$(this).removeClass("submitHover")}),this.timeZone=IC_Common.selectTimeZone(that.consoleOptions.localeTimeFormat,that.consoleOptions.localeCode),this.timeZone.loadTimeIntervals(this.timePickerOptions),this.timeZone.setTimezones(this.timeZoneOptions,AgentConsoleDataStore.timeZoneList),dpDoneBtn.on("click",$.proxy(this.onDateRangePickerClose,this))},updateContact:function(contact,skill){this.options.contact=contact,this.options.useSecDisposition=skill.useSecDispositions,this.options.reqDisposition=skill.reqDisposition,this.isTagsAssigned(),skill.useSecDispositions?this.secDispPanel.showfn():this.secDispPanel.hide()},isTagsAssigned:function(){var skillId=this.options.contact.skillId;IC_Validation.isValidObject(this.tagsPanel)&&(this.options.container.isTagsAssigned(skillId)?(this.tagsPanel.showfn(),this.tagsPanel.hasClass("open")?this.tagControlPanel.showfn():this.tagControlPanel.hide(),this.tagHeader.off("mousedown"),this.tagHeader.on("mousedown",$.proxy(this.showTagsDetailsPnl,this)),this.notesTxtReadOnly&&this.notesTxtReadOnly.addClass("noBorderRadius"),this.notesTxt.addClass("noBorderRadius")):this.tagsPanel.hide())},createTagsPanel:function(){var contact=this.options.contact,skillId=contact.skillId,skillTags=[],skillTagsMap=AgentConsoleDataStore.skillTagsMap[skillId];this.tagsPanel=$('<div class="tagPanel"/>'),this.tagHeader=$('<div class="tagHeader"/>').appendTo(this.tagsPanel),this.tagsCountPanel=$('<div class="tagsCountPanel"/>').appendTo(this.tagHeader);var tagIndicatorDiv=$('<div class="tagIndicator"/>').appendTo(this.tagHeader);this.tagIndicatorIcon=$("<img />").attr("src",this.options.resourceBase+"/css/images/add-tag-enable.png").addClass("addTag").appendTo(tagIndicatorDiv),this.tagClose=$('<div class="tagClose" />').text("x").appendTo(this.tagHeader);var contactId=this.options.contactId;IC_Validation.isNotNullOrEmpty(contactId)&&(skillTags=IC_Validation.isNotNullOrEmpty(skillTagsMap)&&skillTagsMap.length>0?skillTagsMap:[],IC_Validation.isNullOrEmpty(this.tagControlPanel)&&(this.tagControlPanel=$('<div id="tagControlPanel"/>').appendTo(this.tagsPanel),this.tagControlPanel.tagControl({container:this,resourceBase:this.options.resourceBase,contact:contact,skillTags:skillTags,isPopout:this.options.container.isPopout})),this.tagControlPanel.hide(),this.updateDispositionTagData(contact),this.tagClose.on("click",$.proxy(this.closeTagPanel,this,!1)),this.tagHeader.on("mousedown",$.proxy(this.showTagsDetailsPnl,this)))},closeTagPanel:function(notesTxtFocused,event){event.stopPropagation(),this.tagControlPanel.tagControl("onHideTagList"),this.tagControlPanel.hide(),this.tagsPanel.removeClass("open"),this.setTagsPanel(),this.tagHeader.on("mousedown",$.proxy(this.showTagsDetailsPnl,this)),notesTxtFocused||this.options.container.isPopout||(this.setNotesPanelHeight(!1),this.onScrollBarToggle())},updateDispositionTagData:function(contact){var skillTags=AgentConsoleDataStore.skillTagsMap[contact.skillId].length>0?AgentConsoleDataStore.skillTagsMap[contact.skillId]:[];this.tagControlPanel.tagControl("updateData",skillTags,contact)},showTagsDetailsPnl:function(event){if(this.tagHeader.off("mousedown"),this.tagControlPanel.tagControl("updateSelectedTagHeight",this.isChatPanel),this.tagControlPanel.showfn(),this.tagsPanel.addClass("open"),this.setTagsPanel(),!this.options.container.isPopout){var that=this;this.setNotesPanelHeight(!1),this.onScrollBarToggle(),setTimeout(function(){that.onScrollBarToggle()},300)}},setTagsPanel:function(){if(this.options.container.isPopout)this.tagControlPanel.css({height:"120px"}),this.resizeDispPanel();else if(this.tagsPanel.css({height:"23px"}),this.tagsPanel.hasClass("open"))if(this.tagControlPanel.tagControl("updatePanelHeight"),this.options.container.isPopout){var objPixelScrollIntoView=this.tagsPanel[0].offsetTop;this.element.mCustomScrollbar("scrollTo",objPixelScrollIntoView-60)}else this.scrollbarVisible=!1,this.removeHasScrollClass()},updateTagsforContact:function(contact){this.options.container.updateTagsforContact(contact)},resizeNotesPanel:function(showPnl){var dispPanelHeight=this.element.height();dispPanelHeight=dispPanelHeight-7-150-14,dispPanelHeight=this.isErrorDisplayed()?dispPanelHeight-18:dispPanelHeight,dispPanelHeight=this.isDialer?dispPanelHeight-27:dispPanelHeight,dispPanelHeight=this.isIndicator?dispPanelHeight-24:dispPanelHeight,IC_Validation.isValidObject(this.tagsPanel)&&"block"===this.tagsPanel.css("display")&&(dispPanelHeight-=this.tagsPanel.height()),dispPanelHeight=showPnl?dispPanelHeight-32:dispPanelHeight,this.notesPnl.css("height",dispPanelHeight-10+"px"),this.notesTxt.css("height",dispPanelHeight-20+"px")},resizeDispPanel:function(){var winHeight=window.innerHeight,winWidth=window.innerWidth,queryPnlHeight=0;queryPnlWidth=winWidth-195,this.options.container.isPopout&&(queryPnlHeight=winHeight-125),this.options.container.dispPanel.css({width:queryPnlWidth+"px",height:queryPnlHeight+"px"}),this.resizeDispositionPanel(),this.options.container.isPopout&&(this.dispHeader.css({width:queryPnlWidth-20+"px"}),this.element.css({width:queryPnlWidth-20+"px"}),this.resizeNotesPanel())},updateTagsCount:function(contact,showTagsPanel){if(IC_Validation.isValidObject(contact)){var selectedTagsCount=contact.tags.length;this.tagsCountPanel.text(IC_Localization.tags+" ("+selectedTagsCount+")"),this.updateTagsIcon(this.options.container.isAllTagsAddedtoContact(contact.id))}},updateTagsIcon:function(isAllTagsAdded){isAllTagsAdded?this.tagIndicatorIcon.attr("src",this.options.resourceBase+"/css/images/add-tag-disable.png"):this.tagIndicatorIcon.attr("src",this.options.resourceBase+"/css/images/add-tag-enable.png")},_onTimeType:function(evt){this._hideInvalidTimeError()},getLocaleTime:function(){var timeLocale=this.dpStartDateCal.find(".ui_tpicker_time");timeLocale.text(IC_Common.getAMPMLocale(timeLocale.text(),this.consoleOptions.localeCode))},onWhoIdSelected:function(){var obj=this.whoSelect.comboBox("getSelectedItem");logger.trace("WhoId Selected",obj),this.selectedWhoId=obj.id,this.options.container.contactResultChanged(this.options.contactId,IC_Util.WhoId,this.selectedWhoId)},onWhaIdSelected:function(){var obj=this.whatSelect.comboBox("getSelectedItem");logger.trace("WhatId Selected",obj),this.selectedWhatId=obj.id,this.options.container.contactResultChanged(this.options.contactId,IC_Util.WhatId,this.selectedWhatId)},ondispositionSelected:function(){var showPnl,obj=this.dispSelect.comboBox("getSelectedItem");logger.debug("Disposition Selected",obj),$("#"+this.dispDivId+" .txtSpn").removeClass("dispComboText"),this.selectedDisposition=obj,"NaturalCalling"===this.contactType&&(showPnl=obj.isAmount|obj.isDate,this.toggleDateAmntPanel(showPnl,obj.isDate)),this.setDispositionPayLoad(!1,""),this.options.container.contactResultChanged(this.options.contactId,IC_Util.Disposition,this.selectedDisposition),this.options.useSecDisposition&&($("#"+this.secDispDivId+" .txtSpn").removeClass("secDispComboText"),this.populateSecDispositions(this.disposition,this.selectedDisposition)),"block"===this.dispError.css("display")&&(this.dispError.hide(),this.onScrollBarToggle())},onsecDispositionSelected:function(){var obj=this.secDispSelect.comboBox("getSelectedItem");logger.debug("Secondary Disposition Selected",obj),$("#"+this.secDispDivId+" .txtSpn").removeClass("dispComboText"),this.selectedSecDisposition=obj,this.options.container.contactResultChanged(this.options.contactId,IC_Util.SecondaryDisposition,this.selectedSecDisposition),this.populateDispositions(this.disposition,this.contactType,this.selectedSecDisposition)},notesChanged:function(){var that=this;clearTimeout(this.notesChangedTimer),this.notesChangedTimer=setTimeout(function(){that.options.container.contactResultChanged(that.options.contactId,IC_Util.Notes,that.notesTxt.val())},500),this.options.container.isPopout||this.notesTxtReadOnly.html(this.notesTxt.val().replace(/\r?\n/g,"<br/>"))},onDateRangePickerClose:function(){var selectDateTime=this.dpStartDateCal.datepicker("getDate"),time={},selectedTime=$.trim(this.timePickerOptionsTxt.val());if(this.timeZone.isValidTimeSelected(selectedTime,time)){selectDateTime.setHours(time.hours),selectDateTime.setMinutes(time.minutes);var currentTime=new Date,that=this;AgentConsoleDataStore.getIANATimeZoneOffset(this.timeZone.getIANAName(that.timeZoneOptions),function(offset,error){var hours,minutes,dif,targetZoneCallbackTime=null;if(error||0==offset){var data=that.timeZone.getHoursMinutesbyOffset(that.timeZoneOptions,selectDateTime);hours=data.hours,minutes=data.minutes,dif=data.dif}else offset=parseFloat(offset/36e5),hours=Math.abs(parseInt(offset)),minutes=60*(Math.abs(offset)-hours),dif=offset>0?"+":"-";var pad=function(num){var norm=Math.abs(Math.floor(num));return(norm<10?"0":"")+norm},isoDateFormat=selectDateTime.getFullYear()+"-"+pad(selectDateTime.getMonth()+1)+"-"+pad(selectDateTime.getDate())+"T"+pad(selectDateTime.getHours())+":"+pad(selectDateTime.getMinutes())+":"+pad(selectDateTime.getSeconds())+dif+pad(hours)+":"+pad(minutes);(targetZoneCallbackTime=new Date(isoDateFormat))<=currentTime?that._showInvalidTimeError(IC_Localization.inValidDateTimeErrorAttempt):(that._hideInvalidTimeError(),that.dtValue=IC_Common.toShortDateTimeString(targetZoneCallbackTime),that.dateContainerPanel.hide(),that.dispHeaderTxt.text(IC_Localization.disposition),that.contentPanel.showfn(),that.dateValue.val(IC_Common.getAMPMLocale(targetZoneCallbackTime.format(that.localeDateTimeFormat),that.consoleOptions.localeCode)),that.setDispositionPayLoad(!0,that.dtValue))})}else this._showInvalidTimeError(IC_Localization.inValidTimeFormatErrorAttempt)},_showInvalidTimeError:function(errorMessage){this.expiredTimeError.text(errorMessage).showfn()},_hideInvalidTimeError:function(){this.expiredTimeError.hide()},setDispositionPayLoad:function(_isReschedule,value){var payload={isReschedule:_isReschedule,data:value};this.options.container.contactResultChanged(this.options.contactId,IC_Util.DispositionPayload,payload)},onDateTxtClick:function(){this.contentPanel.hide(),this.dispHeaderTxt.text(IC_Localization.dateTime),this.dateContainerPanel.showfn(),this.dpStartDateCal.datepicker("setDate",this.dtValue),this.timeZone.setUserTimeZone(this.timeZoneOptions,this.options.resourceBase),this.timePickerOptionsTxt.val(this.timeZone.getDisplayTime(new Date(this.dtValue))),this.timeZone.saveSelectedTimeForValidation(this.timeZone.getDisplayTime(new Date(this.dtValue)))},onAmntTxtChange:function(){this.amntValue.val()===IC_Localization.enterAmount&&(this.amntValue.val(""),this.amntValue.removeClass("dispComboText"))},onDateTextBlur:function(){this.validateDate()},onAmntTextBlur:function(){""==this.amntValue.val()?(this.amntValue.val(this.DefaultAmntText),this.amntValue.addClass("dispComboText")):"block"===this.dispAmountError.css("display")&&this.dispAmountError.hide(),this.setDispositionPayLoad(!1,this.amntValue.val())},updateMetaData:function(isChatPanel,contactId){this.options.isChatPanel=isChatPanel,this.options.contactId=contactId},updateData:function(sfResult){var contactType=this.contactType;0===$.grep(sfResult.whoLst,function(item,index){return item.name==IC_Localization.none}).length&&sfResult.whoLst.splice(0,0,{id:"",name:IC_Localization.none}),0===$.grep(sfResult.whatLst,function(item,index){return item.name==IC_Localization.none}).length&&sfResult.whatLst.splice(0,0,{id:"",name:IC_Localization.none});var selectedDisp=sfResult.task.disp,dispPayload=sfResult.task.dispPayload,secSelectedDisp=sfResult.task.secDisp;this.notesTxt.val(sfResult.task.notes),this.options.container.isPopout||(this.notesTxtReadOnly.html(sfResult.task.notes.replace(/\r?\n/g,"<br/>")),this.addOrRemoveEllipsis()),this.populateWhoID(sfResult.whoLst),this.populateWhatID(sfResult.whatLst),IC_Validation.isValidObject(secSelectedDisp)&&""!==secSelectedDisp.value?(this.selectedSecDisposition=secSelectedDisp,this.secDispSelect.comboBox("setSelectedItem",{value:secSelectedDisp.value}),$("#"+this.secDispDivId+" .txtSpn").removeClass("secDispComboText"),this.populateDispositions(this.disposition,this.contactType,this.selectedSecDisposition)):(this.secDispSelect.comboBox("setSelectedItem",{value:this.DefaultSecDispText}),$("#"+this.secDispDivId+" .txtSpn").addClass("secDispComboText"),this.resetSelectedValue()),IC_Validation.isValidObject(selectedDisp)&&""!==selectedDisp.value?(this.selectedDisposition=selectedDisp,this.dispSelect.comboBox("setSelectedItem",{value:selectedDisp.value}),$("#"+this.dispDivId+" .txtSpn").removeClass("dispComboText"),$("#"+this.secDispDivId+" .txtSpn").removeClass("secDispComboText"),this.populateSecDispositions(this.disposition,this.selectedDisposition),"NaturalCalling"===contactType&&(showPnl=selectedDisp.isAmount|selectedDisp.isDate,this.toggleDateAmntPanel(showPnl,selectedDisp.isDate),this.textNotesHeight(showPnl)),IC_Validation.isValidObject(dispPayload)&&dispPayload.hasOwnProperty("isReschedule")&&dispPayload.data&&(selectedDisp.isDate&&dispPayload.isReschedule?(this.dtValue=dispPayload.data,this.dateValue.val(IC_Common.getAMPMLocale(new Date(this.dtValue).format(this.localeDateTimeFormat),this.consoleOptions.localeCode))):selectedDisp.isAmount&&0==dispPayload.isReschedule&&(this.amntValue.val(dispPayload.data),this.amntValue.removeClass("dispComboText"))),"block"===this.dispError.css("display")&&(this.dispError.hide(),this.onScrollBarToggle())):(this.dispSelect.comboBox("setSelectedItem",{value:this.DefaultDispText}),$("#"+this.dispDivId+" .txtSpn").addClass("dispComboText"))},onResizeComplete:function(isDialer,isIndicator){var dateContainerHeight,dropDownHeight=415,secDropDownHeight=385;this.isIndicator=isIndicator,dateContainerHeight=isDialer?408:435,dateContainerHeight=isIndicator?dateContainerHeight-24:dateContainerHeight,!1===this.options.isChatPanel&&(dropDownHeight=isDialer?dropDownHeight-25:dropDownHeight,secDropDownHeight=isDialer?secDropDownHeight-25:secDropDownHeight),dropDownHeight=isIndicator?dropDownHeight-25:dropDownHeight,secDropDownHeight=isIndicator?secDropDownHeight-25:secDropDownHeight,this.isDialer=isDialer,IC_Validation.isValidObject(this.selectedDisposition)?this.textNotesHeight(!0):this.textNotesHeight(!1),this.currentDropDownHeight!==dropDownHeight&&(this.currentDropDownHeight=dropDownHeight,$(".dispSelect .cComboBox .menu").css("max-height",dropDownHeight+"px"),this.dispSelect.comboBox("onResizeComplete"),dropDownHeight-=30,$(".secDispSelect .cComboBox .menu").css("max-height",secDropDownHeight+"px"),this.secDispSelect.comboBox("onResizeComplete"),secDropDownHeight-=30,$(".whoSelect .cComboBox .menu").css("max-height",dropDownHeight+"px"),this.whoSelect.comboBox("onResizeComplete"),dropDownHeight-=30,$(".whatSelect .cComboBox .menu").css("max-height",dropDownHeight+"px"),this.whatSelect.comboBox("onResizeComplete")),this.dateContainerPanel.css({height:dateContainerHeight+"px"})},resizeWidget:function(width,height){if(this.options.container.isPopout){var notesHeight,dropDownHeight=height-68,secDropDownHeight=dropDownHeight-30;notesHeight=height-((this.options.useSecDisposition?140:105)+46+26),this.currentDropDownHeight!==dropDownHeight&&(this.currentDropDownHeight=dropDownHeight,$(".dispSelect .cComboBox .menu").css("max-height",dropDownHeight+"px"),this.dispSelect.comboBox("onResizeComplete"),dropDownHeight-=30,$(".secDispSelect .cComboBox .menu").css("max-height",secDropDownHeight+"px"),this.secDispSelect.comboBox("onResizeComplete"),secDropDownHeight-=30,$(".whoSelect .cComboBox .menu").css("max-height",dropDownHeight+"px"),this.whoSelect.comboBox("onResizeComplete"),dropDownHeight-=30,$(".whatSelect .cComboBox .menu").css("max-height",dropDownHeight+"px"),this.whatSelect.comboBox("onResizeComplete")),IC_Validation.isValidObject(this.tagsPanel)&&"block"===this.tagsPanel.css("display")&&(notesHeight-=34),this.resizedNotesHeight=notesHeight,notesHeight-="block"===this.amntPanel.css("display")||"block"===this.datePanel.css("display")?32:0,this.notesPnl.css("height",notesHeight+"px")}},populateWhoID:function(whoIdList){var filteredList=[],addedId=[],lstLength=whoIdList.length-1;if(-1!==lstLength)for(var i=lstLength;i>=0;i--)if(!1===IC_Validation.isNotNullOrUndefinedString(addedId[whoIdList[i].id])){addedId[whoIdList[i].id]=!0;var obj={value:whoIdList[i].name,id:whoIdList[i].id};filteredList.push(obj)}filteredList.length>0?(this.whoSelect.comboBox("setSelectedItem",{value:filteredList[0].value}),$("#"+this.whoDivId+" .txtSpn").removeClass("dispComboText"),this.selectedWhoId=filteredList[0].id):this.whoSelect.comboBox("setSelectedItem",{value:this.DefaultWhoText}),this.whoSelect.comboBox("setStore",filteredList)},populateWhatID:function(whatIdList){var filteredList=[],addedId=[],lstLength=whatIdList.length-1;if(-1!==lstLength)for(var i=lstLength;i>=0;i--)if(!1===IC_Validation.isNotNullOrUndefinedString(addedId[whatIdList[i].id])){addedId[whatIdList[i].id]=!0;var obj={value:whatIdList[i].name,id:whatIdList[i].id};filteredList.push(obj)}filteredList.length>0?(this.whatSelect.comboBox("setSelectedItem",{value:filteredList[0].value}),$("#"+this.whatDivId+" .txtSpn").removeClass("dispComboText"),this.selectedWhatId=filteredList[0].id):this.whatSelect.comboBox("setSelectedItem",{value:this.DefaultWhatText}),this.whatSelect.comboBox("setStore",filteredList)},populateDispositions:function(dispositions,contactType,secDisposition){var isAmount,isDate,i=0,filteredList=[],primDisposition=[];if(this.disposition=dispositions,primDisposition=IC_Validation.isNotNullOrUndefinedString(secDisposition)?dispositions.filter(function(item){return item.id!==secDisposition.id&&!1===item.isPreviewDisposition}):dispositions.filter(function(item){return!1===item.isPreviewDisposition}),this.contactType=contactType,IC_Validation.isNotNullOrEmptyArray(primDisposition)){for(i=0;i<primDisposition.length;i++){isAmount=!1,isDate=!1,IC_Validation.isNullOrEmpty(primDisposition[i].isAmount)||(isAmount=primDisposition[i].isAmount,isDate=primDisposition[i].isDate);var obj={id:primDisposition[i].id,value:primDisposition[i].name,order:primDisposition[i].order,isPreviewDisposition:primDisposition[i].isPreviewDisposition,isAmount:isAmount,isDate:isDate};filteredList.push(obj)}filteredList.sort(function(a,b){return a.order-b.order}),this.dispSelect.comboBox("setStore",filteredList)}},populateSecDispositions:function(dispositions,selectedDisposition){var isAmount,isDate,secDisposition,i=0,filteredList=[];if(this.secDisposition=dispositions.filter(function(item){return item.id!==selectedDisposition.id&&!1===item.isPreviewDisposition}),secDisposition=this.secDisposition,IC_Validation.isNotNullOrEmptyArray(secDisposition)){for(i=0;i<secDisposition.length;i++){isAmount=!1,isDate=!1,IC_Validation.isNullOrEmpty(secDisposition[i].isAmount)||(isAmount=secDisposition[i].isAmount,isDate=secDisposition[i].isDate);var obj={id:secDisposition[i].id,value:secDisposition[i].name,order:secDisposition[i].order,isAmount:isAmount,isPreviewDisposition:secDisposition[i].isPreviewDisposition,isDate:isDate};filteredList.push(obj)}filteredList.sort(function(a,b){return a.order-b.order}),this.secDispSelect.comboBox("setStore",filteredList)}this.onScrollBarToggle()},validateDate:function(){var isValidDate=!1,that=this,ampmText=function(){var ampm=IC_Common.differentLocaleAMPM,amPMObj={AM:"AM",PM:"PM"},langCode=that.consoleOptions.localeCode.substr(0,2).toLowerCase();IC_Validation.isNotNullOrUndefinedString(ampm[langCode])&&(amPMObj=ampm[langCode]);return amPMObj}(),dateTimeString=this.dateValue.val().replace(ampmText.AM,"AM").replace(ampmText.PM,"PM"),enteredDate=Date.parseString(dateTimeString,this.localeDateTimeFormat);if(null==enteredDate)isValidDate=!1;else{this.dtValue=IC_Common.toShortDateTimeString(enteredDate);enteredDate>new Date&&this.dtValue.match(/^\d{2}\/\d{2}\/\d{4}\s\d{2}\:\d{2}\s(?:a|p)m$/)&&(isValidDate=!0,this.setDispositionPayLoad(!0,this.dtValue))}return isValidDate},getAgentInfo:function(){return this.options.container.isPopout?this.options.container.agentInfo:this.options.container.agentInfo()},saveDisposition:function(){var commitmentAmount=this.amntValue.val(),isValidDate=(this.dispSelect.comboBox("getSelectedItem"),!1),notesResult={whoId:this.selectedWhoId,whatId:this.selectedWhatId,disp:this.selectedDisposition,secDisp:this.selectedSecDisposition,notes:this.notesTxt.val(),dispPayload:{isReschedule:!1,data:""}},agentInfo=this.getAgentInfo();if(IC_Validation.isNullOrEmpty(this.selectedDisposition.value)&&!1===this.options.reqDisposition){var len=agentInfo.nState.length-1,state={state:agentInfo.nState[len].state,reason:agentInfo.nState[len].reason};return this.options.container.destroyContactResultPanel(!0),void this.options.container.setAgentState(state)}if(IC_Validation.isNullOrEmpty(this.selectedDisposition.value)){this.dispError.showfn(),this.dispDateError.hide(),this.dispError.text(IC_Localization.error+": "+IC_Localization.selectTheDisposition);var objPixelScrollIntoView=this.dispSelect[0].offsetTop;this.scrollToError(objPixelScrollIntoView)}else if(this.dispError.hide(),this.selectedDisposition.isAmount|this.selectedDisposition.isDate,commitmentAmount===IC_Localization.enterAmount&&(commitmentAmount=""),"block"!==this.amntPanel.css("display")||""!==commitmentAmount)if(this.dispAmountError.hide(),""!==this.dateValue.val()&&(isValidDate=this.validateDate()),"block"!==this.datePanel.css("display")||!1!==isValidDate)this.dispDateError.hide(),notesResult.dispPayload.data=commitmentAmount,this.selectedDisposition.isDate&&(notesResult.dispPayload.isReschedule=!0,notesResult.dispPayload.data=this.dtValue),this.options.container.setDisposition(this.options.contactId,notesResult);else{this.dispDateError.showfn(),this.dispDateError.text(IC_Localization.enterValidDate);objPixelScrollIntoView=this.datePanel[0].offsetTop;this.scrollToError(objPixelScrollIntoView)}else{this.dispAmountError.showfn(),this.dispDateError.hide(),this.dispAmountError.text(IC_Localization.error+": "+IC_Localization.enterTheAmount);var objPixelScrollIntoView=this.amntPanel[0].offsetTop;this.scrollToError(objPixelScrollIntoView)}},scrollToError:function(_top){if(this.options.container.isPopout)this.resizeDispPanel();else{var that=this;this.onScrollBarToggle(),setTimeout(function(){that.element.mCustomScrollbar("scrollTo",_top)},200)}},resetSelectedValue:function(){this.selectedDisposition="",this.selectedSecDisposition="",this.secDispSelect.comboBox("setStore",[])},isErrorDisplayed:function(){return"block"===this.dispDateError.css("display")||"block"===this.dispAmountError.css("display")||"block"===this.dispError.css("display")},textNotesHeight:function(showPnl){var notesHeight;this.options.container.isPopout&&(IC_Validation.isValidObject(this.options.contactContainer)?notesHeight=this.resizedNotesHeight:(notesHeight=this.options.useSecDisposition?278:309,notesHeight=this.isErrorDisplayed()?notesHeight-18:notesHeight,notesHeight=this.isDialer?notesHeight-27:notesHeight,notesHeight=this.isIndicator?notesHeight-24:notesHeight,IC_Validation.isValidObject(this.tagsPanel)&&"block"===this.tagsPanel.css("display")&&(notesHeight-=34)),notesHeight=showPnl?notesHeight-32:notesHeight,this.notesPnl.css("height",notesHeight+"px"))},removeCloseIconforEmailDisposition:function(){this.closeBtn.remove()},getNotesResult:function(){return{whoId:this.selectedWhoId,whatId:this.selectedWhatId,disp:this.selectedDisposition,notes:this.notesTxt.val()}},setDefaultText:function(){this.dispSelect.comboBox("setSelectedItem",{value:this.DefaultDispText}),$("#"+this.dispDivId+" .txtSpn").addClass("dispComboText"),this.secDispSelect.comboBox("setSelectedItem",{value:this.DefaultSecDispText}),this.secDispPanel.find(".txtSpn").addClass("secDispComboText"),this.whoSelect.comboBox("setSelectedItem",{value:this.DefaultWhoText}),$("#"+this.whoDivId+" .txtSpn").addClass("dispComboText"),this.whatSelect.comboBox("setSelectedItem",{value:this.DefaultWhatText}),$("#"+this.whatDivId+" .txtSpn").addClass("dispComboText"),this.amntValue.val(this.DefaultAmntText),this.amntValue.addClass("dispComboText")},toggleDateAmntPanel:function(showPnl,isDate){if(!1===this.options.isChatPanel){var notesHeight=showPnl?277:309;if(notesHeight=this.isDialer?notesHeight-27:notesHeight,notesHeight=this.isIndicator?notesHeight-24:notesHeight,this.amntPanel.hide(),this.datePanel.hide(),this.dispError.hide(),this.dispAmountError.hide(),this.dispDateError.hide(),this.dateValue.val(""),this.dtValue="",this.amntValue.val(this.DefaultAmntText),showPnl)if(isDate){var today=new Date(this.options.container.getServerTimestamp()+18e4);this.dtValue=IC_Common.toShortDateTimeString(today),this.dateValue.val(IC_Common.getAMPMLocale(today.format(this.localeDateTimeFormat),this.consoleOptions.localeCode)),this.datePanel.showfn()}else this.amntPanel.showfn();this.options.container.isPopout?this.resizeDispPanel():(this.textNotesHeight(showPnl),this.onScrollBarToggle())}},getContactId:function(){return this.options.contactId},setDispOptions:function(options){var tabPnlHeight,wndHeight=$(window).height(),wndWidth=$(window).width();this.options.contactId=options.contactId,this.options.useSecDisposition=options.useSecDisposition,this.options.reqDisposition=options.reqDisposition,this.options.agentInfo=options.agentInfo,this.options.useSecDisposition?(tabPnlHeight=wndHeight-120,tabPnlWidth=wndWidth-192,this.resizeWidget(tabPnlWidth,tabPnlHeight),this.secDispPanel.showfn()):this.secDispPanel.hide()},renderCustomScrollBar:function(objName,enableButton){var that=this;"block"===objName.css("display")&&(objName.mCustomScrollbar("destroy"),objName.mCustomScrollbar({scrollButtons:{enable:enableButton},advanced:{autoScrollOnFocus:!1,updateOnContentResize:!0},scrollInertia:0,callbacks:{onScrollStart:function(obj){that.scrollbarVisible||that.onScrollBarToggle(),IC_Validation.isValidObject(that.tagControlPanel)&&that.tagControlPanel.tagControl("onHideTagList"),"block"===that.dispSelect.css("display")&&that.dispSelect.comboBox("comboxMenuHide"),"block"===that.secDispSelect.css("display")&&that.secDispSelect.comboBox("comboxMenuHide"),that.whoSelect.comboBox("comboxMenuHide"),that.whatSelect.comboBox("comboxMenuHide")}}}))},addHasScrollClass:function(){this.contentPanel.addClass("hasScroll")},removeHasScrollClass:function(){this.contentPanel.removeClass("hasScroll")},resizeDispositionPanel:function(){var winHeight=window.innerHeight,queryPnlHeight=(window.innerWidth,0);this.options.container.isPopout?(queryPnlHeight=winHeight-153,this.element.css("height",queryPnlHeight)):(queryPnlHeight=this.options.container.getContentPanelHeight()-139,this.element.css("height",queryPnlHeight),this.setNotesPanelHeight())},destroy:function(){logger.debug("Disposition panel destroy triggered");var self=this;this.options.container.dispPanel.slideUp(250,function(){for(var obj in $(self).children().each(function(){IC_Common.discardElement(this)}),$.Widget.prototype.destroy.call(self),self.element.remove(),self)self.hasOwnProperty(obj)&&IC_Common.discardElement(this)})},setFocusToDispositionHeader:function(){this.dispHeader.trigger("focus")},setNotesPanelHeight:function(showNotesTxt){var dispPanelHeight=this.element.height(),notesPnlHeight=0;dispPanelHeight=dispPanelHeight-78-29,this.options.useSecDisposition&&(dispPanelHeight-=25),IC_Validation.isValidObject(this.tagsPanel)&&"block"===this.tagsPanel.css("display")&&(dispPanelHeight-=24),(notesPnlHeight=dispPanelHeight-1)<21&&(notesPnlHeight=21),this.notesTxtHeight=notesPnlHeight-6,this.notesPnl.css("height",notesPnlHeight+"px"),this.notesTxtReadOnly.css("height",this.notesTxtHeight+"px"),this.setNotesTxtHeight(this.notesTxtHeight),showNotesTxt?(this.notesTxtReadOnly.hide(),this.notesTxt.showfn(),this.notesTxt.trigger("focus")):(this.notesTxt.hide(),this.notesTxtReadOnly.showfn(),this.addOrRemoveEllipsis())},addOrRemoveEllipsis:function(){this.notesTxtReadOnly[0].offsetHeight<this.notesTxtReadOnly[0].scrollHeight?this.notesTxtReadOnly.addClass("showEllipsis"):this.notesTxtReadOnly.removeClass("showEllipsis")},scrollToBottom:function(){this.element.mCustomScrollbar("scrollTo","bottom")},onNotesTxtBlur:function(){this.setNotesPanelHeight(!1),this.onScrollBarToggle()},onScrollBarToggle:function(){this.element[0].offsetHeight>=this.contentPanel[0].offsetHeight?(this.scrollbarVisible=!1,this.removeHasScrollClass()):(this.scrollbarVisible=!0,this.addHasScrollClass(),this.scrollToBottom())},setNotesTxtHeight:function(heightValue){window.chrome?this.notesTxt.css("height",heightValue+"px"):this.notesTxt.css("height",heightValue+2+"px")}})}(jQuery);