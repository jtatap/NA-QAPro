!function($){var logger=IC_Common.getLogger("resultsAndNotesControl");$.widget("AgentConsole.resultsAndNotesControl",{_init:function(){document.getElementById("renderTextSize")||$('<div id="renderTextSize"/>').addClass("renderTextSize").appendTo("Body")},options:{container:null,resourceBase:"",contactId:null,tagContactId:null,contact:"",sfMode:"",isPopout:""},isChatPanel:!1,isChatOrEmail:!1,isEmailPanel:!1,sObjectConfig:{},selectedWhoId:"",selectedWhatId:"",selectedDisposition:"",isQueryPopulated:!1,isPanelExpanded:!1,isPopout:!1,dispositionLst:[],defaultDisposition:{value:"",order:0,id:"",isAmount:!1,isDate:!1},contactIndicator:[],localizedString:{},recordType:"",showTagsPanel:!1,hideExpanderIcons:!1,_create:function(){this.localizedString={CONTACT:IC_Localization.contact,CASE:IC_Localization.caselabel,TASK:IC_Localization.task,OPPORTUNITY:IC_Localization.opportunity,LEAD:IC_Localization.lead,EVENT:IC_Localization.eventlabel,ACCOUNT:IC_Localization.account,USER:IC_Localization.user,"AGENT CONFIGURATION":IC_Localization.agentConfiguration,"AGENT CONFIGURATION ENTITY":IC_Localization.agentConfigEntity,"AGENT CONFIGURATION FIELD":IC_Localization.agentConfigField,"PHONE NUMBER":IC_Localization.phonenumber},this.recordType="Lightning"===this.options.sfMode?"RecordType":"object",this.createRootPanel(),this.txtNotesHeightDiff=33,this.setTextAreaScroll(),this.onResizeComplete()},createRootPanel:function(){var _contact=this.options.contact;if(this.isChatPanel="ChatContactEvent"===_contact.contactType,this.isEmailPanel="EmailContactEvent"===_contact.contactType,this.selectedDisposition=this.defaultDisposition,this.contactResultPanel=$('<div id = "resultsNotesPanel" class=""> </div>').appendTo(this.element),this.options.isPopout){var isPanelExpanded=this.getPanelExpanded();this.hdrPanel=$('<div class="resultNotesHeader"> </div>').appendTo(this.contactResultPanel),this.hdrQueryResult=$('<div class="resultsHead hrdSelect"></div>').on("click",$.proxy(this.toggleView,this,"Results")).appendTo(this.hdrPanel),this.cellResult=$('<span id = "cellResult" class="" />').appendTo(this.hdrQueryResult),IC_Common.setTextWithEllipsis(this.cellResult,IC_Localization.results,59),this.hdrNotes=$('<div class="notesHead"></div>').on("click",$.proxy(this.toggleView,this,"Notes")).appendTo(this.hdrPanel),this.cellNotes=$('<span id = "cellNotes" class="" />').appendTo(this.hdrNotes),IC_Common.setTextWithEllipsis(this.cellNotes,IC_Localization.notes,62),this.resultNotesContent=$('<div class="resultNotesContent"> </div>').appendTo(this.contactResultPanel),this.resultPanel=$('<div class="resultContent"> </div>').appendTo(this.resultNotesContent),this.notesPanel=$('<div class="notesContent"> </div>').hide().appendTo(this.resultNotesContent),this.queryResult=$('<div class="queryResult"></div>').appendTo(this.resultPanel),this.indicatorPanel=$('<div class="indicatorPanel"></div>').appendTo(this.queryResult),this.errorPanel=$('<div class="errorPanel textEllipsis"></div>').appendTo(this.queryResult),this.queryResultPanel=$('<div class="queryResultPanel"> </div>').appendTo(this.queryResult),isPanelExpanded||!this.isChatPanel&&!this.isEmailPanel||this.collapseAll()}else this.resultNotesContent=$('<div class="resultNotesContent"> </div>').appendTo(this.contactResultPanel),this.resultPanel=$('<div class="resultContent"> </div>').appendTo(this.resultNotesContent),this.notesPanel=$('<div class="notesContent"> </div>').hide().appendTo(this.resultNotesContent),this.queryResult=$('<div class="queryResult"></div>').appendTo(this.resultPanel),this.indicatorPanel=$('<div class="indicatorPanel"></div>').appendTo(this.queryResult),this.errorPanel=$('<div class="errorPanel textEllipsis"></div>').appendTo(this.queryResult),this.queryResultPanel=$('<div class="queryResultPanel"> </div>').appendTo(this.queryResult),this.hdrPanel=$('<div class="resultNotesHeader"> </div>').appendTo(this.contactResultPanel),this.hdrQueryResult=$('<div class="resultsHead"></div>').on("click",$.proxy(this.toggleView,this,"Results")).appendTo(this.hdrPanel),this.cellResult=$('<span id = "cellResult" class="" />').appendTo(this.hdrQueryResult),IC_Common.setTextWithEllipsis(this.cellResult,IC_Localization.results,59),this.hdrNotes=$('<div class="notesHead"></div>').on("click",$.proxy(this.toggleView,this,"Notes")).appendTo(this.hdrPanel),this.cellNotes=$('<span id = "cellNotes" class="" />').appendTo(this.hdrNotes),IC_Common.setTextWithEllipsis(this.cellNotes,IC_Localization.notes,62);this.notesContPanel=$('<div class="notesContPanel" />').appendTo(this.notesPanel),this.txtAreaPanel=$('<div class="notesTextArea"> </div>').appendTo(this.notesContPanel),this.txtNotes=$('<textarea id = "txtNotesId" class="txtNotes" title="'+IC_Localization.notes+'"> </textarea>').appendTo(this.txtAreaPanel),this.hiddenDiv=$("<div />").addClass("hiddendiv").appendTo(this.notesContPanel),this.txtNotes.on("keyup",$.proxy(this.notesChanged,this)),this.resultsOptionPanel=$('<div id = "whoWhatContainerId" class="whoWhatContainer"> </div>').appendTo(this.resultPanel);var divWhoContainer=$('<div id = "whoContainer" class="whoContainer"> </div> ').appendTo(this.resultsOptionPanel);$('<div id = "divWhoId" class="whoWhatLbl textEllipsis" title="'+IC_Localization.who+'">'+IC_Localization.who+"</div>").appendTo(divWhoContainer);this.divWhoSelect=$('<div id = "divWhoSelectId" class="infoPanel dropDownPanel"> </div>').appendTo(divWhoContainer),this.divWhoSelect.comboBox({onDataChange:$.proxy(this.onWhoIdSelected,this),resourceBase:this.options.resourceBase,dispPosition:"top"});var divWhatContainer=$('<div id = "whatContainer" class="whatContainer"> </div> ').appendTo(this.resultsOptionPanel);$('<div id = "divWhatId" class="whoWhatLbl textEllipsis" title="'+IC_Localization.what+'">'+IC_Localization.what+"</div>").appendTo(divWhatContainer);this.divWhatSelect=$('<div id = "divWhatSelectId" class="infoPanel dropDownPanel"> </div>').appendTo(divWhatContainer),this.divWhatSelect.comboBox({onDataChange:$.proxy(this.onWhatIdSelected,this),resourceBase:this.options.resourceBase,dispPosition:"top"});var sfResult=AgentConsoleDataStore.getSfResult(_contact.id);IC_Validation.isValidObject(sfResult)&&this.updateData(sfResult);var that=this;if(0!==Object.keys(AgentConsoleDataStore.allSkillList).length){var skill=AgentConsoleDataStore.allSkillList[_contact.skillId];!IC_Validation.isValidObject(skill)||!0!==skill.useDisposition&&!0!==skill.reqDisposition?IC_Validation.isValidObject(this.dispPanel)&&this.dispPanel.hide():this.createDispComboBox(_contact,skill)}else AgentConsoleDataStore.getSkillDetails(_contact.skillId,function(skillDetails){that.createDispComboBox(_contact,skillDetails)});this.UpdateTagContactId(_contact.id),this.createTagsPanel(),this.updateResultsNotesContent(_contact),this.options.isPopout||this.isChatPanel||(this.hdrQueryResult.addClass("hrdSelect"),this.resultPanel.showfn())},agentInfo:function(){return this.options.isPopout?this.options.container.agentInfo:this.options.container.agentInfo()},collapseAll:function(){this.hdrQueryResult.removeClass("hrdSelect"),this.resultPanel.hide(),this.hdrNotes.removeClass("hrdSelect"),this.notesPanel.hide()},getPanelExpanded:function(){if(this.options.isPopout)return this.options.container.getPanelExpanded()},createDispComboBox:function(contact,skill){var agentInfo=this.agentInfo();this.resultNotesDispDivId=IC_Common.generateUniqueId("disp"),IC_Validation.isValidObject(this.dispPanel)||(this.dispositionPanel=$('<div class="dispPanelDiv resultsNotesDispPanel">').appendTo(this.notesContPanel),this.menuContentPanel=$('<div class="container dispositionPnl">').appendTo(this.dispositionPanel),this.dispPanel=$('<div class = "container" id = "'+this.resultNotesDispDivId+'"/>').appendTo(this.dispositionPanel),this.dispPanel.resultsNotesDispControl({container:this,resourceBase:this.options.resourceBase,useSecDisposition:skill.useSecDispositions,reqDisposition:skill.reqDisposition,agentInfo:agentInfo})),this.dispPanel.resultsNotesDispControl("updateContactDetails",{contactType:contact.contactType}),this.dispPanel.resultsNotesDispControl("updateSkillDetails",skill,agentInfo),!1!==contact.active&&this.dispPanel.resultsNotesDispControl("updateMetaData",this.isChatPanel,contact.id),this.dispPanel.resultsNotesDispControl("setDefaultText"),this.dispositionPanel.showfn()},updateResultsNotesContent:function(contact){this.options.contact=contact;var sfResult=AgentConsoleDataStore.getSfResult(contact.id),skill=AgentConsoleDataStore.allSkillList[contact.skillId];!IC_Validation.isValidObject(skill)||!0!==skill.useDisposition&&!0!==skill.reqDisposition?IC_Validation.isValidObject(this.dispositionPanel)&&this.dispositionPanel.hide():IC_Validation.isValidObject(this.dispositionPanel)?(this.dispositionPanel.showfn(),this.dispPanel.resultsNotesDispControl("updateSkillDetails",skill),this.dispPanel.resultsNotesDispControl("populateDispositions",skill.dispositions,contact.type)):this.createDispComboBox(contact,skill),IC_Validation.isValidObject(sfResult)&&(this.updateData(sfResult),IC_Validation.isValidObject(this.dispositionPanel)&&this.dispPanel.resultsNotesDispControl("updateData",sfResult),this.txtNotes.val(sfResult.task.notes)),this.updateTagsContent(contact)},populateDispositions:function(dispositions,contactType,secDisposition){this.dispPanel.resultsNotesDispControl("populateDispositions",dispositions,contactType,secDisposition)},updateTagsContent:function(contact){IC_Validation.isValidObject(this.tagsPanel)&&(skillTagsMap=AgentConsoleDataStore.skillTagsMap[contact.skillId],skillTags=[],IC_Validation.isValidObject(skillTagsMap)&&(skillTags=skillTagsMap.length>0?skillTagsMap:[]),this.updateTagsCount(contact,!0),skillTags.length>0&&(this.tagsPanel.showfn(),this.tagControlPanel.tagControl("updateData",skillTags,contact)))},setTextAreaScroll:function(){var content=null,that=this,wDiff=!1===this.isChatPanel?0:15;this.isChatPanel;this.txtAreaPanel.css({"overflow-y":"auto"}),this.txtNotes.on("keyup.textAreaScroll",function(e){content=$(this).val();var pnlMinHeight=150-that.txtNotesHeightDiff,cursorPosition=(content.length,that.txtNotes.getCursorPosition());content=(content="<span>"+content.substr(0,cursorPosition)+"</span>"+content.substr(cursorPosition,content.length)).replace(/\n/g,"<br />"),that.hiddenDiv.html(content+"<br />"),pnlMinHeight<=that.hiddenDiv.height()?that.hiddenDiv.css({width:176-wDiff+"px"}):that.hiddenDiv.css({width:190-wDiff+"px"})}),$.fn.getCursorPosition=function(){var el=$(this).get(0),pos=0;if("selectionStart"in el)pos=el.selectionStart;else if("selection"in document)try{el.trigger("focus");var sel=document.selection.createRange(),selLength=document.selection.createRange().text.length;sel.moveStart("character",-el.value.length),pos=sel.text.length-selLength}catch(e){}return pos}},contactResultChanged:function(contactId,changedData,value){logger.trace("ContactID: "+contactId," contactResultChanged"),this.options.container.contactResultChanged(contactId,changedData,value)},onWhoIdSelected:function(){var obj=this.divWhoSelect.comboBox("getSelectedItem");this.selectedWhoId=obj.id,this.contactResultChanged(this.options.contact.id,IC_Util.WhoId,this.selectedWhoId)},onWhatIdSelected:function(){var obj=this.divWhatSelect.comboBox("getSelectedItem");this.selectedWhatId=obj.id,this.contactResultChanged(this.options.contact.id,IC_Util.WhatId,this.selectedWhatId)},notesChanged:function(){this.contactResultChanged(this.options.contact.id,IC_Util.Notes,this.txtNotes.val())},textMask:function(objName,text,limit){$("#renderTextSize").text(text),$("#renderTextSize").width()>limit?(objName.attr("title",objName.text()),objName.addClass("textEllipsis")):(objName.attr("title",""),objName.removeClass("textEllipsis")),objName.css("width",limit+"px"),$("#renderTextSize").text("")},notesPanelClose:function(event){event.stopPropagation(),this.element.toggle("slide",{direction:"down"},250),this.hdrQueryResult.trigger("click")},isPanelExpand:function(){this.hdrQueryResult.hasClass("hrdSelect")||this.hdrNotes.hasClass("hrdSelect")?(this.isPanelExpanded=!0,this.options.container.toggleContactResult(this.isPanelExpanded)):(this.isPanelExpanded=!1,this.options.container.toggleContactResult(this.isPanelExpanded))},isResultNoteShow:function(){this.hdrQueryResult.hasClass("hrdSelect")||this.hdrNotes.hasClass("hrdSelect")?this.options.container.showChatMsgPanel(!1):this.options.container.showChatMsgPanel(!0)},toggleView:function(value,context){if("Results"===value){if(this.hdrNotes.removeClass("hrdSelect"),this.notesPanel.hide(),this.options.isPopout)this.isChatPanel||this.isEmailPanel?(this.hdrQueryResult.toggleClass("hrdSelect"),this.resultPanel.toggle(),this.isPanelExpand()):(this.hdrQueryResult.addClass("hrdSelect"),this.resultPanel.showfn());else if(this.hdrQueryResult.toggleClass("hrdSelect"),this.resultPanel.toggle(),this.isChatPanel){var isShow=!this.hdrQueryResult.hasClass("hrdSelect");this.options.container.showChatMsgPanel(isShow)}this.setResultPanelHeight()}else if("Notes"===value){if(this.hdrQueryResult.removeClass("hrdSelect"),this.resultPanel.hide(),this.options.isPopout)this.isChatPanel||this.isEmailPanel?(this.hdrNotes.toggleClass("hrdSelect"),this.notesPanel.toggle(),this.isPanelExpand()):(this.hdrNotes.addClass("hrdSelect"),this.notesPanel.showfn());else if(this.hdrNotes.toggleClass("hrdSelect"),this.notesPanel.toggle(),this.isChatPanel){isShow=!this.hdrNotes.hasClass("hrdSelect");this.options.container.showChatMsgPanel(isShow)}this.txtNotes.trigger("keyup.textAreaScroll"),this.setNotesPanelHeight(),this.options.isPopout||this.renderCustomScrollBar(this.notesPanel)}},ResultNotesIcon:function(hideIcons){this.hideExpanderIcons=hideIcons},onResizeComplete:function(){this.element.height();this.txtNotes.showfn(),this.isChatPanel&&this.isEmailPanel||this.txtNotes.css({top:"36px"}),this.setResultPanelHeight(),this.setNotesPanelHeight(),this.txtNotes.trigger("keyup.textAreaScroll")},populateQueryResult:function(isUrlPop,sObjects,outboundData){this.queryResultPanel.empty();var queryResultCount=Object.keys(sObjects).length;"NoObject"===outboundData?$("<div class='noResult'>"+IC_Localization.noObjectsFound+"</div>").appendTo(this.queryResultPanel):isUrlPop?$("<div class='noResult'>"+IC_Localization.customUrlPop+"</div>").appendTo(this.queryResultPanel):void 0===queryResultCount||0===queryResultCount?$("<div class='noResult'>"+IC_Localization.noDataFound+"</div>").appendTo(this.queryResultPanel):1===queryResultCount?this.singleMatchResult(sObjects,outboundData):this.multipleMatchResult(sObjects,outboundData),this.setResultPanelHeight()},setResultPanelHeight:function(){var queryPnlHeight=0,winHeight=window.innerHeight;window.innerWidth;queryPnlHeight=this.options.isPopout?this.isChatPanel||this.isEmailPanel?163:winHeight-143:this.getContentPanelHeight()-139,this.resultPanel.css({height:queryPnlHeight+"px"}),this.queryResult.css({height:queryPnlHeight-60+"px","overflow-x":"hidden","overflow-y":"auto"})},setNotesPanelHeight:function(){var dispPanelHeight=0,tagPanelHeight=0,winHeight=window.innerHeight,queryPnlHeight=(window.innerWidth,0);this.options.isPopout?(this.isChatPanel||this.isEmailPanel?(queryPnlHeight=163,this.renderCustomScrollBar(this.notesPanel)):queryPnlHeight=winHeight-143,IC_Validation.isValidObject(this.tagsPanel)&&"block"===this.tagsPanel.css("display")&&(tagPanelHeight=this.tagsPanel.height(),this.tagControlPanel.tagControl("onHideTagList"))):(queryPnlHeight=this.getContentPanelHeight()-139,IC_Validation.isValidObject(this.tagsPanel)&&"block"===this.tagsPanel.css("display")&&(tagPanelHeight=this.tagHeader.height())),IC_Validation.isValidObject(this.dispositionPanel)&&"block"===this.dispositionPanel.css("display")&&(dispPanelHeight=this.dispositionPanel.height()),this.notesPanel.css({height:queryPnlHeight+"px"}),this.txtNotes.css("height",queryPnlHeight-dispPanelHeight-tagPanelHeight-5)},setNotesContPanelHeight:function(queryPnlHeight){this.notesContPanel.css({height:queryPnlHeight+"px"})},getContentPanelHeight:function(){return this.options.container.getContentPanelHeight()},setContactResultNotesHeight:function(){this.setResultPanelHeight(),this.txtNotes.trigger("keyup.textAreaScroll")},singleMatchResult:function(sObjects,outboundData){var item,objectID,itemDesc,sObject,curObjVal,sfContactList=$("<dl id='dlObjResult'></dl>");for(objectID in sfContactList.appendTo(this.queryResultPanel),sObjects)if(sObjects.hasOwnProperty(objectID)&&(sObject=sObjects[objectID],this.sObjectConfig.hasOwnProperty([sObject[this.recordType]])||outboundData===objectID)){var locObj=sObject[this.recordType].toUpperCase();locObj=this.localizedString.hasOwnProperty(locObj)?this.localizedString[locObj]:locObj;var queryTitle=$("<div >"+locObj+" (1)</div>");if(this.textMask(queryTitle,queryTitle.text(),150),(item=$("<dt class='dt' id="+sObject[this.recordType]+"></dt>")).append(queryTitle),outboundData===objectID)curObjVal=this.getName(objectID,sObject),itemDesc=this.createItem(objectID,curObjVal),item.append(itemDesc);else for(var i=0;i<3;i++){var property=this.getObjProperty(sObject[this.recordType],i);if(null===property||!sObject.hasOwnProperty(property))break;0===i?itemDesc=this.createItem(objectID,sObject[property]):(itemDesc=$('<dd class="lstItem">'+sObject[property]+"</dd>"),this.textMask(itemDesc,itemDesc.text(),140)),item.append(itemDesc)}sfContactList.append(item);break}},multipleMatchResult:function(sObjects,outboundData){var curObjVal,item,objectID,itemDesc,curObjName="",that=this,sfContactList=$("<dl id='dlObjResult'></dl>");sfContactList.appendTo(this.queryResultPanel),$.each(sObjects,function(key,val){if("object"==typeof val&&(void 0!==val[that.recordType]&&that.sObjectConfig.hasOwnProperty([val[that.recordType]])||key===outboundData)){if(curObjName!=val[that.recordType]){curObjName=val[that.recordType].toUpperCase();var locObj=that.localizedString.hasOwnProperty(curObjName)?that.localizedString[curObjName]:curObjName;if(sfContactList.find("#"+curObjName).attr("id")==curObjName)item=sfContactList.find("#"+curObjName),$("#"+curObjName+that.options.contactId,item).text(locObj+" ("+item[0].childNodes.length+")");else{var queryTitle=$('<div id="'+curObjName+that.options.contactId+'" >'+locObj+" (1)</div>");that.textMask(queryTitle,queryTitle.text(),150),(item=$("<dt class='dt' id="+curObjName+"></dt>")).append(queryTitle)}}objectID=key,curObjVal=that.getName(key,val),itemDesc=that.createItem(objectID,curObjVal),item.append(itemDesc)}sfContactList.append(item)})},getName:function(sObjectId,sObject){var name,objectName=sObject[this.recordType].toLowerCase();if(name="task"===objectName?sObject.Subject:"case"===objectName?sObject.CaseNumber:"idea"===objectName?sObject.Title:"contract"===objectName?sObject.ContractNumber:sObject.Name,!IC_Validation.isNotNullOrUndefinedString(name)){var property=this.getObjProperty(sObject[this.recordType],0);name=null!==property?""===(name=sObject[property])?sObjectId:name:sObjectId}return name},getObjProperty:function(sObjectName,index){return IC_Validation.isNotNullOrEmptyArray(this.sObjectConfig[sObjectName])&&index<this.sObjectConfig[sObjectName].length?this.sObjectConfig[sObjectName][index].apiName:null},createItem:function(id,name){var that=this,hrefObj=$('<a href="#" id="'+id+'">'+(""===name||void 0===name?"&nbsp;&nbsp;":name)+"</a>");that.textMask(hrefObj,hrefObj.text(),140),hrefObj.on("click",function(){var id="/"+hrefObj.attr("id");that.doScreenPop(id)});var itemDesc=$('<dd class="lstItem"></dd>');return itemDesc.append(hrefObj),itemDesc},doScreenPop:function(id){this.options.container.doScreenPop(id,"contactResult")},updateIndicator:function(indicator,contactType){this.contactIndicator=[],this.indicatorPanel.empty();var dispIndicator=!1;if(this.indicatorPanel.showfn(),IC_Validation.isNotNull(contactType))for(var i=0;i<indicator.length;i++)IC_Validation.isValidURL(indicator[i].img)||this.options.contact.id!==indicator[i].contactID||(dispIndicator=!0,this.indicatorInResultsPanel(indicator[i]));dispIndicator?this.indicatorPanel.showfn():this.indicatorPanel.hide(),this.resultPanel.css({"overflow-x":"hidden","overflow-y":"auto"})},indicatorInResultsPanel:function(indicator){var indicatorImg,indicatorDiv=$('<div class="indicatorDiv" />').appendTo(this.indicatorPanel);(indicatorImg=$('<div class="indicatorText" />').text(indicator.img).appendTo(indicatorDiv)).attr("title",indicator.toolTip),indicatorImg.attr("data-value",JSON.stringify(indicator)),indicatorImg.on("click",$.proxy(this.onIndicatorClick,this))},onIndicatorClick:function(event){var selectedValue=event.target.getAttribute("data-value"),indicator=IC_Common.parseJSON(selectedValue);this.options.container.agentIndicatorAction(indicator)},updateMetaData:function(contact,agentInfo){this.options.contact=contact,this.isChatPanel="ChatContactEvent"===contact.contactType,this.isEmailPanel="EmailContactEvent"===contact.contactType},updateData:function(sfResult){0===$.grep(sfResult.whoLst,function(item,index){return item.name==IC_Localization.none}).length&&sfResult.whoLst.splice(0,0,{id:"",name:IC_Localization.none}),0===$.grep(sfResult.whatLst,function(item,index){return item.name==IC_Localization.none}).length&&sfResult.whatLst.splice(0,0,{id:"",name:IC_Localization.none}),this.options.contactId!==sfResult.cId?(this.indicatorPanel.empty(),this.indicatorPanel.hide(),this.options.contactId=sfResult.cId,this.sObjectConfig=sfResult.results.inboundObjects,this.populateQueryResult(sfResult.urlPop,sfResult.results.result,sfResult.outboundData),this.isQueryPopulated=!0,IC_Validation.isNullOrEmpty(sfResult.error)?this.errorPanel.hide():(this.errorPanel.text(sfResult.error),this.errorPanel.attr("title",sfResult.error),this.errorPanel.showfn()),this.updateNotes(sfResult.task.notes,sfResult.whoLst,sfResult.whatLst),this.updateIndicator(AgentConsoleDataStore.indicators.contactIndicator,this.options.contact.contactType)):sfResult.task.changedData===IC_Util.WhoId?this.populateWhoID(sfResult.whoLst):sfResult.task.changedData===IC_Util.WhatId?this.populateWhatID(sfResult.whatLst):sfResult.task.changedData===IC_Util.Notes&&(this.txtNotes.val(sfResult.task.notes),this.txtNotes.trigger("keyup.textAreaScroll")),IC_Validation.isValidObject(this.dispPanel)&&this.dispPanel.resultsNotesDispControl("setContactId",this.options.contact.id)},updateNotes:function(txtComment,whoIdList,whatIdList){this.txtNotes.val(txtComment),this.txtNotes.trigger("keyup.textAreaScroll"),this.populateWhoID(whoIdList),this.populateWhatID(whatIdList)},populateWhoID:function(whoIdList){if(IC_Common.isIE11&&!0===this.divWhoSelect.comboBox("isDropdownOpen"))return;var filteredList=[],addedId=[],lstLength=whoIdList.length-1;if(-1!==lstLength)for(var i=lstLength;i>=0;i--)if(!1===IC_Validation.isNotNullOrUndefinedString(addedId[whoIdList[i].id])){addedId[whoIdList[i].id]=!0;var obj={value:whoIdList[i].name,id:whoIdList[i].id};filteredList.push(obj)}filteredList.length>0&&(this.divWhoSelect.comboBox("setSelectedItem",{value:filteredList[0].value}),this.selectedWhoId=filteredList[0].id),this.divWhoSelect.comboBox("setStore",filteredList)},populateWhatID:function(whatIdList){if(IC_Common.isIE11&&!0===this.divWhatSelect.comboBox("isDropdownOpen"))return;var filteredList=[],addedId=[],lstLength=whatIdList.length-1;if(-1!==lstLength)for(var i=lstLength;i>=0;i--)if(!1===IC_Validation.isNotNullOrUndefinedString(addedId[whatIdList[i].id])){addedId[whatIdList[i].id]=!0;var obj={value:whatIdList[i].name,id:whatIdList[i].id};filteredList.push(obj)}filteredList.length>0&&(this.divWhatSelect.comboBox("setSelectedItem",{value:filteredList[0].value}),this.selectedWhatId=filteredList[0].id),this.divWhatSelect.comboBox("setStore",filteredList)},getContactId:function(){return this.options.contact.id},setContactId:function(contactId){this.options.contactId=contactId},getNotesResult:function(){return{whoId:this.selectedWhoId,whatId:this.selectedWhatId,disp:this.selectedDisposition,notes:this.txtNotes.val()}},renderCustomScrollBar:function(objName){var that=this;"block"===objName.css("display")&&(objName.mCustomScrollbar("destroy"),objName.mCustomScrollbar({scrollButtons:{enable:!0},advanced:{autoScrollOnFocus:!1,updateOnContentResize:!0},scrollInertia:0,callbacks:{onScroll:function(){IC_Validation.isValidObject(that.tagControlPanel)&&that.tagControlPanel.tagControl("onHideTagList"),IC_Validation.isValidObject(that.dispPanel)&&that.dispPanel.resultsNotesDispControl("onComboxMenuHide")}}}))},updateTagsforContact:function(contact){this.options.contact=contact,AgentConsoleDataStore.tags.updateContact(contact),this.updateTagsCount(contact,!0)},createTagsPanel:function(){var _contact=this.options.contact;if(!IC_Validation.isValidObject(this.tagsPanel)){this.tagsPanel=$('<div class="tagPanel"/>').appendTo(this.notesContPanel),this.tagHeader=$('<div class="tagHeader"/>').appendTo(this.tagsPanel),this.tagsCountPanel=$('<div class="tagsCountPanel"/>').appendTo(this.tagHeader);var tagIndicatorDiv=$('<div class="tagIndicator"/>').appendTo(this.tagHeader);this.tagIndicatorIcon=$("<img />").attr("src",this.options.resourceBase+"/css/images/add-tag-enable.png").addClass("addTag").appendTo(tagIndicatorDiv),this.tagClose=$('<div class="tagClose" />').text("x").appendTo(this.tagHeader)}this.options.tagContactId;if(IC_Validation.isNotNullOrEmpty(_contact)){var skillId=_contact.skillId,skillTags=[],skillTagsMap=AgentConsoleDataStore.skillTagsMap[skillId];IC_Validation.isValidObject(skillTagsMap)&&(skillTags=skillTagsMap.length>0?skillTagsMap:[]),IC_Validation.isNullOrEmpty(this.tagControlPanel)&&(this.tagControlPanel=$('<div id="tagControlPanel"/>').appendTo(this.tagsPanel),this.tagControlPanel.tagControl({container:this,resourceBase:this.options.resourceBase,contact:_contact,skillTags:skillTags,isPopout:this.options.isPopout})),this.tagControlPanel.hide(),this.tagsPanel.removeClass("open"),this.tagControlPanel.tagControl("updateData",skillTags,_contact),this.tagHeader.off("click"),this.tagHeader.on("click",$.proxy(this.showTagsDetailsPnl,this)),this.tagClose.on("click",$.proxy(this.closeTagPanel,this)),this.tagControlPanel.tagControl("updatePanelHeight"),this.resetPanel()}},resetPanel:function(){IC_Validation.isValidObject(this.tagsPanel)&&(this.tagsPanel.css({height:"25px"}),this.txtNotes.showfn(),this.tagControlPanel.tagControl("resetSearchText"))},closeTagPanel:function(event){event.stopPropagation();this.options.contact;this.tagControlPanel.tagControl("onHideTagList"),this.tagControlPanel.hide(),this.tagsPanel.removeClass("open"),this.setTagsPanel(),this.setNotesPanelHeight(),this.tagHeader.off("click"),this.tagHeader.on("click",$.proxy(this.showTagsDetailsPnl,this)),this.txtNotes.showfn()},showTagsDetailsPnl:function(){this.options.contact;this.tagHeader.off("click"),this.tagControlPanel.tagControl("onHideTagList"),this.tagControlPanel.showfn(),this.tagsPanel.addClass("open");var isChatOrEmail=!(!this.isChatPanel&&!this.isEmailPanel);this.tagControlPanel.tagControl("updateSelectedTagHeight",isChatOrEmail),this.setTagsPanel(),this.setNotesPanelHeight()},setTagsPanel:function(){var that=this;function resizeTagPanel(){var dispHeight=0,notesPanel=0;that.tagsPanel.css({height:"25px"}),that.tagsPanel.hasClass("open")&&(notesPanel=parseInt(that.notesPanel.height())-5,IC_Validation.isValidObject(that.dispositionPanel)&&"block"===that.dispositionPanel.css("display")&&(dispHeight=parseInt(that.dispositionPanel.height())),that.tagsPanel.css({height:notesPanel-dispHeight+"px"}),that.tagControlPanel.tagControl("onResizeTagsPanel"),that.tagControlPanel.tagControl("updatePanelHeight"))}that.tagsPanel.css({height:"auto"}),this.options.container.isPopout?this.options.container.isPopout&&(this.isChatPanel||this.isEmailPanel)&&(this.txtNotes.toggle(),resizeTagPanel()):(this.txtNotes.toggle(),resizeTagPanel())},updateTagsCount:function(contact,showTagsPanel){this.options.contact;if(IC_Validation.isValidObject(contact)){var selectedTagsCount=contact.tags?contact.tags.length:0;this.tagsCountPanel.text(IC_Localization.tags+" ("+selectedTagsCount+")"),this.updateTagsIcon(this.options.container.isAllTagsAddedtoContact(contact.id)),this.setNotesPanelHeight()}},hideTagsPanel:function(){IC_Validation.isValidObject(this.tagsPanel)&&this.tagsPanel.parent().length>0&&(this.tagsPanel.remove(),this.setResultPanelHeight())},createTagsPanelForContact:function(){this.createTagsPanel()},updateTagsIcon:function(isAllTagsAdded){isAllTagsAdded?this.tagIndicatorIcon.attr("src",this.options.resourceBase+"/css/images/add-tag-disable.png"):this.tagIndicatorIcon.attr("src",this.options.resourceBase+"/css/images/add-tag-enable.png")},UpdateTagContactId:function(contactId){this.options.tagContactId=contactId},hideCloseIcon:function(){this.closeBtn.hide()},showCloseIcon:function(){this.closeBtn.showfn()},resizeWidget:function(){var queryPnlWidth=window.innerWidth-195,extraSpace=0,marLeft=0;(this.isChatPanel||this.isEmailPanel)&&(extraSpace=2,marLeft=2),this.element.css({width:queryPnlWidth-extraSpace+"px","margin-left":marLeft+"px"}),this.setResultPanelHeight(),this.setNotesPanelHeight()},resizeResultNotesHt:function(){IC_Validation.isValidObject(this.tagsPanel)&&"block"===this.tagsPanel.css("display")&&this.tagsPanel.css("display","none"),this.resultPanel.css("height","0px"),this.resultPanel.css("display","none")},getDispPanelHeight:function(){return IC_Validation.isValidObject(this.dispositionPanel)&&"block"===this.dispositionPanel.css("display")?this.dispositionPanel.height():0},isTagsAssigned:function(){var skillId=this.options.contact.skillId;this.element.showfn(),IC_Validation.isValidObject(this.tagsPanel)&&(this.options.container.isTagsAssigned(skillId)?(this.tagsPanel.showfn(),this.tagsPanel.hasClass("open")?this.tagControlPanel.showfn():this.tagControlPanel.hide(),this.tagHeader.off("click"),this.tagHeader.on("click",$.proxy(this.showTagsDetailsPnl,this))):this.tagsPanel.hide())},showEmailPanelOnly:function(){this.isResultPanelShow=!1,this.options.container.elements.ContactResultsNotesPanel.hide()},isDispAssigned:function(){var contact=this.options.contact,skill=AgentConsoleDataStore.allSkillList[contact.skillId];IC_Validation.isValidObject(this.dispositionPanel)&&(!IC_Validation.isValidObject(skill)||!0!==skill.useDisposition&&!0!==skill.reqDisposition?this.dispositionPanel.hide():this.dispositionPanel.showfn())},showAllControls:function(){var isPanelExpanded=this.getPanelExpanded();this.hdrPanel.showfn(),this.txtAreaPanel.showfn(),this.isDispAssigned(),this.isTagsAssigned(),this.isChatPanel||this.isEmailPanel?isPanelExpanded||!this.isChatPanel&&!this.isEmailPanel||this.collapseAll():this.hdrNotes.hasClass("hrdSelect")?this.toggleView("Notes"):(this.isResultPanelShow=!0,this.toggleView("Results"))},localeDateTimeFormat:function(){return this.options.container.localeDateTimeFormat()},localeDateFormat:function(){return this.options.container.localeDateFormat()},getServerTimestamp:function(){return AgentConsoleDataStore.getServerTimestamp()},consoleOptions:function(){return this.options.container.isPopout?this.options.container.options:this.options.container.consoleOptions()},resetDispDatas:function(){IC_Validation.isValidObject(this.dispPanel)&&this.dispPanel.resultsNotesDispControl("setDefaultText")},resetResultsNotes:function(){if(this.options.container.isPopout){var isPanelExpanded=this.getPanelExpanded();this.hdrPanel.showfn(),this.hdrNotes.removeClass("hrdSelect"),this.notesPanel.hide(),isPanelExpanded?(this.hdrQueryResult.addClass("hrdSelect"),this.resultPanel.showfn()):this.collapseAll(),this.onResizeComplete()}else this.isChatPanel||this.isEmailPanel||this.onResizeComplete()},destroy:function(){var self=this;this.element.toggle("clip",{complete:function(){for(var obj in $(self).children().each(function(){IC_Common.discardElement(this)}),$.Widget.prototype.destroy.call(self),self.element.remove(),self)self.hasOwnProperty(obj)&&IC_Common.discardElement(this)}},200)}})}(jQuery);