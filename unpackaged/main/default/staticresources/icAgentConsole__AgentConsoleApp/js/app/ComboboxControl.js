!function($){$.widget("AgentConsole.comboBox",{resourceBase:"",onDataChange:null,selectedItem:{},listCount:0,renderFlag:!1,dropdownOpen:!1,onComboxMenuShow:null,onComboxMenuHide:null,_init:function(){document.getElementById("renderTextSize")||$('<div id="renderTextSize"/>').addClass("renderTextSize").appendTo("Body")},_create:function(){var that=this;this.resourceBase=this.options.resourceBase,this.onDataChange=this.options.onDataChange,this.onComboxMenuShow=this.options.onComboxMenuShow,this.onComboxMenuHide=this.options.onComboxMenuHide,this.comboxDiv=$("<div/>").addClass("cComboBox btnDivEnable").appendTo(this.element),this.comboxDiv.addClass("roundBorder"),this.comboxTxt=$('<div tabindex="0"/>').addClass("txtDiv").on("click",$.proxy(this.comboxMenuShow,this)).appendTo(this.comboxDiv),this.comboxSpn=$("<span/>").addClass("txtSpn").appendTo(this.comboxTxt),this.comboxDD=$('<div id = "iconDivId"/>').addClass("iconDiv").on("click",$.proxy(this.comboxMenuShow,this)).appendTo(this.comboxDiv),this.comboxIcn=$("<div/>").appendTo(this.comboxDD),$("<img/>").addClass("icon").attr("src",this.resourceBase+"/css/images/arrow-down.png").attr("alt",IC_Localization.comboboxItems).appendTo(this.comboxIcn),this.comboxMenu=$('<div id="menuDivId"/>').addClass("menu btnDivEnable").appendTo(this.comboxDiv),this.comboxMenu.on("mouseleave",$.proxy(this.comboxMenuHide,this)),this.comboxDiv.on("mouseleave",$.proxy(this.comboxFocusOut,this)),this.comboxMenu.on("mouseenter",function(){clearTimeout(that.comboxMenuHideTimeout)}),IC_Common.enterKeyPress(this.comboxTxt,function(){that.comboxMenuShow()}),this.comboxTxt.on("focus",function(){that.comboxDiv.addClass("element-focus")}).on("focusout",function(){that.comboxDiv.removeClass("element-focus")})},comboxFocusOut:function(){var that=this;this.comboxMenuHideTimeout=setTimeout(function(){that.comboxMenuHide()},150)},comboxMenuHide:function(event){this.dropdownOpen=!1;var comboxMenu=this.comboxMenu,comboxDiv=this.comboxDiv,comboxDD=this.comboxDD;this.comboxRemoveBorder(),"block"===comboxMenu.css("display")&&($(".menu.btnDivEnable.mCustomScrollbar").css("display","none"),comboxMenu.css("display","none"),"function"==typeof this.onComboxMenuHide&&this.onComboxMenuHide()),comboxDiv.addClass("roundBorder"),comboxDD.addClass("roundBorder")},comboxRemoveBorder:function(){IC_Validation.isNotNullOrEmpty(this.comboxDiv)&&(this.comboxDiv.removeClass("roundBorder"),this.comboxDiv.removeClass("halfRoundBorder halfRoundBorderBottom")),IC_Validation.isNotNullOrEmpty(this.comboxDD)&&(this.comboxDD.removeClass("halfRoundBorder halfRoundBorderBottom"),this.comboxDD.removeClass("roundBorder"))},comboxMenuShow:function(){if(0!==this.listCount){this.dropdownOpen=!0;var maxheight,maxWidth,dynamicHeight,comboxMenu=this.comboxMenu,comboxDiv=this.comboxDiv,comboxDD=this.comboxDD;IC_Validation.isNullOrEmpty(this.options.dispPosition)?this.comboxMenu.css({top:comboxDiv.offset().top+comboxDiv.height()+1,left:comboxDiv.offset().left,width:comboxDiv.offset().width}):this.comboxMenu.css({top:comboxDiv.offset().top-comboxMenu.height(),left:comboxDiv.offset().left,width:comboxDiv.offset().width}),this.comboxRemoveBorder(),"block"===comboxMenu.css("display")?(comboxMenu.css("display","none"),comboxDiv.addClass("roundBorder"),comboxDD.addClass("roundBorder"),"function"==typeof this.onComboxMenuHide&&this.onComboxMenuHide()):(comboxMenu.css("display","block"),IC_Validation.isNullOrEmpty(this.options.dispPosition)?(comboxDiv.addClass("halfRoundBorder"),comboxDD.addClass("halfRoundBorder")):(comboxDiv.addClass("halfRoundBorderBottom"),comboxDD.addClass("halfRoundBorderBottom")),"function"==typeof this.onComboxMenuShow&&this.onComboxMenuShow()),!0!==this.renderFlag&&(this.renderFlag=!0,this.renderCustomScrollBar(comboxMenu),maxheight=comboxDiv.find(".menu .mCustomScrollBox").css("max-height").replace("px",""),maxWidth=comboxDiv.find(".menu .mCustomScrollBox .itemDiv").css("max-width").replace("px","")),dynamicHeight=comboxMenu.height(),$("#"+this.comboxMenuDivId)&&$("#"+this.comboxMenuDivId).css("width",maxWidth+"px"),dynamicHeight>=parseInt(maxheight)?(this.comboxMenu.css("height",maxheight+"px"),$("#"+this.comboxMenuDivId)&&$("#"+this.comboxMenuDivId).css("width",parseInt(maxWidth-16)+"px")):void 0!==this.comboxMenu.style&&this.comboxMenu.style.removeAttribute("height"),comboxMenu.mCustomScrollbar("scrollTo",0,{moveDragger:!0})}},selectedElement:function(selectedValue){this.selectedItem=IC_Common.parseJSON(selectedValue),this.comboxSpn.text(""),this.comboxSpn.text(this.selectedItem.value),!0===IC_Validation.isNotNullOrUndefinedString(this.selectedItem.css)&&this.comboxSpn.css(this.selectedItem.css),!0===IC_Validation.isNotNullOrUndefinedString(this.selectedItem.title)?this.textMask(this.selectedItem.title,this.comboxSpn):this.textMask(this.selectedItem.value,this.comboxSpn),this.comboxMenuHide(),"function"==typeof this.onDataChange&&this.onDataChange()},getSelectedItem:function(){return this.selectedItem},isDropdownOpen:function(){return this.dropdownOpen},setSelectedItem:function(selectedItem){this.selectedItem=selectedItem,this.comboxSpn.text(""),this.comboxSpn.text(this.selectedItem.value),!0===IC_Validation.isNotNullOrUndefinedString(this.selectedItem.title)?this.textMask(this.selectedItem.title,this.comboxSpn):this.textMask(this.selectedItem.value,this.comboxSpn)},textMask:function(text,objName){objName.attr("title",text),objName.addClass("textEllipsis")},renderCustomScrollBar:function(objName){"block"===objName.css("display")&&objName.mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0,advanced:{autoScrollOnFocus:!1,updateOnContentResize:!0}})},onResizeComplete:function(){var comboxMenu=this.comboxMenu,comboxDiv=this.comboxDiv;this.comboxRemoveBorder(),$(".comboxMenu.scrollbar.custom").css("display","none"),comboxMenu.css("height","auto"),"block"===comboxMenu.css("display")&&comboxMenu.css("display","none"),comboxDiv.addClass("roundBorder"),this.loadDropDown(),this.comboxMenu.mCustomScrollbar("destroy"),this.renderFlag=!1},setStore:function(store){var comboxMenu=this.comboxMenu,comboxDiv=this.comboxDiv;this.store=store,this.comboxRemoveBorder(),this.comboxMenu.removeAttr("style"),$(".comboxMenu.scrollbar.custom").css("display","none"),comboxMenu.css("height","auto"),"block"===comboxMenu.css("display")&&comboxMenu.css("display","none"),comboxDiv.addClass("roundBorder"),this.loadDropDown(),this.comboxMenu.mCustomScrollbar("destroy"),this.renderFlag=!1},loadDropDown:function(){var selectItem;(this.isLoading=!1,this.index=0,this.listCount=0,IC_Validation.isNotNullOrEmpty(this.comboxMenuDiv)&&this.comboxMenuDiv.empty(),IC_Validation.isNotNullOrEmptyArray(this.store))&&(IC_Validation.isNotNullOrEmpty(this.loadTimer)&&(clearTimeout(this.loadTimer),this.loadTimer=null),this.limit=this.comboxTxt.width()+20,this.store.length>6&&(this.limit=this.limit-13),IC_Validation.isNotNullOrEmpty(this.comboxMenuDiv)||(this.comboxMenuDivId=IC_Common.generateUniqueId("itemDiv"),this.comboxMenuDiv=$('<div id="'+this.comboxMenuDivId+'"/>').addClass("itemDiv").appendTo(this.comboxMenu)),this.isLoading=!0,this.loadItems(),1===this.listCount&&(IC_Validation.isNotNullOrEmpty(this.store)||(selectItem=this.store[0].value)),this.listCount>0&&(this.comboxSpn.text(selectItem),!0===IC_Validation.isNotNullOrUndefinedString(this.store[0].title)?this.textMask(this.store[0].title,this.comboxSpn):this.textMask(this.comboxSpn.text(),this.comboxSpn)))},loadItems:function(){var that=this;if(!0===this.isLoading){if(void 0===this.index&&(this.index=0),this.index>=this.store.length)return this.isLoading=!1,void(IC_Validation.isNotNullOrEmpty(this.loadTimer)&&(clearTimeout(this.loadTimer),this.loadTimer=null));this.ddMenuItem=$('<div id="'+this.store[this.index].value+'" tabindex="0"/>').addClass("item").text(this.store[this.index].value).appendTo(this.comboxMenuDiv),!0===IC_Validation.isNotNullOrUndefinedString(this.store[this.index].css)&&this.ddMenuItem.css(this.store[this.index].css),this.textMask(this.ddMenuItem.text(),this.ddMenuItem),this.ddMenuItem.attr("data-value",JSON.stringify(this.store[this.index])),this.ddMenuItem.hoverfn(function(){$(this).addClass("btnDivHover")},function(){$(this).removeClass("btnDivHover")}),this.ddMenuItem.on("click",function(event){var selectedValue=event.target.getAttribute("data-value");that.selectedElement(selectedValue)}),this.ddMenuItem.on("keypress",function(event){if(13==event.which){var selectedValue=event.target.getAttribute("data-value");that.selectedElement(selectedValue)}}),this.ddMenuItem.on("focus",function(){$(this).addClass("menuItem-focus")}).on("focusout",function(){$(this).removeClass("menuItem-focus")}),this.listCount++,this.index++,this.loadTimer=setTimeout($.proxy(this.loadItems,this),0)}}})}(jQuery);