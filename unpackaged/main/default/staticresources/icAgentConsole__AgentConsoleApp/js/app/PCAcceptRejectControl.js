!function($){var logger=IC_Common.getLogger("PCAcceptRejectControl");$.widget("AgentConsole.pcAcceptRejectControl",$.AgentConsole.acceptRejectPanel,{options:{controller:null,resourceBase:"",isConsult:!1,agentLegState:""},_init:function(){document.getElementById("renderTextSize")||$('<div id="renderTextSize"/>').addClass("renderTextSize").appendTo("Body")},_create:function(){this.DefaultAmntText=IC_Localization.enterAmount,this.DefaultDispText=IC_Localization.selectDisposition,this.contact=this.options.contact,this.resourceBase=this.options.resourceBase,this.root=this.createRootPanel(),this.root.appendTo(this.element),this.agentLegState=this.options.agentLegState,this.postCreate()},postCreate:function(){var dispositionContainer,that=this;this.acceptBtn.hide(),this.rejectBtn.hide(),this.btnHolder.removeClass("acceptRejectHolder"),this.snoozeDiv=$('<div id = "acceptDivId" class="btnBrRound5 grayGradient pc-icons" title= "'+IC_Localization.snooze+'" align="center" />'),this.snoozeImg=$('<img src="'+this.resourceBase+'/css/images/clock-timer.svg" />'),this.snoozeDiv.append(this.snoozeImg),this.snoozeDiv.hoverfn(function(){$(this).addClass("bntHover")},function(){$(this).removeClass("bntHover")}),this.rescheduleDiv=$('<div id = "acceptDivId" class="btnBrRound5 grayGradient pc-icons" title= "'+IC_Localization.reschedule+'" align="center" />'),this.rescheduleImg=$('<img src="'+this.resourceBase+'/css/images/schedule-new-commitment.svg" />'),this.rescheduleImg.css({width:"12px"}),this.rescheduleDiv.append(this.rescheduleImg),this.rescheduleDiv.hoverfn(function(){$(this).addClass("bntHover")},function(){$(this).removeClass("bntHover")}),this.rejectDiv=$('<div id = "rejectDivId" class="btnBrRound5 grayGradient pc-icons" title= "'+IC_Localization.requeue+'" align="center" />'),this.rejectImg=$('<img src="'+this.resourceBase+'/css/images/close.svg" />'),this.rejectDiv.append(this.rejectImg),this.rejectDiv.hoverfn(function(){$(this).addClass("bntHover")},function(){$(this).removeClass("bntHover")}),this.acceptDiv=$('<div id = "acceptDivId" class="btnBrRound5 grayGradient pc-icons" title= "'+IC_Localization.accept+'" align="center" />'),this.acceptImg=$('<img src="'+this.resourceBase+'/css/images/checkmark.svg" />'),this.acceptImg.css({width:"14px"}),this.acceptDiv.append(this.acceptImg),this.acceptDiv.hoverfn(function(){$(this).addClass("bntHover")},function(){$(this).removeClass("bntHover")}),this.btnHolder.append(this.snoozeDiv),this.btnHolder.append(this.rescheduleDiv),this.btnHolder.append(this.rejectDiv),this.btnHolder.append(this.acceptDiv),this.btnHolder.hide(),this.dispPnl=$('<div class="dispPnl modalDialogPanel">'),dispositionContainer=$('<div class = "modalDialogBackground"/>').appendTo(this.dispPnl),this.headerPanel=$('<div class = "modalDialogHeader">').appendTo(dispositionContainer),this.headerPanel.css({height:"21px"}),$('<div class = "modalDialogHeaderText textEllipsis">'+IC_Localization.disposition+"</div>").appendTo(this.headerPanel).css({"padding-top":"3px"}),this.dispSelect=$('<div id = "dispSelectId" class="selectBox dispSelect"> </div>').appendTo(dispositionContainer),this.dispSelect.comboBox({onDataChange:$.proxy(this.ondispositionSelected,this),resourceBase:this.options.resourceBase}),this.amntPanel=$('<div class = "container searchText amntDiv"/>').appendTo(dispositionContainer),this.amntValue=$('<input class = "searchTextInput" type="text"  title="'+IC_Localization.enterAmount+'"/>').appendTo(this.amntPanel),this.dispAmountError=$("<div/>").addClass("dispErrorDiv textEllipsis").appendTo(dispositionContainer),this.dispAmountError.hide(),this.dispAmountError.text(IC_Localization.enterTheAmount),this.amntValue.on("click",$.proxy(this.onAmntTxtChange,this)),this.amntValue.on("focus",$.proxy(this.onAmntTxtChange,this)),this.amntValue.on("blur",$.proxy(this.onAmntTextBlur,this)),this.amntPanel.hide(),this.amntValue.on("keypress",function(e){if(8!==e.which&&0!==e.which&&(e.which<48||e.which>57)&&46!==e.which)return!1;var amnt=that.amntValue.val();return!(46===e.which&&amnt.length>0&&decimalValidator.test(amnt))&&void 0}),this.notesPnl=$('<div id = "pcNotesPnlId" class="container notesDiv" />').appendTo(dispositionContainer),this.notesTxt=$('<textarea id = "pcNotesTxtId" class="notesTxt" title="'+IC_Localization.notes+'"/>').appendTo(this.notesPnl),this.notesTxt.on("keyup",$.proxy(this.notesChanged,this)),this.saveBtn=$('<div id = "saveCloseBtnId" class="btnPanel grayGradient saveCloseBtn textEllipsis" title="'+IC_Localization.save+" & "+IC_Localization.close+'">'+IC_Localization.save+" & "+IC_Localization.close+"</div>").appendTo(dispositionContainer),this.saveBtn.hoverfn(function(){$(this).addClass("bntHover")},function(){$(this).removeClass("bntHover")}),this.saveBtn.on("click",$.proxy(this.saveDisposition,this)),this.acceptRejectCover.append(this.dispPnl),this.dispPnl.hide();var phoneNum=0;this.mediaTypeImgPnlL.attr("src",this.resourceBase+"/css/images/mediatype-phone.png"),this.timeOutPanel.css({display:"block",float:"right"}),this.acceptDiv.on("click",$.proxy(this.acceptBtnClick,this)),this.rejectDiv.on("click",$.proxy(this.rejectBtnClick,this)),this.snoozeDiv.on("click",$.proxy(this.snoozeBtnClick,this)),this.rescheduleDiv.on("click",$.proxy(this.rescheduleBtnClick,this)),this.notesPnl.css({height:"64px"}),this.message.css({"padding-top":"0px","padding-bottom":"2px"}),this.statusPanel.addClass("prvStatusPnl textEllipsis").removeClass("statusPnl"),this.startTimer(this.contact),this.messageHeader.text(""),this.statusPanel.attr("title",this.contact.name),this.statusPanel.text(this.contact.name),phoneNum=this.contact.dnis,IC_Common.toNumber(this.contact.dnis)&&10===this.contact.dnis.length&&(phoneNum=IC_Common.phoneMask(this.contact.dnis)),this.aniDNSPayloadPanel.text(phoneNum),this.aniDNSPayloadPanel.css({float:"left","margin-top":"2px",height:"10px"}),this.skillNamePanel.hide(),this.compPnl=$('<div class="compPnl" />'),this.compPnl.text(IC_Localization.contactRequiresConfirmation),this.compPnl.hide(),this.prvPnl=$('<div class="prvPnl" />'),this.dialerInfo1=$('<div class="dialerInfo textEllipsis" />'),this.dialerInfo2=$('<div class="dialerInfo textEllipsis" />'),this.valOne=$('<div class="valOne textEllipsis" />').text(IC_Localization.valueOne+" :"),this.valTwo=$('<div class="valTwo textEllipsis" />').text(IC_Localization.valueTwo+" :"),this.valOne.attr("title",IC_Localization.valueOne),this.valTwo.attr("title",IC_Localization.valueTwo),this.prvPnl.append(this.valOne),this.prvPnl.append(this.dialerInfo1),this.prvPnl.append(this.valTwo),this.prvPnl.append(this.dialerInfo2),this.prvPnl.appendTo(this.message),this.compPnl.appendTo(this.message),this.options.isConsult&&(this.rejectBtn.hide(),this.compPnl.hide(),this.aniDNSPayloadPanel.hide(),"Active"!==this.agentLegState&&(this.acceptBtn.removeClass("acceptGradient"),IC_Common.disableButton(this.acceptBtn))),this.setDefaultText(),this.loadOtherInfo(),this.blendedHeight=0},notesChanged:function(){var obj=this.dispSelect.comboBox("getSelectedItem");IC_Validation.isValidObject(obj)&&IC_Validation.isNotNullOrUndefinedString(obj.id)&&(this.dispSelected=obj);var that=this;clearTimeout(this.notesChangedTimer),this.notesChangedTimer=setTimeout(function(){var obj=that.dispSelected,data={contactId:that.options.contact.id,notes:that.notesTxt.val(),disp:obj,amt:that.amntValue.val()};that.options.controller.pcPreviewNotesUpdate(data,!0)},500)},updatePreviewNotes:function(data){IC_Validation.isValidObject(data)&&IC_Validation.isNotNullOrUndefinedString(data.disp)&&IC_Validation.isNotNullOrUndefinedString(this.dispSelect)&&(data.contactId===this.options.contact.id?(this.dispSelected=data.disp,this.dispSelect.comboBox("setSelectedItem",{value:data.disp.value}),this.notesTxt.val(data.notes),this.amntPanel.toggle(data.disp.isAmount),IC_Validation.isNotNullOrUndefinedString(data.amt)&&data.amt!==this.DefaultAmntText?this.amntValue.val(data.amt).removeClass("dispComboText "):this.amntValue.val(this.DefaultAmntText).addClass("dispComboText ")):this.setDefaultText()),this.ondispositionSelected(!0)},rescheduleBtnClick:function(){this.options.controller.showRescheduleDateTime(this.contact.id,this.contact.dnis)},ondispositionSelected:function(isUpdate){var obj={},dispPnl=this.dispPnl.height();dispPnl-=this.headerPanel.outerHeight(!0)+(this.dispSelect?this.dispSelect.outerHeight(!0):0)+this.saveBtn.outerHeight(!0)+6,this.dispAmountError.hide(),this.amntValue.css({border:"1px solid rgb(161, 161, 161)"}),isUpdate?(!IC_Validation.isNotNullOrUndefinedString(this.dispSelected)&&IC_Validation.isNotNullOrUndefinedString(this.dispSelect)&&this.dispSelect.comboBox("setSelectedItem",{value:this.DefaultDispText}),obj=this.dispSelected):IC_Validation.isNotNullOrUndefinedString(this.dispSelect)&&(obj=this.dispSelect.comboBox("getSelectedItem"),this.dispSelected=obj,this.amntValue.val(this.DefaultAmntText)),IC_Validation.isValidObject(obj)&&obj.isAmount&&(dispPnl-=20),this.dispAmountError.hide(),IC_Validation.isValidObject(obj)&&obj.isAmount?this.amntPanel.showfn():(this.amntPanel.hide(),this.amntValue.val("")),this.notesPnl.css({height:dispPnl+"px"}),this.notesTxt.css({height:dispPnl-6+"px"}),IC_Validation.isValidObject(obj)&&IC_Validation.isNotNullOrUndefinedString(this.dispSelect)&&this.notesChanged()},setDefaultText:function(){IC_Validation.isNotNullOrUndefinedString(this.dispSelect)&&this.dispSelect.comboBox("setSelectedItem",{value:this.DefaultDispText}),$("#"+this.dispDivId+" .txtSpn").addClass("dispComboText"),this.amntValue.val(this.DefaultAmntText),this.amntValue.addClass("dispComboText"),this.notesTxt.val("")},onAmntTxtChange:function(){this.dispAmountError.hide(),this.amntValue.css({border:"1px solid rgb(161, 161, 161)"}),this.amntValue.val()===IC_Localization.enterAmount?(this.amntValue.val(""),this.amntValue.removeClass("dispComboText")):this.notesChanged(),this.ondispositionSelected(!0)},onAmntTextBlur:function(){""==this.amntValue.val()&&(this.amntValue.val(this.DefaultAmntText),this.amntValue.addClass("dispComboText"))},updateDispositions:function(dispositions,contactType){this.disposition=dispositions,this.populateDispositions()},populateDispositions:function(){var isAmount,primDisposition,i=0,filteredList=[];if(primDisposition=this.disposition.filter(function(item){return!0===item.isPreviewDisposition}),this.showDispositionValue=primDisposition.length>0,IC_Validation.isNotNullOrEmptyArray(primDisposition)){for(i=0;i<primDisposition.length;i++){isAmount=!1,IC_Validation.isNullOrEmpty(primDisposition[i].isAmount)||(isAmount=primDisposition[i].isAmount);var obj={id:primDisposition[i].id,value:primDisposition[i].name,order:primDisposition[i].order,isPreviewDisposition:primDisposition[i].isPreviewDisposition,isAmount:isAmount};filteredList.push(obj)}filteredList.sort(function(a,b){return a.order-b.order}),IC_Validation.isNotNullOrUndefinedString(this.dispSelect)&&this.dispSelect.comboBox("setStore",filteredList)}},loadOtherInfo:function(){if(this.dialerInfo1.text(""),this.dialerInfo2.text(""),this.valFieldCnt=0,IC_Validation.isNotNullOrUndefinedString(this.contact.otherInfo))try{var otherInfo={},val1="",val2="";this.compPnl.hide(),otherInfo=IC_Common.getFormatOtherInfo(this.contact.otherInfo),IC_Validation.isNotNullOrUndefinedString(otherInfo)&&(this.prvPnl.css("height","55px"),otherInfo.valueOne.length>0&&0==otherInfo.valueTwo.length&&!IC_Validation.isNotNullOrUndefinedString(otherInfo.valueTwo[1])&&(this.dialerInfo2.hide(),this.valTwo.hide(),this.prvPnl.css("height","30px")),IC_Validation.isNotNullOrUndefinedString(otherInfo.valueOne[0])&&(this.valFieldCnt=1,val1=IC_Validation.isNotNullOrUndefinedString(IC_Localization[otherInfo.valueOne[0].toLowerCase()])?IC_Localization[otherInfo.valueOne[0].toLowerCase()]:otherInfo.valueOne[0],this.valOne.text(val1),this.valOne.attr("title",val1)),IC_Validation.isNotNullOrUndefinedString(otherInfo.valueTwo[0])&&(this.valFieldCnt+=1,val2=IC_Validation.isNotNullOrUndefinedString(IC_Localization[otherInfo.valueTwo[0].toLowerCase()])?IC_Localization[otherInfo.valueTwo[0].toLowerCase()]:otherInfo.valueTwo[0],this.valTwo.text(val2),this.valTwo.attr("title",val2)),this.dialerInfo1.text(otherInfo.valueOne[1]),IC_Common.setTextWithEllipsis(this.dialerInfo1,otherInfo.valueOne[1],64),this.dialerInfo2.text(otherInfo.valueTwo[1]),IC_Common.setTextWithEllipsis(this.dialerInfo2,otherInfo.valueTwo[1],64))}catch(ex){logger.error("Other Information Field: "+ex.message)}else this.valFieldCnt=2;this.renderScroll(this.dialerInfo1),this.renderScroll(this.dialerInfo2),this.lastServerTimestamp=this.contact.lastStateTime},renderScroll:function(obj){$(obj).text().length>48&&$(obj).css({"overflow-y":"scroll"})},saveDisposition:function(){var dispPnl,header,disposition,saveBtn,errorMsg,obj=this.dispSelected;if(this.amntValue.css({border:"1px solid rgb(161, 161, 161)"}),IC_Validation.isValidObject(obj)){if(obj.isAmount&&!IC_Validation.isNumber(this.amntValue.val()))return this.dispAmountError.text(IC_Localization.enterTheAmount),void this.amntValue.css({border:"1px solid #ff0000"});this.amntValue.css({border:"1px solid rgb(161, 161, 161)"});var commitmentAmount=this.amntValue.val(),notesResult={disp:obj,secDisp:"",notes:this.notesTxt.val(),dispPayload:{isReschedule:!1,data:commitmentAmount}};this.options.controller.setDisposition(this.contact.id,notesResult)}else this.dispAmountError.text(IC_Localization.error+": "+IC_Localization.selectTheDisposition),this.dispAmountError.showfn(),this.dispAmountError.css({clear:"left"}),dispPnl=this.dispPnl.height(),header=this.headerPanel.outerHeight(!0),disposition=this.dispSelect.outerHeight(!0),errorMsg=this.dispAmountError.outerHeight(!0),saveBtn=this.saveBtn.outerHeight(!0),notesPnlMargin=6,dispPnl-=header+disposition+errorMsg+saveBtn+notesPnlMargin,this.notesPnl.css({height:dispPnl+"px"}),this.notesTxt.css({height:dispPnl-notesPnlMargin+"px"})},resizePanel:function(isDialer){this.options.controller.isPopout||(this.blendedHeight=isDialer?0:30)},updateData:function(type,data){"agentLeg"===type&&!0===this.options.isConsult&&(this.agentLegState=data,"Active"===this.agentLegState?this.acceptBtn.addClass("acceptGradient"):this.acceptBtn.removeClass("acceptGradient"))},acceptBtnClick:function(){this.options.controller.acceptContact(this.contact.id),this.destroy()},rejectBtnClick:function(){this.options.controller.rejectContact(this.contact.id),this.destroy()},snoozeBtnClick:function(){this.options.controller.snoozeContact(this.contact.id),this.destroy()},textMask:function(objName,text,limit){$("#renderTextSize").text(text),$("#renderTextSize").width()>limit?(objName.attr("title",objName.text()),objName.addClass("textEllipsis")):(objName.attr("title",""),objName.removeClass("textEllipsis")),objName.css("width",limit+"px"),$("#renderTextSize").text("")},startTimer:function(contact){var that=this;this.timerId,this.acceptRejectDuration=0,this.acceptRejectDuration>=0&&(this.timerId=setInterval(function(){that.updateTimer(that.timeOutPanel)},1e3))},timeDiff:function(time){var ms=Math.abs(this.options.controller.getServerTimestamp()-time);return Math.round(ms/1e3)},updateTimer:function(timerPnlObj){var calculatedTime=0,diff=0;IC_Validation.isNotNullOrEmpty(this.lastServerTimestamp)&&(diff=parseInt((this.options.controller.getServerTimestamp()-this.lastServerTimestamp)/1e3)),null!==this.contact.timeout&&this.contact.timeout>0?(currentTimerVal=this.contact.timeout-diff,currentTimerVal<0&&(currentTimerVal=0),calculatedTime=IC_Common.secondsToTime(currentTimerVal)):(this.contactDuration=this.timeDiff(this.contact.time),this.contactTimerVal=this.contactDuration,this.contactTimerVal<345600?(this.contactTimerVal=this.contactTimerVal+1,this.contactDuration=this.contactTimerVal,calculatedTime=IC_Common.secondsToTime(this.contactTimerVal)):calculatedTime=">96 "+IC_Localization.hours),timerPnlObj.text(calculatedTime)},isAgentIndicator:function(obj){return IC_Validation.isNotNullOrEmpty(obj)&&IC_Validation.isNotNullOrEmpty(obj.agentIndicator)?obj.agentIndicator.length:0},updatePanel:function(skillDetails){var _dispPnlHeight,_acceptRejectBumperPnHeight=this.acceptRejectPanel.height(),mediaTabsHeight=this.options.controller.elements.mediaTabsDiv.height();this.btnHolder.css({height:"24px"}),this.options.controller.isPopout?this.dispPnl.css({height:"197px"}):(_dispPnlHeight=this.options.controller.getContentPanelHeight()-(_acceptRejectBumperPnHeight+35+18),_dispPnlHeight-=26,this.dispPnl.css({height:_dispPnlHeight-mediaTabsHeight+"px"})),skillDetails.prevDisposition&&this.showDispositionValue?(this.dispPnl.showfn(),this.ondispositionSelected(!0)):this.dispPnl.hide(),this.btnHolder.showfn(),this.rejectDiv.toggle(skillDetails.prevRequeue),this.snoozeDiv.toggle(skillDetails.prevSnooze),this.rescheduleDiv.toggle(skillDetails.prevReschedule)},onDestroy:function(){clearInterval(this.timerId),"Consult"!==this.contact.type&&(this.acceptRejectDuration=0,this.dispSelect=null,this.dispPnl.remove())}})}(jQuery);