!function($){$.widget("AgentConsole.agentInformation",{options:{container:null,resourceBase:""},agentSkillList:[],receivedPermissionsList:!1,_create:function(){var headerDiv,agentIdPnl,stationIdPnl,phoneNumberPnl,agentLegIdPnl,webServerPnl,timePnl,versionPnl,parent=this.element,that=this;this.resourceBase=this.options.resourceBase,this.options.container.isPopout?(this.gridHeight=345,this.gridScrollHeight=320):(this.gridHeight=196,this.gridScrollHeight=172),this.sortGrid={},parent.addClass("agentInfo"),$('<span class="dialogHidden">'+IC_Localization.begin+" "+IC_Localization.agent+" "+IC_Localization.information+"</span>").appendTo(parent),this.rootPanel=$('<div class="modalDialogBackground"/>').appendTo(parent),this.headerPanel=$('<div class="modalDialogHeader" tabindex="-1" aria-label="'+IC_Localization.agent+IC_Localization.information+'"/>').appendTo(this.rootPanel),$('<div id = "agentInfo_Header" class="modalDialogHeaderText textEllipsis"/>').text(IC_Localization.information).appendTo(this.headerPanel),this.closeBtn=$('<div id = "closeBtnId" role="button" aria-label = "'+IC_Localization.close+'" tabindex = "0"/>').attr("title",IC_Localization.close).appendTo(this.headerPanel),this.closeBtnIcon=$("<img/>").addClass("closeBtnIcon").attr("src",this.resourceBase+"/css/images/section-close.png").appendTo(this.closeBtn),this.closeBtn.on("click",$.proxy(this.closeBtnClick,this)),IC_Common.enterKeyPress(this.closeBtn,function(){that.closeBtnClick()}),IC_Common.setFocusToCloseIcon(this.closeBtn,this.closeBtnIcon,"closeBtnFocus","closeBtnIconFocus"),this.infoPnl=$('<div class="infoPanel"/>').appendTo(this.rootPanel),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.agentID),agentIdPnl=$('<div id = "agentPnlId" class="Panel" />').appendTo(this.infoPnl),this.agentIdTxt=$('<div id = "agentPnlTxtId" class="content" />'),agentIdPnl.append(headerDiv),agentIdPnl.append(this.agentIdTxt),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.agentName),agentNamePnl=$('<div id = "agentNamePnlId" class="Panel" />').appendTo(this.infoPnl),this.agentNameTxt=$('<div id = "agentNameTxtId" class="content" />'),agentNamePnl.append(headerDiv),agentNamePnl.append(this.agentNameTxt),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.stationID),stationIdPnl=$('<div id = "stationPnlId" class="Panel" />').appendTo(this.infoPnl),this.stationTxt=$('<div id = "stationTxtId" class="content" />'),stationIdPnl.append(headerDiv),stationIdPnl.append(this.stationTxt),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.phoneNumber),phoneNumberPnl=$('<div id = "phonePnlId" class="Panel" />').appendTo(this.infoPnl),this.phoneTxt=$('<div id = "phoneTxtId" class="content" />'),phoneNumberPnl.append(headerDiv),phoneNumberPnl.append(this.phoneTxt),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.callerID),callerPnl=$('<div id = "callerPnlId" class="Panel" />').appendTo(this.infoPnl),this.callerTxt=$('<div id = "callerTxtId" class="content" />'),callerPnl.append(headerDiv),callerPnl.append(this.callerTxt),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.currentContacts),contactsPnl=$('<div id = "contactsPnlId" class="Panel" />').appendTo(this.infoPnl),this.contactTxt=$('<div id = "contactTxtId" class="content" />'),contactsPnl.append(headerDiv),contactsPnl.append(this.contactTxt),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.currentTime),timePnl=$('<div id = "timePnlId" class="Panel" />').appendTo(this.infoPnl),this.timeTxt=$('<div id = "timeTxtId" class="content" />'),timePnl.append(headerDiv),timePnl.append(this.timeTxt),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.sessionID),sessionPnl=$('<div id = "sessionPnlId" class="Panel" />').appendTo(this.infoPnl),this.sessionTxt=$('<div id = "sessionTxtId" class="content" />'),sessionPnl.append(headerDiv),sessionPnl.append(this.sessionTxt),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.agentLegID),agentLegIdPnl=$('<div id = "agentLegPnlId" class="Panel" />').appendTo(this.infoPnl),this.agentLegTxt=$('<div id = "agentLegTxtId" class="content" />'),agentLegIdPnl.append(headerDiv),agentLegIdPnl.append(this.agentLegTxt),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.webServer),webServerPnl=$('<div id = "webServerPnlId" class="Panel" />').appendTo(this.infoPnl),this.webServerTxt=$('<div id = "webServerTxtId" class="content" />'),webServerPnl.append(headerDiv),webServerPnl.append(this.webServerTxt),headerDiv=$('<div class="headerDiv textEllipsis" />').text(IC_Localization.version),versionPnl=$('<div id = "versionPnlId" class="Panel" />').appendTo(this.infoPnl),this.versionTxt=$('<div id = "versionTxtId" class="content" />'),versionPnl.append(headerDiv),versionPnl.append(this.versionTxt),this.options.container.isPopout?(this.mediaInfoWidth=26,this.dirInfoWidth=26,this.skillNameColWidth=124):(this.mediaInfoWidth=26,this.dirInfoWidth=26,this.skillNameColWidth=78),this.setGridColumn(),this.gridId=IC_Common.generateUniqueId("agentInfoSkill"),this.skillListGrid=$('<div id="'+this.gridId+'" ></div>').addClass("skillListGrid").appendTo(this.infoPnl),this.createSkillListGrid(),$('<span class="dialogHidden">'+IC_Localization.end+" "+IC_Localization.agent+" "+IC_Localization.information+"</span>").appendTo(parent),this.startTimer(),this.setScroll()},_init:function(){},setScroll:function(){this.infoPnl.mCustomScrollbar("destroy"),this.infoPnl.mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0,advanced:{autoScrollOnFocus:!1,updateOnContentResize:!0}})},setGridColumn:function(){var that=this,mediaInfoWidth=this.mediaInfoWidth,dirInfoWidth=this.dirInfoWidth,skillNameColWidth=this.skillNameColWidth,skillNameTextWidth=skillNameColWidth-19;this.colModel=[{id:"MediaInfo",field:"MediaInfo",name:" ",width:mediaInfoWidth,sortable:!0,resizable:!1,headerCssClass:"decorationHeader",cssClass:"decoration",formatter:function(row,col,data){if(null!==that.tableRow[row]&&void 0!==that.tableRow[row]){var mediaDiv=$('<div style="width: 25px;"></div>'),mediaDOMId=IC_Common.generateUniqueId("skillListRowState");return that.tableRow[row].MediaInfo.MediaDOMId=mediaDOMId,$('<div id="'+mediaDOMId+'"></div>').addClass("gridItemMediaType").append(data.mediaImg).appendTo(mediaDiv),mediaDiv.html()}}},{id:"Direction",field:"Direction",name:" ",width:dirInfoWidth,sortable:!0,resizable:!1,cssClass:"decoration",formatter:function(row,col,data){if(null!==that.tableRow[row]&&void 0!==that.tableRow[row]){var mediaDiv=$('<div style="width: 25px;"></div>'),mediaDOMId=IC_Common.generateUniqueId("skillListRowState1");return that.tableRow[row].MediaInfo.MediaDOMId=mediaDOMId,$('<div id="'+mediaDOMId+'"></div>').addClass("gridItemDirection").append(data.mediaDir).appendTo(mediaDiv),mediaDiv.html()}}},{id:"SkillName",field:"SkillName",name:IC_Common.textMask(IC_Localization.skill,skillNameTextWidth),width:skillNameColWidth,sortable:!0,resizable:!1,headerCssClass:this.headerCss,toolTip:IC_Localization.skill,cssClass:"alignLeft",formatter:function(row,col,data){if(null!==that.tableRow[row]&&void 0!==that.tableRow[row])return $("<div></div>").addClass("gridItemSkillName").append(data.skillNameDiv).html()}}]},createSkillListGrid:function(){var that=this;this.dataView=new Slick.Data.DataView,this.grid=new Slick.Grid("#"+this.gridId,this.dataView,this.colModel,{autoHeight:!0,rowHeight:30,enableColumnReorder:!1}),this.dataView.onRowCountChanged.subscribe(function(e,args){that.grid.updateRowCount(),that.grid.render()}),this.dataView.onRowsChanged.subscribe(function(e,args){that.grid.invalidateRows(args.rows),that.grid.render()}),this.grid.onCellChange.subscribe(function(e,args){this.dataView.updateItem(args.item.id,args.item)}),this.grid.onSort.subscribe(function(e,args){that.sortGrid.sortDir=args.sortAsc?1:-1,that.sortGrid.sortCol=args.sortCol.field,that.tableRow.sort($.proxy(that.gridSorter,that)),that.dataView.beginUpdate(),that.dataView.setItems(that.tableRow),that.dataView.endUpdate()}),this.columnBorderDiv=$("<div></div>").addClass("columnBorderDiv"),$("<div></div>").addClass("border1").appendTo(this.columnBorderDiv),$("<div></div>").addClass("border2").appendTo(this.columnBorderDiv),$(".agentInfo .skillListGrid .slick-viewport").append(this.columnBorderDiv)},gridSorter:function(a,b){var sortDir=1,x=a[this.sortGrid.sortCol],y=b[this.sortGrid.sortCol];return"SkillName"===this.sortGrid.sortCol?(x=a.Name.toLowerCase(),y=b.Name.toLowerCase()):"MediaInfo"===this.sortGrid.sortCol?(x=a.MediaTypeId,y=b.MediaTypeId):"Direction"===this.sortGrid.sortCol&&(x=a.DirectionId,y=b.DirectionId),void 0!==this.sortGrid.sortDir&&null!==this.sortGrid.sortDir&&(sortDir=this.sortGrid.sortDir),sortDir*(x==y?0:x>y?1:-1)},resizeWidget:function(width,height){this.infoPnl.css("height",height-33+"px"),this.setScroll(),this.skillListGrid.css({width:this.infoPnl.width()-212+"px",height:height-48+"px"}),this.gridScrollHeight=this.skillListGrid.height()-25,this.mediaInfoWidth=26,this.dirInfoWidth=26,this.skillNameColWidth=this.skillListGrid.width()-45,$(".agentConsolePopout .agentInfo .columnBorderDiv").css("width",this.skillListGrid.width()),this.columnBorderDiv.css("height",this.gridScrollHeight+"px"),this.updateSkillList(this.agentSkillList)},updateMetaData:function(type,list){this.clearTimer(),this.startTimer(),IC_Validation.isNotNullOrEmpty(list)&&("Skill"===type?this.updateSkillList(list):"Info"===type&&this.updateAgentInfo(list))},updatePermissionsList:function(type,data){this.hideAgentIdentity=!1,this.hideAgentCallerId=!1,this.hideAgentPhoneNumber=!1;var that=this;IC_Validation.isNotNullOrEmptyArray(data)&&$.grep(data,function(event){"hideagentidentityinfo"===event.Key?that.hideAgentIdentity=!0:"hideagentcallerid"===event.Key?that.hideAgentCallerId=!0:"hideagentphonenumber"===event.Key&&(that.hideAgentPhoneNumber=!0)}),this.receivedPermissionsList=!0,this.updateAgentPermissionsInfo()},updateSkillList:function(skillList){var agentSkill,mediaImg,mediaDir,i=0,agentSkillList=skillList,len=agentSkillList.length,canAdd=!1;this.agentSkillList=skillList,delete this.tableRow,this.tableRow=[];var inboundDiv=$('<div id = "inboundDivId" class="inbound" title="'+IC_Localization.inbound+'"/>'),outboundDiv=$('<div id = "outboundDivId" class="outbound" title="'+IC_Localization.outbound+'"/>');for(i=0;i<len;i++){if(4===agentSkillList[i].typeId)mediaImg=$('<div id = "phoneDivId" class="phone" title="'+IC_Localization.call+'"/>'),mediaDir=!0===agentSkillList[i].isOutbound?outboundDiv:inboundDiv,canAdd=!0;else if(6===agentSkillList[i].typeId){mediaImg=$('<div id = "workItmDivId" class="workItem" title="'+IC_Localization.workItem+'"/>'),mediaDir=!0===agentSkillList[i].isOutbound?outboundDiv:inboundDiv,canAdd=!0}else if(3===agentSkillList[i].typeId){mediaImg=$('<div id = "chatItmDivId" class="chat" title="'+IC_Localization.chat+'"/>'),mediaDir=!0===agentSkillList[i].isOutbound?outboundDiv:inboundDiv,canAdd=!0}else if(1===agentSkillList[i].typeId){mediaImg=$('<div id = "emailDivId" class="email" title="'+IC_Localization.email+'"/>'),mediaDir=!0===agentSkillList[i].isOutbound?outboundDiv:inboundDiv,canAdd=!0}else if(5===agentSkillList[i].typeId){mediaImg=$('<div id = "vmailDivId" class="vmail" title="'+IC_Localization.voicemail+'"/>'),mediaDir=!0===agentSkillList[i].isOutbound?outboundDiv:inboundDiv,canAdd=!0}else canAdd=!1;if(canAdd){var skillNameDiv=$('<div id = "agentInfoSkillNameId" class="skillName textEllipsis" />').attr("title",agentSkillList[i].name).text(agentSkillList[i].name);agentSkill={id:i,MediaTypeId:agentSkillList[i].typeId,DirectionId:!0===agentSkillList[i].isOutbound?1:0,Name:agentSkillList[i].name,Direction:{mediaDir:mediaDir},MediaInfo:{mediaImg:mediaImg,mediaDir:mediaDir,TypeId:agentSkillList[i].typeId},SkillName:{skillNameDiv:skillNameDiv}},this.tableRow.push(agentSkill)}}this.tableRow.length>6?(this.headerCss="",this.options.container.isPopout?this.columnBorderDiv.hide():(this.mediaInfoWidth=26,this.dirInfoWidth=26,this.skillNameColWidth=78)):(this.headerCss="headerDecorationTopRight",this.options.container.isPopout?this.columnBorderDiv.showfn():(this.mediaInfoWidth=26,this.dirInfoWidth=26,this.skillNameColWidth=100)),this.setGridColumn(),document.getElementById(this.gridId)&&(IC_Validation.isNotNullOrUndefinedString(this.sortGrid.sortDir)||(this.sortGrid.sortCol="MediaInfo",this.grid.setSortColumn(this.sortGrid.sortCol,!0)),this.tableRow.sort($.proxy(this.gridSorter,this)),this.grid.setColumns(this.colModel),this.dataView.beginUpdate(),this.dataView.setItems(this.tableRow),this.dataView.endUpdate(),$(".agentInfo .skillListGrid .slick-viewport").css({height:this.gridScrollHeight+"px"})),$(".agentInfo .skillListGrid .slick-viewport").mCustomScrollbar("destroy"),this.tableRow.length>6?$(".agentInfo .skillListGrid .slick-viewport").mCustomScrollbar({scrollButtons:{enable:!0},scrollInertia:0,advanced:{autoScrollOnFocus:!1,updateOnContentResize:!0}}):$(".agentInfo .skillListGrid .slick-viewport").css({overflow:"hidden"})},updateAgentPermissionsInfo:function(){if(this.receivedPermissionsList&&IC_Validation.isNotNullOrEmpty(this.agentPermissionsInfo)){this.agentNameTxt.text(this.restrictInfo(this.checkData(this.agentPermissionsInfo.name),"AgentName"));var phNo=this.restrictInfo(this.checkData(this.agentPermissionsInfo.phNo),"PhoneNumber");this.phoneTxt.text(phNo).prop("title",phNo),this.callerTxt.text(this.restrictInfo(this.checkData(this.agentPermissionsInfo.callerId),"CallerId"))}},updateAgentInfo:function(infoList){var name,contactId="",len=void 0!==infoList.contacts?infoList.contacts.length:0;for(contacts=void 0!==infoList.contacts?infoList.contacts:null,name=infoList.fName+" "+infoList.lName,this.agentPermissionsInfo={name:name,phNo:infoList.phNo,callerId:infoList.callerId},this.agentIdTxt.text(this.checkData(infoList.id)),this.stationTxt.text(this.checkData(infoList.stationId)),this.updateAgentPermissionsInfo(),i=0;i<len;i++)"Disconnected"===infoList.contacts[i].status||infoList.contacts[i].finalState||(contactId+=infoList.contacts[i].id+"<br/>");this.contactTxt.html(this.checkData(contactId)),this.sessionTxt.text(this.checkData(infoList.sessionId)),this.agentLegTxt.text(this.checkData(infoList.lgId)),this.webServerTxt.text(this.checkData(infoList.webServer)),this.versionTxt.text(this.checkData(this.options.container.options.agentVersion))},restrictInfo:function(value,type){return(this.hideAgentPhoneNumber&&"PhoneNumber"===type||this.hideAgentCallerId&&"CallerId"===type||this.hideAgentIdentity&&"AgentName"===type)&&(value="**********"),value},checkData:function(value){return IC_Validation.isNotNullOrEmpty(value)&&"0"!==value?value:"N/A"},startTimer:function(){var that=this;this.timeOutId=setInterval(function(){that.timeTxt.text(IC_Common.getCurrentTimeLocale(that.options.container.options.localeDateTimeFormat,that.options.container.options.localeCode))},1e3)},clearTimer:function(){void 0!==this.timeOutId&&clearInterval(this.timeOutId)},closeBtnClick:function(){this.options.container.closeAgentInfoAndShowHome(),IC_Common.removeFocusFromCloseIcon(this.closeBtnIcon,"closeBtnIconFocus"),this.clearTimer()},updatePanelHeight:function(height){InfoPnlheight=height-7,this.infoPnl.css({height:InfoPnlheight+"px"})},setFocusToAgentInfoHeader:function(){this.headerPanel.trigger("focus")}})}(jQuery);