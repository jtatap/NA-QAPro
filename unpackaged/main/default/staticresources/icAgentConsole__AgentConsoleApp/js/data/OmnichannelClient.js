!function($){var logger=IC_Common.getLogger("OmnichannelClient");OmnichannelClient={container:null,isOmniChannelLoggedIn:!1,_init:function(){sforce.console.addEventListener(sforce.console.ConsoleEvent.PRESENCE.WORK_ASSIGNED,$.proxy(this.onOmniChannelWorkAssignedorClosed,this)),sforce.console.addEventListener(sforce.console.ConsoleEvent.PRESENCE.WORK_ACCEPTED,$.proxy(this.onOmniChannelWorkAcceptedorRejected,this)),sforce.console.addEventListener(sforce.console.ConsoleEvent.PRESENCE.WORK_DECLINED,$.proxy(this.onOmniChannelWorkAcceptedorRejected,this)),sforce.console.addEventListener(sforce.console.ConsoleEvent.PRESENCE.WORK_CLOSED,$.proxy(this.onOmniChannelWorkAssignedorClosed,this)),sforce.console.addEventListener(sforce.console.ConsoleEvent.PRESENCE.STATUS_CHANGED,$.proxy(this.onOmniChannelStatusChanged,this)),sforce.console.addEventListener(sforce.console.ConsoleEvent.PRESENCE.LOGOUT,$.proxy(this.onOmniChannelLogout,this))},createAgentWork:function(workItemId,serviceChannelId){logger.trace("createAgentWork >>> workItemId: "+workItemId+", serviceChannelId: "+serviceChannelId),AgentConsoleSalesforce.createAgentWork(workItemId,serviceChannelId,function(isWorkCreated){logger.trace("createAgentWork <<< isWorkCreated: "+isWorkCreated)})},onOmniChannelWorkAssignedorClosed:function(result){if(logger.debug("onOmniChannelWorkAssignedorClosed >>> result: "+JSON.stringify(result)),result&&result){var workItemContact=this.getExternalRoutingWIContact(result.workItemId,"Active");if(workItemContact)switch(result.message){case sforce.console.ConsoleEvent.PRESENCE.WORK_ASSIGNED:sforce.console.presence.acceptAgentWork(result.workId,function(response){logger.debug("sforce acceptAgentWork <<< response: "+JSON.stringify(response))});break;case sforce.console.ConsoleEvent.PRESENCE.WORK_CLOSED:this.container.endContact(workItemContact.id)}}},onOmniChannelStatusChanged:function(result){this.isOmniChannelLoggedIn=!0},onOmniChannelLogout:function(result){this.isOmniChannelLoggedIn=!1},canOmniChannelAcceptAgentWork:function(serviceChannelId,callback){this.isOmniChannelLoggedIn||callback(!1),AgentConsoleSalesforce.canOmniChannelAcceptAgentWork(serviceChannelId,function(canAccept){callback(canAccept)})},getExternalRoutingWIContact:function(workItemId,status){var contacts=AgentConsoleDataStore.getContacts(function(contact){return"WorkItemContactEvent"===contact.contactType&&contact.workItemType==IC_Util.SalesforceOmnichannelRouting&&contact.status===status&&IC_Validation.isJSON(contact.workItemPayload)&&JSON.parse(contact.workItemPayload).WorkItemId.startsWith(workItemId)});return 0==contacts.length?null:contacts[0]},onOmniChannelWorkAcceptedorRejected:function(result){if(logger.debug("onOmniChannelWorkAcceptedorRejected <<< result: "+JSON.stringify(result)),result){var workItemContact=this.getExternalRoutingWIContact(result.workItemId,"Incoming");if(workItemContact)switch(result.message){case sforce.console.ConsoleEvent.PRESENCE.WORK_ACCEPTED:this.container.acceptContact(workItemContact.id);break;case sforce.console.ConsoleEvent.PRESENCE.WORK_DECLINED:this.container.rejectContact(workItemContact.id)}}},onWorkItemAcceptedorRejected:function(contact,isRejected){logger.debug("onWorkItemAcceptedorRejected <<< contactId: "+contact.id+",isRejected: "+isRejected);var workItemPayload=JSON.parse(contact.workItemPayload);this.getAgentWork(workItemPayload.WorkItemId,function(agentWork){null!=agentWork&&(isRejected?sforce.console.presence.declineAgentWork(agentWork.workId,function(response){logger.debug("sforce declineAgentWork <<< response: "+JSON.stringify(response))}):sforce.console.presence.acceptAgentWork(agentWork.workId,function(response){logger.debug("sforce acceptAgentWork <<< response: "+JSON.stringify(response))}))})},getAgentWork:function(workItemId,callback){sforce.console.presence.getAgentWorks(function(result){var agentWork=null;if(result.success)for(var works=JSON.parse(result.works),i=0,length=works.length;i<length;i++)if(workItemId.startsWith(works[i].workItemId)){agentWork=works[i];break}callback(agentWork)})}},OmnichannelClient._init()}(jQuery);